saizhansco@instance-20260124-111940:~/myapp/trivia-api$ sudo docker-compose logs -f app
sudo docker-compose logs -f frontend
sudo docker-compose logs -f nginx
Attaching to trivia-api_app_1
app_1       | 2026/02/09 14:26:35 Загрузка конфигурации из config/config.yaml
app_1       | 2026/02/09 14:26:35 Запуск применения миграций базы данных...
app_1       | 2026/02/09 14:26:35 Применяем миграции 'up'...
app_1       | 2026/02/09 14:26:35 Миграции успешно применены.
app_1       | 2026/02/09 14:26:35 Миграции базы данных завершены.
app_1       | 2026/02/09 14:26:35 Successfully connected to Redis
app_1       | 2026/02/09 14:26:35 [TokenManager] Initializing and ensuring JWT keys...
app_1       | 2026/02/09 14:26:35 [TokenManager] Active JWT key ID: a488fda381b19b17 found in repository.
app_1       | 2026/02/09 14:26:35 [TokenManager] Access token expiry set to: 24h0m0s
app_1       | 2026/02/09 14:26:35 [TokenManager] Refresh token expiry set to: 720h0m0s
app_1       | 2026/02/09 14:26:35 [TokenManager] Max refresh tokens per user set to: 10
app_1       | 2026/02/09 14:26:35 [TokenManager] Production mode set to: true, Cookie Secure set to: true
app_1       | 2026/02/09 14:26:35 [TokenManager] Cookie attributes set: Path=/, Domain=, Secure=true, HttpOnly=true, SameSite=4
app_1       | 2026/02/09 14:26:35 Инициализация Redis PubSub для кластеризации WebSocket...
app_1       | 
app_1       | 2026/02/09 14:26:35 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [41.459ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:26:35.858' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 14:26:35 RedisPubSub provider created using existing client.
app_1       | 2026/02/09 14:26:35 Redis PubSub провайдер успешно инициализирован
app_1       | 2026/02/09 14:26:35 Получено 0 записей из invalid_tokens
app_1       | 2026/02/09 14:26:35 JWT: Loaded 0 invalidated tokens from database
app_1       | 2026/02/09 14:26:35 [TokenManager] JWTService has been set.
app_1       | 
app_1       | 2026/02/09 14:26:35 /app/internal/repository/postgres/invalid_token_repo.go:89
app_1       | [6.470ms] [rows:0] SELECT * FROM "invalid_tokens"
app_1       | 2026/02/09 14:26:35 WebSocket: инициализация ShardedHub
app_1       | 2026/02/09 14:26:35 WorkerPool: запущен пул с 8 воркерами
app_1       | 2026/02/09 14:26:35 WorkerPool: запущен пул с 8 воркерами
app_1       | 2026/02/09 14:26:35 [Шард 0] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 14:26:35 [Шард 1] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 14:26:35 [Шард 2] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 14:26:35 [Шард 3] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 14:26:35 ClusterHub: Instance ID не задан, сгенерирован: instance_20260209142635_uJy0mmmA
app_1       | 2026/02/09 14:26:35 ShardedHub создан с 4 шардами
app_1       | 2026/02/09 14:26:35 WebSocket: кластерный режим включен
app_1       | 2026/02/09 14:26:35 [QuizManager] Менеджер викторин успешно инициализирован
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 2 запущен
app_1       | 2026/02/09 14:26:35 [JWTService] Starting periodic cleanup routine every 1h0m0s
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 3 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 4 запущен
app_1       | 2026/02/09 14:26:35 RedisPubSub: Subscribing to channel 'jwt_invalidation_events'
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 5 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 6 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 7 запущен
app_1       | 2026/02/09 14:26:35 [Shard 0] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 14:26:35 [Shard 1] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 14:26:35 [Shard 2] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 14:26:35 [Shard 3] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 14:26:35 ShardedHub: запуск с 4 шардами, до 5000 клиентов на шард
app_1       | 2026/02/09 14:26:35 ClusterHub: запуск кластерного режима, ID экземпляра: instance_20260209142635_uJy0mmmA
app_1       | 2026/02/09 14:26:35 ClusterHub: Запуск публикации метрик каждые 1m0s
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 4 запущен
app_1       | 2026/02/09 14:26:35 Запуск механизма периодической очистки CSRF токенов и истекших refresh-токенов (каждый час)
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 0 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 1 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 2 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 3 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 7 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 5 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 6 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 1 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 0 запущен
app_1       | 2026/02/09 14:26:35 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:ready
app_1       | 2026/02/09 14:26:35 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:answer
app_1       | 2026/02/09 14:26:35 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:heartbeat
app_1       | 2026/02/09 14:26:35 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:resync
app_1       | 2026/02/09 14:26:35 Server started on port 8080
app_1       | 2026/02/09 14:26:35 Starting server on port 8080
app_1       | 2026/02/09 14:26:35 RedisPubSub: Successfully subscribed to channel 'jwt_invalidation_events'
app_1       | 2026/02/09 14:26:35 [JWTService] Успешно подписан на канал jwt_invalidation_events для синхронизации кэша.
app_1       | 2026/02/09 14:26:35 RedisPubSub: Subscribing to channel 'ws:broadcast'
app_1       | 2026/02/09 14:26:35 RedisPubSub: Successfully subscribed to channel 'ws:broadcast'
app_1       | 2026/02/09 14:26:35 ClusterHub: начата обработка широковещательных сообщений
app_1       | 2026/02/09 14:26:35 RedisPubSub: Subscribing to channel 'ws:direct'
app_1       | 2026/02/09 14:26:35 RedisPubSub: Successfully subscribed to channel 'ws:direct'
app_1       | 2026/02/09 14:26:35 [ClusterHub:Direct] Успешно подписан на канал прямых сообщений: ws:direct
app_1       | 2026/02/09 14:26:35 RedisPubSub: Subscribing to channel 'ws:metrics'
app_1       | 
app_1       | 2026/02/09 14:26:35 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [17.683ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:26:35.919' ORDER BY scheduled_time
app_1       | 2026/02/09 14:26:35 RedisPubSub: Successfully subscribed to channel 'ws:metrics'
app_1       | 2026/02/09 14:26:35 [ClusterHub:Metrics] Успешно подписан на канал метрик: ws:metrics
app_1       | 2026/02/09 14:27:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:28:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:29:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:30:14 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.376ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:30:14.261' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:30:14 | 200 |    2.100932ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | [GIN] 2026/02/09 - 14:30:14 | 401 |     131.521µs |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/user_repo.go:46
app_1       | [4.805ms] [rows:1] SELECT * FROM "users" WHERE email = 'temirlan@mail.ru' ORDER BY "users"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/user_repo.go:33
app_1       | [1.539ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 14:30:25 [JWT] Токен доступа успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.084ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:30:25.408' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/refresh_token_repo.go:32
app_1       | [8.400ms] [rows:1] INSERT INTO "refresh_tokens" ("user_id","token","device_id","ip_address","user_agent","expires_at","created_at","is_expired","revoked_at","reason") VALUES (1,'ce3c926b57be941c99c54e22c7816c2ca70023056f646befb1c2c19bf9a53010','Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36','172.18.0.6','Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36','2026-03-11 14:30:25.41','2026-02-09 14:30:25.41',false,NULL,'') RETURNING "id"
app_1       | 2026/02/09 14:30:25 [TokenManager] Сгенерирована пара токенов для пользователя ID=1, JWT Key ID: a488fda381b19b17
app_1       | 2026/02/09 14:30:25 JWT: UserID: 1 was not in the invalidation list
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/refresh_token_repo.go:159
app_1       | [2.442ms] [rows:1] SELECT count(*) FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:30:25.418'
app_1       | 2026/02/09 14:30:25 Запись в invalid_tokens для пользователя ID=1 не найдена
app_1       | 2026/02/09 14:30:25 [AuthService] Пользователь ID=1 (temirlan@mail.ru) успешно вошел в систему
app_1       | 2026/02/09 14:30:25 [TokenManager] Установлена CSRF secret cookie (__Host-csrf-secret) с Secure=true, MaxAge: 86400 секунд
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/invalid_token_repo.go:46
app_1       | [1.989ms] [rows:0] DELETE FROM "invalid_tokens" WHERE "invalid_tokens"."user_id" = 1
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.894ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:30:25 | 200 |  104.775182ms |      172.18.0.6 | POST     "/api/auth/login"
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.632ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:25.56') OR (is_active = false AND rotated_at > '2026-02-02 14:30:25.56' AND expires_at > '2026-02-09 14:30:25.56') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:30:25 | 200 |    2.117411ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:30:25 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 2026/02/09 14:30:25 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.828ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:30:25.575' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:30:25 | 200 |    1.043752ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:30:27 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.199ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:30:27.382' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:30:27 | 200 |    1.442233ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:30:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.283ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:27.383') OR (is_active = false AND rotated_at > '2026-02-02 14:30:27.383' AND expires_at > '2026-02-09 14:30:27.383') ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:27 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.795ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:30:27 | 200 |    3.060649ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:30:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.804ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:27.517') OR (is_active = false AND rotated_at > '2026-02-02 14:30:27.517' AND expires_at > '2026-02-09 14:30:27.517') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:30:27 | 200 |    1.173735ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:30:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 2026/02/09 14:30:27 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:30:28 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.260ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:28.532') OR (is_active = false AND rotated_at > '2026-02-02 14:30:28.532' AND expires_at > '2026-02-09 14:30:28.532') ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:28 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:28 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [2.213ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:30:28.534' ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:28 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | [GIN] 2026/02/09 - 14:30:28 | 200 |    4.300933ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 14:30:34 /app/internal/repository/postgres/user_repo.go:179
app_1       | [0.892ms] [rows:1] SELECT count(*) FROM "users"
app_1       | 
app_1       | 2026/02/09 14:30:34 /app/internal/repository/postgres/user_repo.go:191
app_1       | [1.174ms] [rows:10] SELECT "id","username","profile_picture","wins_count","total_prize_won" FROM "users" ORDER BY wins_count DESC, total_prize_won DESC, id ASC LIMIT 10
app_1       | [GIN] 2026/02/09 - 14:30:34 | 200 |    3.364433ms |      172.18.0.6 | GET      "/api/leaderboard?page=1&page_size=10"
app_1       | 2026/02/09 14:30:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:30:36 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.418ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:36.077') OR (is_active = false AND rotated_at > '2026-02-02 14:30:36.077' AND expires_at > '2026-02-09 14:30:36.077') ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:36 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:36 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [1.595ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:30:36.079' ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:30:36 | 200 |    3.862745ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 2026/02/09 14:30:36 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | 2026/02/09 14:30:36 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:36 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.315ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:36.992') OR (is_active = false AND rotated_at > '2026-02-02 14:30:36.992' AND expires_at > '2026-02-09 14:30:36.992') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:30:36 /app/internal/repository/postgres/result_repo.go:119
app_1       | [3.923ms] [rows:1] SELECT count(*) FROM "results" WHERE user_id = 1
app_1       | 
app_1       | 2026/02/09 14:30:37 /app/internal/repository/postgres/result_repo.go:128
app_1       | [1.712ms] [rows:9] SELECT * FROM "results" WHERE user_id = 1 ORDER BY created_at DESC LIMIT 10
app_1       | [GIN] 2026/02/09 - 14:30:37 | 200 |    7.936192ms |      172.18.0.6 | GET      "/api/users/me/results?page=1&page_size=10"
app_1       | 
app_1       | 2026/02/09 14:30:38 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.160ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:30:38.362' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:30:38 | 200 |    1.465849ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 2026/02/09 14:30:39 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:39 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.016ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:39.302') OR (is_active = false AND rotated_at > '2026-02-02 14:30:39.302' AND expires_at > '2026-02-09 14:30:39.302') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:30:39 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [1.608ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:30:39.304' ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:39 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | [GIN] 2026/02/09 - 14:30:39 | 200 |    3.314486ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 14:30:41 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [3.353ms] [rows:29] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:30:41 | 200 |    3.924484ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.642ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:47.558') OR (is_active = false AND rotated_at > '2026-02-02 14:30:47.558' AND expires_at > '2026-02-09 14:30:47.558') ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:47 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:188
app_1       | [9.720ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:193
app_1       | [2.260ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:202
app_1       | [1.583ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 1
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:202
app_1       | [3.037ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 2
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:202
app_1       | [2.203ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 3
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:202
app_1       | [0.874ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 4
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:202
app_1       | [0.757ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 5
app_1       | [GIN] 2026/02/09 - 14:30:47 | 200 |   25.035695ms |      172.18.0.6 | GET      "/api/admin/question-pool/stats"
app_1       | 
app_1       | 2026/02/09 14:30:59 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.990ms] [rows:29] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:30:59 | 200 |     3.35556ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 14:31:35 [Shard 2] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:31:35 [Shard 0] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:31:35 [Shard 1] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:31:35 [Shard 3] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:31:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:31:42 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:31:42 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.877ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:31:42.976') OR (is_active = false AND rotated_at > '2026-02-02 14:31:42.976' AND expires_at > '2026-02-09 14:31:42.976') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:31:42 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.854ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:31:42 | 200 |    2.337131ms |      172.18.0.6 | GET      "/api/users/me"
^CERROR: Aborting.
Attaching to trivia-api_frontend_1
frontend_1  | ▲ Next.js 16.1.4
frontend_1  | - Local:         http://localhost:3000
frontend_1  | - Network:       http://0.0.0.0:3000
frontend_1  | 
frontend_1  | ✓ Starting...
frontend_1  | ✓ Ready in 531ms

sudo docker-compose logs -f
^CERROR: Aborting.
^CTraceback (most recent call last):
  File "/usr/bin/docker-compose", line 10, in <module>
    from importlib.metadata import distribution
  File "/usr/lib/python3.10/importlib/metadata/__init__.py", line 17, in <module>
    from . import _adapters, _meta
  File "/usr/lib/python3.10/importlib/metadata/_adapters.py", line 3, in <module>
    import email.message
  File "/usr/lib/python3.10/email/message.py", line 15, in <module>
    from email import utils
  File "/usr/lib/python3.10/email/utils.py", line 33, in <module>
    from email._parseaddr import quote
  File "/usr/lib/python3.10/email/_parseaddr.py", line 16, in <module>
    import time, calendar
  File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1006, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 688, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 879, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1012, in get_code
  File "<frozen importlib._bootstrap_external>", line 672, in _compile_bytecode
KeyboardInterrupt

saizhansco@instance-20260124-111940:~/myapp/trivia-api$ sudo docker-compose logs -f
Attaching to trivia-api_nginx_1, trivia-api_app_1, trivia-api_postgres_1, trivia-api_frontend_1, trivia-api_redis_1
app_1       | 2026/02/09 14:26:35 Загрузка конфигурации из config/config.yaml
app_1       | 2026/02/09 14:26:35 Запуск применения миграций базы данных...
app_1       | 2026/02/09 14:26:35 Применяем миграции 'up'...
app_1       | 2026/02/09 14:26:35 Миграции успешно применены.
app_1       | 2026/02/09 14:26:35 Миграции базы данных завершены.
app_1       | 2026/02/09 14:26:35 Successfully connected to Redis
app_1       | 2026/02/09 14:26:35 [TokenManager] Initializing and ensuring JWT keys...
app_1       | 2026/02/09 14:26:35 [TokenManager] Active JWT key ID: a488fda381b19b17 found in repository.
app_1       | 2026/02/09 14:26:35 [TokenManager] Access token expiry set to: 24h0m0s
app_1       | 2026/02/09 14:26:35 [TokenManager] Refresh token expiry set to: 720h0m0s
app_1       | 2026/02/09 14:26:35 [TokenManager] Max refresh tokens per user set to: 10
app_1       | 2026/02/09 14:26:35 [TokenManager] Production mode set to: true, Cookie Secure set to: true
app_1       | 2026/02/09 14:26:35 [TokenManager] Cookie attributes set: Path=/, Domain=, Secure=true, HttpOnly=true, SameSite=4
app_1       | 2026/02/09 14:26:35 Инициализация Redis PubSub для кластеризации WebSocket...
app_1       | 
app_1       | 2026/02/09 14:26:35 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [41.459ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:26:35.858' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 14:26:35 RedisPubSub provider created using existing client.
app_1       | 2026/02/09 14:26:35 Redis PubSub провайдер успешно инициализирован
app_1       | 2026/02/09 14:26:35 Получено 0 записей из invalid_tokens
app_1       | 2026/02/09 14:26:35 JWT: Loaded 0 invalidated tokens from database
app_1       | 2026/02/09 14:26:35 [TokenManager] JWTService has been set.
app_1       | 
app_1       | 2026/02/09 14:26:35 /app/internal/repository/postgres/invalid_token_repo.go:89
app_1       | [6.470ms] [rows:0] SELECT * FROM "invalid_tokens"
app_1       | 2026/02/09 14:26:35 WebSocket: инициализация ShardedHub
app_1       | 2026/02/09 14:26:35 WorkerPool: запущен пул с 8 воркерами
app_1       | 2026/02/09 14:26:35 WorkerPool: запущен пул с 8 воркерами
app_1       | 2026/02/09 14:26:35 [Шард 0] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 14:26:35 [Шард 1] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 14:26:35 [Шард 2] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 14:26:35 [Шард 3] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 14:26:35 ClusterHub: Instance ID не задан, сгенерирован: instance_20260209142635_uJy0mmmA
app_1       | 2026/02/09 14:26:35 ShardedHub создан с 4 шардами
app_1       | 2026/02/09 14:26:35 WebSocket: кластерный режим включен
app_1       | 2026/02/09 14:26:35 [QuizManager] Менеджер викторин успешно инициализирован
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 2 запущен
app_1       | 2026/02/09 14:26:35 [JWTService] Starting periodic cleanup routine every 1h0m0s
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 3 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 4 запущен
app_1       | 2026/02/09 14:26:35 RedisPubSub: Subscribing to channel 'jwt_invalidation_events'
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 5 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 6 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 7 запущен
app_1       | 2026/02/09 14:26:35 [Shard 0] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 14:26:35 [Shard 1] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 14:26:35 [Shard 2] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 14:26:35 [Shard 3] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 14:26:35 ShardedHub: запуск с 4 шардами, до 5000 клиентов на шард
app_1       | 2026/02/09 14:26:35 ClusterHub: запуск кластерного режима, ID экземпляра: instance_20260209142635_uJy0mmmA
app_1       | 2026/02/09 14:26:35 ClusterHub: Запуск публикации метрик каждые 1m0s
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 4 запущен
app_1       | 2026/02/09 14:26:35 Запуск механизма периодической очистки CSRF токенов и истекших refresh-токенов (каждый час)
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 0 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 1 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 2 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 3 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 7 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 5 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 6 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 1 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 0 запущен
app_1       | 2026/02/09 14:26:35 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:ready
frontend_1  | ▲ Next.js 16.1.4
frontend_1  | - Local:         http://localhost:3000
frontend_1  | - Network:       http://0.0.0.0:3000
frontend_1  | 
frontend_1  | ✓ Starting...
frontend_1  | ✓ Ready in 531ms
app_1       | 2026/02/09 14:26:35 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:answer
app_1       | 2026/02/09 14:26:35 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:heartbeat
app_1       | 2026/02/09 14:26:35 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:resync
app_1       | 2026/02/09 14:26:35 Server started on port 8080
app_1       | 2026/02/09 14:26:35 Starting server on port 8080
app_1       | 2026/02/09 14:26:35 RedisPubSub: Successfully subscribed to channel 'jwt_invalidation_events'
app_1       | 2026/02/09 14:26:35 [JWTService] Успешно подписан на канал jwt_invalidation_events для синхронизации кэша.
app_1       | 2026/02/09 14:26:35 RedisPubSub: Subscribing to channel 'ws:broadcast'
app_1       | 2026/02/09 14:26:35 RedisPubSub: Successfully subscribed to channel 'ws:broadcast'
app_1       | 2026/02/09 14:26:35 ClusterHub: начата обработка широковещательных сообщений
app_1       | 2026/02/09 14:26:35 RedisPubSub: Subscribing to channel 'ws:direct'
app_1       | 2026/02/09 14:26:35 RedisPubSub: Successfully subscribed to channel 'ws:direct'
app_1       | 2026/02/09 14:26:35 [ClusterHub:Direct] Успешно подписан на канал прямых сообщений: ws:direct
app_1       | 2026/02/09 14:26:35 RedisPubSub: Subscribing to channel 'ws:metrics'
app_1       | 
app_1       | 2026/02/09 14:26:35 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [17.683ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:26:35.919' ORDER BY scheduled_time
app_1       | 2026/02/09 14:26:35 RedisPubSub: Successfully subscribed to channel 'ws:metrics'
app_1       | 2026/02/09 14:26:35 [ClusterHub:Metrics] Успешно подписан на канал метрик: ws:metrics
app_1       | 2026/02/09 14:27:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:28:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:29:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:30:14 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.376ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:30:14.261' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:30:14 | 200 |    2.100932ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | [GIN] 2026/02/09 - 14:30:14 | 401 |     131.521µs |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/user_repo.go:46
app_1       | [4.805ms] [rows:1] SELECT * FROM "users" WHERE email = 'temirlan@mail.ru' ORDER BY "users"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/user_repo.go:33
app_1       | [1.539ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 14:30:25 [JWT] Токен доступа успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.084ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:30:25.408' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/refresh_token_repo.go:32
app_1       | [8.400ms] [rows:1] INSERT INTO "refresh_tokens" ("user_id","token","device_id","ip_address","user_agent","expires_at","created_at","is_expired","revoked_at","reason") VALUES (1,'ce3c926b57be941c99c54e22c7816c2ca70023056f646befb1c2c19bf9a53010','Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36','172.18.0.6','Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36','2026-03-11 14:30:25.41','2026-02-09 14:30:25.41',false,NULL,'') RETURNING "id"
app_1       | 2026/02/09 14:30:25 [TokenManager] Сгенерирована пара токенов для пользователя ID=1, JWT Key ID: a488fda381b19b17
app_1       | 2026/02/09 14:30:25 JWT: UserID: 1 was not in the invalidation list
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/refresh_token_repo.go:159
app_1       | [2.442ms] [rows:1] SELECT count(*) FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:30:25.418'
app_1       | 2026/02/09 14:30:25 Запись в invalid_tokens для пользователя ID=1 не найдена
app_1       | 2026/02/09 14:30:25 [AuthService] Пользователь ID=1 (temirlan@mail.ru) успешно вошел в систему
app_1       | 2026/02/09 14:30:25 [TokenManager] Установлена CSRF secret cookie (__Host-csrf-secret) с Secure=true, MaxAge: 86400 секунд
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/invalid_token_repo.go:46
app_1       | [1.989ms] [rows:0] DELETE FROM "invalid_tokens" WHERE "invalid_tokens"."user_id" = 1
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.894ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:30:25 | 200 |  104.775182ms |      172.18.0.6 | POST     "/api/auth/login"
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.632ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:25.56') OR (is_active = false AND rotated_at > '2026-02-02 14:30:25.56' AND expires_at > '2026-02-09 14:30:25.56') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:30:25 | 200 |    2.117411ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:30:25 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 2026/02/09 14:30:25 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.828ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:30:25.575' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:30:25 | 200 |    1.043752ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:30:27 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.199ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:30:27.382' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:30:27 | 200 |    1.442233ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:30:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.283ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:27.383') OR (is_active = false AND rotated_at > '2026-02-02 14:30:27.383' AND expires_at > '2026-02-09 14:30:27.383') ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:27 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.795ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:30:27 | 200 |    3.060649ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:30:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.804ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:27.517') OR (is_active = false AND rotated_at > '2026-02-02 14:30:27.517' AND expires_at > '2026-02-09 14:30:27.517') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:30:27 | 200 |    1.173735ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:30:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 2026/02/09 14:30:27 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:30:28 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.260ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:28.532') OR (is_active = false AND rotated_at > '2026-02-02 14:30:28.532' AND expires_at > '2026-02-09 14:30:28.532') ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:28 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:28 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [2.213ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:30:28.534' ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:28 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | [GIN] 2026/02/09 - 14:30:28 | 200 |    4.300933ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 14:30:34 /app/internal/repository/postgres/user_repo.go:179
app_1       | [0.892ms] [rows:1] SELECT count(*) FROM "users"
postgres_1  | 
postgres_1  | PostgreSQL Database directory appears to contain a database; Skipping initialization
postgres_1  | 
postgres_1  | 2026-02-09 14:26:35.306 UTC [1] LOG:  starting PostgreSQL 13.23 on x86_64-pc-linux-musl, compiled by gcc (Alpine 14.2.0) 14.2.0, 64-bit
postgres_1  | 2026-02-09 14:26:35.307 UTC [1] LOG:  listening on IPv4 address "0.0.0.0", port 5432
postgres_1  | 2026-02-09 14:26:35.307 UTC [1] LOG:  listening on IPv6 address "::", port 5432
postgres_1  | 2026-02-09 14:26:35.313 UTC [1] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
postgres_1  | 2026-02-09 14:26:35.327 UTC [26] LOG:  database system was shut down at 2026-02-09 14:23:01 UTC
postgres_1  | 2026-02-09 14:26:35.377 UTC [1] LOG:  database system is ready to accept connections
app_1       | 
app_1       | 2026/02/09 14:30:34 /app/internal/repository/postgres/user_repo.go:191
app_1       | [1.174ms] [rows:10] SELECT "id","username","profile_picture","wins_count","total_prize_won" FROM "users" ORDER BY wins_count DESC, total_prize_won DESC, id ASC LIMIT 10
app_1       | [GIN] 2026/02/09 - 14:30:34 | 200 |    3.364433ms |      172.18.0.6 | GET      "/api/leaderboard?page=1&page_size=10"
app_1       | 2026/02/09 14:30:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:30:36 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.418ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:36.077') OR (is_active = false AND rotated_at > '2026-02-02 14:30:36.077' AND expires_at > '2026-02-09 14:30:36.077') ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:36 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:36 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [1.595ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:30:36.079' ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:30:36 | 200 |    3.862745ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 2026/02/09 14:30:36 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | 2026/02/09 14:30:36 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:36 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.315ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:36.992') OR (is_active = false AND rotated_at > '2026-02-02 14:30:36.992' AND expires_at > '2026-02-09 14:30:36.992') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:30:36 /app/internal/repository/postgres/result_repo.go:119
app_1       | [3.923ms] [rows:1] SELECT count(*) FROM "results" WHERE user_id = 1
app_1       | 
app_1       | 2026/02/09 14:30:37 /app/internal/repository/postgres/result_repo.go:128
app_1       | [1.712ms] [rows:9] SELECT * FROM "results" WHERE user_id = 1 ORDER BY created_at DESC LIMIT 10
app_1       | [GIN] 2026/02/09 - 14:30:37 | 200 |    7.936192ms |      172.18.0.6 | GET      "/api/users/me/results?page=1&page_size=10"
app_1       | 
app_1       | 2026/02/09 14:30:38 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.160ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:30:38.362' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:30:38 | 200 |    1.465849ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 2026/02/09 14:30:39 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:39 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.016ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:39.302') OR (is_active = false AND rotated_at > '2026-02-02 14:30:39.302' AND expires_at > '2026-02-09 14:30:39.302') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:30:39 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [1.608ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:30:39.304' ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:39 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | [GIN] 2026/02/09 - 14:30:39 | 200 |    3.314486ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 14:30:41 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [3.353ms] [rows:29] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:30:41 | 200 |    3.924484ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.642ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:47.558') OR (is_active = false AND rotated_at > '2026-02-02 14:30:47.558' AND expires_at > '2026-02-09 14:30:47.558') ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:47 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:188
app_1       | [9.720ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:193
app_1       | [2.260ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:202
app_1       | [1.583ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 1
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:202
app_1       | [3.037ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 2
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:202
app_1       | [2.203ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 3
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:202
app_1       | [0.874ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 4
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:202
app_1       | [0.757ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 5
app_1       | [GIN] 2026/02/09 - 14:30:47 | 200 |   25.035695ms |      172.18.0.6 | GET      "/api/admin/question-pool/stats"
app_1       | 
app_1       | 2026/02/09 14:30:59 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.990ms] [rows:29] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:30:59 | 200 |     3.35556ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 14:31:35 [Shard 2] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:31:35 [Shard 0] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:31:35 [Shard 1] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:31:35 [Shard 3] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:31:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:31:42 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:31:42 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.877ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:31:42.976') OR (is_active = false AND rotated_at > '2026-02-02 14:31:42.976' AND expires_at > '2026-02-09 14:31:42.976') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:31:42 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.854ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:31:42 | 200 |    2.337131ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:32:13 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.917ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:32:13.983') OR (is_active = false AND rotated_at > '2026-02-02 14:32:13.983' AND expires_at > '2026-02-09 14:32:13.983') ORDER BY created_at DESC
app_1       | 2026/02/09 14:32:13 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:32:13 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.573ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:32:13 | 200 |    2.063629ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:32:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:33:03 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.000ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:33:03.813') OR (is_active = false AND rotated_at > '2026-02-02 14:33:03.813' AND expires_at > '2026-02-09 14:33:03.813') ORDER BY created_at DESC
app_1       | 2026/02/09 14:33:03 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:33:03 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.778ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:33:03 | 200 |    2.527173ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:33:12 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.343ms] [rows:29] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:33:12 | 200 |    1.932128ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 14:33:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:33:36 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.068ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:33:36.212' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:33:36 | 200 |     1.27817ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:33:37 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.387ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:33:37.681') OR (is_active = false AND rotated_at > '2026-02-02 14:33:37.681' AND expires_at > '2026-02-09 14:33:37.681') ORDER BY created_at DESC
app_1       | 2026/02/09 14:33:37 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:33:37 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [1.679ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:33:37.683' ORDER BY created_at DESC
app_1       | 2026/02/09 14:33:37 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | [GIN] 2026/02/09 - 14:33:37 | 200 |    3.964902ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 14:33:39 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.960ms] [rows:29] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:33:39 | 200 |    2.731006ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 14:34:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:34:59 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [103.389ms] [rows:10] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 25
app_1       | 
app_1       | 2026/02/09 14:34:59 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [105.888ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 25 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:34:59 | 200 |  106.242519ms |      172.18.0.6 | GET      "/api/quizzes/25/with-questions"
app_1       | 2026/02/09 14:34:59 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:34:59 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.118ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:34:59.879') OR (is_active = false AND rotated_at > '2026-02-02 14:34:59.879' AND expires_at > '2026-02-09 14:34:59.879') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:34:59 /app/internal/repository/postgres/quiz_ad_slot_repo.go:38
app_1       | [11.093ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 25 ORDER BY question_after ASC
app_1       | [GIN] 2026/02/09 - 14:34:59 | 200 |   13.162936ms |      172.18.0.6 | GET      "/api/quizzes/25/ad-slots"
app_1       | 
app_1       | 2026/02/09 14:34:59 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [20.359ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:34:59.884') OR (is_active = false AND rotated_at > '2026-02-02 14:34:59.884' AND expires_at > '2026-02-09 14:34:59.884') ORDER BY created_at DESC
app_1       | 2026/02/09 14:34:59 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:34:59 /app/internal/repository/postgres/ad_asset_repo.go:35
app_1       | [8.646ms] [rows:0] SELECT * FROM "ad_assets" ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:34:59 | 200 |   29.976498ms |      172.18.0.6 | GET      "/api/admin/ads"
app_1       | 
app_1       | 2026/02/09 14:35:00 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [6.022ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:35:00.319' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:35:00 | 200 |    6.237635ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:35:04 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.236ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:35:04.482' ORDER BY scheduled_time
redis_1     | Starting Redis Server
redis_1     | 1:C 09 Feb 2026 14:26:35.058 * oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
redis_1     | 1:C 09 Feb 2026 14:26:35.058 * Redis version=8.4.0, bits=64, commit=00000000, modified=1, pid=1, just started
redis_1     | 1:C 09 Feb 2026 14:26:35.058 * Configuration loaded
redis_1     | 1:M 09 Feb 2026 14:26:35.061 * monotonic clock: POSIX clock_gettime
redis_1     | 1:M 09 Feb 2026 14:26:35.069 * Running mode=standalone, port=6379.
redis_1     | 1:M 09 Feb 2026 14:26:35.079 * <bf> RedisBloom version 8.4.0 (Git=unknown)
redis_1     | 1:M 09 Feb 2026 14:26:35.079 * <bf> Registering configuration options: [
redis_1     | 1:M 09 Feb 2026 14:26:35.079 * <bf>       { bf-error-rate       :      0.01 }
redis_1     | 1:M 09 Feb 2026 14:26:35.079 * <bf>       { bf-initial-size     :       100 }
redis_1     | 1:M 09 Feb 2026 14:26:35.079 * <bf>       { bf-expansion-factor :         2 }
redis_1     | 1:M 09 Feb 2026 14:26:35.079 * <bf>       { cf-bucket-size      :         2 }
redis_1     | 1:M 09 Feb 2026 14:26:35.079 * <bf>       { cf-initial-size     :      1024 }
redis_1     | 1:M 09 Feb 2026 14:26:35.079 * <bf>       { cf-max-iterations   :        20 }
redis_1     | 1:M 09 Feb 2026 14:26:35.079 * <bf>       { cf-expansion-factor :         1 }
redis_1     | 1:M 09 Feb 2026 14:26:35.079 * <bf>       { cf-max-expansions   :        32 }
redis_1     | 1:M 09 Feb 2026 14:26:35.079 * <bf> ]
redis_1     | 1:M 09 Feb 2026 14:26:35.080 * Module 'bf' loaded from /usr/local/lib/redis/modules//redisbloom.so
redis_1     | 1:M 09 Feb 2026 14:26:35.119 * <search> Redis version found by RedisSearch : 8.4.0 - oss
redis_1     | 1:M 09 Feb 2026 14:26:35.119 * <search> RediSearch version 8.4.2 (Git=9e2b676)
redis_1     | 1:M 09 Feb 2026 14:26:35.119 * <search> Low level api version 1 initialized successfully
redis_1     | 1:M 09 Feb 2026 14:26:35.120 * <search> gc: ON, prefix min length: 2, min word length to stem: 4, prefix max expansions: 200, query timeout (ms): 500, timeout policy: return, oom policy: return, cursor read size: 1000, cursor max idle (ms): 300000, max doctable size: 1000000, max number of search results:  1000000, default scorer: BM25STD, 
redis_1     | 1:M 09 Feb 2026 14:26:35.121 * <search> Initialized thread pools!
redis_1     | 1:M 09 Feb 2026 14:26:35.121 * <search> Disabled workers threadpool of size 0
redis_1     | 1:M 09 Feb 2026 14:26:35.121 * <search> Subscribe to config changes
redis_1     | 1:M 09 Feb 2026 14:26:35.121 * <search> Subscribe to cluster slot migration events
redis_1     | 1:M 09 Feb 2026 14:26:35.121 * <search> Enabled role change notification
redis_1     | 1:M 09 Feb 2026 14:26:35.122 * <search> Cluster configuration: AUTO partitions, type: 0, coordinator timeout: 0ms
redis_1     | 1:M 09 Feb 2026 14:26:35.122 * <search> Register write commands
redis_1     | 1:M 09 Feb 2026 14:26:35.123 * Module 'search' loaded from /usr/local/lib/redis/modules//redisearch.so
redis_1     | 1:M 09 Feb 2026 14:26:35.127 * <timeseries> RedisTimeSeries version 80400, git_sha=3520a1568ad69076d60885c70711fbdc9b448749
redis_1     | 1:M 09 Feb 2026 14:26:35.127 * <timeseries> Redis version found by RedisTimeSeries : 8.4.0 - oss
redis_1     | 1:M 09 Feb 2026 14:26:35.127 * <timeseries> Registering configuration options: [
redis_1     | 1:M 09 Feb 2026 14:26:35.128 * <timeseries>       { ts-compaction-policy   :              }
redis_1     | 1:M 09 Feb 2026 14:26:35.128 * <timeseries>       { ts-num-threads         :            3 }
redis_1     | 1:M 09 Feb 2026 14:26:35.128 * <timeseries>       { ts-retention-policy    :            0 }
redis_1     | 1:M 09 Feb 2026 14:26:35.128 * <timeseries>       { ts-duplicate-policy    :        block }
redis_1     | 1:M 09 Feb 2026 14:26:35.128 * <timeseries>       { ts-chunk-size-bytes    :         4096 }
redis_1     | 1:M 09 Feb 2026 14:26:35.128 * <timeseries>       { ts-encoding            :   compressed }
redis_1     | 1:M 09 Feb 2026 14:26:35.128 * <timeseries>       { ts-ignore-max-time-diff:            0 }
redis_1     | 1:M 09 Feb 2026 14:26:35.128 * <timeseries>       { ts-ignore-max-val-diff :     0.000000 }
redis_1     | 1:M 09 Feb 2026 14:26:35.128 * <timeseries> ]
redis_1     | 1:M 09 Feb 2026 14:26:35.129 * <timeseries> Detected redis oss
redis_1     | 1:M 09 Feb 2026 14:26:35.132 * <timeseries> Subscribe to ASM events
redis_1     | 1:M 09 Feb 2026 14:26:35.133 * <timeseries> Enabled diskless replication
redis_1     | 1:M 09 Feb 2026 14:26:35.133 * Module 'timeseries' loaded from /usr/local/lib/redis/modules//redistimeseries.so
redis_1     | 1:M 09 Feb 2026 14:26:35.142 * <ReJSON> Created new data type 'ReJSON-RL'
redis_1     | 1:M 09 Feb 2026 14:26:35.148 * <ReJSON> version: 80400 git sha: unknown branch: unknown
redis_1     | 1:M 09 Feb 2026 14:26:35.148 * <ReJSON> Exported RedisJSON_V1 API
redis_1     | 1:M 09 Feb 2026 14:26:35.148 * <ReJSON> Exported RedisJSON_V2 API
redis_1     | 1:M 09 Feb 2026 14:26:35.148 * <ReJSON> Exported RedisJSON_V3 API
redis_1     | 1:M 09 Feb 2026 14:26:35.148 * <ReJSON> Exported RedisJSON_V4 API
redis_1     | 1:M 09 Feb 2026 14:26:35.148 * <ReJSON> Exported RedisJSON_V5 API
redis_1     | 1:M 09 Feb 2026 14:26:35.148 * <ReJSON> Exported RedisJSON_V6 API
redis_1     | 1:M 09 Feb 2026 14:26:35.148 * <ReJSON> Enabled diskless replication
redis_1     | 1:M 09 Feb 2026 14:26:35.148 * <ReJSON> Initialized shared string cache, thread safe: true.
redis_1     | 1:M 09 Feb 2026 14:26:35.148 * Module 'ReJSON' loaded from /usr/local/lib/redis/modules//rejson.so
redis_1     | 1:M 09 Feb 2026 14:26:35.148 * <search> Acquired RedisJSON_V6 API
redis_1     | 1:M 09 Feb 2026 14:26:35.149 * Server initialized
redis_1     | 1:M 09 Feb 2026 14:26:35.149 * <search> Loading event starts
redis_1     | 1:M 09 Feb 2026 14:26:35.149 * <search> Changing workers threadpool size from 0 to 4
redis_1     | 1:M 09 Feb 2026 14:26:35.149 * <search> Enabled workers threadpool of size 4
redis_1     | 1:M 09 Feb 2026 14:26:35.149 * Loading RDB produced by version 8.4.0
redis_1     | 1:M 09 Feb 2026 14:26:35.149 * RDB age 214 seconds
redis_1     | 1:M 09 Feb 2026 14:26:35.149 * RDB memory usage when created 1.19 Mb
redis_1     | 1:M 09 Feb 2026 14:26:35.149 * Done loading RDB, keys loaded: 0, keys expired: 0.
redis_1     | 1:M 09 Feb 2026 14:26:35.149 * <search> Changing workers threadpool size from 4 to 0
redis_1     | 1:M 09 Feb 2026 14:26:35.149 * <search> Disabled workers threadpool of size 4
redis_1     | 1:M 09 Feb 2026 14:26:35.149 * <search> Loading event ends
redis_1     | 1:M 09 Feb 2026 14:26:35.149 * DB loaded from disk: 0.000 seconds
redis_1     | 1:M 09 Feb 2026 14:26:35.149 * Ready to accept connections tcp
app_1       | [GIN] 2026/02/09 - 14:35:04 | 200 |    1.440536ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:35:04 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.196ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:35:04.493') OR (is_active = false AND rotated_at > '2026-02-02 14:35:04.493' AND expires_at > '2026-02-09 14:35:04.493') ORDER BY created_at DESC
app_1       | 2026/02/09 14:35:04 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:35:04 /app/internal/repository/postgres/user_repo.go:33
app_1       | [5.111ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:35:04 | 200 |    7.215956ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:35:04 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 2026/02/09 14:35:04 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:35:04 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.921ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:35:04.66') OR (is_active = false AND rotated_at > '2026-02-02 14:35:04.66' AND expires_at > '2026-02-09 14:35:04.66') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:35:04 | 200 |    1.359947ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:35:11 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 2026/02/09 14:35:11 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:35:11 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.579ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:35:11.425') OR (is_active = false AND rotated_at > '2026-02-02 14:35:11.425' AND expires_at > '2026-02-09 14:35:11.425') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:35:11 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.238ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:35:11.427') OR (is_active = false AND rotated_at > '2026-02-02 14:35:11.427' AND expires_at > '2026-02-09 14:35:11.427') ORDER BY created_at DESC
app_1       | 2026/02/09 14:35:11 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:35:11 /app/internal/repository/postgres/refresh_token_repo.go:112
app_1       | [5.092ms] [rows:1] UPDATE "refresh_tokens" SET "expires_at"='2026-02-09 13:35:11.429' WHERE token = 'ce3c926b57be941c99c54e22c7816c2ca70023056f646befb1c2c19bf9a53010'
app_1       | 2026/02/09 14:35:11 [TokenManager] Отозван refresh-токен
app_1       | 2026/02/09 14:35:11 [AuthService] Refresh токен успешно отозван
app_1       | 2026/02/09 14:35:11 [AuthHandler] Logout: User logged out successfully.
app_1       | [GIN] 2026/02/09 - 14:35:11 | 200 |   10.086008ms |      172.18.0.6 | POST     "/api/auth/logout"
app_1       | [GIN] 2026/02/09 - 14:35:11 | 401 |      76.752µs |      172.18.0.6 | GET      "/api/users/me"
app_1       | [GIN] 2026/02/09 - 14:35:13 | 401 |      66.186µs |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:35:13 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.271ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:35:13.067' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:35:13 | 200 |    1.550175ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | [GIN] 2026/02/09 - 14:35:15 | 401 |      63.457µs |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:35:15 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [2.706ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:35:15.134' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:35:15 | 200 |    2.877854ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | [GIN] 2026/02/09 - 14:35:17 | 401 |      65.076µs |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:35:17 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.618ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:35:17.352' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:35:17 | 200 |    2.123497ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | [GIN] 2026/02/09 - 14:35:25 | 401 |      82.435µs |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:35:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:35:39 /app/internal/repository/postgres/user_repo.go:46
app_1       | [1.512ms] [rows:1] SELECT * FROM "users" WHERE email = 'temirlan@mail.ru' ORDER BY "users"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 14:35:39 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.714ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 14:35:39 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [2.032ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:35:39.899' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 14:35:39 [JWT] Токен доступа успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17
app_1       | 
app_1       | 2026/02/09 14:35:39 /app/internal/repository/postgres/refresh_token_repo.go:32
app_1       | [3.824ms] [rows:1] INSERT INTO "refresh_tokens" ("user_id","token","device_id","ip_address","user_agent","expires_at","created_at","is_expired","revoked_at","reason") VALUES (1,'d55ce5c980dc43116dd86973eeea09ceab999b3381014c4f2b15aba36e0f8ae5','Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36','172.18.0.6','Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36','2026-03-11 14:35:39.901','2026-02-09 14:35:39.901',false,NULL,'') RETURNING "id"
app_1       | 2026/02/09 14:35:39 [TokenManager] Сгенерирована пара токенов для пользователя ID=1, JWT Key ID: a488fda381b19b17
app_1       | 2026/02/09 14:35:39 JWT: UserID: 1 was not in the invalidation list
app_1       | 
app_1       | 2026/02/09 14:35:39 /app/internal/repository/postgres/refresh_token_repo.go:159
app_1       | [1.850ms] [rows:1] SELECT count(*) FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:35:39.905'
app_1       | 
app_1       | 2026/02/09 14:35:39 /app/internal/repository/postgres/invalid_token_repo.go:46
app_1       | [2.177ms] [rows:0] DELETE FROM "invalid_tokens" WHERE "invalid_tokens"."user_id" = 1
app_1       | 2026/02/09 14:35:39 Запись в invalid_tokens для пользователя ID=1 не найдена
nginx_1     | /docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
nginx_1     | /docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/
nginx_1     | /docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
nginx_1     | 10-listen-on-ipv6-by-default.sh: info: can not modify /etc/nginx/conf.d/default.conf (read-only file system?)
nginx_1     | /docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh
nginx_1     | /docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
nginx_1     | /docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
nginx_1     | /docker-entrypoint.sh: Configuration complete; ready for start up
nginx_1     | 2026/02/09 14:26:36 [warn] 1#1: the "listen ... http2" directive is deprecated, use the "http2" directive instead in /etc/nginx/conf.d/default.conf:11
nginx_1     | nginx: [warn] the "listen ... http2" directive is deprecated, use the "http2" directive instead in /etc/nginx/conf.d/default.conf:11
nginx_1     | 2026/02/09 14:26:36 [notice] 1#1: using the "epoll" event method
nginx_1     | 2026/02/09 14:26:36 [notice] 1#1: nginx/1.29.4
nginx_1     | 2026/02/09 14:26:36 [notice] 1#1: built by gcc 15.2.0 (Alpine 15.2.0) 
nginx_1     | 2026/02/09 14:26:36 [notice] 1#1: OS: Linux 6.8.0-1045-gcp
nginx_1     | 2026/02/09 14:26:36 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
nginx_1     | 2026/02/09 14:26:36 [notice] 1#1: start worker processes
nginx_1     | 2026/02/09 14:26:36 [notice] 1#1: start worker process 21
nginx_1     | 2026/02/09 14:26:36 [notice] 1#1: start worker process 22
nginx_1     | 44.202.137.75 - - [09/Feb/2026:14:28:46 +0000] "GET /favicon.ico HTTP/1.1" 200 25967 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36" "-"
nginx_1     | 34.207.164.227 - - [09/Feb/2026:14:29:32 +0000] "GET / HTTP/1.1" 301 169 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:13 +0000] "GET / HTTP/2.0" 200 4993 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:13 +0000] "GET /_next/static/chunks/62a4b4701d6a8910.js HTTP/2.0" 200 9555 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:13 +0000] "GET /_next/static/chunks/b9b2fdc9b3f56042.js HTTP/2.0" 200 9216 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:14 +0000] "GET /api/quizzes/scheduled HTTP/2.0" 200 2 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:14 +0000] "GET /api/users/me HTTP/2.0" 401 53 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:14 +0000] "GET /?_rsc=eqsj3 HTTP/2.0" 200 331 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:14 +0000] "GET /register?_rsc=eqsj3 HTTP/2.0" 200 342 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:14 +0000] "GET /login?_rsc=eqsj3 HTTP/2.0" 200 339 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:14 +0000] "GET /leaderboard?_rsc=eqsj3 HTTP/2.0" 200 343 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:14 +0000] "GET /?_rsc=tqohj HTTP/2.0" 200 1138 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:14 +0000] "GET /?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:14 +0000] "GET /login?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:14 +0000] "GET /login?_rsc=mubk8 HTTP/2.0" 200 2352 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:14 +0000] "GET /login?_rsc=1eznk HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:14 +0000] "GET /login?_rsc=1yhl2 HTTP/2.0" 200 534 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:14 +0000] "GET /register?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:14 +0000] "GET /register?_rsc=1p7qy HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:15 +0000] "GET /register?_rsc=ggxyb HTTP/2.0" 200 530 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:15 +0000] "GET /leaderboard?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:15 +0000] "GET /_next/static/chunks/597e11429becaa9e.js HTTP/2.0" 200 8356 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:15 +0000] "GET /leaderboard?_rsc=1x3py HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:15 +0000] "GET /leaderboard?_rsc=1vblc HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:15 +0000] "GET /?_rsc=2mwil HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/09 14:35:39 [AuthService] Пользователь ID=1 (temirlan@mail.ru) успешно вошел в систему
app_1       | 2026/02/09 14:35:39 [TokenManager] Установлена CSRF secret cookie (__Host-csrf-secret) с Secure=true, MaxAge: 86400 секунд
app_1       | 
app_1       | 2026/02/09 14:35:39 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.660ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:35:39 | 200 |   93.444843ms |      172.18.0.6 | POST     "/api/auth/login"
app_1       | 
app_1       | 2026/02/09 14:35:40 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.847ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:35:40.047') OR (is_active = false AND rotated_at > '2026-02-02 14:35:40.047' AND expires_at > '2026-02-09 14:35:40.047') ORDER BY created_at DESC
app_1       | 2026/02/09 14:35:40 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:35:40 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | [GIN] 2026/02/09 - 14:35:40 | 200 |    1.182219ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 
app_1       | 2026/02/09 14:35:40 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.638ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:35:40.064' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:35:40 | 200 |     787.149µs |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 2026/02/09 14:36:35 [Shard 0] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:36:35 [Shard 1] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:36:35 [Shard 2] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:36:35 [Shard 3] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:36:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:36:56 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.988ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:36:56.951' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:36:56 | 200 |    1.221849ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:36:56 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.988ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:36:56.951') OR (is_active = false AND rotated_at > '2026-02-02 14:36:56.951' AND expires_at > '2026-02-09 14:36:56.951') ORDER BY created_at DESC
app_1       | 2026/02/09 14:36:56 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:36:56 /app/internal/repository/postgres/user_repo.go:33
app_1       | [1.147ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:36:56 | 200 |    2.792223ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:36:57 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:36:57 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:36:57 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.934ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:36:57.098') OR (is_active = false AND rotated_at > '2026-02-02 14:36:57.098' AND expires_at > '2026-02-09 14:36:57.098') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:36:57 | 200 |    1.370881ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:37:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:37:36 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.801ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:37:36.692') OR (is_active = false AND rotated_at > '2026-02-02 14:37:36.692' AND expires_at > '2026-02-09 14:37:36.692') ORDER BY created_at DESC
app_1       | 2026/02/09 14:37:36 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:37:36 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.392ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:37:36 | 200 |    1.655621ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:37:56 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:37:56 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | 
app_1       | 2026/02/09 14:37:56 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.188ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:37:56.883') OR (is_active = false AND rotated_at > '2026-02-02 14:37:56.883' AND expires_at > '2026-02-09 14:37:56.883') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:37:56 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [1.221ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:37:56.884' ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:37:56 | 200 |    3.335546ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 14:37:58 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.503ms] [rows:29] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:37:58 | 200 |    2.090172ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 14:38:24 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:38:24 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:38:24 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.094ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:24.717') OR (is_active = false AND rotated_at > '2026-02-02 14:38:24.717' AND expires_at > '2026-02-09 14:38:24.717') ORDER BY created_at DESC
app_1       | 2026/02/09 14:38:24 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:38:24 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.636ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:24.719') OR (is_active = false AND rotated_at > '2026-02-02 14:38:24.719' AND expires_at > '2026-02-09 14:38:24.719') ORDER BY created_at DESC
app_1       | 
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:15 +0000] "GET /_next/static/chunks/44e4a7481549fa76.js HTTP/2.0" 200 8563 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:15 +0000] "GET /_next/static/chunks/6f710bd3a602f837.js HTTP/2.0" 200 11438 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:25 +0000] "POST /api/auth/login HTTP/2.0" 200 808 "https://qazaquiz.duckdns.org/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:25 +0000] "GET /api/auth/csrf HTTP/2.0" 200 81 "https://qazaquiz.duckdns.org/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:25 +0000] "GET /api/quizzes/scheduled HTTP/2.0" 200 2 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:25 +0000] "GET /profile?_rsc=eqsj3 HTTP/2.0" 200 343 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:25 +0000] "GET /profile?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:25 +0000] "GET /profile?_rsc=t8ou9 HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:25 +0000] "GET /profile?_rsc=acm04 HTTP/2.0" 200 534 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:26 +0000] "GET /_next/static/chunks/e87f8976933bc254.js HTTP/2.0" 200 11540 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET / HTTP/2.0" 304 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET /api/quizzes/scheduled HTTP/2.0" 200 2 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET /api/users/me HTTP/2.0" 200 286 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET /favicon.ico?favicon.0b3bf435.ico HTTP/2.0" 200 25931 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET /api/auth/csrf HTTP/2.0" 200 81 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET /profile?_rsc=eqsj3 HTTP/2.0" 200 343 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET /leaderboard?_rsc=eqsj3 HTTP/2.0" 200 343 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET /?_rsc=eqsj3 HTTP/2.0" 200 331 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET /profile?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET /profile?_rsc=tqohj HTTP/2.0" 200 1138 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET /profile?_rsc=mubk8 HTTP/2.0" 200 2352 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET /profile?_rsc=t8ou9 HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET /profile?_rsc=acm04 HTTP/2.0" 200 534 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET /leaderboard?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET /leaderboard?_rsc=1x3py HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:27 +0000] "GET /leaderboard?_rsc=1vblc HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:28 +0000] "GET /?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:28 +0000] "GET /?_rsc=2mwil HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:28 +0000] "GET /api/auth/sessions HTTP/2.0" 200 1895 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:28 +0000] "GET /profile/history?_rsc=1ugzb HTTP/2.0" 200 354 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:28 +0000] "GET /profile/history?_rsc=ys5m8 HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:28 +0000] "GET /profile/history?_rsc=baz01 HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:28 +0000] "GET /profile/history?_rsc=2dhtl HTTP/2.0" 200 533 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:28 +0000] "GET /_next/static/chunks/e1b105b98b5c726b.js HTTP/2.0" 200 9318 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:34 +0000] "GET /api/leaderboard?page=1&page_size=10 HTTP/2.0" 200 1066 "https://qazaquiz.duckdns.org/leaderboard" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:36 +0000] "GET /api/auth/sessions HTTP/2.0" 200 1895 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /api/users/me/results?page=1&page_size=10 HTTP/2.0" 200 2952 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/14/results?_rsc=1h1ho HTTP/2.0" 200 183 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/15/results?_rsc=1h1ho HTTP/2.0" 200 183 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/18/results?_rsc=1h1ho HTTP/2.0" 200 183 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/19/results?_rsc=1h1ho HTTP/2.0" 200 183 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/20/results?_rsc=1h1ho HTTP/2.0" 200 182 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/22/results?_rsc=1h1ho HTTP/2.0" 200 183 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/23/results?_rsc=1h1ho HTTP/2.0" 200 182 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/27/results?_rsc=1h1ho HTTP/2.0" 200 183 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/14/results?_rsc=1w085 HTTP/2.0" 200 830 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/15/results?_rsc=1w085 HTTP/2.0" 200 830 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/18/results?_rsc=1w085 HTTP/2.0" 200 827 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/19/results?_rsc=1w085 HTTP/2.0" 200 832 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/20/results?_rsc=1w085 HTTP/2.0" 200 829 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/22/results?_rsc=1w085 HTTP/2.0" 200 831 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/23/results?_rsc=1w085 HTTP/2.0" 200 831 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:37 +0000] "GET /quiz/27/results?_rsc=1w085 HTTP/2.0" 200 829 "https://qazaquiz.duckdns.org/profile/history" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:38 +0000] "GET /api/quizzes/scheduled HTTP/2.0" 200 2 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:39 +0000] "GET /api/auth/sessions HTTP/2.0" 200 1895 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:40 +0000] "GET /admin?_rsc=1143l HTTP/2.0" 200 1953 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /api/quizzes?page=1&page_size=100 HTTP/2.0" 200 8885 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/quizzes/new?_rsc=17qrm HTTP/2.0" 200 346 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/question-pool?_rsc=17qrm HTTP/2.0" 200 342 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/ads?_rsc=17qrm HTTP/2.0" 200 331 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/monitoring?_rsc=17qrm HTTP/2.0" 200 339 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/09 14:38:24 /app/internal/repository/postgres/quiz_repo.go:26
app_1       | [5.937ms] [rows:1] INSERT INTO "quizzes" ("title","description","scheduled_time","status","question_count","prize_fund","created_at","updated_at") VALUES ('Проверка викторины','','2026-02-09 14:40:00','scheduled',0,900,'2026-02-09 14:38:24.72','2026-02-09 14:38:24.72') RETURNING "id"
app_1       | [GIN] 2026/02/09 - 14:38:24 | 201 |    8.884932ms |      172.18.0.6 | POST     "/api/quizzes"
app_1       | 
app_1       | 2026/02/09 14:38:25 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.494ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 30
app_1       | 
app_1       | 2026/02/09 14:38:25 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [1.392ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:38:25 | 200 |    1.581963ms |      172.18.0.6 | GET      "/api/quizzes/30/with-questions"
app_1       | 2026/02/09 14:38:29 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:38:29 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.682ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:29.1') OR (is_active = false AND rotated_at > '2026-02-02 14:38:29.1' AND expires_at > '2026-02-09 14:38:29.1') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:38:29 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.907ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:38:29 | 200 |    3.529634ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:38:29 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.716ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:38:29 | 200 |     983.672µs |      172.18.0.6 | GET      "/api/quizzes/30"
app_1       | 
app_1       | 2026/02/09 14:38:29 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.926ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:29.237') OR (is_active = false AND rotated_at > '2026-02-02 14:38:29.237' AND expires_at > '2026-02-09 14:38:29.237') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:38:29 | 200 |    1.237317ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:38:29 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:38:29 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 2026/02/09 14:38:29 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:38:29 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.960ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:29.48') OR (is_active = false AND rotated_at > '2026-02-02 14:38:29.48' AND expires_at > '2026-02-09 14:38:29.48') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:38:29 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.859ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:38:29 | 200 |    2.627749ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:38:31 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.102ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:31.722') OR (is_active = false AND rotated_at > '2026-02-02 14:38:31.722' AND expires_at > '2026-02-09 14:38:31.722') ORDER BY created_at DESC
app_1       | 2026/02/09 14:38:31 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:38:31 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 2026/02/09 14:38:31 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:38:31 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.939ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:31.724') OR (is_active = false AND rotated_at > '2026-02-02 14:38:31.724' AND expires_at > '2026-02-09 14:38:31.724') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:38:31 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [0.870ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:38:31.725' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 14:38:31 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [GIN] 2026/02/09 - 14:38:31 | 200 |    4.371605ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 
app_1       | 2026/02/09 14:38:32 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.684ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:32.157') OR (is_active = false AND rotated_at > '2026-02-02 14:38:32.157' AND expires_at > '2026-02-09 14:38:32.157') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:38:32 | 200 |    1.318711ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0Nzk3MSwiaWF0IjoxNzcwNjQ3OTExLCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.egkimR-zlumuIccwn7ceh7SB8KUFaJi-z89j0qzy4rk"
app_1       | 2026/02/09 14:38:32 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:38:32 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:38:32 Shard 0: client 1 registered
app_1       | 2026/02/09 14:38:32 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:38:32 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 4f6ca735-3456-46a9-8e06-76e5a73135e5
app_1       | 2026/02/09 14:38:32 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 4f6ca735-3456-46a9-8e06-76e5a73135e5
app_1       | 2026/02/09 14:38:32 Client 1 (Conn: 4f6ca735-3456-46a9-8e06-76e5a73135e5) set QuizID to 30
app_1       | 2026/02/09 14:38:32 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 4f6ca735-3456-46a9-8e06-76e5a73135e5) to Quiz 30
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] Client 1: Created new map for quiz 30
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/quizzes/new?_rsc=m0mb1 HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/quizzes/new?_rsc=rjpof HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/quizzes/new?_rsc=1ijyj HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/quizzes/new?_rsc=14zdw HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/quizzes/new?_rsc=p7cw9 HTTP/2.0" 200 496 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/question-pool?_rsc=m0mb1 HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/question-pool?_rsc=dki0b HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/question-pool?_rsc=dyoas HTTP/2.0" 200 498 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/ads?_rsc=m0mb1 HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/ads?_rsc=1cj06 HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/ads?_rsc=hjmgi HTTP/2.0" 200 499 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/monitoring?_rsc=m0mb1 HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/monitoring?_rsc=1iinw HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:41 +0000] "GET /admin/monitoring?_rsc=1majf HTTP/2.0" 200 497 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:47 +0000] "GET /admin?_rsc=kue73 HTTP/2.0" 200 326 "https://qazaquiz.duckdns.org/admin/question-pool" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:47 +0000] "GET /api/admin/question-pool/stats HTTP/2.0" 200 93 "https://qazaquiz.duckdns.org/admin/question-pool" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:47 +0000] "GET /admin?_rsc=ysiw2 HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/admin/question-pool" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:47 +0000] "GET /admin?_rsc=1j22c HTTP/2.0" 200 499 "https://qazaquiz.duckdns.org/admin/question-pool" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:30:59 +0000] "GET /api/quizzes?page=1&page_size=100 HTTP/2.0" 200 8885 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:31:42 +0000] "GET /api/users/me HTTP/2.0" 200 286 "https://qazaquiz.duckdns.org/admin/quizzes/new" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:32:13 +0000] "GET /api/users/me HTTP/2.0" 200 286 "https://qazaquiz.duckdns.org/admin/quizzes/new" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:33:03 +0000] "GET /api/users/me HTTP/2.0" 200 286 "https://qazaquiz.duckdns.org/admin/quizzes/new" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:33:12 +0000] "GET /api/quizzes?page=1&page_size=100 HTTP/2.0" 200 8885 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 84.17.55.211 - - [09/Feb/2026:14:33:23 +0000] "CONNECT blog.cloudflare.com:443 HTTP/1.1" 405 157 "-" "Go-http-client/1.1" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:33:36 +0000] "GET /api/quizzes/scheduled HTTP/2.0" 200 2 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:33:37 +0000] "GET /api/auth/sessions HTTP/2.0" 200 1895 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:33:39 +0000] "GET /api/quizzes?page=1&page_size=100 HTTP/2.0" 200 8885 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 3.90.111.248 - - [09/Feb/2026:14:33:56 +0000] "GET / HTTP/1.1" 200 5017 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36" "-"
nginx_1     | 52.21.0.206 - - [09/Feb/2026:14:33:58 +0000] "GET /robots.txt HTTP/1.1" 404 2516 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:34:59 +0000] "GET /admin/quizzes/25?_rsc=1o6v1 HTTP/2.0" 200 1252 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:34:59 +0000] "GET /_next/static/chunks/17ae67d06e71bedb.js HTTP/2.0" 200 12750 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:34:59 +0000] "GET /api/quizzes/25/with-questions HTTP/2.0" 200 2909 "https://qazaquiz.duckdns.org/admin/quizzes/25" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:34:59 +0000] "GET /api/quizzes/25/ad-slots HTTP/2.0" 200 12 "https://qazaquiz.duckdns.org/admin/quizzes/25" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:34:59 +0000] "GET /api/admin/ads HTTP/2.0" 200 12 "https://qazaquiz.duckdns.org/admin/quizzes/25" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:00 +0000] "GET /api/quizzes/scheduled HTTP/2.0" 200 2 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:04 +0000] "GET / HTTP/2.0" 304 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:04 +0000] "GET /api/quizzes/scheduled HTTP/2.0" 200 2 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:04 +0000] "GET /api/users/me HTTP/2.0" 200 286 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:04 +0000] "GET /favicon.ico?favicon.0b3bf435.ico HTTP/2.0" 200 25931 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:04 +0000] "GET /api/auth/csrf HTTP/2.0" 200 81 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:04 +0000] "GET /profile?_rsc=eqsj3 HTTP/2.0" 200 343 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:04 +0000] "GET /leaderboard?_rsc=eqsj3 HTTP/2.0" 200 343 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:04 +0000] "GET /?_rsc=eqsj3 HTTP/2.0" 200 331 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:04 +0000] "GET /profile?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:04 +0000] "GET /profile?_rsc=tqohj HTTP/2.0" 200 1138 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:04 +0000] "GET /profile?_rsc=mubk8 HTTP/2.0" 200 2352 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:04 +0000] "GET /profile?_rsc=t8ou9 HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:05 +0000] "GET /profile?_rsc=acm04 HTTP/2.0" 200 534 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:05 +0000] "GET /leaderboard?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:05 +0000] "GET /leaderboard?_rsc=1x3py HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:05 +0000] "GET /leaderboard?_rsc=1vblc HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:05 +0000] "GET /?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:05 +0000] "GET /?_rsc=2mwil HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:11 +0000] "POST /api/auth/logout HTTP/2.0" 200 37 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:11 +0000] "GET /api/users/me HTTP/2.0" 401 53 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:11 +0000] "GET /login?_rsc=eqsj3 HTTP/2.0" 200 339 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:11 +0000] "GET /register?_rsc=eqsj3 HTTP/2.0" 200 342 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:11 +0000] "GET /login?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:11 +0000] "GET /login?_rsc=1eznk HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:11 +0000] "GET /login?_rsc=1yhl2 HTTP/2.0" 200 534 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:11 +0000] "GET /register?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:12 +0000] "GET /register?_rsc=1p7qy HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:12 +0000] "GET /register?_rsc=ggxyb HTTP/2.0" 200 530 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:12 +0000] "GET / HTTP/2.0" 304 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:38:32 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
app_1       | 2026/02/09 14:38:32 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:38:32 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:38:32 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:38:32 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:32 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:32 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 4f6ca735-3456-46a9-8e06-76e5a73135e5
app_1       | 2026/02/09 14:38:32 [Shard 0][Quiz 30][User 1][Conn 4f6ca735-3456-46a9-8e06-76e5a73135e5] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:38:32 [Shard 0][Quiz 30][User 1][Conn 4f6ca735-3456-46a9-8e06-76e5a73135e5] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:38:32 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:38:32 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:32 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:32 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:38:32 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 1)
app_1       | 2026/02/09 14:38:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:38:45 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.753ms] [rows:30] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:38:45 | 200 |    2.185726ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 
app_1       | 2026/02/09 14:38:48 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.983ms] [rows:1] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:38:48.676' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:38:48 | 200 |    1.259478ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:38:55 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [1.362ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:38:55 | 200 |    1.631205ms |      172.18.0.6 | GET      "/api/quizzes/30"
app_1       | 
app_1       | 2026/02/09 14:38:55 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.778ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:55.622') OR (is_active = false AND rotated_at > '2026-02-02 14:38:55.622' AND expires_at > '2026-02-09 14:38:55.622') ORDER BY created_at DESC
app_1       | 2026/02/09 14:38:55 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:38:55 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:38:55 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.585ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:55.624') OR (is_active = false AND rotated_at > '2026-02-02 14:38:55.624' AND expires_at > '2026-02-09 14:38:55.624') ORDER BY created_at DESC
app_1       | 2026/02/09 14:38:55 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:38:55 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | 
app_1       | 2026/02/09 14:38:55 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.192ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:38:55.625' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:38:55 | 200 |    4.277168ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 
app_1       | 2026/02/09 14:38:56 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.794ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:56.041') OR (is_active = false AND rotated_at > '2026-02-02 14:38:56.041' AND expires_at > '2026-02-09 14:38:56.041') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:38:56 | 200 |    1.426391ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0Nzk5NSwiaWF0IjoxNzcwNjQ3OTM1LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.rvkWspZF6FIQivvwk7UqMjojiV-HGonKcquoeHIhJbM"
app_1       | 2026/02/09 14:38:56 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:38:56 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:38:56 Shard 0: replacing client 1 with new connection
app_1       | 2026/02/09 14:38:56 Shard 0: client 1 registered
app_1       | 2026/02/09 14:38:56 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:38:56 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:38:56 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:38:56 Client 1 (Conn: 017ac53c-7f68-42c8-b486-2495a06f3c13) set QuizID to 30
app_1       | 2026/02/09 14:38:56 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 017ac53c-7f68-42c8-b486-2495a06f3c13) to Quiz 30
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] Client 1: Found existing map for quiz 30
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:38:56 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
app_1       | 2026/02/09 14:38:56 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:38:56 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:38:56 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:38:56 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:56 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 4f6ca735-3456-46a9-8e06-76e5a73135e5
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][User 1][Conn 4f6ca735-3456-46a9-8e06-76e5a73135e5] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][User 1][Conn 4f6ca735-3456-46a9-8e06-76e5a73135e5] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:38:56 Shard 0: Message broadcast to 2 clients in Quiz 30
app_1       | 2026/02/09 14:38:56 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:56 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:38:56 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 2)
app_1       | 2026/02/09 14:38:56 WebSocket Client Read Error (UserID: 1, ConnID: 4f6ca735-3456-46a9-8e06-76e5a73135e5): read tcp 172.18.0.5:8080->172.18.0.6:50030: use of closed network connection
app_1       | 2026/02/09 14:38:56 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 4f6ca735-3456-46a9-8e06-76e5a73135e5
app_1       | 2026/02/09 14:38:56 [Shard 0][User 1][Conn 4f6ca735-3456-46a9-8e06-76e5a73135e5] handleUnregister called
app_1       | 2026/02/09 14:38:56 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 4f6ca735-3456-46a9-8e06-76e5a73135e5) from Quiz 30
app_1       | 2026/02/09 14:38:56 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:38:56 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:38:56 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 30.
app_1       | 2026/02/09 14:38:56 Client 1 (Conn: 4f6ca735-3456-46a9-8e06-76e5a73135e5) cleared QuizID
app_1       | 2026/02/09 14:38:56 Shard 0: Client 1 unsubscribed from Quiz 30
app_1       | 2026/02/09 14:38:56 [ShardedHub] Отправлено обновление player_count для викторины #30: 1 игроков
app_1       | 2026/02/09 14:38:56 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:38:56 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:38:56 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 4f6ca735-3456-46a9-8e06-76e5a73135e5)
app_1       | 2026/02/09 14:38:56 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 4f6ca735-3456-46a9-8e06-76e5a73135e5
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 14:38:56 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:38:56 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:38:56 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:38:56 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 
app_1       | 2026/02/09 14:38:58 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.026ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:58.457') OR (is_active = false AND rotated_at > '2026-02-02 14:38:58.457' AND expires_at > '2026-02-09 14:38:58.457') ORDER BY created_at DESC
app_1       | 2026/02/09 14:38:58 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:38:58 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:38:58 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.573ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:58.459') OR (is_active = false AND rotated_at > '2026-02-02 14:38:58.459' AND expires_at > '2026-02-09 14:38:58.459') ORDER BY created_at DESC
app_1       | 2026/02/09 14:38:58 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:38:58 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | 
app_1       | 2026/02/09 14:38:58 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.131ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:38:58.46' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:38:58 | 200 |    4.310341ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 14:38:58 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:38:58 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:38:58 Shard 0: client 1 registered
app_1       | 2026/02/09 14:38:58 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:38:58 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: cb0f9325-d521-4903-936a-79f9ffec6750
app_1       | 2026/02/09 14:38:58 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: cb0f9325-d521-4903-936a-79f9ffec6750
app_1       | 
app_1       | 2026/02/09 14:38:58 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.879ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:58.992') OR (is_active = false AND rotated_at > '2026-02-02 14:38:58.992' AND expires_at > '2026-02-09 14:38:58.992') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:38:58 | 200 |    1.430831ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0Nzk5OCwiaWF0IjoxNzcwNjQ3OTM4LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.Z7e8HMSyS3ZY06HKrOesb3XOvEcFvXEXjS7PSfUFP98"
app_1       | 2026/02/09 14:38:59 Client 1 (Conn: cb0f9325-d521-4903-936a-79f9ffec6750) set QuizID to 30
app_1       | 2026/02/09 14:38:59 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: cb0f9325-d521-4903-936a-79f9ffec6750) to Quiz 30
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /api/users/me HTTP/2.0" 401 53 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /api/quizzes/scheduled HTTP/2.0" 200 2 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /login?_rsc=eqsj3 HTTP/2.0" 200 339 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /register?_rsc=eqsj3 HTTP/2.0" 200 342 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /leaderboard?_rsc=eqsj3 HTTP/2.0" 200 343 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /?_rsc=eqsj3 HTTP/2.0" 200 331 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /login?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /login?_rsc=tqohj HTTP/2.0" 200 1138 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /login?_rsc=1eznk HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /login?_rsc=mubk8 HTTP/2.0" 200 2352 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /login?_rsc=1yhl2 HTTP/2.0" 200 534 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /register?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /register?_rsc=1p7qy HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /register?_rsc=ggxyb HTTP/2.0" 200 530 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /leaderboard?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /leaderboard?_rsc=1x3py HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /leaderboard?_rsc=1vblc HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:13 +0000] "GET /?_rsc=2mwil HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:14 +0000] "GET /favicon.ico?favicon.0b3bf435.ico HTTP/2.0" 200 25931 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:14 +0000] "GET / HTTP/2.0" 304 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /api/users/me HTTP/2.0" 401 53 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /api/quizzes/scheduled HTTP/2.0" 200 2 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /favicon.ico?favicon.0b3bf435.ico HTTP/2.0" 200 25931 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /login?_rsc=eqsj3 HTTP/2.0" 200 339 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /register?_rsc=eqsj3 HTTP/2.0" 200 342 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /leaderboard?_rsc=eqsj3 HTTP/2.0" 200 343 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /?_rsc=eqsj3 HTTP/2.0" 200 331 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /login?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /login?_rsc=tqohj HTTP/2.0" 200 1138 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /login?_rsc=mubk8 HTTP/2.0" 200 2352 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /login?_rsc=1eznk HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] Client 1: Found existing map for quiz 30
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:38:59 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
app_1       | 2026/02/09 14:38:59 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:38:59 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:38:59 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:38:59 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:59 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:59 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:38:59 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:38:59 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:38:59 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn cb0f9325-d521-4903-936a-79f9ffec6750
app_1       | 2026/02/09 14:38:59 [Shard 0][Quiz 30][User 1][Conn cb0f9325-d521-4903-936a-79f9ffec6750] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:38:59 [Shard 0][Quiz 30][User 1][Conn cb0f9325-d521-4903-936a-79f9ffec6750] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:38:59 Shard 0: Message broadcast to 2 clients in Quiz 30
app_1       | 2026/02/09 14:38:59 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:59 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:59 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:38:59 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 2)
app_1       | 2026/02/09 14:39:08 WebSocket Client Connection Closed Normally (UserID: 1, ConnID: cb0f9325-d521-4903-936a-79f9ffec6750): websocket: close 1001 (going away)
app_1       | 2026/02/09 14:39:08 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: cb0f9325-d521-4903-936a-79f9ffec6750
app_1       | 2026/02/09 14:39:08 [Shard 0][User 1][Conn cb0f9325-d521-4903-936a-79f9ffec6750] handleUnregister called
app_1       | 2026/02/09 14:39:08 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: cb0f9325-d521-4903-936a-79f9ffec6750) from Quiz 30
app_1       | 2026/02/09 14:39:08 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:08 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:08 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 30.
app_1       | 2026/02/09 14:39:08 Client 1 (Conn: cb0f9325-d521-4903-936a-79f9ffec6750) cleared QuizID
app_1       | 2026/02/09 14:39:08 Shard 0: Client 1 unsubscribed from Quiz 30
app_1       | 2026/02/09 14:39:08 Shard 0: client 1 unregistered
app_1       | 2026/02/09 14:39:08 WebSocket Client Send Channel Closed (UserID: 1, ConnID: cb0f9325-d521-4903-936a-79f9ffec6750)
app_1       | 2026/02/09 14:39:08 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: cb0f9325-d521-4903-936a-79f9ffec6750
app_1       | 2026/02/09 14:39:08 [ShardedHub] Отправлено обновление player_count для викторины #30: 1 игроков
app_1       | 2026/02/09 14:39:08 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:39:08 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:08 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:08 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:39:08 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 14:39:08 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 14:39:08 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:39:08 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:08 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:08 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 
app_1       | 2026/02/09 14:39:08 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.771ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:08.412') OR (is_active = false AND rotated_at > '2026-02-02 14:39:08.412' AND expires_at > '2026-02-09 14:39:08.412') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:08 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:39:08 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.624ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:39:08 | 200 |    2.077844ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:39:08 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.567ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:39:08 | 200 |     798.975µs |      172.18.0.6 | GET      "/api/quizzes/30"
app_1       | 2026/02/09 14:39:08 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:39:08 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:39:08 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.866ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:08.549') OR (is_active = false AND rotated_at > '2026-02-02 14:39:08.549' AND expires_at > '2026-02-09 14:39:08.549') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:39:08 | 200 |    1.398933ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 
app_1       | 2026/02/09 14:39:09 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.019ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:09.504') OR (is_active = false AND rotated_at > '2026-02-02 14:39:09.504' AND expires_at > '2026-02-09 14:39:09.504') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:09 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:39:09 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /login?_rsc=1yhl2 HTTP/2.0" 200 534 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /register?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /register?_rsc=1p7qy HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /register?_rsc=ggxyb HTTP/2.0" 200 530 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /leaderboard?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /leaderboard?_rsc=1x3py HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /leaderboard?_rsc=1vblc HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:15 +0000] "GET /?_rsc=2mwil HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET / HTTP/2.0" 304 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /api/users/me HTTP/2.0" 401 53 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /api/quizzes/scheduled HTTP/2.0" 200 2 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /login?_rsc=eqsj3 HTTP/2.0" 200 339 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /register?_rsc=eqsj3 HTTP/2.0" 200 342 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /leaderboard?_rsc=eqsj3 HTTP/2.0" 200 343 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /?_rsc=eqsj3 HTTP/2.0" 200 331 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /login?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /login?_rsc=tqohj HTTP/2.0" 200 1138 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /login?_rsc=mubk8 HTTP/2.0" 200 2352 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /login?_rsc=1eznk HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /login?_rsc=1yhl2 HTTP/2.0" 200 534 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /register?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /register?_rsc=1p7qy HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /register?_rsc=ggxyb HTTP/2.0" 200 530 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /leaderboard?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:17 +0000] "GET /leaderboard?_rsc=1x3py HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:18 +0000] "GET /leaderboard?_rsc=1vblc HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:18 +0000] "GET /?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:18 +0000] "GET /?_rsc=2mwil HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:25 +0000] "GET /login HTTP/2.0" 200 6039 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:25 +0000] "GET /api/users/me HTTP/2.0" 401 53 "https://qazaquiz.duckdns.org/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:25 +0000] "GET /register?_rsc=175rj HTTP/2.0" 200 342 "https://qazaquiz.duckdns.org/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/09 14:39:09 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.804ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:09.506') OR (is_active = false AND rotated_at > '2026-02-02 14:39:09.506' AND expires_at > '2026-02-09 14:39:09.506') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:09 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:39:09 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.354ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:39:09.508' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 14:39:09 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [GIN] 2026/02/09 - 14:39:09 | 200 |     5.08456ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 
app_1       | 2026/02/09 14:39:09 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.702ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:09.909') OR (is_active = false AND rotated_at > '2026-02-02 14:39:09.909' AND expires_at > '2026-02-09 14:39:09.909') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:09 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:39:09 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:39:09 Shard 0: client 1 registered
app_1       | 2026/02/09 14:39:09 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:39:09 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: cbcc93de-b6c1-4f14-8959-88d3805948b0
app_1       | 2026/02/09 14:39:09 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: cbcc93de-b6c1-4f14-8959-88d3805948b0
app_1       | [GIN] 2026/02/09 - 14:39:09 | 200 |    1.392454ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODAwOSwiaWF0IjoxNzcwNjQ3OTQ5LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.2oGeOk4zkaxBGulKl55WmysEzqjm8sfuGP7c9ThtvT0"
app_1       | 2026/02/09 14:39:10 Client 1 (Conn: cbcc93de-b6c1-4f14-8959-88d3805948b0) set QuizID to 30
app_1       | 2026/02/09 14:39:10 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: cbcc93de-b6c1-4f14-8959-88d3805948b0) to Quiz 30
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] Client 1: Found existing map for quiz 30
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:39:10 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
app_1       | 2026/02/09 14:39:10 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:39:10 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:39:10 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:39:10 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:10 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:10 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn cbcc93de-b6c1-4f14-8959-88d3805948b0
app_1       | 2026/02/09 14:39:10 [Shard 0][Quiz 30][User 1][Conn cbcc93de-b6c1-4f14-8959-88d3805948b0] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:39:10 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:10 [Shard 0][Quiz 30][User 1][Conn cbcc93de-b6c1-4f14-8959-88d3805948b0] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:39:10 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:10 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:39:10 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:39:10 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:39:10 Shard 0: Message broadcast to 2 clients in Quiz 30
app_1       | 2026/02/09 14:39:10 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:39:10 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 2)
app_1       | 2026/02/09 14:39:28 WebSocket Client Connection Closed Normally (UserID: 1, ConnID: 017ac53c-7f68-42c8-b486-2495a06f3c13): websocket: close 1001 (going away)
app_1       | 2026/02/09 14:39:28 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:39:28 [Shard 0][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] handleUnregister called
app_1       | 2026/02/09 14:39:28 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 017ac53c-7f68-42c8-b486-2495a06f3c13) from Quiz 30
app_1       | 2026/02/09 14:39:28 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:28 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:28 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 30.
app_1       | 2026/02/09 14:39:28 Client 1 (Conn: 017ac53c-7f68-42c8-b486-2495a06f3c13) cleared QuizID
app_1       | 2026/02/09 14:39:28 Shard 0: Client 1 unsubscribed from Quiz 30
app_1       | 2026/02/09 14:39:28 Shard 0: client 1 unregistered
app_1       | 2026/02/09 14:39:28 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 017ac53c-7f68-42c8-b486-2495a06f3c13)
app_1       | 2026/02/09 14:39:28 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:39:28 [ShardedHub] Отправлено обновление player_count для викторины #30: 1 игроков
app_1       | 2026/02/09 14:39:28 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:39:28 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:28 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:28 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:28 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:28 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn cbcc93de-b6c1-4f14-8959-88d3805948b0
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:25 +0000] "GET /?_rsc=175rj HTTP/2.0" 200 331 "https://qazaquiz.duckdns.org/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:25 +0000] "GET /register?_rsc=1034b HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:25 +0000] "GET /register?_rsc=1xxxg HTTP/2.0" 200 1138 "https://qazaquiz.duckdns.org/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:25 +0000] "GET /register?_rsc=1l35v HTTP/2.0" 200 2352 "https://qazaquiz.duckdns.org/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:25 +0000] "GET /register?_rsc=tdi8d HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:25 +0000] "GET /register?_rsc=656fz HTTP/2.0" 200 530 "https://qazaquiz.duckdns.org/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:25 +0000] "GET /?_rsc=1034b HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:25 +0000] "GET /?_rsc=u8sv4 HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:39 +0000] "POST /api/auth/login HTTP/2.0" 200 808 "https://qazaquiz.duckdns.org/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:40 +0000] "GET /api/auth/csrf HTTP/2.0" 200 81 "https://qazaquiz.duckdns.org/login" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:40 +0000] "GET /api/quizzes/scheduled HTTP/2.0" 200 2 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:40 +0000] "GET /profile?_rsc=eqsj3 HTTP/2.0" 200 343 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:40 +0000] "GET /leaderboard?_rsc=eqsj3 HTTP/2.0" 200 343 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:40 +0000] "GET /profile?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:40 +0000] "GET /profile?_rsc=t8ou9 HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:40 +0000] "GET /profile?_rsc=acm04 HTTP/2.0" 200 534 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:40 +0000] "GET /leaderboard?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:40 +0000] "GET /leaderboard?_rsc=1x3py HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:35:40 +0000] "GET /leaderboard?_rsc=1vblc HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:56 +0000] "GET / HTTP/2.0" 304 0 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:56 +0000] "GET /api/quizzes/scheduled HTTP/2.0" 200 2 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:56 +0000] "GET /api/users/me HTTP/2.0" 200 286 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:56 +0000] "GET /favicon.ico?favicon.0b3bf435.ico HTTP/2.0" 200 25931 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:57 +0000] "GET /api/auth/csrf HTTP/2.0" 200 81 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:57 +0000] "GET /profile?_rsc=eqsj3 HTTP/2.0" 200 343 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:57 +0000] "GET /leaderboard?_rsc=eqsj3 HTTP/2.0" 200 343 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:57 +0000] "GET /?_rsc=eqsj3 HTTP/2.0" 200 331 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:57 +0000] "GET /profile?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:57 +0000] "GET /profile?_rsc=tqohj HTTP/2.0" 200 1138 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:57 +0000] "GET /profile?_rsc=mubk8 HTTP/2.0" 200 2352 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:57 +0000] "GET /profile?_rsc=t8ou9 HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:57 +0000] "GET /profile?_rsc=acm04 HTTP/2.0" 200 534 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/09 14:39:28 [Shard 0][Quiz 30][User 1][Conn cbcc93de-b6c1-4f14-8959-88d3805948b0] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 14:39:28 [Shard 0][Quiz 30][User 1][Conn cbcc93de-b6c1-4f14-8959-88d3805948b0] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 14:39:28 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:39:28 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 
app_1       | 2026/02/09 14:39:28 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.906ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:28.569') OR (is_active = false AND rotated_at > '2026-02-02 14:39:28.569' AND expires_at > '2026-02-09 14:39:28.569') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:28 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:39:28 /app/internal/repository/postgres/user_repo.go:33
app_1       | [1.205ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:39:28 | 200 |    3.028085ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:39:28 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.764ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:39:28 | 200 |    1.002743ms |      172.18.0.6 | GET      "/api/quizzes/30"
app_1       | 
app_1       | 2026/02/09 14:39:28 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.078ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:28.709') OR (is_active = false AND rotated_at > '2026-02-02 14:39:28.709' AND expires_at > '2026-02-09 14:39:28.709') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:28 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:39:28 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | [GIN] 2026/02/09 - 14:39:28 | 200 |    1.664291ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 
app_1       | 2026/02/09 14:39:28 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.848ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:28.844') OR (is_active = false AND rotated_at > '2026-02-02 14:39:28.844' AND expires_at > '2026-02-09 14:39:28.844') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:28 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:39:28 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 2026/02/09 14:39:28 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:39:28 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.638ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:28.846') OR (is_active = false AND rotated_at > '2026-02-02 14:39:28.846' AND expires_at > '2026-02-09 14:39:28.846') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:39:28 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.092ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:39:28.846' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 14:39:28 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [GIN] 2026/02/09 - 14:39:28 | 200 |    3.723732ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 
app_1       | 2026/02/09 14:39:29 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.770ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:29.249') OR (is_active = false AND rotated_at > '2026-02-02 14:39:29.249' AND expires_at > '2026-02-09 14:39:29.249') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:39:29 | 200 |    1.339387ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODAyOCwiaWF0IjoxNzcwNjQ3OTY4LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.rcF56mIBj3IGEr5ZHEiKF_QDLAxTj0SmXFs6-XXF_a0"
app_1       | 2026/02/09 14:39:29 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:39:29 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:39:29 Shard 0: replacing client 1 with new connection
app_1       | 2026/02/09 14:39:29 Shard 0: client 1 registered
app_1       | 2026/02/09 14:39:29 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:39:29 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 2d32343f-676d-4a0d-a2d2-8e2858acca34
app_1       | 2026/02/09 14:39:29 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 2d32343f-676d-4a0d-a2d2-8e2858acca34
app_1       | 2026/02/09 14:39:29 Client 1 (Conn: 2d32343f-676d-4a0d-a2d2-8e2858acca34) set QuizID to 30
app_1       | 2026/02/09 14:39:29 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 2d32343f-676d-4a0d-a2d2-8e2858acca34) to Quiz 30
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] Client 1: Found existing map for quiz 30
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:39:29 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
app_1       | 2026/02/09 14:39:29 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:39:29 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:39:29 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:39:29 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn cbcc93de-b6c1-4f14-8959-88d3805948b0
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][User 1][Conn cbcc93de-b6c1-4f14-8959-88d3805948b0] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][User 1][Conn cbcc93de-b6c1-4f14-8959-88d3805948b0] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:57 +0000] "GET /leaderboard?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:57 +0000] "GET /leaderboard?_rsc=1x3py HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:57 +0000] "GET /leaderboard?_rsc=1vblc HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:57 +0000] "GET /?_rsc=7uv5c HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:36:57 +0000] "GET /?_rsc=2mwil HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:36 +0000] "GET /api/users/me HTTP/2.0" 200 286 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 206.168.34.222 - - [09/Feb/2026:14:37:50 +0000] "GET / HTTP/1.1" 301 169 "-" "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)" "-"
nginx_1     | 206.168.34.222 - - [09/Feb/2026:14:37:52 +0000] "PRI * HTTP/2.0" 400 157 "-" "-" "-"
nginx_1     | 206.168.34.222 - - [09/Feb/2026:14:37:54 +0000] "\x16\x03\x01\x00\xEE\x01\x00\x00\xEA\x03\x03\xBC4\x08\xA2B\x1C\xE6R\x5C\xFA\xB4\xAB\xCE\xD5\xA8\x8A\xE9T\xD6}\x18\x98n>\xBF\x8A\xABgx\x96F\x99 \x13~\xC9\xA3\x16%\xE2\xAB\x82@\x05p\x80\x9D\x07\x03>\xC8\x9A\x93W\x85S_\x9Ep\x94\xDF\x04\xF2cY\x00&\xCC\xA8\xCC\xA9\xC0/\xC00\xC0+\xC0,\xC0\x13\xC0\x09\xC0\x14\xC0" 400 157 "-" "-" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:56 +0000] "GET /api/auth/sessions HTTP/2.0" 200 1895 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:56 +0000] "GET /profile/history?_rsc=1ugzb HTTP/2.0" 200 354 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:57 +0000] "GET /profile/history?_rsc=ys5m8 HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:57 +0000] "GET /profile/history?_rsc=baz01 HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:57 +0000] "GET /profile/history?_rsc=2dhtl HTTP/2.0" 200 533 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 206.168.34.222 - - [09/Feb/2026:14:37:57 +0000] "GET /login HTTP/1.1" 301 169 "-" "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:58 +0000] "GET /admin?_rsc=1143l HTTP/2.0" 200 1953 "https://qazaquiz.duckdns.org/profile" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:58 +0000] "GET /api/quizzes?page=1&page_size=100 HTTP/2.0" 200 8885 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:58 +0000] "GET /admin/quizzes/new?_rsc=17qrm HTTP/2.0" 200 346 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:58 +0000] "GET /admin/question-pool?_rsc=17qrm HTTP/2.0" 200 342 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:58 +0000] "GET /admin/ads?_rsc=17qrm HTTP/2.0" 200 331 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:58 +0000] "GET /admin/monitoring?_rsc=17qrm HTTP/2.0" 200 339 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:58 +0000] "GET /admin/quizzes/new?_rsc=m0mb1 HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:58 +0000] "GET /admin/quizzes/new?_rsc=rjpof HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:58 +0000] "GET /admin/quizzes/new?_rsc=1ijyj HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:58 +0000] "GET /admin/quizzes/new?_rsc=14zdw HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:59 +0000] "GET /admin/quizzes/new?_rsc=p7cw9 HTTP/2.0" 200 496 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:59 +0000] "GET /admin/question-pool?_rsc=m0mb1 HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:59 +0000] "GET /admin/question-pool?_rsc=dki0b HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:59 +0000] "GET /admin/question-pool?_rsc=dyoas HTTP/2.0" 200 498 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:59 +0000] "GET /admin/ads?_rsc=m0mb1 HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:59 +0000] "GET /admin/ads?_rsc=1cj06 HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:59 +0000] "GET /admin/ads?_rsc=hjmgi HTTP/2.0" 200 499 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][User 1][Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][User 1][Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:39:29 Shard 0: Message broadcast to 2 clients in Quiz 30
app_1       | 2026/02/09 14:39:29 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:29 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:29 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:39:29 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 2)
app_1       | 2026/02/09 14:39:29 WebSocket Client Read Error (UserID: 1, ConnID: cbcc93de-b6c1-4f14-8959-88d3805948b0): read tcp 172.18.0.5:8080->172.18.0.6:49966: use of closed network connection
app_1       | 2026/02/09 14:39:29 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: cbcc93de-b6c1-4f14-8959-88d3805948b0
app_1       | 2026/02/09 14:39:29 [Shard 0][User 1][Conn cbcc93de-b6c1-4f14-8959-88d3805948b0] handleUnregister called
app_1       | 2026/02/09 14:39:29 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: cbcc93de-b6c1-4f14-8959-88d3805948b0) from Quiz 30
app_1       | 2026/02/09 14:39:29 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:29 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:29 WebSocket Client Send Channel Closed (UserID: 1, ConnID: cbcc93de-b6c1-4f14-8959-88d3805948b0)
app_1       | 2026/02/09 14:39:29 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: cbcc93de-b6c1-4f14-8959-88d3805948b0
app_1       | 2026/02/09 14:39:29 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 30.
app_1       | 2026/02/09 14:39:29 Client 1 (Conn: cbcc93de-b6c1-4f14-8959-88d3805948b0) cleared QuizID
app_1       | 2026/02/09 14:39:29 Shard 0: Client 1 unsubscribed from Quiz 30
app_1       | 2026/02/09 14:39:29 [ShardedHub] Отправлено обновление player_count для викторины #30: 1 игроков
app_1       | 2026/02/09 14:39:29 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:39:29 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:29 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:29 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][User 1][Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][User 1][Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 14:39:29 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:39:29 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:39:35 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:39:35 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:39:35 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | 2026/02/09 14:39:35 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:39:35 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [0.857ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:35.584') OR (is_active = false AND rotated_at > '2026-02-02 14:39:35.584' AND expires_at > '2026-02-09 14:39:35.584') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:39:35 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.689ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:35.585') OR (is_active = false AND rotated_at > '2026-02-02 14:39:35.585' AND expires_at > '2026-02-09 14:39:35.585') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:39:35 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [0.507ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:39:35.586' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:39:35 | 200 |    3.019696ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 14:39:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:39:35 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.866ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:35.984') OR (is_active = false AND rotated_at > '2026-02-02 14:39:35.984' AND expires_at > '2026-02-09 14:39:35.984') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:35 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:39:35 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:39:35 Shard 0: client 1 registered
app_1       | 2026/02/09 14:39:35 WebSocket: client 1 fully registered, starting pumps
app_1       | [GIN] 2026/02/09 - 14:39:35 | 200 |    1.725255ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODAzNSwiaWF0IjoxNzcwNjQ3OTc1LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.fQCxBO5LatW424fICvvAR7kj1DOQvGul8O86ePnqP24"
app_1       | 2026/02/09 14:39:35 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 9c26391a-8a78-46a0-affa-8c79dd0636bb
app_1       | 2026/02/09 14:39:35 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 9c26391a-8a78-46a0-affa-8c79dd0636bb
app_1       | 2026/02/09 14:39:36 Client 1 (Conn: 9c26391a-8a78-46a0-affa-8c79dd0636bb) set QuizID to 30
app_1       | 2026/02/09 14:39:36 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 9c26391a-8a78-46a0-affa-8c79dd0636bb) to Quiz 30
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] Client 1: Found existing map for quiz 30
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:39:36 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:59 +0000] "GET /admin/monitoring?_rsc=m0mb1 HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:59 +0000] "GET /admin/monitoring?_rsc=1iinw HTTP/2.0" 200 261 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:37:59 +0000] "GET /admin/monitoring?_rsc=1majf HTTP/2.0" 200 497 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:00 +0000] "GET /admin?_rsc=1kaua HTTP/2.0" 200 326 "https://qazaquiz.duckdns.org/admin/quizzes/new" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:00 +0000] "GET /admin?_rsc=19m7j HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/admin/quizzes/new" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:00 +0000] "GET /admin?_rsc=bs77n HTTP/2.0" 200 499 "https://qazaquiz.duckdns.org/admin/quizzes/new" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 206.168.34.222 - - [09/Feb/2026:14:38:02 +0000] "\x16\x03\x01\x00\xEE\x01\x00\x00\xEA\x03\x03\xD0v\x1D\xE4\xC7g\xBAg\xA4\x89\xEA\xDD;\xCF\xFA\x93\xDFU\x1C\xBB2\xDAV\x0E\xFC\x16\xE2j\xF6\xF8X\x7F \xD6P\x99\xB5\x13\xD5$\xDFT\xBA,\x99\x84^\xC9\xDCq\xB4N\x11\x9A\x9C\xDC\x84|\xE3\x92\xBF:m\xAB\xB4\x00&\xCC\xA8\xCC\xA9\xC0/\xC00\xC0+\xC0,\xC0\x13\xC0\x09\xC0\x14\xC0" 400 157 "-" "-" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:24 +0000] "POST /api/quizzes HTTP/2.0" 201 244 "https://qazaquiz.duckdns.org/admin/quizzes/new" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:24 +0000] "GET /admin/quizzes/30?_rsc=526y9 HTTP/2.0" 200 1174 "https://qazaquiz.duckdns.org/admin/quizzes/new" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:25 +0000] "GET /api/quizzes/30/with-questions HTTP/2.0" 200 238 "https://qazaquiz.duckdns.org/admin/quizzes/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:25 +0000] "GET /admin/quiz-live/30?_rsc=3uwmu HTTP/2.0" 200 172 "https://qazaquiz.duckdns.org/admin/quizzes/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:25 +0000] "GET /admin/quiz-live/30?_rsc=2yizi HTTP/2.0" 200 823 "https://qazaquiz.duckdns.org/admin/quizzes/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:28 +0000] "GET /admin/quiz-live/30 HTTP/2.0" 200 3299 "https://qazaquiz.duckdns.org/admin/quizzes/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:29 +0000] "GET /api/users/me HTTP/2.0" 200 286 "https://qazaquiz.duckdns.org/admin/quiz-live/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:29 +0000] "GET /api/quizzes/30 HTTP/2.0" 200 238 "https://qazaquiz.duckdns.org/admin/quiz-live/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:29 +0000] "GET /api/auth/csrf HTTP/2.0" 200 81 "https://qazaquiz.duckdns.org/admin/quiz-live/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:29 +0000] "GET /api/users/me HTTP/2.0" 200 286 "https://qazaquiz.duckdns.org/admin/quizzes/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:29 +0000] "GET /admin/quizzes/30?_rsc=9416w HTTP/2.0" 200 171 "https://qazaquiz.duckdns.org/admin/quiz-live/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:29 +0000] "GET /admin/quizzes/30?_rsc=o2rnv HTTP/2.0" 200 820 "https://qazaquiz.duckdns.org/admin/quiz-live/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:31 +0000] "POST /api/auth/ws-ticket HTTP/2.0" 200 363 "https://qazaquiz.duckdns.org/admin/quiz-live/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:45 +0000] "GET /api/quizzes?page=1&page_size=100 HTTP/2.0" 200 9124 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:48 +0000] "GET /api/quizzes/scheduled HTTP/2.0" 200 240 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:48 +0000] "GET /quiz/30/lobby?_rsc=eqsj3 HTTP/2.0" 200 182 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:49 +0000] "GET /quiz/30/lobby?_rsc=1a28h HTTP/2.0" 200 830 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:55 +0000] "GET /quiz/30/lobby?_rsc=1q21b HTTP/2.0" 200 1410 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:55 +0000] "GET /_next/static/chunks/37fd273292b531ac.js HTTP/2.0" 200 3017 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:55 +0000] "GET /_next/static/chunks/835a944e81ccaac0.js HTTP/2.0" 200 9391 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:55 +0000] "GET /api/quizzes/30 HTTP/2.0" 200 238 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:55 +0000] "POST /api/auth/ws-ticket HTTP/2.0" 200 363 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/09 14:39:36 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:39:36 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:39:36 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:39:36 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:36 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:36 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:36 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34
app_1       | 2026/02/09 14:39:36 [Shard 0][Quiz 30][User 1][Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:39:36 [Shard 0][Quiz 30][User 1][Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:39:36 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb
app_1       | 2026/02/09 14:39:36 [Shard 0][Quiz 30][User 1][Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:39:36 [Shard 0][Quiz 30][User 1][Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:39:36 Shard 0: Message broadcast to 2 clients in Quiz 30
app_1       | 2026/02/09 14:39:36 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:36 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:39:36 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 2)
app_1       | 2026/02/09 14:40:15 WebSocket Client Connection Closed Normally (UserID: 1, ConnID: 2d32343f-676d-4a0d-a2d2-8e2858acca34): websocket: close 1001 (going away)
app_1       | 2026/02/09 14:40:15 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 2d32343f-676d-4a0d-a2d2-8e2858acca34
app_1       | 2026/02/09 14:40:15 [Shard 0][User 1][Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34] handleUnregister called
app_1       | 2026/02/09 14:40:15 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 2d32343f-676d-4a0d-a2d2-8e2858acca34) from Quiz 30
app_1       | 2026/02/09 14:40:15 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:15 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:15 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 30.
app_1       | 2026/02/09 14:40:15 Client 1 (Conn: 2d32343f-676d-4a0d-a2d2-8e2858acca34) cleared QuizID
app_1       | 2026/02/09 14:40:15 Shard 0: Client 1 unsubscribed from Quiz 30
app_1       | 2026/02/09 14:40:15 Shard 0: client 1 unregistered
app_1       | 2026/02/09 14:40:15 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 2d32343f-676d-4a0d-a2d2-8e2858acca34)
app_1       | 2026/02/09 14:40:15 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 2d32343f-676d-4a0d-a2d2-8e2858acca34
app_1       | 2026/02/09 14:40:15 [ShardedHub] Отправлено обновление player_count для викторины #30: 1 игроков
app_1       | 2026/02/09 14:40:15 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:40:15 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:15 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:15 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb
app_1       | 2026/02/09 14:40:15 [Shard 0][Quiz 30][User 1][Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 14:40:15 [Shard 0][Quiz 30][User 1][Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 14:40:15 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:40:15 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:15 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:15 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.099ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:16.065') OR (is_active = false AND rotated_at > '2026-02-02 14:40:16.065' AND expires_at > '2026-02-09 14:40:16.065') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.537ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:40:16 | 200 |    2.206849ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:40:16 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.875ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:40:16 | 200 |     1.15009ms |      172.18.0.6 | GET      "/api/quizzes/30"
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.756ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:16.204') OR (is_active = false AND rotated_at > '2026-02-02 14:40:16.204' AND expires_at > '2026-02-09 14:40:16.204') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:40:16 | 200 |    1.155544ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:40:16 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:40:16 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.811ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:16.367') OR (is_active = false AND rotated_at > '2026-02-02 14:40:16.367' AND expires_at > '2026-02-09 14:40:16.367') ORDER BY created_at DESC
app_1       | 2026/02/09 14:40:16 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:40:16 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.091ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:16.369') OR (is_active = false AND rotated_at > '2026-02-02 14:40:16.369' AND expires_at > '2026-02-09 14:40:16.369') ORDER BY created_at DESC
app_1       | 2026/02/09 14:40:16 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/jwt_key_repo.go:99
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:56 +0000] "GET /ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0Nzk3MSwiaWF0IjoxNzcwNjQ3OTExLCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.egkimR-zlumuIccwn7ceh7SB8KUFaJi-z89j0qzy4rk HTTP/1.1" 101 167 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:38:58 +0000] "POST /api/auth/ws-ticket HTTP/2.0" 200 363 "https://qazaquiz.duckdns.org/admin/quiz-live/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:08 +0000] "GET /admin/quiz-live/30 HTTP/2.0" 200 3299 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:08 +0000] "GET /ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0Nzk5OCwiaWF0IjoxNzcwNjQ3OTM4LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.Z7e8HMSyS3ZY06HKrOesb3XOvEcFvXEXjS7PSfUFP98 HTTP/1.1" 101 84 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:08 +0000] "GET /api/users/me HTTP/2.0" 200 286 "https://qazaquiz.duckdns.org/admin/quiz-live/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:08 +0000] "GET /api/quizzes/30 HTTP/2.0" 200 238 "https://qazaquiz.duckdns.org/admin/quiz-live/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:08 +0000] "GET /api/auth/csrf HTTP/2.0" 200 81 "https://qazaquiz.duckdns.org/admin/quiz-live/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:08 +0000] "GET /admin/quizzes/30?_rsc=9416w HTTP/2.0" 200 171 "https://qazaquiz.duckdns.org/admin/quiz-live/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:08 +0000] "GET /admin/quizzes/30?_rsc=o2rnv HTTP/2.0" 200 821 "https://qazaquiz.duckdns.org/admin/quiz-live/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:09 +0000] "POST /api/auth/ws-ticket HTTP/2.0" 200 363 "https://qazaquiz.duckdns.org/admin/quiz-live/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:28 +0000] "GET /quiz/30/lobby HTTP/2.0" 200 5719 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:28 +0000] "GET /ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0Nzk5NSwiaWF0IjoxNzcwNjQ3OTM1LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.rvkWspZF6FIQivvwk7UqMjojiV-HGonKcquoeHIhJbM HTTP/1.1" 101 390 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:28 +0000] "GET /api/users/me HTTP/2.0" 200 286 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:28 +0000] "GET /favicon.ico?favicon.0b3bf435.ico HTTP/2.0" 200 25931 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:28 +0000] "GET /api/quizzes/30 HTTP/2.0" 200 238 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:28 +0000] "GET /api/auth/csrf HTTP/2.0" 200 81 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:28 +0000] "POST /api/auth/ws-ticket HTTP/2.0" 200 363 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:28 +0000] "GET /?_rsc=1swjf HTTP/2.0" 200 331 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:29 +0000] "GET /?_rsc=1uqdf HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:29 +0000] "GET /?_rsc=wjndt HTTP/2.0" 200 1138 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:29 +0000] "GET /?_rsc=1httj HTTP/2.0" 200 2352 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:29 +0000] "GET /?_rsc=tru38 HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:29 +0000] "GET /ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODAwOSwiaWF0IjoxNzcwNjQ3OTQ5LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.2oGeOk4zkaxBGulKl55WmysEzqjm8sfuGP7c9ThtvT0 HTTP/1.1" 101 301 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:39:35 +0000] "POST /api/auth/ws-ticket HTTP/2.0" 200 363 "https://qazaquiz.duckdns.org/admin/quiz-live/30" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:15 +0000] "GET /quiz/30/lobby HTTP/2.0" 200 5719 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:15 +0000] "GET /ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODAyOCwiaWF0IjoxNzcwNjQ3OTY4LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.rcF56mIBj3IGEr5ZHEiKF_QDLAxTj0SmXFs6-XXF_a0 HTTP/1.1" 101 238 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | [1.001ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:40:16.372' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:40:16 | 200 |    7.940386ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 14:40:16 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.044ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:16.805') OR (is_active = false AND rotated_at > '2026-02-02 14:40:16.805' AND expires_at > '2026-02-09 14:40:16.805') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:40:16 | 200 |    1.717443ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODA3NiwiaWF0IjoxNzcwNjQ4MDE2LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.Ou4YMfv2hYfFU8KLc92Ssn646eUt2bzRrpfvRxhMkFA"
app_1       | 2026/02/09 14:40:16 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:40:16 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:40:16 Shard 0: replacing client 1 with new connection
app_1       | 2026/02/09 14:40:16 Shard 0: client 1 registered
app_1       | 2026/02/09 14:40:16 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:40:16 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 3dbce8d1-f0f1-4569-9636-6075a6f7303c
app_1       | 2026/02/09 14:40:16 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 3dbce8d1-f0f1-4569-9636-6075a6f7303c
app_1       | 2026/02/09 14:40:16 Client 1 (Conn: 3dbce8d1-f0f1-4569-9636-6075a6f7303c) set QuizID to 30
app_1       | 2026/02/09 14:40:16 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 3dbce8d1-f0f1-4569-9636-6075a6f7303c) to Quiz 30
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] Client 1: Found existing map for quiz 30
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:40:16 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
app_1       | 2026/02/09 14:40:16 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:40:16 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:40:16 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:40:16 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:16 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:16 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb
app_1       | 2026/02/09 14:40:16 [Shard 0][Quiz 30][User 1][Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:40:16 [Shard 0][Quiz 30][User 1][Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:40:16 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 3dbce8d1-f0f1-4569-9636-6075a6f7303c
app_1       | 2026/02/09 14:40:16 [Shard 0][Quiz 30][User 1][Conn 3dbce8d1-f0f1-4569-9636-6075a6f7303c] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:40:16 [Shard 0][Quiz 30][User 1][Conn 3dbce8d1-f0f1-4569-9636-6075a6f7303c] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:40:16 Shard 0: Message broadcast to 2 clients in Quiz 30
app_1       | 2026/02/09 14:40:16 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:16 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:16 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:40:16 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 2)
app_1       | 2026/02/09 14:40:17 WebSocket Client Read Error (UserID: 1, ConnID: 9c26391a-8a78-46a0-affa-8c79dd0636bb): read tcp 172.18.0.5:8080->172.18.0.6:54422: use of closed network connection
app_1       | 2026/02/09 14:40:17 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 9c26391a-8a78-46a0-affa-8c79dd0636bb
app_1       | 2026/02/09 14:40:17 [Shard 0][User 1][Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb] handleUnregister called
app_1       | 2026/02/09 14:40:17 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 9c26391a-8a78-46a0-affa-8c79dd0636bb) from Quiz 30
app_1       | 2026/02/09 14:40:17 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:17 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:17 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 30.
app_1       | 2026/02/09 14:40:17 Client 1 (Conn: 9c26391a-8a78-46a0-affa-8c79dd0636bb) cleared QuizID
app_1       | 2026/02/09 14:40:17 Shard 0: Client 1 unsubscribed from Quiz 30
app_1       | 2026/02/09 14:40:17 [ShardedHub] Отправлено обновление player_count для викторины #30: 1 игроков
app_1       | 2026/02/09 14:40:17 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:40:17 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:17 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 9c26391a-8a78-46a0-affa-8c79dd0636bb)
app_1       | 2026/02/09 14:40:17 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 9c26391a-8a78-46a0-affa-8c79dd0636bb
app_1       | 2026/02/09 14:40:17 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:17 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 3dbce8d1-f0f1-4569-9636-6075a6f7303c
app_1       | 2026/02/09 14:40:17 [Shard 0][Quiz 30][User 1][Conn 3dbce8d1-f0f1-4569-9636-6075a6f7303c] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 14:40:17 [Shard 0][Quiz 30][User 1][Conn 3dbce8d1-f0f1-4569-9636-6075a6f7303c] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 14:40:17 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:40:17 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:17 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:17 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:40:27 WebSocket Client Connection Closed Normally (UserID: 1, ConnID: 3dbce8d1-f0f1-4569-9636-6075a6f7303c): websocket: close 1001 (going away)
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:16 +0000] "GET /api/users/me HTTP/2.0" 200 286 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:16 +0000] "GET /favicon.ico?favicon.0b3bf435.ico HTTP/2.0" 200 25931 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:16 +0000] "GET /api/quizzes/30 HTTP/2.0" 200 238 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:16 +0000] "GET /api/auth/csrf HTTP/2.0" 200 81 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:16 +0000] "GET /?_rsc=1swjf HTTP/2.0" 200 331 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:16 +0000] "POST /api/auth/ws-ticket HTTP/2.0" 200 363 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:16 +0000] "GET /?_rsc=1uqdf HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:16 +0000] "GET /?_rsc=wjndt HTTP/2.0" 200 1138 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:16 +0000] "GET /?_rsc=1httj HTTP/2.0" 200 2352 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:16 +0000] "GET /?_rsc=tru38 HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:17 +0000] "GET /ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODAzNSwiaWF0IjoxNzcwNjQ3OTc1LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.fQCxBO5LatW424fICvvAR7kj1DOQvGul8O86ePnqP24 HTTP/1.1" 101 303 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:27 +0000] "GET /quiz/30/lobby HTTP/2.0" 200 5719 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:27 +0000] "GET /ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODA3NiwiaWF0IjoxNzcwNjQ4MDE2LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.Ou4YMfv2hYfFU8KLc92Ssn646eUt2bzRrpfvRxhMkFA HTTP/1.1" 101 152 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:27 +0000] "GET /api/users/me HTTP/2.0" 200 286 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:27 +0000] "GET /favicon.ico?favicon.0b3bf435.ico HTTP/2.0" 200 25931 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:27 +0000] "GET /api/quizzes/30 HTTP/2.0" 200 238 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:27 +0000] "GET /api/auth/csrf HTTP/2.0" 200 81 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:27 +0000] "POST /api/auth/ws-ticket HTTP/2.0" 200 363 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:27 +0000] "GET /?_rsc=1swjf HTTP/2.0" 200 331 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:27 +0000] "GET /?_rsc=1uqdf HTTP/2.0" 200 592 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:27 +0000] "GET /?_rsc=wjndt HTTP/2.0" 200 1138 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:27 +0000] "GET /?_rsc=1httj HTTP/2.0" 200 2352 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.159 - - [09/Feb/2026:14:40:27 +0000] "GET /?_rsc=tru38 HTTP/2.0" 200 532 "https://qazaquiz.duckdns.org/quiz/30/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/09 14:40:27 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 3dbce8d1-f0f1-4569-9636-6075a6f7303c
app_1       | 2026/02/09 14:40:27 [Shard 0][User 1][Conn 3dbce8d1-f0f1-4569-9636-6075a6f7303c] handleUnregister called
app_1       | 2026/02/09 14:40:27 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 3dbce8d1-f0f1-4569-9636-6075a6f7303c) from Quiz 30
app_1       | 2026/02/09 14:40:27 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:27 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:27 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 30.
app_1       | 2026/02/09 14:40:27 Client 1 (Conn: 3dbce8d1-f0f1-4569-9636-6075a6f7303c) cleared QuizID
app_1       | 2026/02/09 14:40:27 Shard 0: Client 1 unsubscribed from Quiz 30
app_1       | 2026/02/09 14:40:27 Shard 0: client 1 unregistered
app_1       | 2026/02/09 14:40:27 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 3dbce8d1-f0f1-4569-9636-6075a6f7303c)
app_1       | 2026/02/09 14:40:27 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 3dbce8d1-f0f1-4569-9636-6075a6f7303c
app_1       | 2026/02/09 14:40:27 [ShardedHub] Отправлено обновление player_count для викторины #30: 0 игроков
app_1       | 2026/02/09 14:40:27 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:40:27 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:27 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:27 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:27 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:27 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:40:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:40:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.026ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:27.354') OR (is_active = false AND rotated_at > '2026-02-02 14:40:27.354' AND expires_at > '2026-02-09 14:40:27.354') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:40:27 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.496ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:40:27 | 200 |     2.03301ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:40:27 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.789ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:40:27 | 200 |     985.349µs |      172.18.0.6 | GET      "/api/quizzes/30"
app_1       | 
app_1       | 2026/02/09 14:40:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.677ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:27.502') OR (is_active = false AND rotated_at > '2026-02-02 14:40:27.502' AND expires_at > '2026-02-09 14:40:27.502') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:40:27 | 200 |     982.682µs |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:40:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:40:27 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:40:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.721ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:27.634') OR (is_active = false AND rotated_at > '2026-02-02 14:40:27.634' AND expires_at > '2026-02-09 14:40:27.634') ORDER BY created_at DESC
app_1       | 2026/02/09 14:40:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:40:27 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:40:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.629ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:27.635') OR (is_active = false AND rotated_at > '2026-02-02 14:40:27.635' AND expires_at > '2026-02-09 14:40:27.635') ORDER BY created_at DESC
app_1       | 2026/02/09 14:40:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:40:27 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [0.716ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:40:27.636' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 14:40:27 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [GIN] 2026/02/09 - 14:40:27 | 200 |    3.297978ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 14:40:28 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:40:28 WebSocket: registering client 1 in ShardedHub
app_1       | 
app_1       | 2026/02/09 14:40:28 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.801ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:28.043') OR (is_active = false AND rotated_at > '2026-02-02 14:40:28.043' AND expires_at > '2026-02-09 14:40:28.043') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:40:28 | 200 |    1.368579ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODA4NywiaWF0IjoxNzcwNjQ4MDI3LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.ai5prwG_tsc664zdmbbRoT0qg7Bd-0DdaEdkgW4uRHA"
app_1       | 2026/02/09 14:40:28 Shard 0: client 1 registered
app_1       | 2026/02/09 14:40:28 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:40:28 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 4388f979-de6d-4878-83fb-0f0920cffbf7
app_1       | 2026/02/09 14:40:28 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 4388f979-de6d-4878-83fb-0f0920cffbf7
app_1       | 2026/02/09 14:40:28 Client 1 (Conn: 4388f979-de6d-4878-83fb-0f0920cffbf7) set QuizID to 30
app_1       | 2026/02/09 14:40:28 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 4388f979-de6d-4878-83fb-0f0920cffbf7) to Quiz 30
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] Client 1: Found existing map for quiz 30
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:40:28 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
app_1       | 2026/02/09 14:40:28 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:40:28 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:40:28 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:40:28 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:28 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:28 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 4388f979-de6d-4878-83fb-0f0920cffbf7
app_1       | 2026/02/09 14:40:28 [Shard 0][Quiz 30][User 1][Conn 4388f979-de6d-4878-83fb-0f0920cffbf7] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:40:28 [Shard 0][Quiz 30][User 1][Conn 4388f979-de6d-4878-83fb-0f0920cffbf7] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:40:28 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:40:28 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:28 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:28 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:40:28 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 1)
app_1       | 2026/02/09 14:40:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
^CERROR: Aborting.
saizhansco@instance-20260124-111940:~/myapp/trivia-api$ sudo docker-compose logs -f app
Attaching to trivia-api_app_1
app_1       | 2026/02/09 14:26:35 Загрузка конфигурации из config/config.yaml
app_1       | 2026/02/09 14:26:35 Запуск применения миграций базы данных...
app_1       | 2026/02/09 14:26:35 Применяем миграции 'up'...
app_1       | 2026/02/09 14:26:35 Миграции успешно применены.
app_1       | 2026/02/09 14:26:35 Миграции базы данных завершены.
app_1       | 2026/02/09 14:26:35 Successfully connected to Redis
app_1       | 2026/02/09 14:26:35 [TokenManager] Initializing and ensuring JWT keys...
app_1       | 2026/02/09 14:26:35 [TokenManager] Active JWT key ID: a488fda381b19b17 found in repository.
app_1       | 2026/02/09 14:26:35 [TokenManager] Access token expiry set to: 24h0m0s
app_1       | 2026/02/09 14:26:35 [TokenManager] Refresh token expiry set to: 720h0m0s
app_1       | 2026/02/09 14:26:35 [TokenManager] Max refresh tokens per user set to: 10
app_1       | 2026/02/09 14:26:35 [TokenManager] Production mode set to: true, Cookie Secure set to: true
app_1       | 2026/02/09 14:26:35 [TokenManager] Cookie attributes set: Path=/, Domain=, Secure=true, HttpOnly=true, SameSite=4
app_1       | 2026/02/09 14:26:35 Инициализация Redis PubSub для кластеризации WebSocket...
app_1       | 
app_1       | 2026/02/09 14:26:35 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [41.459ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:26:35.858' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 14:26:35 RedisPubSub provider created using existing client.
app_1       | 2026/02/09 14:26:35 Redis PubSub провайдер успешно инициализирован
app_1       | 2026/02/09 14:26:35 Получено 0 записей из invalid_tokens
app_1       | 2026/02/09 14:26:35 JWT: Loaded 0 invalidated tokens from database
app_1       | 2026/02/09 14:26:35 [TokenManager] JWTService has been set.
app_1       | 
app_1       | 2026/02/09 14:26:35 /app/internal/repository/postgres/invalid_token_repo.go:89
app_1       | [6.470ms] [rows:0] SELECT * FROM "invalid_tokens"
app_1       | 2026/02/09 14:26:35 WebSocket: инициализация ShardedHub
app_1       | 2026/02/09 14:26:35 WorkerPool: запущен пул с 8 воркерами
app_1       | 2026/02/09 14:26:35 WorkerPool: запущен пул с 8 воркерами
app_1       | 2026/02/09 14:26:35 [Шард 0] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 14:26:35 [Шард 1] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 14:26:35 [Шард 2] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 14:26:35 [Шард 3] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 14:26:35 ClusterHub: Instance ID не задан, сгенерирован: instance_20260209142635_uJy0mmmA
app_1       | 2026/02/09 14:26:35 ShardedHub создан с 4 шардами
app_1       | 2026/02/09 14:26:35 WebSocket: кластерный режим включен
app_1       | 2026/02/09 14:26:35 [QuizManager] Менеджер викторин успешно инициализирован
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 2 запущен
app_1       | 2026/02/09 14:26:35 [JWTService] Starting periodic cleanup routine every 1h0m0s
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 3 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 4 запущен
app_1       | 2026/02/09 14:26:35 RedisPubSub: Subscribing to channel 'jwt_invalidation_events'
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 5 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 6 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 7 запущен
app_1       | 2026/02/09 14:26:35 [Shard 0] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 14:26:35 [Shard 1] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 14:26:35 [Shard 2] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 14:26:35 [Shard 3] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 14:26:35 ShardedHub: запуск с 4 шардами, до 5000 клиентов на шард
app_1       | 2026/02/09 14:26:35 ClusterHub: запуск кластерного режима, ID экземпляра: instance_20260209142635_uJy0mmmA
app_1       | 2026/02/09 14:26:35 ClusterHub: Запуск публикации метрик каждые 1m0s
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 4 запущен
app_1       | 2026/02/09 14:26:35 Запуск механизма периодической очистки CSRF токенов и истекших refresh-токенов (каждый час)
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 0 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 1 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 2 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 3 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 7 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 5 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 6 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 1 запущен
app_1       | 2026/02/09 14:26:35 WorkerPool: воркер 0 запущен
app_1       | 2026/02/09 14:26:35 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:ready
app_1       | 2026/02/09 14:26:35 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:answer
app_1       | 2026/02/09 14:26:35 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:heartbeat
app_1       | 2026/02/09 14:26:35 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:resync
app_1       | 2026/02/09 14:26:35 Server started on port 8080
app_1       | 2026/02/09 14:26:35 Starting server on port 8080
app_1       | 2026/02/09 14:26:35 RedisPubSub: Successfully subscribed to channel 'jwt_invalidation_events'
app_1       | 2026/02/09 14:26:35 [JWTService] Успешно подписан на канал jwt_invalidation_events для синхронизации кэша.
app_1       | 2026/02/09 14:26:35 RedisPubSub: Subscribing to channel 'ws:broadcast'
app_1       | 2026/02/09 14:26:35 RedisPubSub: Successfully subscribed to channel 'ws:broadcast'
app_1       | 2026/02/09 14:26:35 ClusterHub: начата обработка широковещательных сообщений
app_1       | 2026/02/09 14:26:35 RedisPubSub: Subscribing to channel 'ws:direct'
app_1       | 2026/02/09 14:26:35 RedisPubSub: Successfully subscribed to channel 'ws:direct'
app_1       | 2026/02/09 14:26:35 [ClusterHub:Direct] Успешно подписан на канал прямых сообщений: ws:direct
app_1       | 2026/02/09 14:26:35 RedisPubSub: Subscribing to channel 'ws:metrics'
app_1       | 
app_1       | 2026/02/09 14:26:35 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [17.683ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:26:35.919' ORDER BY scheduled_time
app_1       | 2026/02/09 14:26:35 RedisPubSub: Successfully subscribed to channel 'ws:metrics'
app_1       | 2026/02/09 14:26:35 [ClusterHub:Metrics] Успешно подписан на канал метрик: ws:metrics
app_1       | 2026/02/09 14:27:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:28:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:29:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:30:14 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.376ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:30:14.261' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:30:14 | 200 |    2.100932ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | [GIN] 2026/02/09 - 14:30:14 | 401 |     131.521µs |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/user_repo.go:46
app_1       | [4.805ms] [rows:1] SELECT * FROM "users" WHERE email = 'temirlan@mail.ru' ORDER BY "users"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/user_repo.go:33
app_1       | [1.539ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 14:30:25 [JWT] Токен доступа успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.084ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:30:25.408' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/refresh_token_repo.go:32
app_1       | [8.400ms] [rows:1] INSERT INTO "refresh_tokens" ("user_id","token","device_id","ip_address","user_agent","expires_at","created_at","is_expired","revoked_at","reason") VALUES (1,'ce3c926b57be941c99c54e22c7816c2ca70023056f646befb1c2c19bf9a53010','Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36','172.18.0.6','Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36','2026-03-11 14:30:25.41','2026-02-09 14:30:25.41',false,NULL,'') RETURNING "id"
app_1       | 2026/02/09 14:30:25 [TokenManager] Сгенерирована пара токенов для пользователя ID=1, JWT Key ID: a488fda381b19b17
app_1       | 2026/02/09 14:30:25 JWT: UserID: 1 was not in the invalidation list
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/refresh_token_repo.go:159
app_1       | [2.442ms] [rows:1] SELECT count(*) FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:30:25.418'
app_1       | 2026/02/09 14:30:25 Запись в invalid_tokens для пользователя ID=1 не найдена
app_1       | 2026/02/09 14:30:25 [AuthService] Пользователь ID=1 (temirlan@mail.ru) успешно вошел в систему
app_1       | 2026/02/09 14:30:25 [TokenManager] Установлена CSRF secret cookie (__Host-csrf-secret) с Secure=true, MaxAge: 86400 секунд
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/invalid_token_repo.go:46
app_1       | [1.989ms] [rows:0] DELETE FROM "invalid_tokens" WHERE "invalid_tokens"."user_id" = 1
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.894ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:30:25 | 200 |  104.775182ms |      172.18.0.6 | POST     "/api/auth/login"
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.632ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:25.56') OR (is_active = false AND rotated_at > '2026-02-02 14:30:25.56' AND expires_at > '2026-02-09 14:30:25.56') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:30:25 | 200 |    2.117411ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:30:25 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 2026/02/09 14:30:25 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:30:25 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.828ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:30:25.575' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:30:25 | 200 |    1.043752ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:30:27 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.199ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:30:27.382' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:30:27 | 200 |    1.442233ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:30:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.283ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:27.383') OR (is_active = false AND rotated_at > '2026-02-02 14:30:27.383' AND expires_at > '2026-02-09 14:30:27.383') ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:27 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.795ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:30:27 | 200 |    3.060649ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:30:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.804ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:27.517') OR (is_active = false AND rotated_at > '2026-02-02 14:30:27.517' AND expires_at > '2026-02-09 14:30:27.517') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:30:27 | 200 |    1.173735ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:30:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 2026/02/09 14:30:27 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:30:28 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.260ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:28.532') OR (is_active = false AND rotated_at > '2026-02-02 14:30:28.532' AND expires_at > '2026-02-09 14:30:28.532') ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:28 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:28 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [2.213ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:30:28.534' ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:28 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | [GIN] 2026/02/09 - 14:30:28 | 200 |    4.300933ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 14:30:34 /app/internal/repository/postgres/user_repo.go:179
app_1       | [0.892ms] [rows:1] SELECT count(*) FROM "users"
app_1       | 
app_1       | 2026/02/09 14:30:34 /app/internal/repository/postgres/user_repo.go:191
app_1       | [1.174ms] [rows:10] SELECT "id","username","profile_picture","wins_count","total_prize_won" FROM "users" ORDER BY wins_count DESC, total_prize_won DESC, id ASC LIMIT 10
app_1       | [GIN] 2026/02/09 - 14:30:34 | 200 |    3.364433ms |      172.18.0.6 | GET      "/api/leaderboard?page=1&page_size=10"
app_1       | 2026/02/09 14:30:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:30:36 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.418ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:36.077') OR (is_active = false AND rotated_at > '2026-02-02 14:30:36.077' AND expires_at > '2026-02-09 14:30:36.077') ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:36 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:36 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [1.595ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:30:36.079' ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:30:36 | 200 |    3.862745ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 2026/02/09 14:30:36 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | 2026/02/09 14:30:36 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:36 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.315ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:36.992') OR (is_active = false AND rotated_at > '2026-02-02 14:30:36.992' AND expires_at > '2026-02-09 14:30:36.992') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:30:36 /app/internal/repository/postgres/result_repo.go:119
app_1       | [3.923ms] [rows:1] SELECT count(*) FROM "results" WHERE user_id = 1
app_1       | 
app_1       | 2026/02/09 14:30:37 /app/internal/repository/postgres/result_repo.go:128
app_1       | [1.712ms] [rows:9] SELECT * FROM "results" WHERE user_id = 1 ORDER BY created_at DESC LIMIT 10
app_1       | [GIN] 2026/02/09 - 14:30:37 | 200 |    7.936192ms |      172.18.0.6 | GET      "/api/users/me/results?page=1&page_size=10"
app_1       | 
app_1       | 2026/02/09 14:30:38 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.160ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:30:38.362' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:30:38 | 200 |    1.465849ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 2026/02/09 14:30:39 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:39 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.016ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:39.302') OR (is_active = false AND rotated_at > '2026-02-02 14:30:39.302' AND expires_at > '2026-02-09 14:30:39.302') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:30:39 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [1.608ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:30:39.304' ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:39 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | [GIN] 2026/02/09 - 14:30:39 | 200 |    3.314486ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 14:30:41 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [3.353ms] [rows:29] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:30:41 | 200 |    3.924484ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.642ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:30:47.558') OR (is_active = false AND rotated_at > '2026-02-02 14:30:47.558' AND expires_at > '2026-02-09 14:30:47.558') ORDER BY created_at DESC
app_1       | 2026/02/09 14:30:47 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:188
app_1       | [9.720ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:193
app_1       | [2.260ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:202
app_1       | [1.583ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 1
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:202
app_1       | [3.037ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 2
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:202
app_1       | [2.203ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 3
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:202
app_1       | [0.874ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 4
app_1       | 
app_1       | 2026/02/09 14:30:47 /app/internal/repository/postgres/question_repo.go:202
app_1       | [0.757ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 5
app_1       | [GIN] 2026/02/09 - 14:30:47 | 200 |   25.035695ms |      172.18.0.6 | GET      "/api/admin/question-pool/stats"
app_1       | 
app_1       | 2026/02/09 14:30:59 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.990ms] [rows:29] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:30:59 | 200 |     3.35556ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 14:31:35 [Shard 2] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:31:35 [Shard 0] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:31:35 [Shard 1] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:31:35 [Shard 3] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:31:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:31:42 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:31:42 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.877ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:31:42.976') OR (is_active = false AND rotated_at > '2026-02-02 14:31:42.976' AND expires_at > '2026-02-09 14:31:42.976') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:31:42 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.854ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:31:42 | 200 |    2.337131ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:32:13 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.917ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:32:13.983') OR (is_active = false AND rotated_at > '2026-02-02 14:32:13.983' AND expires_at > '2026-02-09 14:32:13.983') ORDER BY created_at DESC
app_1       | 2026/02/09 14:32:13 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:32:13 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.573ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:32:13 | 200 |    2.063629ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:32:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:33:03 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.000ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:33:03.813') OR (is_active = false AND rotated_at > '2026-02-02 14:33:03.813' AND expires_at > '2026-02-09 14:33:03.813') ORDER BY created_at DESC
app_1       | 2026/02/09 14:33:03 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:33:03 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.778ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:33:03 | 200 |    2.527173ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:33:12 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.343ms] [rows:29] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:33:12 | 200 |    1.932128ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 14:33:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:33:36 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.068ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:33:36.212' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:33:36 | 200 |     1.27817ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:33:37 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.387ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:33:37.681') OR (is_active = false AND rotated_at > '2026-02-02 14:33:37.681' AND expires_at > '2026-02-09 14:33:37.681') ORDER BY created_at DESC
app_1       | 2026/02/09 14:33:37 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:33:37 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [1.679ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:33:37.683' ORDER BY created_at DESC
app_1       | 2026/02/09 14:33:37 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | [GIN] 2026/02/09 - 14:33:37 | 200 |    3.964902ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 14:33:39 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.960ms] [rows:29] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:33:39 | 200 |    2.731006ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 14:34:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:34:59 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [103.389ms] [rows:10] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 25
app_1       | 
app_1       | 2026/02/09 14:34:59 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [105.888ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 25 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:34:59 | 200 |  106.242519ms |      172.18.0.6 | GET      "/api/quizzes/25/with-questions"
app_1       | 2026/02/09 14:34:59 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:34:59 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.118ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:34:59.879') OR (is_active = false AND rotated_at > '2026-02-02 14:34:59.879' AND expires_at > '2026-02-09 14:34:59.879') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:34:59 /app/internal/repository/postgres/quiz_ad_slot_repo.go:38
app_1       | [11.093ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 25 ORDER BY question_after ASC
app_1       | [GIN] 2026/02/09 - 14:34:59 | 200 |   13.162936ms |      172.18.0.6 | GET      "/api/quizzes/25/ad-slots"
app_1       | 
app_1       | 2026/02/09 14:34:59 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [20.359ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:34:59.884') OR (is_active = false AND rotated_at > '2026-02-02 14:34:59.884' AND expires_at > '2026-02-09 14:34:59.884') ORDER BY created_at DESC
app_1       | 2026/02/09 14:34:59 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:34:59 /app/internal/repository/postgres/ad_asset_repo.go:35
app_1       | [8.646ms] [rows:0] SELECT * FROM "ad_assets" ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:34:59 | 200 |   29.976498ms |      172.18.0.6 | GET      "/api/admin/ads"
app_1       | 
app_1       | 2026/02/09 14:35:00 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [6.022ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:35:00.319' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:35:00 | 200 |    6.237635ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:35:04 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.236ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:35:04.482' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:35:04 | 200 |    1.440536ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:35:04 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.196ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:35:04.493') OR (is_active = false AND rotated_at > '2026-02-02 14:35:04.493' AND expires_at > '2026-02-09 14:35:04.493') ORDER BY created_at DESC
app_1       | 2026/02/09 14:35:04 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:35:04 /app/internal/repository/postgres/user_repo.go:33
app_1       | [5.111ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:35:04 | 200 |    7.215956ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:35:04 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 2026/02/09 14:35:04 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:35:04 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.921ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:35:04.66') OR (is_active = false AND rotated_at > '2026-02-02 14:35:04.66' AND expires_at > '2026-02-09 14:35:04.66') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:35:04 | 200 |    1.359947ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:35:11 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 2026/02/09 14:35:11 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:35:11 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.579ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:35:11.425') OR (is_active = false AND rotated_at > '2026-02-02 14:35:11.425' AND expires_at > '2026-02-09 14:35:11.425') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:35:11 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.238ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:35:11.427') OR (is_active = false AND rotated_at > '2026-02-02 14:35:11.427' AND expires_at > '2026-02-09 14:35:11.427') ORDER BY created_at DESC
app_1       | 2026/02/09 14:35:11 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:30:25 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:35:11 /app/internal/repository/postgres/refresh_token_repo.go:112
app_1       | [5.092ms] [rows:1] UPDATE "refresh_tokens" SET "expires_at"='2026-02-09 13:35:11.429' WHERE token = 'ce3c926b57be941c99c54e22c7816c2ca70023056f646befb1c2c19bf9a53010'
app_1       | 2026/02/09 14:35:11 [TokenManager] Отозван refresh-токен
app_1       | 2026/02/09 14:35:11 [AuthService] Refresh токен успешно отозван
app_1       | 2026/02/09 14:35:11 [AuthHandler] Logout: User logged out successfully.
app_1       | [GIN] 2026/02/09 - 14:35:11 | 200 |   10.086008ms |      172.18.0.6 | POST     "/api/auth/logout"
app_1       | [GIN] 2026/02/09 - 14:35:11 | 401 |      76.752µs |      172.18.0.6 | GET      "/api/users/me"
app_1       | [GIN] 2026/02/09 - 14:35:13 | 401 |      66.186µs |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:35:13 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.271ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:35:13.067' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:35:13 | 200 |    1.550175ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | [GIN] 2026/02/09 - 14:35:15 | 401 |      63.457µs |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:35:15 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [2.706ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:35:15.134' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:35:15 | 200 |    2.877854ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | [GIN] 2026/02/09 - 14:35:17 | 401 |      65.076µs |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:35:17 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.618ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:35:17.352' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:35:17 | 200 |    2.123497ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | [GIN] 2026/02/09 - 14:35:25 | 401 |      82.435µs |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:35:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:35:39 /app/internal/repository/postgres/user_repo.go:46
app_1       | [1.512ms] [rows:1] SELECT * FROM "users" WHERE email = 'temirlan@mail.ru' ORDER BY "users"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 14:35:39 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.714ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 14:35:39 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [2.032ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:35:39.899' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 14:35:39 [JWT] Токен доступа успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17
app_1       | 
app_1       | 2026/02/09 14:35:39 /app/internal/repository/postgres/refresh_token_repo.go:32
app_1       | [3.824ms] [rows:1] INSERT INTO "refresh_tokens" ("user_id","token","device_id","ip_address","user_agent","expires_at","created_at","is_expired","revoked_at","reason") VALUES (1,'d55ce5c980dc43116dd86973eeea09ceab999b3381014c4f2b15aba36e0f8ae5','Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36','172.18.0.6','Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36','2026-03-11 14:35:39.901','2026-02-09 14:35:39.901',false,NULL,'') RETURNING "id"
app_1       | 2026/02/09 14:35:39 [TokenManager] Сгенерирована пара токенов для пользователя ID=1, JWT Key ID: a488fda381b19b17
app_1       | 2026/02/09 14:35:39 JWT: UserID: 1 was not in the invalidation list
app_1       | 
app_1       | 2026/02/09 14:35:39 /app/internal/repository/postgres/refresh_token_repo.go:159
app_1       | [1.850ms] [rows:1] SELECT count(*) FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:35:39.905'
app_1       | 
app_1       | 2026/02/09 14:35:39 /app/internal/repository/postgres/invalid_token_repo.go:46
app_1       | [2.177ms] [rows:0] DELETE FROM "invalid_tokens" WHERE "invalid_tokens"."user_id" = 1
app_1       | 2026/02/09 14:35:39 Запись в invalid_tokens для пользователя ID=1 не найдена
app_1       | 2026/02/09 14:35:39 [AuthService] Пользователь ID=1 (temirlan@mail.ru) успешно вошел в систему
app_1       | 2026/02/09 14:35:39 [TokenManager] Установлена CSRF secret cookie (__Host-csrf-secret) с Secure=true, MaxAge: 86400 секунд
app_1       | 
app_1       | 2026/02/09 14:35:39 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.660ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:35:39 | 200 |   93.444843ms |      172.18.0.6 | POST     "/api/auth/login"
app_1       | 
app_1       | 2026/02/09 14:35:40 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.847ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:35:40.047') OR (is_active = false AND rotated_at > '2026-02-02 14:35:40.047' AND expires_at > '2026-02-09 14:35:40.047') ORDER BY created_at DESC
app_1       | 2026/02/09 14:35:40 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:35:40 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | [GIN] 2026/02/09 - 14:35:40 | 200 |    1.182219ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 
app_1       | 2026/02/09 14:35:40 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.638ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:35:40.064' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:35:40 | 200 |     787.149µs |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 2026/02/09 14:36:35 [Shard 0] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:36:35 [Shard 1] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:36:35 [Shard 2] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:36:35 [Shard 3] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:36:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:36:56 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.988ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:36:56.951' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:36:56 | 200 |    1.221849ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:36:56 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.988ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:36:56.951') OR (is_active = false AND rotated_at > '2026-02-02 14:36:56.951' AND expires_at > '2026-02-09 14:36:56.951') ORDER BY created_at DESC
app_1       | 2026/02/09 14:36:56 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:36:56 /app/internal/repository/postgres/user_repo.go:33
app_1       | [1.147ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:36:56 | 200 |    2.792223ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:36:57 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:36:57 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:36:57 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.934ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:36:57.098') OR (is_active = false AND rotated_at > '2026-02-02 14:36:57.098' AND expires_at > '2026-02-09 14:36:57.098') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:36:57 | 200 |    1.370881ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:37:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:37:36 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.801ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:37:36.692') OR (is_active = false AND rotated_at > '2026-02-02 14:37:36.692' AND expires_at > '2026-02-09 14:37:36.692') ORDER BY created_at DESC
app_1       | 2026/02/09 14:37:36 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:37:36 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.392ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:37:36 | 200 |    1.655621ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:37:56 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:37:56 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | 
app_1       | 2026/02/09 14:37:56 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.188ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:37:56.883') OR (is_active = false AND rotated_at > '2026-02-02 14:37:56.883' AND expires_at > '2026-02-09 14:37:56.883') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:37:56 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [1.221ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:37:56.884' ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:37:56 | 200 |    3.335546ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 14:37:58 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.503ms] [rows:29] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:37:58 | 200 |    2.090172ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 14:38:24 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:38:24 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:38:24 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.094ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:24.717') OR (is_active = false AND rotated_at > '2026-02-02 14:38:24.717' AND expires_at > '2026-02-09 14:38:24.717') ORDER BY created_at DESC
app_1       | 2026/02/09 14:38:24 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:38:24 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.636ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:24.719') OR (is_active = false AND rotated_at > '2026-02-02 14:38:24.719' AND expires_at > '2026-02-09 14:38:24.719') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:38:24 /app/internal/repository/postgres/quiz_repo.go:26
app_1       | [5.937ms] [rows:1] INSERT INTO "quizzes" ("title","description","scheduled_time","status","question_count","prize_fund","created_at","updated_at") VALUES ('Проверка викторины','','2026-02-09 14:40:00','scheduled',0,900,'2026-02-09 14:38:24.72','2026-02-09 14:38:24.72') RETURNING "id"
app_1       | [GIN] 2026/02/09 - 14:38:24 | 201 |    8.884932ms |      172.18.0.6 | POST     "/api/quizzes"
app_1       | 
app_1       | 2026/02/09 14:38:25 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.494ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 30
app_1       | 
app_1       | 2026/02/09 14:38:25 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [1.392ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:38:25 | 200 |    1.581963ms |      172.18.0.6 | GET      "/api/quizzes/30/with-questions"
app_1       | 2026/02/09 14:38:29 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:38:29 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.682ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:29.1') OR (is_active = false AND rotated_at > '2026-02-02 14:38:29.1' AND expires_at > '2026-02-09 14:38:29.1') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:38:29 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.907ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:38:29 | 200 |    3.529634ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:38:29 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.716ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:38:29 | 200 |     983.672µs |      172.18.0.6 | GET      "/api/quizzes/30"
app_1       | 
app_1       | 2026/02/09 14:38:29 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.926ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:29.237') OR (is_active = false AND rotated_at > '2026-02-02 14:38:29.237' AND expires_at > '2026-02-09 14:38:29.237') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:38:29 | 200 |    1.237317ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:38:29 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:38:29 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 2026/02/09 14:38:29 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:38:29 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.960ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:29.48') OR (is_active = false AND rotated_at > '2026-02-02 14:38:29.48' AND expires_at > '2026-02-09 14:38:29.48') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:38:29 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.859ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:38:29 | 200 |    2.627749ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:38:31 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.102ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:31.722') OR (is_active = false AND rotated_at > '2026-02-02 14:38:31.722' AND expires_at > '2026-02-09 14:38:31.722') ORDER BY created_at DESC
app_1       | 2026/02/09 14:38:31 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:38:31 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 2026/02/09 14:38:31 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:38:31 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.939ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:31.724') OR (is_active = false AND rotated_at > '2026-02-02 14:38:31.724' AND expires_at > '2026-02-09 14:38:31.724') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:38:31 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [0.870ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:38:31.725' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 14:38:31 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [GIN] 2026/02/09 - 14:38:31 | 200 |    4.371605ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 
app_1       | 2026/02/09 14:38:32 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.684ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:32.157') OR (is_active = false AND rotated_at > '2026-02-02 14:38:32.157' AND expires_at > '2026-02-09 14:38:32.157') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:38:32 | 200 |    1.318711ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0Nzk3MSwiaWF0IjoxNzcwNjQ3OTExLCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.egkimR-zlumuIccwn7ceh7SB8KUFaJi-z89j0qzy4rk"
app_1       | 2026/02/09 14:38:32 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:38:32 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:38:32 Shard 0: client 1 registered
app_1       | 2026/02/09 14:38:32 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:38:32 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 4f6ca735-3456-46a9-8e06-76e5a73135e5
app_1       | 2026/02/09 14:38:32 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 4f6ca735-3456-46a9-8e06-76e5a73135e5
app_1       | 2026/02/09 14:38:32 Client 1 (Conn: 4f6ca735-3456-46a9-8e06-76e5a73135e5) set QuizID to 30
app_1       | 2026/02/09 14:38:32 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 4f6ca735-3456-46a9-8e06-76e5a73135e5) to Quiz 30
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] Client 1: Created new map for quiz 30
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:38:32 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:38:32 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
app_1       | 2026/02/09 14:38:32 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:38:32 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:38:32 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:38:32 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:32 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:32 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 4f6ca735-3456-46a9-8e06-76e5a73135e5
app_1       | 2026/02/09 14:38:32 [Shard 0][Quiz 30][User 1][Conn 4f6ca735-3456-46a9-8e06-76e5a73135e5] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:38:32 [Shard 0][Quiz 30][User 1][Conn 4f6ca735-3456-46a9-8e06-76e5a73135e5] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:38:32 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:38:32 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:32 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:32 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:38:32 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 1)
app_1       | 2026/02/09 14:38:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:38:45 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.753ms] [rows:30] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:38:45 | 200 |    2.185726ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 
app_1       | 2026/02/09 14:38:48 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.983ms] [rows:1] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:38:48.676' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:38:48 | 200 |    1.259478ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:38:55 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [1.362ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:38:55 | 200 |    1.631205ms |      172.18.0.6 | GET      "/api/quizzes/30"
app_1       | 
app_1       | 2026/02/09 14:38:55 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.778ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:55.622') OR (is_active = false AND rotated_at > '2026-02-02 14:38:55.622' AND expires_at > '2026-02-09 14:38:55.622') ORDER BY created_at DESC
app_1       | 2026/02/09 14:38:55 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:38:55 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:38:55 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.585ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:55.624') OR (is_active = false AND rotated_at > '2026-02-02 14:38:55.624' AND expires_at > '2026-02-09 14:38:55.624') ORDER BY created_at DESC
app_1       | 2026/02/09 14:38:55 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:38:55 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | 
app_1       | 2026/02/09 14:38:55 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.192ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:38:55.625' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:38:55 | 200 |    4.277168ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 
app_1       | 2026/02/09 14:38:56 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.794ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:56.041') OR (is_active = false AND rotated_at > '2026-02-02 14:38:56.041' AND expires_at > '2026-02-09 14:38:56.041') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:38:56 | 200 |    1.426391ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0Nzk5NSwiaWF0IjoxNzcwNjQ3OTM1LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.rvkWspZF6FIQivvwk7UqMjojiV-HGonKcquoeHIhJbM"
app_1       | 2026/02/09 14:38:56 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:38:56 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:38:56 Shard 0: replacing client 1 with new connection
app_1       | 2026/02/09 14:38:56 Shard 0: client 1 registered
app_1       | 2026/02/09 14:38:56 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:38:56 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:38:56 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:38:56 Client 1 (Conn: 017ac53c-7f68-42c8-b486-2495a06f3c13) set QuizID to 30
app_1       | 2026/02/09 14:38:56 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 017ac53c-7f68-42c8-b486-2495a06f3c13) to Quiz 30
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] Client 1: Found existing map for quiz 30
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:38:56 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:38:56 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
app_1       | 2026/02/09 14:38:56 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:38:56 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:38:56 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:38:56 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:56 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 4f6ca735-3456-46a9-8e06-76e5a73135e5
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][User 1][Conn 4f6ca735-3456-46a9-8e06-76e5a73135e5] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][User 1][Conn 4f6ca735-3456-46a9-8e06-76e5a73135e5] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:38:56 Shard 0: Message broadcast to 2 clients in Quiz 30
app_1       | 2026/02/09 14:38:56 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:56 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:38:56 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 2)
app_1       | 2026/02/09 14:38:56 WebSocket Client Read Error (UserID: 1, ConnID: 4f6ca735-3456-46a9-8e06-76e5a73135e5): read tcp 172.18.0.5:8080->172.18.0.6:50030: use of closed network connection
app_1       | 2026/02/09 14:38:56 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 4f6ca735-3456-46a9-8e06-76e5a73135e5
app_1       | 2026/02/09 14:38:56 [Shard 0][User 1][Conn 4f6ca735-3456-46a9-8e06-76e5a73135e5] handleUnregister called
app_1       | 2026/02/09 14:38:56 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 4f6ca735-3456-46a9-8e06-76e5a73135e5) from Quiz 30
app_1       | 2026/02/09 14:38:56 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:38:56 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:38:56 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 30.
app_1       | 2026/02/09 14:38:56 Client 1 (Conn: 4f6ca735-3456-46a9-8e06-76e5a73135e5) cleared QuizID
app_1       | 2026/02/09 14:38:56 Shard 0: Client 1 unsubscribed from Quiz 30
app_1       | 2026/02/09 14:38:56 [ShardedHub] Отправлено обновление player_count для викторины #30: 1 игроков
app_1       | 2026/02/09 14:38:56 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:38:56 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:38:56 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 4f6ca735-3456-46a9-8e06-76e5a73135e5)
app_1       | 2026/02/09 14:38:56 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 4f6ca735-3456-46a9-8e06-76e5a73135e5
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 14:38:56 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 14:38:56 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:38:56 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:38:56 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:38:56 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 
app_1       | 2026/02/09 14:38:58 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.026ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:58.457') OR (is_active = false AND rotated_at > '2026-02-02 14:38:58.457' AND expires_at > '2026-02-09 14:38:58.457') ORDER BY created_at DESC
app_1       | 2026/02/09 14:38:58 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:38:58 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:38:58 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.573ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:58.459') OR (is_active = false AND rotated_at > '2026-02-02 14:38:58.459' AND expires_at > '2026-02-09 14:38:58.459') ORDER BY created_at DESC
app_1       | 2026/02/09 14:38:58 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:38:58 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | 
app_1       | 2026/02/09 14:38:58 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.131ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:38:58.46' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:38:58 | 200 |    4.310341ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 14:38:58 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:38:58 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:38:58 Shard 0: client 1 registered
app_1       | 2026/02/09 14:38:58 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:38:58 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: cb0f9325-d521-4903-936a-79f9ffec6750
app_1       | 2026/02/09 14:38:58 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: cb0f9325-d521-4903-936a-79f9ffec6750
app_1       | 
app_1       | 2026/02/09 14:38:58 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.879ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:38:58.992') OR (is_active = false AND rotated_at > '2026-02-02 14:38:58.992' AND expires_at > '2026-02-09 14:38:58.992') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:38:58 | 200 |    1.430831ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0Nzk5OCwiaWF0IjoxNzcwNjQ3OTM4LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.Z7e8HMSyS3ZY06HKrOesb3XOvEcFvXEXjS7PSfUFP98"
app_1       | 2026/02/09 14:38:59 Client 1 (Conn: cb0f9325-d521-4903-936a-79f9ffec6750) set QuizID to 30
app_1       | 2026/02/09 14:38:59 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: cb0f9325-d521-4903-936a-79f9ffec6750) to Quiz 30
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] Client 1: Found existing map for quiz 30
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:38:59 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:38:59 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
app_1       | 2026/02/09 14:38:59 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:38:59 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:38:59 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:38:59 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:59 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:59 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:38:59 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:38:59 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:38:59 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn cb0f9325-d521-4903-936a-79f9ffec6750
app_1       | 2026/02/09 14:38:59 [Shard 0][Quiz 30][User 1][Conn cb0f9325-d521-4903-936a-79f9ffec6750] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:38:59 [Shard 0][Quiz 30][User 1][Conn cb0f9325-d521-4903-936a-79f9ffec6750] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:38:59 Shard 0: Message broadcast to 2 clients in Quiz 30
app_1       | 2026/02/09 14:38:59 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:59 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:38:59 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:38:59 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 2)
app_1       | 2026/02/09 14:39:08 WebSocket Client Connection Closed Normally (UserID: 1, ConnID: cb0f9325-d521-4903-936a-79f9ffec6750): websocket: close 1001 (going away)
app_1       | 2026/02/09 14:39:08 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: cb0f9325-d521-4903-936a-79f9ffec6750
app_1       | 2026/02/09 14:39:08 [Shard 0][User 1][Conn cb0f9325-d521-4903-936a-79f9ffec6750] handleUnregister called
app_1       | 2026/02/09 14:39:08 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: cb0f9325-d521-4903-936a-79f9ffec6750) from Quiz 30
app_1       | 2026/02/09 14:39:08 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:08 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:08 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 30.
app_1       | 2026/02/09 14:39:08 Client 1 (Conn: cb0f9325-d521-4903-936a-79f9ffec6750) cleared QuizID
app_1       | 2026/02/09 14:39:08 Shard 0: Client 1 unsubscribed from Quiz 30
app_1       | 2026/02/09 14:39:08 Shard 0: client 1 unregistered
app_1       | 2026/02/09 14:39:08 WebSocket Client Send Channel Closed (UserID: 1, ConnID: cb0f9325-d521-4903-936a-79f9ffec6750)
app_1       | 2026/02/09 14:39:08 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: cb0f9325-d521-4903-936a-79f9ffec6750
app_1       | 2026/02/09 14:39:08 [ShardedHub] Отправлено обновление player_count для викторины #30: 1 игроков
app_1       | 2026/02/09 14:39:08 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:39:08 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:08 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:08 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:39:08 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 14:39:08 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 14:39:08 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:39:08 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:08 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:08 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 
app_1       | 2026/02/09 14:39:08 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.771ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:08.412') OR (is_active = false AND rotated_at > '2026-02-02 14:39:08.412' AND expires_at > '2026-02-09 14:39:08.412') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:08 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:39:08 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.624ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:39:08 | 200 |    2.077844ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:39:08 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.567ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:39:08 | 200 |     798.975µs |      172.18.0.6 | GET      "/api/quizzes/30"
app_1       | 2026/02/09 14:39:08 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:39:08 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:39:08 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.866ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:08.549') OR (is_active = false AND rotated_at > '2026-02-02 14:39:08.549' AND expires_at > '2026-02-09 14:39:08.549') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:39:08 | 200 |    1.398933ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 
app_1       | 2026/02/09 14:39:09 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.019ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:09.504') OR (is_active = false AND rotated_at > '2026-02-02 14:39:09.504' AND expires_at > '2026-02-09 14:39:09.504') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:09 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:39:09 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:39:09 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.804ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:09.506') OR (is_active = false AND rotated_at > '2026-02-02 14:39:09.506' AND expires_at > '2026-02-09 14:39:09.506') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:09 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:39:09 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.354ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:39:09.508' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 14:39:09 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [GIN] 2026/02/09 - 14:39:09 | 200 |     5.08456ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 
app_1       | 2026/02/09 14:39:09 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.702ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:09.909') OR (is_active = false AND rotated_at > '2026-02-02 14:39:09.909' AND expires_at > '2026-02-09 14:39:09.909') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:09 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:39:09 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:39:09 Shard 0: client 1 registered
app_1       | 2026/02/09 14:39:09 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:39:09 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: cbcc93de-b6c1-4f14-8959-88d3805948b0
app_1       | 2026/02/09 14:39:09 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: cbcc93de-b6c1-4f14-8959-88d3805948b0
app_1       | [GIN] 2026/02/09 - 14:39:09 | 200 |    1.392454ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODAwOSwiaWF0IjoxNzcwNjQ3OTQ5LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.2oGeOk4zkaxBGulKl55WmysEzqjm8sfuGP7c9ThtvT0"
app_1       | 2026/02/09 14:39:10 Client 1 (Conn: cbcc93de-b6c1-4f14-8959-88d3805948b0) set QuizID to 30
app_1       | 2026/02/09 14:39:10 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: cbcc93de-b6c1-4f14-8959-88d3805948b0) to Quiz 30
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] Client 1: Found existing map for quiz 30
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:10 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:39:10 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
app_1       | 2026/02/09 14:39:10 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:39:10 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:39:10 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:39:10 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:10 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:10 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn cbcc93de-b6c1-4f14-8959-88d3805948b0
app_1       | 2026/02/09 14:39:10 [Shard 0][Quiz 30][User 1][Conn cbcc93de-b6c1-4f14-8959-88d3805948b0] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:39:10 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:10 [Shard 0][Quiz 30][User 1][Conn cbcc93de-b6c1-4f14-8959-88d3805948b0] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:39:10 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:10 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:39:10 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:39:10 [Shard 0][Quiz 30][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:39:10 Shard 0: Message broadcast to 2 clients in Quiz 30
app_1       | 2026/02/09 14:39:10 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:39:10 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 2)
app_1       | 2026/02/09 14:39:28 WebSocket Client Connection Closed Normally (UserID: 1, ConnID: 017ac53c-7f68-42c8-b486-2495a06f3c13): websocket: close 1001 (going away)
app_1       | 2026/02/09 14:39:28 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:39:28 [Shard 0][User 1][Conn 017ac53c-7f68-42c8-b486-2495a06f3c13] handleUnregister called
app_1       | 2026/02/09 14:39:28 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 017ac53c-7f68-42c8-b486-2495a06f3c13) from Quiz 30
app_1       | 2026/02/09 14:39:28 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:28 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:28 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 30.
app_1       | 2026/02/09 14:39:28 Client 1 (Conn: 017ac53c-7f68-42c8-b486-2495a06f3c13) cleared QuizID
app_1       | 2026/02/09 14:39:28 Shard 0: Client 1 unsubscribed from Quiz 30
app_1       | 2026/02/09 14:39:28 Shard 0: client 1 unregistered
app_1       | 2026/02/09 14:39:28 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 017ac53c-7f68-42c8-b486-2495a06f3c13)
app_1       | 2026/02/09 14:39:28 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 017ac53c-7f68-42c8-b486-2495a06f3c13
app_1       | 2026/02/09 14:39:28 [ShardedHub] Отправлено обновление player_count для викторины #30: 1 игроков
app_1       | 2026/02/09 14:39:28 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:39:28 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:28 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:28 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:28 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:28 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn cbcc93de-b6c1-4f14-8959-88d3805948b0
app_1       | 2026/02/09 14:39:28 [Shard 0][Quiz 30][User 1][Conn cbcc93de-b6c1-4f14-8959-88d3805948b0] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 14:39:28 [Shard 0][Quiz 30][User 1][Conn cbcc93de-b6c1-4f14-8959-88d3805948b0] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 14:39:28 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:39:28 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 
app_1       | 2026/02/09 14:39:28 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.906ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:28.569') OR (is_active = false AND rotated_at > '2026-02-02 14:39:28.569' AND expires_at > '2026-02-09 14:39:28.569') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:28 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:39:28 /app/internal/repository/postgres/user_repo.go:33
app_1       | [1.205ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:39:28 | 200 |    3.028085ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:39:28 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.764ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:39:28 | 200 |    1.002743ms |      172.18.0.6 | GET      "/api/quizzes/30"
app_1       | 
app_1       | 2026/02/09 14:39:28 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.078ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:28.709') OR (is_active = false AND rotated_at > '2026-02-02 14:39:28.709' AND expires_at > '2026-02-09 14:39:28.709') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:28 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:39:28 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | [GIN] 2026/02/09 - 14:39:28 | 200 |    1.664291ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 
app_1       | 2026/02/09 14:39:28 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.848ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:28.844') OR (is_active = false AND rotated_at > '2026-02-02 14:39:28.844' AND expires_at > '2026-02-09 14:39:28.844') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:28 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:39:28 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 2026/02/09 14:39:28 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:39:28 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.638ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:28.846') OR (is_active = false AND rotated_at > '2026-02-02 14:39:28.846' AND expires_at > '2026-02-09 14:39:28.846') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:39:28 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.092ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:39:28.846' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 14:39:28 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [GIN] 2026/02/09 - 14:39:28 | 200 |    3.723732ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 
app_1       | 2026/02/09 14:39:29 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.770ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:29.249') OR (is_active = false AND rotated_at > '2026-02-02 14:39:29.249' AND expires_at > '2026-02-09 14:39:29.249') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:39:29 | 200 |    1.339387ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODAyOCwiaWF0IjoxNzcwNjQ3OTY4LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.rcF56mIBj3IGEr5ZHEiKF_QDLAxTj0SmXFs6-XXF_a0"
app_1       | 2026/02/09 14:39:29 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:39:29 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:39:29 Shard 0: replacing client 1 with new connection
app_1       | 2026/02/09 14:39:29 Shard 0: client 1 registered
app_1       | 2026/02/09 14:39:29 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:39:29 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 2d32343f-676d-4a0d-a2d2-8e2858acca34
app_1       | 2026/02/09 14:39:29 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 2d32343f-676d-4a0d-a2d2-8e2858acca34
app_1       | 2026/02/09 14:39:29 Client 1 (Conn: 2d32343f-676d-4a0d-a2d2-8e2858acca34) set QuizID to 30
app_1       | 2026/02/09 14:39:29 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 2d32343f-676d-4a0d-a2d2-8e2858acca34) to Quiz 30
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] Client 1: Found existing map for quiz 30
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:29 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:39:29 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
app_1       | 2026/02/09 14:39:29 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:39:29 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:39:29 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:39:29 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn cbcc93de-b6c1-4f14-8959-88d3805948b0
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][User 1][Conn cbcc93de-b6c1-4f14-8959-88d3805948b0] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][User 1][Conn cbcc93de-b6c1-4f14-8959-88d3805948b0] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][User 1][Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][User 1][Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:39:29 Shard 0: Message broadcast to 2 clients in Quiz 30
app_1       | 2026/02/09 14:39:29 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:29 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:29 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:39:29 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 2)
app_1       | 2026/02/09 14:39:29 WebSocket Client Read Error (UserID: 1, ConnID: cbcc93de-b6c1-4f14-8959-88d3805948b0): read tcp 172.18.0.5:8080->172.18.0.6:49966: use of closed network connection
app_1       | 2026/02/09 14:39:29 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: cbcc93de-b6c1-4f14-8959-88d3805948b0
app_1       | 2026/02/09 14:39:29 [Shard 0][User 1][Conn cbcc93de-b6c1-4f14-8959-88d3805948b0] handleUnregister called
app_1       | 2026/02/09 14:39:29 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: cbcc93de-b6c1-4f14-8959-88d3805948b0) from Quiz 30
app_1       | 2026/02/09 14:39:29 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:29 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:29 WebSocket Client Send Channel Closed (UserID: 1, ConnID: cbcc93de-b6c1-4f14-8959-88d3805948b0)
app_1       | 2026/02/09 14:39:29 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: cbcc93de-b6c1-4f14-8959-88d3805948b0
app_1       | 2026/02/09 14:39:29 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 30.
app_1       | 2026/02/09 14:39:29 Client 1 (Conn: cbcc93de-b6c1-4f14-8959-88d3805948b0) cleared QuizID
app_1       | 2026/02/09 14:39:29 Shard 0: Client 1 unsubscribed from Quiz 30
app_1       | 2026/02/09 14:39:29 [ShardedHub] Отправлено обновление player_count для викторины #30: 1 игроков
app_1       | 2026/02/09 14:39:29 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:39:29 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:29 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:29 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][User 1][Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 14:39:29 [Shard 0][Quiz 30][User 1][Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 14:39:29 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:39:29 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:39:35 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:39:35 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:39:35 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | 2026/02/09 14:39:35 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:39:35 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [0.857ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:35.584') OR (is_active = false AND rotated_at > '2026-02-02 14:39:35.584' AND expires_at > '2026-02-09 14:39:35.584') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:39:35 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.689ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:35.585') OR (is_active = false AND rotated_at > '2026-02-02 14:39:35.585' AND expires_at > '2026-02-09 14:39:35.585') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:39:35 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [0.507ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:39:35.586' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:39:35 | 200 |    3.019696ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 14:39:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:39:35 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.866ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:39:35.984') OR (is_active = false AND rotated_at > '2026-02-02 14:39:35.984' AND expires_at > '2026-02-09 14:39:35.984') ORDER BY created_at DESC
app_1       | 2026/02/09 14:39:35 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:39:35 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:39:35 Shard 0: client 1 registered
app_1       | 2026/02/09 14:39:35 WebSocket: client 1 fully registered, starting pumps
app_1       | [GIN] 2026/02/09 - 14:39:35 | 200 |    1.725255ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODAzNSwiaWF0IjoxNzcwNjQ3OTc1LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.fQCxBO5LatW424fICvvAR7kj1DOQvGul8O86ePnqP24"
app_1       | 2026/02/09 14:39:35 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 9c26391a-8a78-46a0-affa-8c79dd0636bb
app_1       | 2026/02/09 14:39:35 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 9c26391a-8a78-46a0-affa-8c79dd0636bb
app_1       | 2026/02/09 14:39:36 Client 1 (Conn: 9c26391a-8a78-46a0-affa-8c79dd0636bb) set QuizID to 30
app_1       | 2026/02/09 14:39:36 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 9c26391a-8a78-46a0-affa-8c79dd0636bb) to Quiz 30
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] Client 1: Found existing map for quiz 30
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:39:36 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:39:36 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
app_1       | 2026/02/09 14:39:36 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:39:36 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:39:36 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:39:36 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:36 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:36 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:36 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34
app_1       | 2026/02/09 14:39:36 [Shard 0][Quiz 30][User 1][Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:39:36 [Shard 0][Quiz 30][User 1][Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:39:36 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb
app_1       | 2026/02/09 14:39:36 [Shard 0][Quiz 30][User 1][Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:39:36 [Shard 0][Quiz 30][User 1][Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:39:36 Shard 0: Message broadcast to 2 clients in Quiz 30
app_1       | 2026/02/09 14:39:36 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:39:36 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:39:36 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 2)
app_1       | 2026/02/09 14:40:15 WebSocket Client Connection Closed Normally (UserID: 1, ConnID: 2d32343f-676d-4a0d-a2d2-8e2858acca34): websocket: close 1001 (going away)
app_1       | 2026/02/09 14:40:15 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 2d32343f-676d-4a0d-a2d2-8e2858acca34
app_1       | 2026/02/09 14:40:15 [Shard 0][User 1][Conn 2d32343f-676d-4a0d-a2d2-8e2858acca34] handleUnregister called
app_1       | 2026/02/09 14:40:15 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 2d32343f-676d-4a0d-a2d2-8e2858acca34) from Quiz 30
app_1       | 2026/02/09 14:40:15 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:15 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:15 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 30.
app_1       | 2026/02/09 14:40:15 Client 1 (Conn: 2d32343f-676d-4a0d-a2d2-8e2858acca34) cleared QuizID
app_1       | 2026/02/09 14:40:15 Shard 0: Client 1 unsubscribed from Quiz 30
app_1       | 2026/02/09 14:40:15 Shard 0: client 1 unregistered
app_1       | 2026/02/09 14:40:15 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 2d32343f-676d-4a0d-a2d2-8e2858acca34)
app_1       | 2026/02/09 14:40:15 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 2d32343f-676d-4a0d-a2d2-8e2858acca34
app_1       | 2026/02/09 14:40:15 [ShardedHub] Отправлено обновление player_count для викторины #30: 1 игроков
app_1       | 2026/02/09 14:40:15 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:40:15 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:15 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:15 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb
app_1       | 2026/02/09 14:40:15 [Shard 0][Quiz 30][User 1][Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 14:40:15 [Shard 0][Quiz 30][User 1][Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 14:40:15 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:40:15 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:15 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:15 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.099ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:16.065') OR (is_active = false AND rotated_at > '2026-02-02 14:40:16.065' AND expires_at > '2026-02-09 14:40:16.065') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.537ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:40:16 | 200 |    2.206849ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:40:16 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.875ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:40:16 | 200 |     1.15009ms |      172.18.0.6 | GET      "/api/quizzes/30"
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.756ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:16.204') OR (is_active = false AND rotated_at > '2026-02-02 14:40:16.204' AND expires_at > '2026-02-09 14:40:16.204') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:40:16 | 200 |    1.155544ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:40:16 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:40:16 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.811ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:16.367') OR (is_active = false AND rotated_at > '2026-02-02 14:40:16.367' AND expires_at > '2026-02-09 14:40:16.367') ORDER BY created_at DESC
app_1       | 2026/02/09 14:40:16 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:40:16 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.091ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:16.369') OR (is_active = false AND rotated_at > '2026-02-02 14:40:16.369' AND expires_at > '2026-02-09 14:40:16.369') ORDER BY created_at DESC
app_1       | 2026/02/09 14:40:16 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.001ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:40:16.372' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:40:16 | 200 |    7.940386ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 14:40:16 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | 
app_1       | 2026/02/09 14:40:16 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.044ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:16.805') OR (is_active = false AND rotated_at > '2026-02-02 14:40:16.805' AND expires_at > '2026-02-09 14:40:16.805') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:40:16 | 200 |    1.717443ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODA3NiwiaWF0IjoxNzcwNjQ4MDE2LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.Ou4YMfv2hYfFU8KLc92Ssn646eUt2bzRrpfvRxhMkFA"
app_1       | 2026/02/09 14:40:16 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:40:16 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:40:16 Shard 0: replacing client 1 with new connection
app_1       | 2026/02/09 14:40:16 Shard 0: client 1 registered
app_1       | 2026/02/09 14:40:16 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:40:16 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 3dbce8d1-f0f1-4569-9636-6075a6f7303c
app_1       | 2026/02/09 14:40:16 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 3dbce8d1-f0f1-4569-9636-6075a6f7303c
app_1       | 2026/02/09 14:40:16 Client 1 (Conn: 3dbce8d1-f0f1-4569-9636-6075a6f7303c) set QuizID to 30
app_1       | 2026/02/09 14:40:16 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 3dbce8d1-f0f1-4569-9636-6075a6f7303c) to Quiz 30
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] Client 1: Found existing map for quiz 30
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:16 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:40:16 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
app_1       | 2026/02/09 14:40:16 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:40:16 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:40:16 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:40:16 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:16 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:16 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb
app_1       | 2026/02/09 14:40:16 [Shard 0][Quiz 30][User 1][Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:40:16 [Shard 0][Quiz 30][User 1][Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:40:16 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 3dbce8d1-f0f1-4569-9636-6075a6f7303c
app_1       | 2026/02/09 14:40:16 [Shard 0][Quiz 30][User 1][Conn 3dbce8d1-f0f1-4569-9636-6075a6f7303c] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:40:16 [Shard 0][Quiz 30][User 1][Conn 3dbce8d1-f0f1-4569-9636-6075a6f7303c] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:40:16 Shard 0: Message broadcast to 2 clients in Quiz 30
app_1       | 2026/02/09 14:40:16 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:16 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:16 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:40:16 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 2)
app_1       | 2026/02/09 14:40:17 WebSocket Client Read Error (UserID: 1, ConnID: 9c26391a-8a78-46a0-affa-8c79dd0636bb): read tcp 172.18.0.5:8080->172.18.0.6:54422: use of closed network connection
app_1       | 2026/02/09 14:40:17 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 9c26391a-8a78-46a0-affa-8c79dd0636bb
app_1       | 2026/02/09 14:40:17 [Shard 0][User 1][Conn 9c26391a-8a78-46a0-affa-8c79dd0636bb] handleUnregister called
app_1       | 2026/02/09 14:40:17 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 9c26391a-8a78-46a0-affa-8c79dd0636bb) from Quiz 30
app_1       | 2026/02/09 14:40:17 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:17 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:17 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 30.
app_1       | 2026/02/09 14:40:17 Client 1 (Conn: 9c26391a-8a78-46a0-affa-8c79dd0636bb) cleared QuizID
app_1       | 2026/02/09 14:40:17 Shard 0: Client 1 unsubscribed from Quiz 30
app_1       | 2026/02/09 14:40:17 [ShardedHub] Отправлено обновление player_count для викторины #30: 1 игроков
app_1       | 2026/02/09 14:40:17 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:40:17 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:17 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 9c26391a-8a78-46a0-affa-8c79dd0636bb)
app_1       | 2026/02/09 14:40:17 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 9c26391a-8a78-46a0-affa-8c79dd0636bb
app_1       | 2026/02/09 14:40:17 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:17 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 3dbce8d1-f0f1-4569-9636-6075a6f7303c
app_1       | 2026/02/09 14:40:17 [Shard 0][Quiz 30][User 1][Conn 3dbce8d1-f0f1-4569-9636-6075a6f7303c] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 14:40:17 [Shard 0][Quiz 30][User 1][Conn 3dbce8d1-f0f1-4569-9636-6075a6f7303c] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 14:40:17 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:40:17 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:17 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:17 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:40:27 WebSocket Client Connection Closed Normally (UserID: 1, ConnID: 3dbce8d1-f0f1-4569-9636-6075a6f7303c): websocket: close 1001 (going away)
app_1       | 2026/02/09 14:40:27 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 3dbce8d1-f0f1-4569-9636-6075a6f7303c
app_1       | 2026/02/09 14:40:27 [Shard 0][User 1][Conn 3dbce8d1-f0f1-4569-9636-6075a6f7303c] handleUnregister called
app_1       | 2026/02/09 14:40:27 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 3dbce8d1-f0f1-4569-9636-6075a6f7303c) from Quiz 30
app_1       | 2026/02/09 14:40:27 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:27 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:27 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 30.
app_1       | 2026/02/09 14:40:27 Client 1 (Conn: 3dbce8d1-f0f1-4569-9636-6075a6f7303c) cleared QuizID
app_1       | 2026/02/09 14:40:27 Shard 0: Client 1 unsubscribed from Quiz 30
app_1       | 2026/02/09 14:40:27 Shard 0: client 1 unregistered
app_1       | 2026/02/09 14:40:27 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 3dbce8d1-f0f1-4569-9636-6075a6f7303c)
app_1       | 2026/02/09 14:40:27 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 3dbce8d1-f0f1-4569-9636-6075a6f7303c
app_1       | 2026/02/09 14:40:27 [ShardedHub] Отправлено обновление player_count для викторины #30: 0 игроков
app_1       | 2026/02/09 14:40:27 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:40:27 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:27 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:27 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:27 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:40:27 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:40:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:40:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.026ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:27.354') OR (is_active = false AND rotated_at > '2026-02-02 14:40:27.354' AND expires_at > '2026-02-09 14:40:27.354') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:40:27 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.496ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:40:27 | 200 |     2.03301ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:40:27 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.789ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:40:27 | 200 |     985.349µs |      172.18.0.6 | GET      "/api/quizzes/30"
app_1       | 
app_1       | 2026/02/09 14:40:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.677ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:27.502') OR (is_active = false AND rotated_at > '2026-02-02 14:40:27.502' AND expires_at > '2026-02-09 14:40:27.502') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:40:27 | 200 |     982.682µs |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:40:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:40:27 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:40:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.721ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:27.634') OR (is_active = false AND rotated_at > '2026-02-02 14:40:27.634' AND expires_at > '2026-02-09 14:40:27.634') ORDER BY created_at DESC
app_1       | 2026/02/09 14:40:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:40:27 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:40:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.629ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:27.635') OR (is_active = false AND rotated_at > '2026-02-02 14:40:27.635' AND expires_at > '2026-02-09 14:40:27.635') ORDER BY created_at DESC
app_1       | 2026/02/09 14:40:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:40:27 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [0.716ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:40:27.636' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 14:40:27 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [GIN] 2026/02/09 - 14:40:27 | 200 |    3.297978ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 14:40:28 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:40:28 WebSocket: registering client 1 in ShardedHub
app_1       | 
app_1       | 2026/02/09 14:40:28 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.801ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:40:28.043') OR (is_active = false AND rotated_at > '2026-02-02 14:40:28.043' AND expires_at > '2026-02-09 14:40:28.043') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:40:28 | 200 |    1.368579ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODA4NywiaWF0IjoxNzcwNjQ4MDI3LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.ai5prwG_tsc664zdmbbRoT0qg7Bd-0DdaEdkgW4uRHA"
app_1       | 2026/02/09 14:40:28 Shard 0: client 1 registered
app_1       | 2026/02/09 14:40:28 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:40:28 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 4388f979-de6d-4878-83fb-0f0920cffbf7
app_1       | 2026/02/09 14:40:28 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 4388f979-de6d-4878-83fb-0f0920cffbf7
app_1       | 2026/02/09 14:40:28 Client 1 (Conn: 4388f979-de6d-4878-83fb-0f0920cffbf7) set QuizID to 30
app_1       | 2026/02/09 14:40:28 [WSHandler] User 1 set QuizID to 30
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 4388f979-de6d-4878-83fb-0f0920cffbf7) to Quiz 30
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] Client 1: Old QuizID is 30, New QuizID is 30
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] Client 1 already has atomic QuizID 30. Ensuring map presence.
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 30
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] Client 1: Found existing map for quiz 30
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] Client 1: STORED client in map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:40:28 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 30 immediately after Store.
app_1       | 2026/02/09 14:40:28 [WebSocketManager] Клиент 1 подписан на викторину 30 в шарде 0
app_1       | 2026/02/09 14:40:28 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #30
app_1       | 2026/02/09 14:40:28 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #30
app_1       | 2026/02/09 14:40:28 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:40:28 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:28 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:28 [Shard 0][Quiz 30][Range] Iterating over client: User 1, Conn 4388f979-de6d-4878-83fb-0f0920cffbf7
app_1       | 2026/02/09 14:40:28 [Shard 0][Quiz 30][User 1][Conn 4388f979-de6d-4878-83fb-0f0920cffbf7] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:40:28 [Shard 0][Quiz 30][User 1][Conn 4388f979-de6d-4878-83fb-0f0920cffbf7] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:40:28 Shard 0: Message broadcast to 1 clients in Quiz 30
app_1       | 2026/02/09 14:40:28 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:28 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:40:28 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:40:28 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #30 (игроков онлайн: 1)
app_1       | 2026/02/09 14:40:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:41:35 [Shard 2] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:41:35 [Shard 0] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:41:35 [Shard 1] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:41:35 [Shard 3] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:41:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:41:57 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:41:57 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.077ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:41:57.504') OR (is_active = false AND rotated_at > '2026-02-02 14:41:57.504' AND expires_at > '2026-02-09 14:41:57.504') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:41:57 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.637ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:41:57 | 200 |    2.690852ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:41:57 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.603ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:41:57.63') OR (is_active = false AND rotated_at > '2026-02-02 14:41:57.63' AND expires_at > '2026-02-09 14:41:57.63') ORDER BY created_at DESC
app_1       | 2026/02/09 14:41:57 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:41:57 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.409ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:41:57 | 200 |    1.551155ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:42:03 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.266ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:42:03.857' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:42:03 | 200 |    1.527945ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 2026/02/09 14:42:05 WebSocket Client Connection Closed Normally (UserID: 1, ConnID: 4388f979-de6d-4878-83fb-0f0920cffbf7): websocket: close 1001 (going away)
app_1       | 2026/02/09 14:42:05 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 4388f979-de6d-4878-83fb-0f0920cffbf7
app_1       | 2026/02/09 14:42:05 [Shard 0][User 1][Conn 4388f979-de6d-4878-83fb-0f0920cffbf7] handleUnregister called
app_1       | 2026/02/09 14:42:05 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 4388f979-de6d-4878-83fb-0f0920cffbf7) from Quiz 30
app_1       | 2026/02/09 14:42:05 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:42:05 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 30 (Map: 0xc000229320)
app_1       | 2026/02/09 14:42:05 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 30.
app_1       | 2026/02/09 14:42:05 Client 1 (Conn: 4388f979-de6d-4878-83fb-0f0920cffbf7) cleared QuizID
app_1       | 2026/02/09 14:42:05 Shard 0: Client 1 unsubscribed from Quiz 30
app_1       | 2026/02/09 14:42:05 Shard 0: client 1 unregistered
app_1       | 2026/02/09 14:42:05 [ShardedHub] Отправлено обновление player_count для викторины #30: 0 игроков
app_1       | 2026/02/09 14:42:05 ShardedHub: Broadcasting message to Quiz 30 across all shards
app_1       | 2026/02/09 14:42:05 [Shard 3][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:42:05 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 4388f979-de6d-4878-83fb-0f0920cffbf7)
app_1       | 2026/02/09 14:42:05 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 4388f979-de6d-4878-83fb-0f0920cffbf7
app_1       | 2026/02/09 14:42:05 [Shard 0][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:42:05 [Shard 1][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:42:05 [Shard 2][Quiz 30] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:42:05 ShardedHub: Finished broadcasting to Quiz 30
app_1       | 2026/02/09 14:42:05 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:42:05 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.822ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:42:05.809') OR (is_active = false AND rotated_at > '2026-02-02 14:42:05.809' AND expires_at > '2026-02-09 14:42:05.809') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:42:05 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.909ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:42:05.809' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:42:05 | 200 |    1.544893ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:42:05 /app/internal/repository/postgres/user_repo.go:33
app_1       | [1.200ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:42:05 | 200 |     2.69259ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:42:05 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:42:05 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:42:05 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.186ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:42:05.958') OR (is_active = false AND rotated_at > '2026-02-02 14:42:05.958' AND expires_at > '2026-02-09 14:42:05.958') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:42:05 | 200 |    1.611506ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 14:42:08 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:42:08 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.035ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:42:08.044') OR (is_active = false AND rotated_at > '2026-02-02 14:42:08.044' AND expires_at > '2026-02-09 14:42:08.044') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:42:08 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | 2026/02/09 14:42:08 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [0.873ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:42:08.045' ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:42:08 | 200 |    2.512059ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 14:42:14 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.251ms] [rows:30] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:42:14 | 200 |    1.713783ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 
app_1       | 2026/02/09 14:42:17 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.484ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 30
app_1       | 
app_1       | 2026/02/09 14:42:17 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [1.766ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:42:17 | 200 |    1.953649ms |      172.18.0.6 | GET      "/api/quizzes/30/with-questions"
app_1       | 
app_1       | 2026/02/09 14:42:19 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.824ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:42:19.442') OR (is_active = false AND rotated_at > '2026-02-02 14:42:19.442' AND expires_at > '2026-02-09 14:42:19.442') ORDER BY created_at DESC
app_1       | 2026/02/09 14:42:19 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:42:19 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 2026/02/09 14:42:19 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:42:19 [QuizManager] Отмена викторины #30
app_1       | 
app_1       | 2026/02/09 14:42:19 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.528ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:42:19.443') OR (is_active = false AND rotated_at > '2026-02-02 14:42:19.443' AND expires_at > '2026-02-09 14:42:19.443') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:42:19 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.451ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | 2026/02/09 14:42:19 [Scheduler] Предупреждение: функция отмены для викторины #30 не найдена
app_1       | 
app_1       | 2026/02/09 14:42:19 /app/internal/repository/postgres/quiz_repo.go:84
app_1       | [2.359ms] [rows:1] UPDATE "quizzes" SET "status"='cancelled',"updated_at"='2026-02-09 14:42:19.445' WHERE id = 30
app_1       | 2026/02/09 14:42:19 RedisPubSub: Published message to channel 'ws:broadcast' (Subscribers: 1)
app_1       | 2026/02/09 14:42:19 [Scheduler] Викторина #30 отменена
app_1       | [GIN] 2026/02/09 - 14:42:19 | 200 |    5.496363ms |      172.18.0.6 | PUT      "/api/quizzes/30/cancel"
app_1       | 
app_1       | 2026/02/09 14:42:19 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.490ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 30
app_1       | 
app_1       | 2026/02/09 14:42:19 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [1.249ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 30 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:42:19 | 200 |    1.377737ms |      172.18.0.6 | GET      "/api/quizzes/30/with-questions"
app_1       | 
app_1       | 2026/02/09 14:42:21 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.299ms] [rows:30] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:42:21 | 200 |    1.866248ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 14:42:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:42:37 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.950ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:42:37.883') OR (is_active = false AND rotated_at > '2026-02-02 14:42:37.883' AND expires_at > '2026-02-09 14:42:37.883') ORDER BY created_at DESC
app_1       | 2026/02/09 14:42:37 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:42:37 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.505ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:42:37 | 200 |    2.014938ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:43:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:44:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:45:20 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.136ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:45:20.78') OR (is_active = false AND rotated_at > '2026-02-02 14:45:20.78' AND expires_at > '2026-02-09 14:45:20.78') ORDER BY created_at DESC
app_1       | 2026/02/09 14:45:20 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:45:20 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.666ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:45:20 | 200 |    2.578225ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:45:21 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.756ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:45:21.579' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:45:21 | 200 |     946.028µs |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 2026/02/09 14:45:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:46:23 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.328ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:46:23.55') OR (is_active = false AND rotated_at > '2026-02-02 14:46:23.55' AND expires_at > '2026-02-09 14:46:23.55') ORDER BY created_at DESC
app_1       | 2026/02/09 14:46:23 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:46:23 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.427ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:46:23 | 200 |    2.400484ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:46:25 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.134ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:46:25.75') OR (is_active = false AND rotated_at > '2026-02-02 14:46:25.75' AND expires_at > '2026-02-09 14:46:25.75') ORDER BY created_at DESC
app_1       | 2026/02/09 14:46:25 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:46:25 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | 
app_1       | 2026/02/09 14:46:25 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [0.818ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 14:46:25.751' ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:46:25 | 200 |    2.971538ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 14:46:29 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.189ms] [rows:30] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:46:29 | 200 |    1.668884ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 14:46:35 [Shard 1] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:46:35 [Shard 0] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:46:35 [Shard 2] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:46:35 [Shard 3] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:46:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 14:46:46 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.962ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:46:46.98') OR (is_active = false AND rotated_at > '2026-02-02 14:46:46.98' AND expires_at > '2026-02-09 14:46:46.98') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:46:46 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.514ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:46:46.981') OR (is_active = false AND rotated_at > '2026-02-02 14:46:46.981' AND expires_at > '2026-02-09 14:46:46.981') ORDER BY created_at DESC
app_1       | 2026/02/09 14:46:46 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:46:46 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 2026/02/09 14:46:46 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:46:46 /app/internal/repository/postgres/quiz_repo.go:26
app_1       | [2.263ms] [rows:1] INSERT INTO "quizzes" ("title","description","scheduled_time","status","question_count","prize_fund","created_at","updated_at") VALUES ('адаптивная','','2026-02-09 14:48:00','scheduled',0,1000000,'2026-02-09 14:46:46.982','2026-02-09 14:46:46.982') RETURNING "id"
app_1       | [GIN] 2026/02/09 - 14:46:46 | 201 |    4.642673ms |      172.18.0.6 | POST     "/api/quizzes"
app_1       | 
app_1       | 2026/02/09 14:46:47 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.815ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 31
app_1       | 
app_1       | 2026/02/09 14:46:47 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [1.887ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 31 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:46:47 | 200 |    2.095353ms |      172.18.0.6 | GET      "/api/quizzes/31/with-questions"
app_1       | 
app_1       | 2026/02/09 14:46:49 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.464ms] [rows:31] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 14:46:49 | 200 |    2.521374ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 
app_1       | 2026/02/09 14:46:50 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.707ms] [rows:1] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 14:46:50.69' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 14:46:50 | 200 |     935.406µs |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 14:46:52 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.744ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 31 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:46:52 | 200 |     992.214µs |      172.18.0.6 | GET      "/api/quizzes/31"
app_1       | 
app_1       | 2026/02/09 14:46:52 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.346ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:46:52.506') OR (is_active = false AND rotated_at > '2026-02-02 14:46:52.506' AND expires_at > '2026-02-09 14:46:52.506') ORDER BY created_at DESC
app_1       | 2026/02/09 14:46:52 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:46:52 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:46:52 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.654ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:46:52.507') OR (is_active = false AND rotated_at > '2026-02-02 14:46:52.507' AND expires_at > '2026-02-09 14:46:52.507') ORDER BY created_at DESC
app_1       | 2026/02/09 14:46:52 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:46:52 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | 
app_1       | 2026/02/09 14:46:52 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [0.748ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:46:52.508' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:46:52 | 200 |    3.417001ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 
app_1       | 2026/02/09 14:46:52 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.627ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:46:52.915') OR (is_active = false AND rotated_at > '2026-02-02 14:46:52.915' AND expires_at > '2026-02-09 14:46:52.915') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:46:52 | 200 |     1.17759ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODQ3MiwiaWF0IjoxNzcwNjQ4NDEyLCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.hlIhjLZrkWbqHEf-NQsUCrF9bTa4-jQzZXnkCqnwJzI"
app_1       | 2026/02/09 14:46:52 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:46:52 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:46:52 Shard 0: client 1 registered
app_1       | 2026/02/09 14:46:52 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:46:52 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 0d76b7c0-8680-4a95-998d-1d97e2a27d58
app_1       | 2026/02/09 14:46:52 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 0d76b7c0-8680-4a95-998d-1d97e2a27d58
app_1       | 2026/02/09 14:46:53 Client 1 (Conn: 0d76b7c0-8680-4a95-998d-1d97e2a27d58) set QuizID to 31
app_1       | 2026/02/09 14:46:53 [WSHandler] User 1 set QuizID to 31
app_1       | 2026/02/09 14:46:53 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 0d76b7c0-8680-4a95-998d-1d97e2a27d58) to Quiz 31
app_1       | 2026/02/09 14:46:53 [Shard 0][Sub] Client 1: Old QuizID is 31, New QuizID is 31
app_1       | 2026/02/09 14:46:53 [Shard 0][Sub] Client 1 already has atomic QuizID 31. Ensuring map presence.
app_1       | 2026/02/09 14:46:53 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 31
app_1       | 2026/02/09 14:46:53 [Shard 0][Sub] Client 1: Created new map for quiz 31
app_1       | 2026/02/09 14:46:53 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 31 (Map: 0xc000529410)
app_1       | 2026/02/09 14:46:53 [Shard 0][Sub] Client 1: STORED client in map for Quiz 31 (Map: 0xc000529410)
app_1       | 2026/02/09 14:46:53 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 31 immediately after Store.
app_1       | 2026/02/09 14:46:53 [WebSocketManager] Клиент 1 подписан на викторину 31 в шарде 0
app_1       | 2026/02/09 14:46:53 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #31
app_1       | 2026/02/09 14:46:53 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #31
app_1       | 2026/02/09 14:46:53 ShardedHub: Broadcasting message to Quiz 31 across all shards
app_1       | 2026/02/09 14:46:53 [Shard 3][Quiz 31] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:46:53 [Shard 1][Quiz 31] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:46:53 [Shard 2][Quiz 31] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:46:53 [Shard 0][Quiz 31] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:46:53 [Shard 0][Quiz 31][Range] Iterating over client: User 1, Conn 0d76b7c0-8680-4a95-998d-1d97e2a27d58
app_1       | 2026/02/09 14:46:53 [Shard 0][Quiz 31][User 1][Conn 0d76b7c0-8680-4a95-998d-1d97e2a27d58] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:46:53 [Shard 0][Quiz 31][User 1][Conn 0d76b7c0-8680-4a95-998d-1d97e2a27d58] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:46:53 Shard 0: Message broadcast to 1 clients in Quiz 31
app_1       | 2026/02/09 14:46:53 ShardedHub: Finished broadcasting to Quiz 31
app_1       | 2026/02/09 14:46:53 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #31 (игроков онлайн: 1)
app_1       | 2026/02/09 14:47:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:47:59 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:47:59 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.875ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:47:59.734') OR (is_active = false AND rotated_at > '2026-02-02 14:47:59.734' AND expires_at > '2026-02-09 14:47:59.734') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:47:59 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.534ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:47:59 | 200 |    2.056834ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:48:05 WebSocket Client Connection Closed Normally (UserID: 1, ConnID: 0d76b7c0-8680-4a95-998d-1d97e2a27d58): websocket: close 1001 (going away)
app_1       | 2026/02/09 14:48:05 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 0d76b7c0-8680-4a95-998d-1d97e2a27d58
app_1       | 2026/02/09 14:48:05 [Shard 0][User 1][Conn 0d76b7c0-8680-4a95-998d-1d97e2a27d58] handleUnregister called
app_1       | 2026/02/09 14:48:05 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 0d76b7c0-8680-4a95-998d-1d97e2a27d58) from Quiz 31
app_1       | 2026/02/09 14:48:05 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 31 (Map: 0xc000529410)
app_1       | 2026/02/09 14:48:05 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 31 (Map: 0xc000529410)
app_1       | 2026/02/09 14:48:05 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 31.
app_1       | 2026/02/09 14:48:05 Client 1 (Conn: 0d76b7c0-8680-4a95-998d-1d97e2a27d58) cleared QuizID
app_1       | 2026/02/09 14:48:05 Shard 0: Client 1 unsubscribed from Quiz 31
app_1       | 2026/02/09 14:48:05 Shard 0: client 1 unregistered
app_1       | 2026/02/09 14:48:05 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 0d76b7c0-8680-4a95-998d-1d97e2a27d58)
app_1       | 2026/02/09 14:48:05 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 0d76b7c0-8680-4a95-998d-1d97e2a27d58
app_1       | 2026/02/09 14:48:05 [ShardedHub] Отправлено обновление player_count для викторины #31: 0 игроков
app_1       | 2026/02/09 14:48:05 ShardedHub: Broadcasting message to Quiz 31 across all shards
app_1       | 2026/02/09 14:48:05 [Shard 3][Quiz 31] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:48:05 [Shard 0][Quiz 31] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:48:05 [Shard 1][Quiz 31] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:48:05 [Shard 2][Quiz 31] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 14:48:05 ShardedHub: Finished broadcasting to Quiz 31
app_1       | 2026/02/09 14:48:05 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:48:05 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.000ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:48:05.355') OR (is_active = false AND rotated_at > '2026-02-02 14:48:05.355' AND expires_at > '2026-02-09 14:48:05.355') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:48:05 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.656ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:48:05 | 200 |    2.165886ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 14:48:05 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [1.046ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 31 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:48:05 | 200 |    1.290904ms |      172.18.0.6 | GET      "/api/quizzes/31"
app_1       | 
app_1       | 2026/02/09 14:48:05 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.677ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:48:05.498') OR (is_active = false AND rotated_at > '2026-02-02 14:48:05.498' AND expires_at > '2026-02-09 14:48:05.498') ORDER BY created_at DESC
app_1       | 2026/02/09 14:48:05 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:48:05 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | [GIN] 2026/02/09 - 14:48:05 | 200 |    1.291314ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 
app_1       | 2026/02/09 14:48:05 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.834ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:48:05.659') OR (is_active = false AND rotated_at > '2026-02-02 14:48:05.659' AND expires_at > '2026-02-09 14:48:05.659') ORDER BY created_at DESC
app_1       | 2026/02/09 14:48:05 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:48:05 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 14:48:05 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.694ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:48:05.661') OR (is_active = false AND rotated_at > '2026-02-02 14:48:05.661' AND expires_at > '2026-02-09 14:48:05.661') ORDER BY created_at DESC
app_1       | 2026/02/09 14:48:05 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 14:48:05 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | 
app_1       | 2026/02/09 14:48:05 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.551ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 14:48:05.663' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:48:05 | 200 |    6.605011ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 
app_1       | 2026/02/09 14:48:06 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.826ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:48:06.105') OR (is_active = false AND rotated_at > '2026-02-02 14:48:06.105' AND expires_at > '2026-02-09 14:48:06.105') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 14:48:06 | 200 |    1.732924ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0ODU0NSwiaWF0IjoxNzcwNjQ4NDg1LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.SouLrQyT80d5simnGR4nI6UM6n1A_rC21jCb5acMRa0"
app_1       | 2026/02/09 14:48:06 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 14:48:06 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 14:48:06 Shard 0: client 1 registered
app_1       | 2026/02/09 14:48:06 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 14:48:06 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 3e5e0ac3-50da-4207-a2c6-2b3a8ff173d3
app_1       | 2026/02/09 14:48:06 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 3e5e0ac3-50da-4207-a2c6-2b3a8ff173d3
app_1       | 2026/02/09 14:48:06 Client 1 (Conn: 3e5e0ac3-50da-4207-a2c6-2b3a8ff173d3) set QuizID to 31
app_1       | 2026/02/09 14:48:06 [WSHandler] User 1 set QuizID to 31
app_1       | 2026/02/09 14:48:06 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 3e5e0ac3-50da-4207-a2c6-2b3a8ff173d3) to Quiz 31
app_1       | 2026/02/09 14:48:06 [Shard 0][Sub] Client 1: Old QuizID is 31, New QuizID is 31
app_1       | 2026/02/09 14:48:06 [Shard 0][Sub] Client 1 already has atomic QuizID 31. Ensuring map presence.
app_1       | 2026/02/09 14:48:06 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 31
app_1       | 2026/02/09 14:48:06 [Shard 0][Sub] Client 1: Found existing map for quiz 31
app_1       | 2026/02/09 14:48:06 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 31 (Map: 0xc000529410)
app_1       | 2026/02/09 14:48:06 [Shard 0][Sub] Client 1: STORED client in map for Quiz 31 (Map: 0xc000529410)
app_1       | 2026/02/09 14:48:06 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 31 immediately after Store.
app_1       | 2026/02/09 14:48:06 [WebSocketManager] Клиент 1 подписан на викторину 31 в шарде 0
app_1       | 2026/02/09 14:48:06 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #31
app_1       | 2026/02/09 14:48:06 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #31
app_1       | 2026/02/09 14:48:06 ShardedHub: Broadcasting message to Quiz 31 across all shards
app_1       | 2026/02/09 14:48:06 [Shard 3][Quiz 31] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:48:06 [Shard 0][Quiz 31] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:48:06 [Shard 0][Quiz 31][Range] Iterating over client: User 1, Conn 3e5e0ac3-50da-4207-a2c6-2b3a8ff173d3
app_1       | 2026/02/09 14:48:06 [Shard 0][Quiz 31][User 1][Conn 3e5e0ac3-50da-4207-a2c6-2b3a8ff173d3] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 14:48:06 [Shard 0][Quiz 31][User 1][Conn 3e5e0ac3-50da-4207-a2c6-2b3a8ff173d3] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 14:48:06 Shard 0: Message broadcast to 1 clients in Quiz 31
app_1       | 2026/02/09 14:48:06 [Shard 1][Quiz 31] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:48:06 [Shard 2][Quiz 31] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 14:48:06 ShardedHub: Finished broadcasting to Quiz 31
app_1       | 2026/02/09 14:48:06 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #31 (игроков онлайн: 1)
app_1       | 2026/02/09 14:48:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:49:23 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 14:49:23 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.559ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 14:49:23.385') OR (is_active = false AND rotated_at > '2026-02-02 14:49:23.385' AND expires_at > '2026-02-09 14:49:23.385') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 14:49:23 /app/internal/repository/postgres/user_repo.go:33
app_1       | [1.199ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 14:49:23 | 200 |    3.743081ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 14:49:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:50:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:51:35 [Shard 3] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:51:35 [Shard 0] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:51:35 [Shard 1] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:51:35 [Shard 2] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:51:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:52:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:53:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:54:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:55:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:56:35 [Shard 0] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:56:35 [Shard 1] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:56:35 [Shard 2] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:56:35 [Shard 3] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 14:56:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:57:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:58:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 14:59:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 15:00:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 15:01:35 [Shard 0] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 15:01:35 [Shard 1] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 15:01:35 [Shard 2] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 15:01:35 [Shard 3] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 15:01:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 15:01:55 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.906ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:01:55.854') OR (is_active = false AND rotated_at > '2026-02-02 15:01:55.854' AND expires_at > '2026-02-09 15:01:55.854') ORDER BY created_at DESC
app_1       | 2026/02/09 15:01:55 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 15:01:55 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.794ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 15:01:55 | 200 |    2.480451ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 15:01:57 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.813ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 15:01:57.186' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 15:01:57 | 200 |     1.07749ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 15:01:58 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.565ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:01:58.181') OR (is_active = false AND rotated_at > '2026-02-02 15:01:58.181' AND expires_at > '2026-02-09 15:01:58.181') ORDER BY created_at DESC
app_1       | 2026/02/09 15:01:58 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 15:01:58 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [1.714ms] [rows:5] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 15:01:58.182' ORDER BY created_at DESC
app_1       | 2026/02/09 15:01:58 [TokenManager] Получено 5 активных токенов пользователя ID=1
app_1       | [GIN] 2026/02/09 - 15:01:58 | 200 |    3.245107ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 15:02:00 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.744ms] [rows:31] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 15:02:00 | 200 |     2.36488ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 
app_1       | 2026/02/09 15:02:05 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [2.953ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 31
app_1       | 
app_1       | 2026/02/09 15:02:05 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [3.882ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 31 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 15:02:05 | 200 |    4.058444ms |      172.18.0.6 | GET      "/api/quizzes/31/with-questions"
app_1       | 2026/02/09 15:02:07 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 15:02:07 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 15:02:07 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.832ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:02:07.812') OR (is_active = false AND rotated_at > '2026-02-02 15:02:07.812' AND expires_at > '2026-02-09 15:02:07.812') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 15:02:07 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.452ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:02:07.813') OR (is_active = false AND rotated_at > '2026-02-02 15:02:07.813' AND expires_at > '2026-02-09 15:02:07.813') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 15:02:07 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.384ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 31 ORDER BY "quizzes"."id" LIMIT 1
app_1       | 2026/02/09 15:02:07 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 15:02:07 [QuizManager] Отмена викторины #31
app_1       | 2026/02/09 15:02:07 [Scheduler] Предупреждение: функция отмены для викторины #31 не найдена
app_1       | 
app_1       | 2026/02/09 15:02:07 /app/internal/repository/postgres/quiz_repo.go:84
app_1       | [3.725ms] [rows:1] UPDATE "quizzes" SET "status"='cancelled',"updated_at"='2026-02-09 15:02:07.815' WHERE id = 31
app_1       | [GIN] 2026/02/09 - 15:02:07 | 200 |    6.822764ms |      172.18.0.6 | PUT      "/api/quizzes/31/cancel"
app_1       | 2026/02/09 15:02:07 RedisPubSub: Published message to channel 'ws:broadcast' (Subscribers: 1)
app_1       | 2026/02/09 15:02:07 [Scheduler] Викторина #31 отменена
app_1       | 
app_1       | 2026/02/09 15:02:07 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.505ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 31
app_1       | 
app_1       | 2026/02/09 15:02:07 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [1.183ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 31 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 15:02:07 | 200 |     1.31882ms |      172.18.0.6 | GET      "/api/quizzes/31/with-questions"
app_1       | 
app_1       | 2026/02/09 15:02:09 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.316ms] [rows:31] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 15:02:09 | 200 |    1.792456ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 15:02:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 15:03:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 15:04:18 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.649ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:04:18.927') OR (is_active = false AND rotated_at > '2026-02-02 15:04:18.927' AND expires_at > '2026-02-09 15:04:18.927') ORDER BY created_at DESC
app_1       | 2026/02/09 15:04:18 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 15:04:18 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.526ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 15:04:18 | 200 |    3.390954ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 15:04:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 15:04:38 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.004ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:04:38.535') OR (is_active = false AND rotated_at > '2026-02-02 15:04:38.535' AND expires_at > '2026-02-09 15:04:38.535') ORDER BY created_at DESC
app_1       | 2026/02/09 15:04:38 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 15:04:38 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 2026/02/09 15:04:38 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 15:04:38 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.468ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:04:38.536') OR (is_active = false AND rotated_at > '2026-02-02 15:04:38.536' AND expires_at > '2026-02-09 15:04:38.536') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 15:04:38 /app/internal/repository/postgres/quiz_repo.go:26
app_1       | [3.929ms] [rows:1] INSERT INTO "quizzes" ("title","description","scheduled_time","status","question_count","prize_fund","created_at","updated_at") VALUES ('хоер','','2026-02-09 15:07:00','scheduled',0,1000000,'2026-02-09 15:04:38.537','2026-02-09 15:04:38.537') RETURNING "id"
app_1       | [GIN] 2026/02/09 - 15:04:38 | 201 |    7.361386ms |      172.18.0.6 | POST     "/api/quizzes"
app_1       | 
app_1       | 2026/02/09 15:04:38 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.626ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 32
app_1       | 
app_1       | 2026/02/09 15:04:38 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [2.067ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 32 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 15:04:38 | 200 |    2.239105ms |      172.18.0.6 | GET      "/api/quizzes/32/with-questions"
app_1       | 
app_1       | 2026/02/09 15:04:57 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.917ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:04:57.83') OR (is_active = false AND rotated_at > '2026-02-02 15:04:57.83' AND expires_at > '2026-02-09 15:04:57.83') ORDER BY created_at DESC
app_1       | 2026/02/09 15:04:57 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 15:04:57 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 2026/02/09 15:04:57 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 15:04:57 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.398ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:04:57.831') OR (is_active = false AND rotated_at > '2026-02-02 15:04:57.831' AND expires_at > '2026-02-09 15:04:57.831') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 15:04:57 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.409ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 32 ORDER BY "quizzes"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 15:04:57 /app/internal/repository/postgres/question_repo.go:54
app_1       | [2.099ms] [rows:0] SELECT * FROM "questions" WHERE quiz_id = 32 ORDER BY id
app_1       | 
app_1       | 2026/02/09 15:04:57 /app/internal/repository/postgres/question_repo.go:31
app_1       | [0.454ms] [rows:0] SET CLIENT_ENCODING TO 'UTF8'
app_1       | 
app_1       | 2026/02/09 15:04:57 /app/internal/repository/postgres/question_repo.go:34
app_1       | [9.068ms] [rows:1] INSERT INTO "questions" ("quiz_id","text","options","text_kk","options_kk","correct_option","time_limit_sec","point_value","difficulty","is_used","created_at","updated_at") VALUES (32,'привет','["да","НЕ","Р","К"]','','[]',0,10,1,3,false,'2026-02-09 15:04:57.837','2026-02-09 15:04:57.837') RETURNING "id"
app_1       | 
app_1       | 2026/02/09 15:04:57 /app/internal/repository/postgres/quiz_repo.go:90
app_1       | [2.355ms] [rows:1] UPDATE "quizzes" SET "title"='хоер',"description"='',"scheduled_time"='2026-02-09 15:07:00',"status"='scheduled',"question_count"=1,"prize_fund"=1000000,"created_at"='2026-02-09 15:04:38.537',"updated_at"='2026-02-09 15:04:57.849' WHERE "id" = 32
app_1       | [GIN] 2026/02/09 - 15:04:57 | 200 |   21.364457ms |      172.18.0.6 | POST     "/api/quizzes/32/questions"
app_1       | 
app_1       | 2026/02/09 15:04:57 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.624ms] [rows:1] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 32
app_1       | 
app_1       | 2026/02/09 15:04:57 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [1.293ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 32 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 15:04:57 | 200 |    1.453166ms |      172.18.0.6 | GET      "/api/quizzes/32/with-questions"
app_1       | 
app_1       | 2026/02/09 15:04:58 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.633ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:04:58.122') OR (is_active = false AND rotated_at > '2026-02-02 15:04:58.122' AND expires_at > '2026-02-09 15:04:58.122') ORDER BY created_at DESC
app_1       | 2026/02/09 15:04:58 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 15:04:58 /app/internal/repository/postgres/quiz_ad_slot_repo.go:38
app_1       | [2.628ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 32 ORDER BY question_after ASC
app_1       | [GIN] 2026/02/09 - 15:04:58 | 200 |    3.703863ms |      172.18.0.6 | GET      "/api/quizzes/32/ad-slots"
app_1       | 2026/02/09 15:04:58 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 15:04:58 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.548ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:04:58.126') OR (is_active = false AND rotated_at > '2026-02-02 15:04:58.126' AND expires_at > '2026-02-09 15:04:58.126') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 15:04:58 /app/internal/repository/postgres/ad_asset_repo.go:35
app_1       | [0.377ms] [rows:0] SELECT * FROM "ad_assets" ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 15:04:58 | 200 |    1.255171ms |      172.18.0.6 | GET      "/api/admin/ads"
app_1       | 
app_1       | 2026/02/09 15:05:01 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.659ms] [rows:32] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 15:05:01 | 200 |    2.215464ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 
app_1       | 2026/02/09 15:05:02 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.209ms] [rows:1] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 15:05:02.675' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 15:05:02 | 200 |    1.459849ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 2026/02/09 15:05:06 WebSocket Client Connection Closed Normally (UserID: 1, ConnID: 3e5e0ac3-50da-4207-a2c6-2b3a8ff173d3): websocket: close 1001 (going away)
app_1       | 2026/02/09 15:05:06 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 3e5e0ac3-50da-4207-a2c6-2b3a8ff173d3
app_1       | 2026/02/09 15:05:06 [Shard 0][User 1][Conn 3e5e0ac3-50da-4207-a2c6-2b3a8ff173d3] handleUnregister called
app_1       | 2026/02/09 15:05:06 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 3e5e0ac3-50da-4207-a2c6-2b3a8ff173d3) from Quiz 31
app_1       | 2026/02/09 15:05:06 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 31 (Map: 0xc000529410)
app_1       | 2026/02/09 15:05:06 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 31 (Map: 0xc000529410)
app_1       | 2026/02/09 15:05:06 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 31.
app_1       | 2026/02/09 15:05:06 Client 1 (Conn: 3e5e0ac3-50da-4207-a2c6-2b3a8ff173d3) cleared QuizID
app_1       | 2026/02/09 15:05:06 Shard 0: Client 1 unsubscribed from Quiz 31
app_1       | 2026/02/09 15:05:06 Shard 0: client 1 unregistered
app_1       | 2026/02/09 15:05:06 [ShardedHub] Отправлено обновление player_count для викторины #31: 0 игроков
app_1       | 2026/02/09 15:05:06 ShardedHub: Broadcasting message to Quiz 31 across all shards
app_1       | 2026/02/09 15:05:06 [Shard 3][Quiz 31] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 15:05:06 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 3e5e0ac3-50da-4207-a2c6-2b3a8ff173d3)
app_1       | 2026/02/09 15:05:06 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 3e5e0ac3-50da-4207-a2c6-2b3a8ff173d3
app_1       | 2026/02/09 15:05:06 [Shard 0][Quiz 31] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 15:05:06 [Shard 1][Quiz 31] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 15:05:06 [Shard 2][Quiz 31] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 15:05:06 ShardedHub: Finished broadcasting to Quiz 31
app_1       | 
app_1       | 2026/02/09 15:05:06 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.993ms] [rows:1] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 15:05:06.895' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 15:05:06 | 200 |    1.210793ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 2026/02/09 15:05:06 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 15:05:06 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.240ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:05:06.895') OR (is_active = false AND rotated_at > '2026-02-02 15:05:06.895' AND expires_at > '2026-02-09 15:05:06.895') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 15:05:06 /app/internal/repository/postgres/user_repo.go:33
app_1       | [1.919ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 15:05:06 | 200 |    3.861812ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 15:05:07 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.683ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:05:07.034') OR (is_active = false AND rotated_at > '2026-02-02 15:05:07.034' AND expires_at > '2026-02-09 15:05:07.034') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 15:05:07 | 200 |    1.509037ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 15:05:07 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 15:05:07 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 2026/02/09 15:05:08 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 15:05:08 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 15:05:08 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.829ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:05:08.595') OR (is_active = false AND rotated_at > '2026-02-02 15:05:08.595' AND expires_at > '2026-02-09 15:05:08.595') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 15:05:08 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.403ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:05:08.596') OR (is_active = false AND rotated_at > '2026-02-02 15:05:08.596' AND expires_at > '2026-02-09 15:05:08.596') ORDER BY created_at DESC
app_1       | 2026/02/09 15:05:08 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 15:05:08 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [2.244ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 32 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 15:05:08 | 200 |    2.435551ms |      172.18.0.6 | GET      "/api/quizzes/32"
app_1       | 
app_1       | 2026/02/09 15:05:08 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [3.977ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 15:05:08.597' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 15:05:08 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [GIN] 2026/02/09 - 15:05:08 | 200 |    7.905574ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 15:05:09 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 15:05:09 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 15:05:09 Shard 0: client 1 registered
app_1       | 2026/02/09 15:05:09 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 15:05:09 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: a2da3350-93c3-45f8-a501-18791409a8d3
app_1       | 2026/02/09 15:05:09 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: a2da3350-93c3-45f8-a501-18791409a8d3
app_1       | 
app_1       | 2026/02/09 15:05:09 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.974ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:05:09.014') OR (is_active = false AND rotated_at > '2026-02-02 15:05:09.014' AND expires_at > '2026-02-09 15:05:09.014') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 15:05:09 | 200 |    1.563165ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0OTU2OCwiaWF0IjoxNzcwNjQ5NTA4LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.cl9560KKje19qNpPJlFIThMV0BJwxeelEwpRgzZnZbE"
app_1       | 2026/02/09 15:05:09 Client 1 (Conn: a2da3350-93c3-45f8-a501-18791409a8d3) set QuizID to 32
app_1       | 2026/02/09 15:05:09 [WSHandler] User 1 set QuizID to 32
app_1       | 2026/02/09 15:05:09 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: a2da3350-93c3-45f8-a501-18791409a8d3) to Quiz 32
app_1       | 2026/02/09 15:05:09 [Shard 0][Sub] Client 1: Old QuizID is 32, New QuizID is 32
app_1       | 2026/02/09 15:05:09 [Shard 0][Sub] Client 1 already has atomic QuizID 32. Ensuring map presence.
app_1       | 2026/02/09 15:05:09 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 32
app_1       | 2026/02/09 15:05:09 [Shard 0][Sub] Client 1: Created new map for quiz 32
app_1       | 2026/02/09 15:05:09 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 32 (Map: 0xc000528c90)
app_1       | 2026/02/09 15:05:09 [Shard 0][Sub] Client 1: STORED client in map for Quiz 32 (Map: 0xc000528c90)
app_1       | 2026/02/09 15:05:09 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 32 immediately after Store.
app_1       | 2026/02/09 15:05:09 [WebSocketManager] Клиент 1 подписан на викторину 32 в шарде 0
app_1       | 2026/02/09 15:05:09 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #32
app_1       | 2026/02/09 15:05:09 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #32
app_1       | 2026/02/09 15:05:09 ShardedHub: Broadcasting message to Quiz 32 across all shards
app_1       | 2026/02/09 15:05:09 [Shard 1][Quiz 32] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 15:05:09 [Shard 3][Quiz 32] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 15:05:09 [Shard 2][Quiz 32] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 15:05:09 [Shard 0][Quiz 32] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 15:05:09 [Shard 0][Quiz 32][Range] Iterating over client: User 1, Conn a2da3350-93c3-45f8-a501-18791409a8d3
app_1       | 2026/02/09 15:05:09 [Shard 0][Quiz 32][User 1][Conn a2da3350-93c3-45f8-a501-18791409a8d3] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 15:05:09 [Shard 0][Quiz 32][User 1][Conn a2da3350-93c3-45f8-a501-18791409a8d3] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 15:05:09 Shard 0: Message broadcast to 1 clients in Quiz 32
app_1       | 2026/02/09 15:05:09 ShardedHub: Finished broadcasting to Quiz 32
app_1       | 2026/02/09 15:05:09 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #32 (игроков онлайн: 1)
app_1       | 2026/02/09 15:05:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 15:05:48 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.881ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:05:48.711') OR (is_active = false AND rotated_at > '2026-02-02 15:05:48.711' AND expires_at > '2026-02-09 15:05:48.711') ORDER BY created_at DESC
app_1       | 2026/02/09 15:05:48 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 15:05:48 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.563ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 15:05:48 | 200 |    2.021292ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 15:06:14 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.983ms] [rows:1] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 15:06:14.412' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 15:06:14 | 200 |    1.395767ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 15:06:17 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.642ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 32 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 15:06:17 | 200 |     832.668µs |      172.18.0.6 | GET      "/api/quizzes/32"
app_1       | 
app_1       | 2026/02/09 15:06:17 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.580ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:06:17.98') OR (is_active = false AND rotated_at > '2026-02-02 15:06:17.98' AND expires_at > '2026-02-09 15:06:17.98') ORDER BY created_at DESC
app_1       | 2026/02/09 15:06:17 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 15:06:17 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 15:06:17 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.082ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:06:17.981') OR (is_active = false AND rotated_at > '2026-02-02 15:06:17.981' AND expires_at > '2026-02-09 15:06:17.981') ORDER BY created_at DESC
app_1       | 2026/02/09 15:06:17 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 15:06:17 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.329ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 15:06:17.982' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 15:06:17 | 200 |    4.165848ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 15:06:17 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | 2026/02/09 15:06:18 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 15:06:18 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 15:06:18 Shard 0: replacing client 1 with new connection
app_1       | 2026/02/09 15:06:18 Shard 0: client 1 registered
app_1       | 2026/02/09 15:06:18 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 15:06:18 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 050e482c-9001-46ac-974f-25a5dc0b53fa
app_1       | 2026/02/09 15:06:18 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 050e482c-9001-46ac-974f-25a5dc0b53fa
app_1       | 
app_1       | 2026/02/09 15:06:18 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.861ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:06:18.402') OR (is_active = false AND rotated_at > '2026-02-02 15:06:18.402' AND expires_at > '2026-02-09 15:06:18.402') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 15:06:18 | 200 |    1.563191ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0OTYzNywiaWF0IjoxNzcwNjQ5NTc3LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.xaUf41xg4QLwMP76IaqnrvFrZGWbIV9aPTTGJph4oJA"
app_1       | 2026/02/09 15:06:18 Client 1 (Conn: 050e482c-9001-46ac-974f-25a5dc0b53fa) set QuizID to 32
app_1       | 2026/02/09 15:06:18 [WSHandler] User 1 set QuizID to 32
app_1       | 2026/02/09 15:06:18 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 050e482c-9001-46ac-974f-25a5dc0b53fa) to Quiz 32
app_1       | 2026/02/09 15:06:18 [Shard 0][Sub] Client 1: Old QuizID is 32, New QuizID is 32
app_1       | 2026/02/09 15:06:18 [Shard 0][Sub] Client 1 already has atomic QuizID 32. Ensuring map presence.
app_1       | 2026/02/09 15:06:18 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 32
app_1       | 2026/02/09 15:06:18 [Shard 0][Sub] Client 1: Found existing map for quiz 32
app_1       | 2026/02/09 15:06:18 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 32 (Map: 0xc000528c90)
app_1       | 2026/02/09 15:06:18 [Shard 0][Sub] Client 1: STORED client in map for Quiz 32 (Map: 0xc000528c90)
app_1       | 2026/02/09 15:06:18 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 32 immediately after Store.
app_1       | 2026/02/09 15:06:18 [WebSocketManager] Клиент 1 подписан на викторину 32 в шарде 0
app_1       | 2026/02/09 15:06:18 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #32
app_1       | 2026/02/09 15:06:18 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #32
app_1       | 2026/02/09 15:06:18 ShardedHub: Broadcasting message to Quiz 32 across all shards
app_1       | 2026/02/09 15:06:18 [Shard 3][Quiz 32] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 15:06:18 [Shard 0][Quiz 32] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 15:06:18 [Shard 0][Quiz 32][Range] Iterating over client: User 1, Conn 050e482c-9001-46ac-974f-25a5dc0b53fa
app_1       | 2026/02/09 15:06:18 [Shard 0][Quiz 32][User 1][Conn 050e482c-9001-46ac-974f-25a5dc0b53fa] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 15:06:18 [Shard 0][Quiz 32][User 1][Conn 050e482c-9001-46ac-974f-25a5dc0b53fa] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 15:06:18 [Shard 0][Quiz 32][Range] Iterating over client: User 1, Conn a2da3350-93c3-45f8-a501-18791409a8d3
app_1       | 2026/02/09 15:06:18 [Shard 0][Quiz 32][User 1][Conn a2da3350-93c3-45f8-a501-18791409a8d3] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 15:06:18 [Shard 0][Quiz 32][User 1][Conn a2da3350-93c3-45f8-a501-18791409a8d3] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 15:06:18 Shard 0: Message broadcast to 2 clients in Quiz 32
app_1       | 2026/02/09 15:06:18 [Shard 1][Quiz 32] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 15:06:18 [Shard 2][Quiz 32] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 15:06:18 ShardedHub: Finished broadcasting to Quiz 32
app_1       | 2026/02/09 15:06:18 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #32 (игроков онлайн: 2)
app_1       | 2026/02/09 15:06:18 WebSocket Client Read Error (UserID: 1, ConnID: a2da3350-93c3-45f8-a501-18791409a8d3): read tcp 172.18.0.5:8080->172.18.0.6:47322: use of closed network connection
app_1       | 2026/02/09 15:06:18 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: a2da3350-93c3-45f8-a501-18791409a8d3
app_1       | 2026/02/09 15:06:18 WebSocket Client Send Channel Closed (UserID: 1, ConnID: a2da3350-93c3-45f8-a501-18791409a8d3)
app_1       | 2026/02/09 15:06:18 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: a2da3350-93c3-45f8-a501-18791409a8d3
app_1       | 2026/02/09 15:06:18 [Shard 0][User 1][Conn a2da3350-93c3-45f8-a501-18791409a8d3] handleUnregister called
app_1       | 2026/02/09 15:06:18 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: a2da3350-93c3-45f8-a501-18791409a8d3) from Quiz 32
app_1       | 2026/02/09 15:06:18 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 32 (Map: 0xc000528c90)
app_1       | 2026/02/09 15:06:18 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 32 (Map: 0xc000528c90)
app_1       | 2026/02/09 15:06:18 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 32.
app_1       | 2026/02/09 15:06:18 Client 1 (Conn: a2da3350-93c3-45f8-a501-18791409a8d3) cleared QuizID
app_1       | 2026/02/09 15:06:18 Shard 0: Client 1 unsubscribed from Quiz 32
app_1       | 2026/02/09 15:06:18 [ShardedHub] Отправлено обновление player_count для викторины #32: 1 игроков
app_1       | 2026/02/09 15:06:18 ShardedHub: Broadcasting message to Quiz 32 across all shards
app_1       | 2026/02/09 15:06:18 [Shard 3][Quiz 32] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 15:06:18 [Shard 0][Quiz 32] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 15:06:18 [Shard 0][Quiz 32][Range] Iterating over client: User 1, Conn 050e482c-9001-46ac-974f-25a5dc0b53fa
app_1       | 2026/02/09 15:06:18 [Shard 0][Quiz 32][User 1][Conn 050e482c-9001-46ac-974f-25a5dc0b53fa] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 15:06:18 [Shard 0][Quiz 32][User 1][Conn 050e482c-9001-46ac-974f-25a5dc0b53fa] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 15:06:18 Shard 0: Message broadcast to 1 clients in Quiz 32
app_1       | 2026/02/09 15:06:18 [Shard 1][Quiz 32] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 15:06:18 [Shard 2][Quiz 32] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 15:06:18 ShardedHub: Finished broadcasting to Quiz 32
app_1       | 2026/02/09 15:06:22 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 2026/02/09 15:06:22 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 15:06:22 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.536ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:06:22.057') OR (is_active = false AND rotated_at > '2026-02-02 15:06:22.057' AND expires_at > '2026-02-09 15:06:22.057') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 15:06:22 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.710ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:06:22.059') OR (is_active = false AND rotated_at > '2026-02-02 15:06:22.059' AND expires_at > '2026-02-09 15:06:22.059') ORDER BY created_at DESC
app_1       | 2026/02/09 15:06:22 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 15:06:22 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.526ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 15:06:22.059' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 15:06:22 | 200 |    5.021387ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 15:06:22 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | 
app_1       | 2026/02/09 15:06:22 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.812ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:06:22.464') OR (is_active = false AND rotated_at > '2026-02-02 15:06:22.464' AND expires_at > '2026-02-09 15:06:22.464') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 15:06:22 | 200 |    1.447603ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY0OTY0MiwiaWF0IjoxNzcwNjQ5NTgyLCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.qsOfr4CpepaMySnSYrHrMl1US_qL2_Gg9TwOX2lr1vs"
app_1       | 2026/02/09 15:06:22 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 15:06:22 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 15:06:22 Shard 0: client 1 registered
app_1       | 2026/02/09 15:06:22 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 15:06:22 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 06b98e67-11d6-48fa-89b2-d073049c600a
app_1       | 2026/02/09 15:06:22 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 06b98e67-11d6-48fa-89b2-d073049c600a
app_1       | 2026/02/09 15:06:22 Client 1 (Conn: 06b98e67-11d6-48fa-89b2-d073049c600a) set QuizID to 32
app_1       | 2026/02/09 15:06:22 [WSHandler] User 1 set QuizID to 32
app_1       | 2026/02/09 15:06:22 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 06b98e67-11d6-48fa-89b2-d073049c600a) to Quiz 32
app_1       | 2026/02/09 15:06:22 [Shard 0][Sub] Client 1: Old QuizID is 32, New QuizID is 32
app_1       | 2026/02/09 15:06:22 [Shard 0][Sub] Client 1 already has atomic QuizID 32. Ensuring map presence.
app_1       | 2026/02/09 15:06:22 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 32
app_1       | 2026/02/09 15:06:22 [Shard 0][Sub] Client 1: Found existing map for quiz 32
app_1       | 2026/02/09 15:06:22 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 32 (Map: 0xc000528c90)
app_1       | 2026/02/09 15:06:22 [Shard 0][Sub] Client 1: STORED client in map for Quiz 32 (Map: 0xc000528c90)
app_1       | 2026/02/09 15:06:22 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 32 immediately after Store.
app_1       | 2026/02/09 15:06:22 [WebSocketManager] Клиент 1 подписан на викторину 32 в шарде 0
app_1       | 2026/02/09 15:06:22 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #32
app_1       | 2026/02/09 15:06:22 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #32
app_1       | 2026/02/09 15:06:22 ShardedHub: Broadcasting message to Quiz 32 across all shards
app_1       | 2026/02/09 15:06:22 [Shard 1][Quiz 32] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 15:06:22 [Shard 0][Quiz 32] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 15:06:22 [Shard 0][Quiz 32][Range] Iterating over client: User 1, Conn 06b98e67-11d6-48fa-89b2-d073049c600a
app_1       | 2026/02/09 15:06:22 [Shard 0][Quiz 32][User 1][Conn 06b98e67-11d6-48fa-89b2-d073049c600a] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 15:06:22 [Shard 0][Quiz 32][User 1][Conn 06b98e67-11d6-48fa-89b2-d073049c600a] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 15:06:22 [Shard 0][Quiz 32][Range] Iterating over client: User 1, Conn 050e482c-9001-46ac-974f-25a5dc0b53fa
app_1       | 2026/02/09 15:06:22 [Shard 0][Quiz 32][User 1][Conn 050e482c-9001-46ac-974f-25a5dc0b53fa] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 15:06:22 [Shard 0][Quiz 32][User 1][Conn 050e482c-9001-46ac-974f-25a5dc0b53fa] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 15:06:22 Shard 0: Message broadcast to 2 clients in Quiz 32
app_1       | 2026/02/09 15:06:22 [Shard 2][Quiz 32] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 15:06:22 [Shard 3][Quiz 32] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 15:06:22 ShardedHub: Finished broadcasting to Quiz 32
app_1       | 2026/02/09 15:06:22 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #32 (игроков онлайн: 2)
app_1       | 2026/02/09 15:06:22 [WSHandler] Resync запрос от пользователя 1 для викторины 32
app_1       | 
app_1       | 2026/02/09 15:06:22 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [1.356ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 32 ORDER BY "quizzes"."id" LIMIT 1
app_1       | 2026/02/09 15:06:22 [WSHandler] Успешно отправлен resync для пользователя 1, quiz 32
app_1       | 2026/02/09 15:06:35 [Shard 0] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 15:06:35 [Shard 1] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 15:06:35 [Shard 2] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 15:06:35 [Shard 3] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 15:06:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 15:07:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
^Fapp_1       | 2026/02/09 15:08:35 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 15:08:35 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.980ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:08:35.565') OR (is_active = false AND rotated_at > '2026-02-02 15:08:35.565' AND expires_at > '2026-02-09 15:08:35.565') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 15:08:35 /app/internal/repository/postgres/user_repo.go:33
app_1       | [1.547ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 15:08:35 | 200 |    3.518885ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 15:08:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | [GIN] 2026/02/09 - 15:08:55 | 404 |       2.689µs |      172.18.0.6 | GET      "/ws/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php"
app_1       | [GIN] 2026/02/09 - 15:08:55 | 404 |       1.602µs |      172.18.0.6 | GET      "/ws/ec/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php"
app_1       | [GIN] 2026/02/09 - 15:08:55 | 404 |       2.002µs |      172.18.0.6 | GET      "/api/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php"
app_1       | 2026/02/09 15:09:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 15:10:35 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 15:10:44 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.975ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 15:10:44.593') OR (is_active = false AND rotated_at > '2026-02-02 15:10:44.593' AND expires_at > '2026-02-09 15:10:44.593') ORDER BY created_at DESC
app_1       | 2026/02/09 15:10:44 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 15:10:44 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.647ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 15:10:44 | 200 |    2.273423ms |      172.18.0.6 | GET      "/api/users/me"
