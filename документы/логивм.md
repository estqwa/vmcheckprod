saizhansco@instance-20260124-111940:~/myapp/trivia-api$ sudo docker-compose logs -f app
Attaching to trivia-api_app_1
app_1       | 2026/02/09 17:45:11 Загрузка конфигурации из config/config.yaml
app_1       | 2026/02/09 17:45:11 Запуск применения миграций базы данных...
app_1       | 2026/02/09 17:45:11 Применяем миграции 'up'...
app_1       | 2026/02/09 17:45:11 Изменений в миграциях не найдено, база данных уже актуальна.
app_1       | 2026/02/09 17:45:11 Миграции базы данных завершены.
app_1       | 2026/02/09 17:45:11 Successfully connected to Redis
app_1       | 2026/02/09 17:45:11 [TokenManager] Initializing and ensuring JWT keys...
app_1       | 
app_1       | 2026/02/09 17:45:11 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [42.571ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 17:45:11.74' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 17:45:11 [TokenManager] Active JWT key ID: a488fda381b19b17 found in repository.
app_1       | 2026/02/09 17:45:11 [TokenManager] Access token expiry set to: 24h0m0s
app_1       | 2026/02/09 17:45:11 [TokenManager] Refresh token expiry set to: 720h0m0s
app_1       | 2026/02/09 17:45:11 [TokenManager] Max refresh tokens per user set to: 10
app_1       | 2026/02/09 17:45:11 [TokenManager] Production mode set to: true, Cookie Secure set to: true
app_1       | 2026/02/09 17:45:11 [TokenManager] Cookie attributes set: Path=/, Domain=, Secure=true, HttpOnly=true, SameSite=4
app_1       | 2026/02/09 17:45:11 Инициализация Redis PubSub для кластеризации WebSocket...
app_1       | 2026/02/09 17:45:11 RedisPubSub provider created using existing client.
app_1       | 2026/02/09 17:45:11 Redis PubSub провайдер успешно инициализирован
app_1       | 
app_1       | 2026/02/09 17:45:11 /app/internal/repository/postgres/invalid_token_repo.go:89
app_1       | [11.350ms] [rows:0] SELECT * FROM "invalid_tokens"
app_1       | 2026/02/09 17:45:11 Получено 0 записей из invalid_tokens
app_1       | 2026/02/09 17:45:11 JWT: Loaded 0 invalidated tokens from database
app_1       | 2026/02/09 17:45:11 [TokenManager] JWTService has been set.
app_1       | 2026/02/09 17:45:11 WebSocket: инициализация ShardedHub
app_1       | 2026/02/09 17:45:11 WorkerPool: запущен пул с 8 воркерами
app_1       | 2026/02/09 17:45:11 WorkerPool: запущен пул с 8 воркерами
app_1       | 2026/02/09 17:45:11 [Шард 0] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 17:45:11 [Шард 1] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 17:45:11 [Шард 2] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 17:45:11 [Шард 3] Создан с максимальным количеством клиентов 5000
app_1       | 2026/02/09 17:45:11 ClusterHub: Instance ID не задан, сгенерирован: instance_20260209174511_F0Y5c5Dw
app_1       | 2026/02/09 17:45:11 ShardedHub создан с 4 шардами
app_1       | 2026/02/09 17:45:11 WebSocket: кластерный режим включен
app_1       | 2026/02/09 17:45:11 [QuizManager] Менеджер викторин успешно инициализирован
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 1 запущен
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 2 запущен
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 3 запущен
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 4 запущен
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 5 запущен
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 6 запущен
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 7 запущен
app_1       | 2026/02/09 17:45:11 [Shard 0] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 17:45:11 [Shard 1] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 17:45:11 [Shard 2] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 17:45:11 [Shard 3] Запуск рутины очистки каждые 5m0s с таймаутом 1m0s
app_1       | 2026/02/09 17:45:11 ShardedHub: запуск с 4 шардами, до 5000 клиентов на шард
app_1       | 2026/02/09 17:45:11 ClusterHub: запуск кластерного режима, ID экземпляра: instance_20260209174511_F0Y5c5Dw
app_1       | 2026/02/09 17:45:11 RedisPubSub: Subscribing to channel 'ws:broadcast'
app_1       | 2026/02/09 17:45:11 [JWTService] Starting periodic cleanup routine every 1h0m0s
app_1       | 2026/02/09 17:45:11 Запуск механизма периодической очистки CSRF токенов и истекших refresh-токенов (каждый час)
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 0 запущен
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 1 запущен
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 2 запущен
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 3 запущен
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 4 запущен
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 5 запущен
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 6 запущен
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 7 запущен
app_1       | 2026/02/09 17:45:11 WorkerPool: воркер 0 запущен
app_1       | 2026/02/09 17:45:11 ClusterHub: Запуск публикации метрик каждые 1m0s
app_1       | 2026/02/09 17:45:11 RedisPubSub: Successfully subscribed to channel 'ws:broadcast'
app_1       | 2026/02/09 17:45:11 ClusterHub: начата обработка широковещательных сообщений
app_1       | 2026/02/09 17:45:11 RedisPubSub: Subscribing to channel 'jwt_invalidation_events'
app_1       | 2026/02/09 17:45:11 RedisPubSub: Successfully subscribed to channel 'jwt_invalidation_events'
app_1       | 2026/02/09 17:45:11 [JWTService] Успешно подписан на канал jwt_invalidation_events для синхронизации кэша.
app_1       | 2026/02/09 17:45:11 RedisPubSub: Subscribing to channel 'ws:direct'
app_1       | 2026/02/09 17:45:11 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:ready
app_1       | 2026/02/09 17:45:11 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:answer
app_1       | 2026/02/09 17:45:11 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:heartbeat
app_1       | 2026/02/09 17:45:11 [WebSocketManager] Зарегистрирован обработчик для сообщений типа: user:resync
app_1       | 2026/02/09 17:45:11 Server started on port 8080
app_1       | 2026/02/09 17:45:11 Starting server on port 8080
app_1       | 2026/02/09 17:45:11 RedisPubSub: Successfully subscribed to channel 'ws:direct'
app_1       | 2026/02/09 17:45:11 [ClusterHub:Direct] Успешно подписан на канал прямых сообщений: ws:direct
app_1       | 2026/02/09 17:45:11 RedisPubSub: Subscribing to channel 'ws:metrics'
app_1       | 2026/02/09 17:45:11 RedisPubSub: Successfully subscribed to channel 'ws:metrics'
app_1       | 2026/02/09 17:45:11 [ClusterHub:Metrics] Успешно подписан на канал метрик: ws:metrics
app_1       | 
app_1       | 2026/02/09 17:45:11 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [20.649ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 17:45:11.812' ORDER BY scheduled_time
app_1       | 2026/02/09 17:46:11 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 17:46:57 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:46:57 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [2.847ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:46:57.473') OR (is_active = false AND rotated_at > '2026-02-02 17:46:57.473' AND expires_at > '2026-02-09 17:46:57.473') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:46:57 /app/internal/repository/postgres/user_repo.go:33
app_1       | [19.335ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:46:57 | 200 |   23.639083ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 17:46:57 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.993ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:46:57.627') OR (is_active = false AND rotated_at > '2026-02-02 17:46:57.627' AND expires_at > '2026-02-09 17:46:57.627') ORDER BY created_at DESC
app_1       | 2026/02/09 17:46:57 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 14:35:39 +0000 UTC
app_1       | [GIN] 2026/02/09 - 17:46:57 | 200 |     3.32239ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 17:46:57 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 17:47:03 /app/internal/repository/postgres/user_repo.go:46
app_1       | [1.772ms] [rows:1] SELECT * FROM "users" WHERE email = 'temirlan@mail.ru' ORDER BY "users"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 17:47:03 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.783ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 17:47:03 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [0.856ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 17:47:03.923' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 17:47:03 [JWT] Токен доступа успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17
app_1       | 
app_1       | 2026/02/09 17:47:03 /app/internal/repository/postgres/refresh_token_repo.go:32
app_1       | [15.361ms] [rows:1] INSERT INTO "refresh_tokens" ("user_id","token","device_id","ip_address","user_agent","expires_at","created_at","is_expired","revoked_at","reason") VALUES (1,'d0b949666040dc15965f006d078ea792dea23bdbf6fd5ad8f8aa74efc9cdb040','Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36','172.18.0.6','Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36','2026-03-11 17:47:03.924','2026-02-09 17:47:03.924',false,NULL,'') RETURNING "id"
app_1       | 
app_1       | 2026/02/09 17:47:03 /app/internal/repository/postgres/refresh_token_repo.go:159
app_1       | [2.242ms] [rows:1] SELECT count(*) FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 17:47:03.939'
app_1       | 2026/02/09 17:47:03 [TokenManager] Сгенерирована пара токенов для пользователя ID=1, JWT Key ID: a488fda381b19b17
app_1       | 2026/02/09 17:47:03 JWT: UserID: 1 was not in the invalidation list
app_1       | 2026/02/09 17:47:03 Запись в invalid_tokens для пользователя ID=1 не найдена
app_1       | 2026/02/09 17:47:03 [AuthService] Пользователь ID=1 (temirlan@mail.ru) успешно вошел в систему
app_1       | 
app_1       | 2026/02/09 17:47:03 /app/internal/repository/postgres/invalid_token_repo.go:46
app_1       | [1.201ms] [rows:0] DELETE FROM "invalid_tokens" WHERE "invalid_tokens"."user_id" = 1
app_1       | 2026/02/09 17:47:03 [TokenManager] Установлена CSRF secret cookie (__Host-csrf-secret) с Secure=true, MaxAge: 86400 секунд
app_1       | 
app_1       | 2026/02/09 17:47:03 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.877ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:47:03 | 200 |  104.720599ms |      172.18.0.6 | POST     "/api/auth/login"
app_1       | 
app_1       | 2026/02/09 17:47:04 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [0.960ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 17:47:04.095' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 17:47:04 | 200 |     1.54516ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 2026/02/09 17:47:07 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:47:07 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.808ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:47:07.207') OR (is_active = false AND rotated_at > '2026-02-02 17:47:07.207' AND expires_at > '2026-02-09 17:47:07.207') ORDER BY created_at DESC
app_1       | 2026/02/09 17:47:07 [TokenManager] Получено 6 активных токенов пользователя ID=1
app_1       | 
app_1       | 2026/02/09 17:47:07 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [3.549ms] [rows:6] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 17:47:07.209' ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 17:47:07 | 200 |    7.530088ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 17:47:09 /app/internal/repository/postgres/user_repo.go:179
app_1       | [0.877ms] [rows:1] SELECT count(*) FROM "users"
app_1       | 
app_1       | 2026/02/09 17:47:09 /app/internal/repository/postgres/user_repo.go:191
app_1       | [2.015ms] [rows:10] SELECT "id","username","profile_picture","wins_count","total_prize_won" FROM "users" ORDER BY wins_count DESC, total_prize_won DESC, id ASC LIMIT 10
app_1       | [GIN] 2026/02/09 - 17:47:09 | 200 |    7.705346ms |      172.18.0.6 | GET      "/api/leaderboard?page=1&page_size=10"
app_1       | 2026/02/09 17:47:10 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:47:10 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.094ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:47:10.402') OR (is_active = false AND rotated_at > '2026-02-02 17:47:10.402' AND expires_at > '2026-02-09 17:47:10.402') ORDER BY created_at DESC
app_1       | 2026/02/09 17:47:10 [TokenManager] Получено 6 активных токенов пользователя ID=1
app_1       | 
app_1       | 2026/02/09 17:47:10 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [0.897ms] [rows:6] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 17:47:10.403' ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 17:47:10 | 200 |    2.557504ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 17:47:11 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [2.326ms] [rows:33] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 17:47:11 | 200 |    3.020522ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 17:47:11 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 17:47:14 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.491ms] [rows:33] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 17:47:14 | 200 |    2.206717ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 17:47:14 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:47:14 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.801ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:47:14.67') OR (is_active = false AND rotated_at > '2026-02-02 17:47:14.67' AND expires_at > '2026-02-09 17:47:14.67') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:47:14 /app/internal/repository/postgres/question_repo.go:188
app_1       | [47.865ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL
app_1       | 
app_1       | 2026/02/09 17:47:14 /app/internal/repository/postgres/question_repo.go:193
app_1       | [2.110ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false
app_1       | 
app_1       | 2026/02/09 17:47:14 /app/internal/repository/postgres/question_repo.go:202
app_1       | [1.204ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 1
app_1       | 
app_1       | 2026/02/09 17:47:14 /app/internal/repository/postgres/question_repo.go:202
app_1       | [0.817ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 2
app_1       | 
app_1       | 2026/02/09 17:47:14 /app/internal/repository/postgres/question_repo.go:202
app_1       | [0.760ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 3
app_1       | 
app_1       | 2026/02/09 17:47:14 /app/internal/repository/postgres/question_repo.go:202
app_1       | [0.653ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 4
app_1       | 
app_1       | 2026/02/09 17:47:14 /app/internal/repository/postgres/question_repo.go:202
app_1       | [0.868ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 5
app_1       | [GIN] 2026/02/09 - 17:47:14 | 200 |   56.440804ms |      172.18.0.6 | GET      "/api/admin/question-pool/stats"
app_1       | 
app_1       | 2026/02/09 17:47:15 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.929ms] [rows:33] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 17:47:15 | 200 |     2.51823ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 
app_1       | 2026/02/09 17:47:30 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.285ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:47:30.14') OR (is_active = false AND rotated_at > '2026-02-02 17:47:30.14' AND expires_at > '2026-02-09 17:47:30.14') ORDER BY created_at DESC
app_1       | 2026/02/09 17:47:30 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:47:30 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 2026/02/09 17:47:30 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:47:30 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.534ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:47:30.141') OR (is_active = false AND rotated_at > '2026-02-02 17:47:30.141' AND expires_at > '2026-02-09 17:47:30.141') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:47:30 /app/internal/repository/postgres/quiz_repo.go:26
app_1       | [7.294ms] [rows:1] INSERT INTO "quizzes" ("title","description","scheduled_time","status","question_count","prize_fund","created_at","updated_at") VALUES ('хахахаха','','2026-02-09 17:49:00','scheduled',0,8555,'2026-02-09 17:47:30.143','2026-02-09 17:47:30.143') RETURNING "id"
app_1       | 2026/02/09 17:47:30 [QuizManager] Планирование викторины #34 на 2026-02-09 17:49:00 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:47:30 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [5.223ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 34
app_1       | 
app_1       | 2026/02/09 17:47:30 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [6.995ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 17:47:30 /app/internal/repository/postgres/question_repo.go:173
app_1       | [4.068ms] [rows:1] SELECT * FROM "questions" WHERE quiz_id IS NULL AND difficulty = 1 AND is_used = false ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/09 17:47:30 [Scheduler] Quiz #34: no preset questions, using pool
app_1       | 2026/02/09 17:47:30 [Scheduler] Викторина #34 запланирована на 2026-02-09 17:49:00 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:47:30 /app/internal/repository/postgres/quiz_repo.go:90
app_1       | [2.952ms] [rows:1] UPDATE "quizzes" SET "title"='хахахаха',"description"='',"scheduled_time"='2026-02-09 17:49:00',"status"='scheduled',"question_count"=0,"prize_fund"=8555,"created_at"='2026-02-09 17:47:30.143',"updated_at"='2026-02-09 17:47:30.162' WHERE "id" = 34
app_1       | [GIN] 2026/02/09 - 17:47:30 | 201 |   24.668066ms |      172.18.0.6 | POST     "/api/quizzes"
app_1       | 2026/02/09 17:47:30 [Scheduler] Викторина #34: планирую обратный отсчет через 29.835127494s
app_1       | 
app_1       | 2026/02/09 17:47:30 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.672ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 34
app_1       | 
app_1       | 2026/02/09 17:47:30 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [2.007ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:47:30 | 200 |    2.245763ms |      172.18.0.6 | GET      "/api/quizzes/34/with-questions"
app_1       | 
app_1       | 2026/02/09 17:47:35 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.425ms] [rows:34] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 17:47:35 | 200 |     1.89519ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 
app_1       | 2026/02/09 17:47:37 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.009ms] [rows:1] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 17:47:37.569' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 17:47:37 | 200 |     1.18572ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 17:47:40 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.911ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:47:40 | 200 |    1.094639ms |      172.18.0.6 | GET      "/api/quizzes/34"
app_1       | 
app_1       | 2026/02/09 17:47:40 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.723ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:47:40.669') OR (is_active = false AND rotated_at > '2026-02-02 17:47:40.669' AND expires_at > '2026-02-09 17:47:40.669') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:47:40 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.741ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:47:40.67') OR (is_active = false AND rotated_at > '2026-02-02 17:47:40.67' AND expires_at > '2026-02-09 17:47:40.67') ORDER BY created_at DESC
app_1       | 2026/02/09 17:47:40 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:47:40 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 2026/02/09 17:47:40 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:47:40 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [0.904ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 17:47:40.671' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:47:40 | 200 |    3.307296ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 17:47:40 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | 
app_1       | 2026/02/09 17:47:41 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.699ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:47:41.094') OR (is_active = false AND rotated_at > '2026-02-02 17:47:41.094' AND expires_at > '2026-02-09 17:47:41.094') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 17:47:41 | 200 |    1.327782ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY1OTMyMCwiaWF0IjoxNzcwNjU5MjYwLCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.ynsgXQ4bSPsmgPMI9eKiaNnc6G4Pub2Xi5dbAr1Tjuo"
app_1       | 2026/02/09 17:47:41 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 17:47:41 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 17:47:41 Shard 0: client 1 registered
app_1       | 2026/02/09 17:47:41 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 17:47:41 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:47:41 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:47:41 Client 1 (Conn: 62140943-ab8b-4629-9222-23fda91fd117) set QuizID to 34
app_1       | 2026/02/09 17:47:41 [WSHandler] User 1 set QuizID to 34
app_1       | 2026/02/09 17:47:41 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 62140943-ab8b-4629-9222-23fda91fd117) to Quiz 34
app_1       | 2026/02/09 17:47:41 [Shard 0][Sub] Client 1: Old QuizID is 34, New QuizID is 34
app_1       | 2026/02/09 17:47:41 [Shard 0][Sub] Client 1 already has atomic QuizID 34. Ensuring map presence.
app_1       | 2026/02/09 17:47:41 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 34
app_1       | 2026/02/09 17:47:41 [Shard 0][Sub] Client 1: Created new map for quiz 34
app_1       | 2026/02/09 17:47:41 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:47:41 [Shard 0][Sub] Client 1: STORED client in map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:47:41 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 34 immediately after Store.
app_1       | 2026/02/09 17:47:41 [WebSocketManager] Клиент 1 подписан на викторину 34 в шарде 0
app_1       | 2026/02/09 17:47:41 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #34
app_1       | 2026/02/09 17:47:41 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #34
app_1       | 2026/02/09 17:47:41 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:47:41 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:47:41 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:47:41 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:47:41 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:47:41 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:47:41 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 17:47:41 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 17:47:41 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:47:41 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:47:41 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #34 (игроков онлайн: 1)
app_1       | 2026/02/09 17:48:00 [Scheduler] Запуск обратного отсчета для викторины #34
app_1       | 2026/02/09 17:48:01 [Scheduler] Обратный отсчет викторины #34: 58 сек.
app_1       | 2026/02/09 17:48:01 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:01 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:01 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:01 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:01 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:01 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:01 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:01 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:01 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:01 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:02 [Scheduler] Обратный отсчет викторины #34: 57 сек.
app_1       | 2026/02/09 17:48:02 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:02 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:02 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:02 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:02 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:02 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:02 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:02 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:02 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:02 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:03 [Scheduler] Обратный отсчет викторины #34: 56 сек.
app_1       | 2026/02/09 17:48:03 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:03 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:03 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:03 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:03 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:03 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:03 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:03 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:03 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:03 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:04 [Scheduler] Обратный отсчет викторины #34: 55 сек.
app_1       | 2026/02/09 17:48:04 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:04 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:04 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:04 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:04 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:04 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:04 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:04 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:04 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:04 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:05 [Scheduler] Обратный отсчет викторины #34: 54 сек.
app_1       | 2026/02/09 17:48:05 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:05 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:05 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:05 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:05 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:05 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:05 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:05 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:05 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:05 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:06 [Scheduler] Обратный отсчет викторины #34: 53 сек.
app_1       | 2026/02/09 17:48:06 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:06 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:06 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:06 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:06 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:06 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:06 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:06 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:06 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:06 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:07 [Scheduler] Обратный отсчет викторины #34: 52 сек.
app_1       | 2026/02/09 17:48:07 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:07 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:07 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:07 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:07 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:07 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:07 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:07 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:07 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:07 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:08 [Scheduler] Обратный отсчет викторины #34: 51 сек.
app_1       | 2026/02/09 17:48:08 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:08 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:08 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:08 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:08 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:08 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:08 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:08 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:08 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:08 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:09 [Scheduler] Обратный отсчет викторины #34: 50 сек.
app_1       | 2026/02/09 17:48:09 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:09 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:09 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:09 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:09 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:09 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:09 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:09 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:09 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:09 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:10 [Scheduler] Обратный отсчет викторины #34: 49 сек.
app_1       | 2026/02/09 17:48:10 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:10 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:10 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:10 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:10 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:10 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:10 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:10 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:10 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:10 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:11 [Scheduler] Обратный отсчет викторины #34: 48 сек.
app_1       | 2026/02/09 17:48:11 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:11 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:11 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:11 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:11 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:11 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:11 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:11 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:11 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:11 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:11 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 17:48:12 [Scheduler] Обратный отсчет викторины #34: 47 сек.
app_1       | 2026/02/09 17:48:12 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:12 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:12 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:12 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:12 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:12 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:12 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:12 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:12 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:12 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:13 [Scheduler] Обратный отсчет викторины #34: 46 сек.
app_1       | 2026/02/09 17:48:13 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:13 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:13 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:13 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:13 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:13 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:13 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:13 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:13 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:13 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:14 [Scheduler] Обратный отсчет викторины #34: 45 сек.
app_1       | 2026/02/09 17:48:14 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:14 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:14 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:14 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:14 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:14 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:14 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:14 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:14 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:14 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:15 [Scheduler] Обратный отсчет викторины #34: 44 сек.
app_1       | 2026/02/09 17:48:15 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:15 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:15 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:15 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:15 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:15 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:15 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:15 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:15 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:15 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:16 [Scheduler] Обратный отсчет викторины #34: 43 сек.
app_1       | 2026/02/09 17:48:16 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:16 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:16 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:16 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:16 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:16 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:16 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:16 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:16 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:16 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:17 [Scheduler] Обратный отсчет викторины #34: 42 сек.
app_1       | 2026/02/09 17:48:17 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:17 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:17 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:17 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:17 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:17 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:17 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:17 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:17 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:17 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:18 [Scheduler] Обратный отсчет викторины #34: 41 сек.
app_1       | 2026/02/09 17:48:18 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:18 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:18 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:18 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:18 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:18 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:18 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:18 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:18 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:18 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:19 [Scheduler] Обратный отсчет викторины #34: 40 сек.
app_1       | 2026/02/09 17:48:19 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:19 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:19 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:19 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:19 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:19 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:19 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:19 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:19 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:19 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:20 [Scheduler] Обратный отсчет викторины #34: 39 сек.
app_1       | 2026/02/09 17:48:20 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:20 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:20 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:20 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:20 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:20 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:20 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:20 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:20 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:20 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:21 [Scheduler] Обратный отсчет викторины #34: 38 сек.
app_1       | 2026/02/09 17:48:21 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:21 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:21 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:21 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:21 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:21 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:21 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:21 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:21 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:21 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:22 [Scheduler] Обратный отсчет викторины #34: 37 сек.
app_1       | 2026/02/09 17:48:22 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:22 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:22 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:22 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:22 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:22 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:22 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:22 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:22 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:22 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:23 [Scheduler] Обратный отсчет викторины #34: 36 сек.
app_1       | 2026/02/09 17:48:23 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:23 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:23 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:23 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:23 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:23 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:23 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:23 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:23 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:23 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:24 [Scheduler] Обратный отсчет викторины #34: 35 сек.
app_1       | 2026/02/09 17:48:24 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:24 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:24 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:24 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:24 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:24 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:24 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:24 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:24 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:24 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:25 [Scheduler] Обратный отсчет викторины #34: 34 сек.
app_1       | 2026/02/09 17:48:25 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:25 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:25 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:25 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:25 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:25 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:25 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:25 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:25 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:25 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:26 [Scheduler] Обратный отсчет викторины #34: 33 сек.
app_1       | 2026/02/09 17:48:26 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:26 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:26 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:26 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:26 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:26 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:26 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:26 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:26 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:26 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:27 [Scheduler] Обратный отсчет викторины #34: 32 сек.
app_1       | 2026/02/09 17:48:27 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:27 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:27 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:27 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:27 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:27 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:27 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:27 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:27 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:27 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:28 [Scheduler] Обратный отсчет викторины #34: 31 сек.
app_1       | 2026/02/09 17:48:28 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:28 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:28 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:28 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:28 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:28 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:28 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:28 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:28 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:28 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:29 [Scheduler] Обратный отсчет викторины #34: 30 сек.
app_1       | 2026/02/09 17:48:29 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:29 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:29 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:29 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:29 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:29 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:29 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:29 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:29 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:29 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:30 [Scheduler] Обратный отсчет викторины #34: 29 сек.
app_1       | 2026/02/09 17:48:30 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:30 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:30 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:30 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:30 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:30 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:30 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:30 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:30 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:30 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:31 [Scheduler] Обратный отсчет викторины #34: 28 сек.
app_1       | 2026/02/09 17:48:31 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:31 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:31 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:31 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:31 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:31 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:31 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:31 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:31 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:31 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:32 [Scheduler] Обратный отсчет викторины #34: 27 сек.
app_1       | 2026/02/09 17:48:32 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:32 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:32 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:32 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:32 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:32 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:32 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:32 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:32 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:32 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:33 [Scheduler] Обратный отсчет викторины #34: 26 сек.
app_1       | 2026/02/09 17:48:33 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:33 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:33 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:33 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:33 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:33 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:33 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:33 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:33 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:33 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:34 [Scheduler] Обратный отсчет викторины #34: 25 сек.
app_1       | 2026/02/09 17:48:34 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:34 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:34 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:34 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:34 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:34 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:34 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:34 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:34 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:34 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:35 [Scheduler] Обратный отсчет викторины #34: 24 сек.
app_1       | 2026/02/09 17:48:35 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:35 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:35 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:35 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:35 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:35 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:35 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:35 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:35 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:35 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:36 [Scheduler] Обратный отсчет викторины #34: 23 сек.
app_1       | 2026/02/09 17:48:36 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:36 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:36 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:36 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:36 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:36 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:36 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:36 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:36 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:36 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:37 [Scheduler] Обратный отсчет викторины #34: 22 сек.
app_1       | 2026/02/09 17:48:37 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:37 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:37 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:37 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:37 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:37 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:37 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:37 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:37 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:37 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:38 [Scheduler] Обратный отсчет викторины #34: 21 сек.
app_1       | 2026/02/09 17:48:38 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:38 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:38 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:38 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:38 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:38 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:38 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:38 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:38 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:38 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:39 [Scheduler] Обратный отсчет викторины #34: 20 сек.
app_1       | 2026/02/09 17:48:39 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:39 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:39 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:39 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:39 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:39 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:39 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:39 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:39 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:39 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:40 [Scheduler] Обратный отсчет викторины #34: 19 сек.
app_1       | 2026/02/09 17:48:40 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:40 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:40 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:40 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:40 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:40 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:40 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:40 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:40 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:40 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:41 [Scheduler] Обратный отсчет викторины #34: 18 сек.
app_1       | 2026/02/09 17:48:41 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:41 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:41 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:41 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:41 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:41 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:41 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:41 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:41 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:41 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:42 [Scheduler] Обратный отсчет викторины #34: 17 сек.
app_1       | 2026/02/09 17:48:42 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:42 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:42 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:42 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:42 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:42 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:42 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:42 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:42 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:42 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:43 [Scheduler] Обратный отсчет викторины #34: 16 сек.
app_1       | 2026/02/09 17:48:43 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:43 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:43 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:43 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:43 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:43 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:43 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:43 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:43 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:43 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:44 [Scheduler] Обратный отсчет викторины #34: 15 сек.
app_1       | 2026/02/09 17:48:44 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:44 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:44 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:44 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:44 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:44 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:44 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:44 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:44 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:44 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:45 [Scheduler] Обратный отсчет викторины #34: 14 сек.
app_1       | 2026/02/09 17:48:45 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:45 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:45 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:45 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:45 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:45 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:45 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:45 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:45 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:45 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:46 [Scheduler] Обратный отсчет викторины #34: 13 сек.
app_1       | 2026/02/09 17:48:46 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:46 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:46 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:46 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:46 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:46 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:46 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:46 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:46 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:46 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:47 [Scheduler] Обратный отсчет викторины #34: 12 сек.
app_1       | 2026/02/09 17:48:47 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:47 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:47 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:47 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:47 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:47 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:47 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:47 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:47 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:47 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:48 [Scheduler] Обратный отсчет викторины #34: 11 сек.
app_1       | 2026/02/09 17:48:48 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:48 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:48 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:48 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:48 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:48 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:48 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:48 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:48 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:48 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:49 [Scheduler] Обратный отсчет викторины #34: 10 сек.
app_1       | 2026/02/09 17:48:49 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:49 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:49 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:49 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:49 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:49 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:49 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:49 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:49 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:49 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:50 [Scheduler] Обратный отсчет викторины #34: 9 сек.
app_1       | 2026/02/09 17:48:50 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:50 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:50 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:50 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:50 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:50 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:50 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:50 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:50 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:50 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:51 [Scheduler] Обратный отсчет викторины #34: 8 сек.
app_1       | 2026/02/09 17:48:51 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:51 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:51 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:51 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:51 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:51 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:51 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:51 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:51 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:51 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:52 [Scheduler] Обратный отсчет викторины #34: 7 сек.
app_1       | 2026/02/09 17:48:52 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:52 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:52 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:52 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:52 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:52 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:52 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:52 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:52 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:52 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:53 [Scheduler] Обратный отсчет викторины #34: 6 сек.
app_1       | 2026/02/09 17:48:53 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:53 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:53 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:53 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:53 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:53 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:53 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:53 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:53 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:53 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:54 [Scheduler] Обратный отсчет викторины #34: 5 сек.
app_1       | 2026/02/09 17:48:54 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:54 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:54 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:54 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:54 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:54 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:54 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:54 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:54 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:54 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 
app_1       | 2026/02/09 17:48:54 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.040ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:48:54.789') OR (is_active = false AND rotated_at > '2026-02-02 17:48:54.789' AND expires_at > '2026-02-09 17:48:54.789') ORDER BY created_at DESC
app_1       | 2026/02/09 17:48:54 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:48:54 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.863ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:48:54 | 200 |    2.532411ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 17:48:55 [Scheduler] Обратный отсчет викторины #34: 4 сек.
app_1       | 2026/02/09 17:48:55 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:55 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:55 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:55 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:55 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:55 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:55 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:55 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:55 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:55 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:56 [Scheduler] Обратный отсчет викторины #34: 3 сек.
app_1       | 2026/02/09 17:48:56 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:56 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:56 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:56 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:56 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:56 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:56 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:56 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:56 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:56 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:57 [Scheduler] Обратный отсчет викторины #34: 2 сек.
app_1       | 2026/02/09 17:48:57 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:57 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:57 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:57 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:57 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:57 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:57 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:57 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:57 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:57 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:58 [Scheduler] Обратный отсчет викторины #34: 1 сек.
app_1       | 2026/02/09 17:48:58 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:58 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:58 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:58 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:58 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:countdown
app_1       | 2026/02/09 17:48:58 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:countdown. Buffer len: 0
app_1       | 2026/02/09 17:48:58 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:58 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:58 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:countdown
app_1       | 2026/02/09 17:48:58 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:59 [Scheduler] Обратный отсчет завершен для викторины #34, запуск викторины
app_1       | 2026/02/09 17:48:59 [Scheduler] Запуск викторины #34
app_1       | 
app_1       | 2026/02/09 17:48:59 /app/internal/repository/postgres/quiz_repo.go:84
app_1       | [3.285ms] [rows:1] UPDATE "quizzes" SET "status"='in_progress',"updated_at"='2026-02-09 17:48:59.002' WHERE id = 34
app_1       | 2026/02/09 17:48:59 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:59 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:start
app_1       | 2026/02/09 17:48:59 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:start
app_1       | 2026/02/09 17:48:59 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:start
app_1       | 2026/02/09 17:48:59 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:start
app_1       | 2026/02/09 17:48:59 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:59 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:start
app_1       | 2026/02/09 17:48:59 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:start. Buffer len: 0
app_1       | 2026/02/09 17:48:59 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:59 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:59 [Scheduler] Уведомление о запуске викторины #34 отправлено
app_1       | 2026/02/09 17:48:59 [Scheduler] Сигнал о запуске викторины #34 отправлен в QuizManager
app_1       | 2026/02/09 17:48:59 [QuizManager] Обработка запуска викторины #34
app_1       | 
app_1       | 2026/02/09 17:48:59 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.733ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 34
app_1       | 
app_1       | 2026/02/09 17:48:59 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [1.790ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | 2026/02/09 17:48:59 [QuizManager] Quiz #34: no preset questions, using adaptive mode
app_1       | 2026/02/09 17:48:59 [QuestionManager] Начинаю адаптивный процесс отправки вопросов для викторины #34. Всего вопросов: 10
app_1       | 2026/02/09 17:48:59 [AdaptiveSelector] Quiz #34, Q1: prev_pass_rate=1.00, target_difficulty=1
app_1       | 
app_1       | 2026/02/09 17:48:59 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [1.421ms] [rows:0] SELECT * FROM "questions" WHERE quiz_id = 34 AND difficulty = 1 AND is_used = false ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 17:48:59 /app/internal/repository/postgres/question_repo.go:173
app_1       | [1.368ms] [rows:1] SELECT * FROM "questions" WHERE quiz_id IS NULL AND difficulty = 1 AND is_used = false ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/09 17:48:59 [AdaptiveSelector] Found pool question ID=296 (difficulty=1)
app_1       | 2026/02/09 17:48:59 [AdaptiveSelector] Selected question ID=296, difficulty=1 for Q1
app_1       | 2026/02/09 17:48:59 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:48:59 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:48:59 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:48:59 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:48:59 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:question
app_1       | 2026/02/09 17:48:59 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/09 17:48:59 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:48:59 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:48:59 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:48:59 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:48:59 [QuestionManager] Событие quiz:question для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:48:59 [QuestionManager][DEBUG] Викторина #34, Вопрос #296: Ожидание завершения таймера (10s)...
app_1       | 2026/02/09 17:48:59 [WSHandler] Resync запрос от пользователя 1 для викторины 34
app_1       | 
app_1       | 2026/02/09 17:48:59 /app/internal/repository/postgres/result_repo.go:33
app_1       | [6.517ms] [rows:0] SELECT * FROM "user_answers" WHERE user_id = 1 AND quiz_id = 34 ORDER BY created_at
app_1       | 2026/02/09 17:48:59 [WSHandler] Успешно отправлен resync для пользователя 1, quiz 34
app_1       | 2026/02/09 17:49:00 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:00 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:00 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:00 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:00 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:00 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:00 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:00 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:00 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:00 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:00 [QuestionManager] Таймер вопроса #296 (1 из 0): осталось 8 секунд
app_1       | 2026/02/09 17:49:01 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:01 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:01 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:01 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:01 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:01 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:01 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:01 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:01 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:01 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:01 [QuestionManager] Таймер вопроса #296 (1 из 0): осталось 7 секунд
app_1       | 2026/02/09 17:49:02 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:02 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:02 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:02 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:02 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:02 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:02 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:02 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:02 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:02 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:02 [QuestionManager] Таймер вопроса #296 (1 из 0): осталось 6 секунд
app_1       | 2026/02/09 17:49:03 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:03 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:03 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:03 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:03 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:03 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:03 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:03 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:03 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:03 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:03 [QuestionManager] Таймер вопроса #296 (1 из 0): осталось 5 секунд
app_1       | 2026/02/09 17:49:04 [AnswerProcessor] Обработка ответа пользователя #1 на вопрос #296 (викторина #34), выбранный вариант: 1
app_1       | 2026/02/09 17:49:04 [AnswerProcessor] Ответ User #1 на Q #296 успешно сохранен в БД.
app_1       | 
app_1       | 2026/02/09 17:49:04 /app/internal/repository/postgres/result_repo.go:25
app_1       | [7.539ms] [rows:1] INSERT INTO "user_answers" ("user_id","quiz_id","question_id","selected_option","is_correct","response_time_ms","score","is_eliminated","elimination_reason","created_at") VALUES (1,34,296,1,true,4671,1,false,'','2026-02-09 17:49:04.183') RETURNING "id"
app_1       | 2026/02/09 17:49:04 [AnswerProcessor] Успешно обработан и отправлен результат для User #1 на Q #296 (Quiz #34). Выбыл: false
app_1       | 2026/02/09 17:49:04 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:04 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:04 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:04 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:04 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:04 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:04 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:04 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:04 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:04 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:04 [QuestionManager] Таймер вопроса #296 (1 из 0): осталось 4 секунд
app_1       | 2026/02/09 17:49:05 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:05 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:05 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:05 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:05 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:05 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:05 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:05 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:05 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:05 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:05 [QuestionManager] Таймер вопроса #296 (1 из 0): осталось 3 секунд
app_1       | 2026/02/09 17:49:06 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:06 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:06 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:06 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:06 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:06 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:06 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:06 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:06 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:06 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:06 [QuestionManager] Таймер вопроса #296 (1 из 0): осталось 2 секунд
app_1       | 2026/02/09 17:49:07 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:07 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:07 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:07 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:07 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:07 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:07 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:07 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:07 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:07 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:07 [QuestionManager] Таймер вопроса #296 (1 из 0): осталось 1 секунд
app_1       | 2026/02/09 17:49:08 [QuestionManager] Время на вопрос #296 (1 из 0) викторины #34 истекло
app_1       | 
app_1       | 2026/02/09 17:49:09 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.241ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 17:49:09.376' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 17:49:09 | 200 |    1.759516ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 17:49:09 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.883ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:49:09.379') OR (is_active = false AND rotated_at > '2026-02-02 17:49:09.379' AND expires_at > '2026-02-09 17:49:09.379') ORDER BY created_at DESC
app_1       | 2026/02/09 17:49:09 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:49:09 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.943ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:49:09 | 200 |     2.42578ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 17:49:09 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.649ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:49:09.511') OR (is_active = false AND rotated_at > '2026-02-02 17:49:09.511' AND expires_at > '2026-02-09 17:49:09.511') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 17:49:09 | 200 |    1.085743ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 17:49:09 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:49:09 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 2026/02/09 17:49:09 [QuestionManager] Викторина #34, Вопрос #296 (1 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/09 17:49:09 [QuestionManager][DEBUG] Викторина #34, Вопрос #296: Получение участников из Redis Set quiz:34:participants...
app_1       | 2026/02/09 17:49:09 [QuestionManager][DEBUG] Викторина #34, Вопрос #296: SMembers вернул 1 участников
app_1       | 2026/02/09 17:49:09 [QuestionManager][DEBUG] Викторина #34, Вопрос #296: Проверка ответа для User #1 (Ключ: quiz:34:user:1:question:296)
app_1       | 2026/02/09 17:49:09 [QuestionManager][DEBUG] Викторина #34, Вопрос #296: User #1 УСПЕЛ ответить (ключ quiz:34:user:1:question:296 существует).
app_1       | 2026/02/09 17:49:09 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:09 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:09 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:09 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:09 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:09 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:09 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:09 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/09 17:49:09 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:09 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:09 [QuestionManager] Событие adaptive:question_stats для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:49:09 [QuestionManager] adaptive:question_stats отправлен для Q1: pass_rate=1.00, target=0.90
app_1       | 2026/02/09 17:49:09 [QuestionManager][DEBUG] Викторина #34, Вопрос #296: Отправка события quiz:answer_reveal...
app_1       | 2026/02/09 17:49:09 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:09 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:09 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:09 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:09 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:09 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/09 17:49:09 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:09 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:09 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:09 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:09 [QuestionManager] Событие quiz:answer_reveal для викторины #34 успешно отправлено с 1 попытки
app_1       | 
app_1       | 2026/02/09 17:49:09 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [6.854ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 34 AND question_after = 1 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/09 17:49:09 [QuestionManager] Пауза 500ms между вопросами 1 и 2
app_1       | 2026/02/09 17:49:10 [AdaptiveSelector] Quiz #34, Q2: prev_pass_rate=1.00, target_difficulty=2
app_1       | 
app_1       | 2026/02/09 17:49:10 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [3.031ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 34 AND difficulty = 2 AND is_used = false) AND id NOT IN (296) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/09 17:49:10 [AdaptiveSelector] Found pool question ID=345 (difficulty=2)
app_1       | 2026/02/09 17:49:10 [AdaptiveSelector] Selected question ID=345, difficulty=2 for Q2
app_1       | 
app_1       | 2026/02/09 17:49:10 /app/internal/repository/postgres/question_repo.go:173
app_1       | [1.834ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 2 AND is_used = false) AND id NOT IN (296) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/09 17:49:10 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:10 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:10 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:10 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:10 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:10 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:question
app_1       | 2026/02/09 17:49:10 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:10 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/09 17:49:10 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:10 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:10 [QuestionManager] Событие quiz:question для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:49:10 [QuestionManager][DEBUG] Викторина #34, Вопрос #345: Ожидание завершения таймера (10s)...
app_1       | 2026/02/09 17:49:11 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:11 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:11 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:11 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:11 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:11 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:11 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:11 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:11 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:11 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:11 [QuestionManager] Таймер вопроса #345 (2 из 0): осталось 8 секунд
app_1       | 2026/02/09 17:49:11 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 17:49:12 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:12 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:12 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:12 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:12 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:12 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:12 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:12 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:12 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:12 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:12 [QuestionManager] Таймер вопроса #345 (2 из 0): осталось 7 секунд
app_1       | 2026/02/09 17:49:13 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:13 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:13 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:13 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:13 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:13 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:13 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:13 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:13 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:13 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:13 [QuestionManager] Таймер вопроса #345 (2 из 0): осталось 6 секунд
app_1       | 2026/02/09 17:49:14 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:14 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:14 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:14 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:14 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:14 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:14 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:14 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:14 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:14 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:14 [QuestionManager] Таймер вопроса #345 (2 из 0): осталось 5 секунд
app_1       | 2026/02/09 17:49:15 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:15 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:15 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:15 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:15 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:15 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:15 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:15 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:15 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:15 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:15 [QuestionManager] Таймер вопроса #345 (2 из 0): осталось 4 секунд
app_1       | 2026/02/09 17:49:16 [AnswerProcessor] Обработка ответа пользователя #1 на вопрос #345 (викторина #34), выбранный вариант: 1
app_1       | 2026/02/09 17:49:16 [AnswerProcessor] Ответ User #1 на Q #345 успешно сохранен в БД.
app_1       | 2026/02/09 17:49:16 [AnswerProcessor] Успешно обработан и отправлен результат для User #1 на Q #345 (Quiz #34). Выбыл: false
app_1       | 
app_1       | 2026/02/09 17:49:16 /app/internal/repository/postgres/result_repo.go:25
app_1       | [4.803ms] [rows:1] INSERT INTO "user_answers" ("user_id","quiz_id","question_id","selected_option","is_correct","response_time_ms","score","is_eliminated","elimination_reason","created_at") VALUES (1,34,345,1,true,5824,1,false,'','2026-02-09 17:49:16.555') RETURNING "id"
app_1       | 2026/02/09 17:49:16 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:16 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:16 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:16 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:16 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:16 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:16 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:16 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:16 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:16 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:16 [QuestionManager] Таймер вопроса #345 (2 из 0): осталось 3 секунд
app_1       | 2026/02/09 17:49:17 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:17 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:17 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:17 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:17 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:17 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:17 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:17 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:17 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:17 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:17 [QuestionManager] Таймер вопроса #345 (2 из 0): осталось 2 секунд
app_1       | 2026/02/09 17:49:18 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:18 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:18 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:18 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:18 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:18 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:18 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:18 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:18 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:18 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:18 [QuestionManager] Таймер вопроса #345 (2 из 0): осталось 1 секунд
app_1       | 2026/02/09 17:49:18 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:49:18 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.043ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:49:18.762') OR (is_active = false AND rotated_at > '2026-02-02 17:49:18.762' AND expires_at > '2026-02-09 17:49:18.762') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:49:18 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [1.347ms] [rows:6] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 17:49:18.763' ORDER BY created_at DESC
app_1       | 2026/02/09 17:49:18 [TokenManager] Получено 6 активных токенов пользователя ID=1
app_1       | [GIN] 2026/02/09 - 17:49:18 | 200 |    3.236685ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 2026/02/09 17:49:19 [QuestionManager] Время на вопрос #345 (2 из 0) викторины #34 истекло
app_1       | 
app_1       | 2026/02/09 17:49:20 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.806ms] [rows:34] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 17:49:20 | 200 |    2.486201ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 17:49:20 [QuestionManager] Викторина #34, Вопрос #345 (2 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/09 17:49:20 [QuestionManager][DEBUG] Викторина #34, Вопрос #345: Получение участников из Redis Set quiz:34:participants...
app_1       | 2026/02/09 17:49:20 [QuestionManager][DEBUG] Викторина #34, Вопрос #345: SMembers вернул 1 участников
app_1       | 2026/02/09 17:49:20 [QuestionManager][DEBUG] Викторина #34, Вопрос #345: Проверка ответа для User #1 (Ключ: quiz:34:user:1:question:345)
app_1       | 2026/02/09 17:49:20 [QuestionManager][DEBUG] Викторина #34, Вопрос #345: User #1 УСПЕЛ ответить (ключ quiz:34:user:1:question:345 существует).
app_1       | 2026/02/09 17:49:20 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:20 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:20 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:20 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:20 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:20 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/09 17:49:20 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:20 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:20 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:20 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:20 [QuestionManager] Событие adaptive:question_stats для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:49:20 [QuestionManager] adaptive:question_stats отправлен для Q2: pass_rate=1.00, target=0.85
app_1       | 2026/02/09 17:49:20 [QuestionManager][DEBUG] Викторина #34, Вопрос #345: Отправка события quiz:answer_reveal...
app_1       | 2026/02/09 17:49:20 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:20 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:20 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:20 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:20 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:20 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/09 17:49:20 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:20 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:20 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:20 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:20 [QuestionManager] Событие quiz:answer_reveal для викторины #34 успешно отправлено с 1 попытки
app_1       | 
app_1       | 2026/02/09 17:49:20 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [1.243ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 34 AND question_after = 2 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/09 17:49:20 [QuestionManager] Пауза 500ms между вопросами 2 и 3
app_1       | 
app_1       | 2026/02/09 17:49:21 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.569ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 34
app_1       | 
app_1       | 2026/02/09 17:49:21 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [1.486ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:49:21 | 200 |    1.755118ms |      172.18.0.6 | GET      "/api/quizzes/34/with-questions"
app_1       | 2026/02/09 17:49:21 [AdaptiveSelector] Quiz #34, Q3: prev_pass_rate=1.00, target_difficulty=3
app_1       | 
app_1       | 2026/02/09 17:49:21 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [3.083ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 34 AND difficulty = 3 AND is_used = false) AND id NOT IN (296,345) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 17:49:21 /app/internal/repository/postgres/question_repo.go:173
app_1       | [1.955ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 3 AND is_used = false) AND id NOT IN (296,345) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/09 17:49:21 [AdaptiveSelector] Found pool question ID=383 (difficulty=3)
app_1       | 2026/02/09 17:49:21 [AdaptiveSelector] Selected question ID=383, difficulty=3 for Q3
app_1       | 2026/02/09 17:49:21 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:21 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:21 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:21 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:21 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:question
app_1       | 2026/02/09 17:49:21 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/09 17:49:21 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:21 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:21 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:21 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:21 [QuestionManager] Событие quiz:question для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:49:21 [QuestionManager][DEBUG] Викторина #34, Вопрос #383: Ожидание завершения таймера (10s)...
app_1       | 
app_1       | 2026/02/09 17:49:22 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.897ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:49:22 | 200 |    1.151624ms |      172.18.0.6 | GET      "/api/quizzes/34"
app_1       | 2026/02/09 17:49:22 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:22 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:22 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:22 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:22 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:22 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:22 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:22 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:22 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:22 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:22 [QuestionManager] Таймер вопроса #383 (3 из 0): осталось 8 секунд
app_1       | 2026/02/09 17:49:23 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:23 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:23 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:23 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:23 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:23 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:23 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:23 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:23 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:23 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:23 [QuestionManager] Таймер вопроса #383 (3 из 0): осталось 7 секунд
app_1       | 2026/02/09 17:49:24 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:24 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:24 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:24 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:24 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:24 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:24 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:24 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:24 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:24 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:24 [QuestionManager] Таймер вопроса #383 (3 из 0): осталось 6 секунд
app_1       | 2026/02/09 17:49:25 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:25 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:25 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:25 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:25 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:25 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:25 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:25 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:25 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:25 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:25 [QuestionManager] Таймер вопроса #383 (3 из 0): осталось 5 секунд
app_1       | 2026/02/09 17:49:26 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:49:26 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 17:49:26 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.853ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:49:26.236') OR (is_active = false AND rotated_at > '2026-02-02 17:49:26.236' AND expires_at > '2026-02-09 17:49:26.236') ORDER BY created_at DESC
app_1       | 2026/02/09 17:49:26 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:49:26 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.379ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:49:26.237') OR (is_active = false AND rotated_at > '2026-02-02 17:49:26.237' AND expires_at > '2026-02-09 17:49:26.237') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:49:26 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [0.863ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 17:49:26.238' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:49:26 | 200 |    2.769976ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 17:49:26 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | 
app_1       | 2026/02/09 17:49:26 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.594ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:49:26.64') OR (is_active = false AND rotated_at > '2026-02-02 17:49:26.64' AND expires_at > '2026-02-09 17:49:26.64') ORDER BY created_at DESC
app_1       | 2026/02/09 17:49:26 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 17:49:26 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 17:49:26 Shard 0: replacing client 1 with new connection
app_1       | 2026/02/09 17:49:26 Shard 0: client 1 registered
app_1       | 2026/02/09 17:49:26 WebSocket: client 1 fully registered, starting pumps
app_1       | [GIN] 2026/02/09 - 17:49:26 | 200 |    1.708169ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY1OTQyNiwiaWF0IjoxNzcwNjU5MzY2LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.-Ehh2twAmywlL_wmXalfRMW_sSv-RqTWdyNj-QnZSQw"
app_1       | 2026/02/09 17:49:26 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:26 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:26 Client 1 (Conn: d67837c1-f1c5-4a47-bba8-f77ec52acd4c) set QuizID to 34
app_1       | 2026/02/09 17:49:26 [WSHandler] User 1 set QuizID to 34
app_1       | 2026/02/09 17:49:26 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: d67837c1-f1c5-4a47-bba8-f77ec52acd4c) to Quiz 34
app_1       | 2026/02/09 17:49:26 [Shard 0][Sub] Client 1: Old QuizID is 34, New QuizID is 34
app_1       | 2026/02/09 17:49:26 [Shard 0][Sub] Client 1 already has atomic QuizID 34. Ensuring map presence.
app_1       | 2026/02/09 17:49:26 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 34
app_1       | 2026/02/09 17:49:26 [Shard 0][Sub] Client 1: Found existing map for quiz 34
app_1       | 2026/02/09 17:49:26 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:49:26 [Shard 0][Sub] Client 1: STORED client in map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:49:26 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 34 immediately after Store.
app_1       | 2026/02/09 17:49:26 [WebSocketManager] Клиент 1 подписан на викторину 34 в шарде 0
app_1       | 2026/02/09 17:49:26 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #34
app_1       | 2026/02/09 17:49:26 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #34
app_1       | 2026/02/09 17:49:26 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:26 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:49:26 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:49:26 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:26 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 17:49:26 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 17:49:26 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:26 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 17:49:26 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 17:49:26 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:26 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:49:26 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:49:26 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:26 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #34 (игроков онлайн: 2)
app_1       | 2026/02/09 17:49:26 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:26 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:26 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:26 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:26 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:26 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:26 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:26 [Shard 0][Quiz 34][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:26 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:26 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:26 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:26 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:26 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:26 [QuestionManager] Таймер вопроса #383 (3 из 0): осталось 4 секунд
app_1       | 2026/02/09 17:49:27 WebSocket Client Read Error (UserID: 1, ConnID: 62140943-ab8b-4629-9222-23fda91fd117): read tcp 172.18.0.5:8080->172.18.0.6:50922: use of closed network connection
app_1       | 2026/02/09 17:49:27 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:27 [Shard 0][User 1][Conn 62140943-ab8b-4629-9222-23fda91fd117] handleUnregister called
app_1       | 2026/02/09 17:49:27 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 62140943-ab8b-4629-9222-23fda91fd117) from Quiz 34
app_1       | 2026/02/09 17:49:27 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:49:27 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:49:27 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 34.
app_1       | 2026/02/09 17:49:27 Client 1 (Conn: 62140943-ab8b-4629-9222-23fda91fd117) cleared QuizID
app_1       | 2026/02/09 17:49:27 Shard 0: Client 1 unsubscribed from Quiz 34
app_1       | 2026/02/09 17:49:27 [ShardedHub] Отправлено обновление player_count для викторины #34: 1 игроков
app_1       | 2026/02/09 17:49:27 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:27 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:49:27 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 62140943-ab8b-4629-9222-23fda91fd117)
app_1       | 2026/02/09 17:49:27 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 62140943-ab8b-4629-9222-23fda91fd117
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 17:49:27 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:49:27 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:49:27 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:49:27 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 
app_1       | 2026/02/09 17:49:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.548ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:49:27.274') OR (is_active = false AND rotated_at > '2026-02-02 17:49:27.274' AND expires_at > '2026-02-09 17:49:27.274') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:49:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.580ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:49:27.275') OR (is_active = false AND rotated_at > '2026-02-02 17:49:27.275' AND expires_at > '2026-02-09 17:49:27.275') ORDER BY created_at DESC
app_1       | 2026/02/09 17:49:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:49:27 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 2026/02/09 17:49:27 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:49:27 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.099ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 17:49:27.276' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 17:49:27 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [GIN] 2026/02/09 - 17:49:27 | 200 |    3.330934ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 
app_1       | 2026/02/09 17:49:27 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.756ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:49:27.747') OR (is_active = false AND rotated_at > '2026-02-02 17:49:27.747' AND expires_at > '2026-02-09 17:49:27.747') ORDER BY created_at DESC
app_1       | 2026/02/09 17:49:27 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 17:49:27 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 17:49:27 Shard 0: client 1 registered
app_1       | 2026/02/09 17:49:27 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 17:49:27 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | [GIN] 2026/02/09 - 17:49:27 | 200 |     1.89612ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY1OTQyNywiaWF0IjoxNzcwNjU5MzY3LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.sHmp3-asiQAs1MXd_Zb8OPvky9mng1pJ3LW1OaWpCJY"
app_1       | 2026/02/09 17:49:27 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:27 Client 1 (Conn: 7e1ad69a-d50c-4614-b50e-0c0b455633ea) set QuizID to 34
app_1       | 2026/02/09 17:49:27 [WSHandler] User 1 set QuizID to 34
app_1       | 2026/02/09 17:49:27 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 7e1ad69a-d50c-4614-b50e-0c0b455633ea) to Quiz 34
app_1       | 2026/02/09 17:49:27 [Shard 0][Sub] Client 1: Old QuizID is 34, New QuizID is 34
app_1       | 2026/02/09 17:49:27 [Shard 0][Sub] Client 1 already has atomic QuizID 34. Ensuring map presence.
app_1       | 2026/02/09 17:49:27 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 34
app_1       | 2026/02/09 17:49:27 [Shard 0][Sub] Client 1: Found existing map for quiz 34
app_1       | 2026/02/09 17:49:27 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:49:27 [Shard 0][Sub] Client 1: STORED client in map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:49:27 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 34 immediately after Store.
app_1       | 2026/02/09 17:49:27 [WebSocketManager] Клиент 1 подписан на викторину 34 в шарде 0
app_1       | 2026/02/09 17:49:27 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #34
app_1       | 2026/02/09 17:49:27 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #34
app_1       | 2026/02/09 17:49:27 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:27 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 17:49:27 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:49:27 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 17:49:27 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:27 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:27 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #34 (игроков онлайн: 2)
app_1       | 2026/02/09 17:49:27 [WSHandler] Resync запрос от пользователя 1 для викторины 34
app_1       | 
app_1       | 2026/02/09 17:49:27 /app/internal/repository/postgres/result_repo.go:33
app_1       | [1.017ms] [rows:2] SELECT * FROM "user_answers" WHERE user_id = 1 AND quiz_id = 34 ORDER BY created_at
app_1       | 2026/02/09 17:49:27 [WSHandler] Успешно отправлен resync для пользователя 1, quiz 34
app_1       | 2026/02/09 17:49:27 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:27 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:27 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:27 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:27 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:27 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:27 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:27 [QuestionManager] Таймер вопроса #383 (3 из 0): осталось 3 секунд
app_1       | 2026/02/09 17:49:28 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:28 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:28 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:28 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:28 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:28 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:28 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:28 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:28 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:28 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:28 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:28 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:28 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:28 [QuestionManager] Таймер вопроса #383 (3 из 0): осталось 2 секунд
app_1       | 2026/02/09 17:49:29 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:29 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:29 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:29 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:29 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:29 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:29 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:29 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:29 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:29 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:29 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:29 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:29 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:29 [QuestionManager] Таймер вопроса #383 (3 из 0): осталось 1 секунд
app_1       | 2026/02/09 17:49:30 [QuestionManager] Время на вопрос #383 (3 из 0) викторины #34 истекло
app_1       | 2026/02/09 17:49:31 [QuestionManager] Викторина #34, Вопрос #383 (3 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/09 17:49:31 [QuestionManager][DEBUG] Викторина #34, Вопрос #383: Получение участников из Redis Set quiz:34:participants...
app_1       | 2026/02/09 17:49:31 [QuestionManager][DEBUG] Викторина #34, Вопрос #383: SMembers вернул 1 участников
app_1       | 2026/02/09 17:49:31 [QuestionManager][DEBUG] Викторина #34, Вопрос #383: Проверка ответа для User #1 (Ключ: quiz:34:user:1:question:383)
app_1       | 2026/02/09 17:49:31 [QuestionManager][DEBUG] Викторина #34, Вопрос #383: User #1 НЕ ответил. Проверка ключа выбывания quiz:34:eliminated:1...
app_1       | 2026/02/09 17:49:31 [QuestionManager] Пользователь #1 выбывает из викторины #34. Причина: no_answer_timeout (Вопрос #383). Установка ключа quiz:34:eliminated:1...
app_1       | 2026/02/09 17:49:31 [QuestionManager][DEBUG] Сохранён user_answer для таймаута User #1 на вопрос #383
app_1       | 
app_1       | 2026/02/09 17:49:31 /app/internal/repository/postgres/result_repo.go:25
app_1       | [3.227ms] [rows:1] INSERT INTO "user_answers" ("user_id","quiz_id","question_id","selected_option","is_correct","response_time_ms","score","is_eliminated","elimination_reason","created_at") VALUES (1,34,383,-1,false,0,0,true,'no_answer_timeout','2026-02-09 17:49:31.947') RETURNING "id"
app_1       | 2026/02/09 17:49:31 [QuestionManager][DEBUG] Успешно установлен ключ выбывания quiz:34:eliminated:1 для User #1
app_1       | 2026/02/09 17:49:31 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:31 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:31 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:31 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:31 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:31 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/09 17:49:31 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:31 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:31 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/09 17:49:31 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:31 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:31 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:31 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:31 [QuestionManager] Событие adaptive:question_stats для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:49:31 [QuestionManager] adaptive:question_stats отправлен для Q3: pass_rate=0.00, target=0.78
app_1       | 2026/02/09 17:49:32 [QuestionManager][DEBUG] Викторина #34, Вопрос #383: Отправка события quiz:answer_reveal...
app_1       | 2026/02/09 17:49:32 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:32 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:32 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:32 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:32 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:32 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/09 17:49:32 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:32 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:32 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/09 17:49:32 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:32 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:32 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:32 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:32 [QuestionManager] Событие quiz:answer_reveal для викторины #34 успешно отправлено с 1 попытки
app_1       | 
app_1       | 2026/02/09 17:49:32 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [1.234ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 34 AND question_after = 3 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/09 17:49:32 [QuestionManager] Пауза 500ms между вопросами 3 и 4
app_1       | 2026/02/09 17:49:32 [AdaptiveSelector] Quiz #34, Q4: prev_pass_rate=1.00, target_difficulty=4
app_1       | 
app_1       | 2026/02/09 17:49:32 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [1.916ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 34 AND difficulty = 4 AND is_used = false) AND id NOT IN (296,345,383) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 17:49:32 [AdaptiveSelector] Found pool question ID=583 (difficulty=4)
app_1       | 2026/02/09 17:49:32 [AdaptiveSelector] Selected question ID=583, difficulty=4 for Q4
app_1       | 2026/02/09 17:49:32 /app/internal/repository/postgres/question_repo.go:173
app_1       | [1.676ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 4 AND is_used = false) AND id NOT IN (296,345,383) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/09 17:49:33 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:33 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:33 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:33 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:33 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:question
app_1       | 2026/02/09 17:49:33 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/09 17:49:33 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:33 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:question
app_1       | 2026/02/09 17:49:33 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/09 17:49:33 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:33 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:33 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:33 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:33 [QuestionManager] Событие quiz:question для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:49:33 [QuestionManager][DEBUG] Викторина #34, Вопрос #583: Ожидание завершения таймера (10s)...
app_1       | 2026/02/09 17:49:34 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:34 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:34 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:34 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:34 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:34 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:34 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:34 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:34 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:34 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:34 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:34 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:34 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:34 [QuestionManager] Таймер вопроса #583 (4 из 0): осталось 8 секунд
app_1       | 2026/02/09 17:49:35 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:35 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:35 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:35 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:35 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:35 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:35 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:35 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:35 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:35 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:35 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:35 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:35 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:35 [QuestionManager] Таймер вопроса #583 (4 из 0): осталось 7 секунд
app_1       | 2026/02/09 17:49:36 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:36 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:36 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:36 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:36 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:36 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:36 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:36 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:36 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:36 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:36 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:36 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:36 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:36 [QuestionManager] Таймер вопроса #583 (4 из 0): осталось 6 секунд
app_1       | 2026/02/09 17:49:37 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:37 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:37 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:37 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:37 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:37 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:37 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:37 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:37 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:37 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:37 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:37 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:37 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:37 [QuestionManager] Таймер вопроса #583 (4 из 0): осталось 5 секунд
app_1       | 2026/02/09 17:49:38 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:38 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:38 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:38 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:38 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:38 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:38 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:38 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:38 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:38 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:38 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:38 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:38 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:38 [QuestionManager] Таймер вопроса #583 (4 из 0): осталось 4 секунд
app_1       | 2026/02/09 17:49:39 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:39 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:39 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:39 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:39 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:39 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:39 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:39 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:39 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:39 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:39 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:39 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:39 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:39 [QuestionManager] Таймер вопроса #583 (4 из 0): осталось 3 секунд
app_1       | 2026/02/09 17:49:40 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:40 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:40 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:40 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:40 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:40 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:40 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:40 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:40 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:40 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:40 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:40 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:40 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:40 [QuestionManager] Таймер вопроса #583 (4 из 0): осталось 2 секунд
app_1       | 2026/02/09 17:49:41 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:41 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:41 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:41 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:41 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:41 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:41 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:41 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:41 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:41 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:41 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:41 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:41 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:41 [QuestionManager] Таймер вопроса #583 (4 из 0): осталось 1 секунд
app_1       | 2026/02/09 17:49:42 [QuestionManager] Время на вопрос #583 (4 из 0) викторины #34 истекло
app_1       | 2026/02/09 17:49:43 [QuestionManager] Викторина #34, Вопрос #583 (4 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/09 17:49:43 [QuestionManager][DEBUG] Викторина #34, Вопрос #583: Получение участников из Redis Set quiz:34:participants...
app_1       | 2026/02/09 17:49:43 [QuestionManager][DEBUG] Викторина #34, Вопрос #583: SMembers вернул 1 участников
app_1       | 2026/02/09 17:49:43 [QuestionManager][DEBUG] Викторина #34, Вопрос #583: Проверка ответа для User #1 (Ключ: quiz:34:user:1:question:583)
app_1       | 2026/02/09 17:49:43 [QuestionManager][DEBUG] Викторина #34, Вопрос #583: User #1 НЕ ответил. Проверка ключа выбывания quiz:34:eliminated:1...
app_1       | 2026/02/09 17:49:43 [QuestionManager][DEBUG] Викторина #34, Вопрос #583: User #1 не ответил, но УЖЕ был выбывший (ключ quiz:34:eliminated:1 существует).
app_1       | 2026/02/09 17:49:43 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:43 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:43 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:43 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:43 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:43 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/09 17:49:43 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:43 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:43 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/09 17:49:43 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:43 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:43 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:43 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:43 [QuestionManager] Событие adaptive:question_stats для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:49:43 [QuestionManager] adaptive:question_stats отправлен для Q4: pass_rate=0.00, target=0.70
app_1       | 2026/02/09 17:49:43 [QuestionManager][DEBUG] Викторина #34, Вопрос #583: Отправка события quiz:answer_reveal...
app_1       | 2026/02/09 17:49:43 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:43 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:43 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:43 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:43 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:43 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:43 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:43 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/09 17:49:43 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:43 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:43 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/09 17:49:43 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:43 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:43 [QuestionManager] Событие quiz:answer_reveal для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:49:43 [QuestionManager] Пауза 500ms между вопросами 4 и 5
app_1       | 
app_1       | 2026/02/09 17:49:43 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [1.487ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 34 AND question_after = 4 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/09 17:49:43 [AdaptiveSelector] Quiz #34, Q5: prev_pass_rate=1.00, target_difficulty=4
app_1       | 
app_1       | 2026/02/09 17:49:43 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [1.411ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 34 AND difficulty = 4 AND is_used = false) AND id NOT IN (296,345,383,583) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 17:49:43 /app/internal/repository/postgres/question_repo.go:173
app_1       | [1.311ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 4 AND is_used = false) AND id NOT IN (296,345,383,583) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/09 17:49:43 [AdaptiveSelector] Found pool question ID=587 (difficulty=4)
app_1       | 2026/02/09 17:49:43 [AdaptiveSelector] Selected question ID=587, difficulty=4 for Q5
app_1       | 2026/02/09 17:49:44 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:44 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:44 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:44 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:44 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:question
app_1       | 2026/02/09 17:49:44 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/09 17:49:44 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:44 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:question
app_1       | 2026/02/09 17:49:44 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:44 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/09 17:49:44 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:44 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:44 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:44 [QuestionManager] Событие quiz:question для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:49:44 [QuestionManager][DEBUG] Викторина #34, Вопрос #587: Ожидание завершения таймера (10s)...
app_1       | 2026/02/09 17:49:45 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:45 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:45 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:45 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:45 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:45 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:45 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:45 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:45 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:45 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:45 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:45 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:45 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:45 [QuestionManager] Таймер вопроса #587 (5 из 0): осталось 8 секунд
app_1       | 2026/02/09 17:49:46 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:46 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:46 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:46 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:46 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:46 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:46 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:46 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:46 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:46 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:46 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:46 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:46 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:46 [QuestionManager] Таймер вопроса #587 (5 из 0): осталось 7 секунд
app_1       | 2026/02/09 17:49:47 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:47 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:47 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:47 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:47 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:47 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:47 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:47 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:47 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:47 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:47 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:47 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:47 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:47 [QuestionManager] Таймер вопроса #587 (5 из 0): осталось 6 секунд
app_1       | 2026/02/09 17:49:48 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:48 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:48 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:48 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:48 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:48 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:48 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:48 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:48 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:48 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:48 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:48 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:48 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:48 [QuestionManager] Таймер вопроса #587 (5 из 0): осталось 5 секунд
app_1       | 2026/02/09 17:49:49 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:49 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:49 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:49 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:49 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:49 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:49 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:49 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:49 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:49 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:49 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:49 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:49 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:49 [QuestionManager] Таймер вопроса #587 (5 из 0): осталось 4 секунд
app_1       | 2026/02/09 17:49:50 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:50 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:50 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:50 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:50 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:50 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:50 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:50 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:50 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:50 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:50 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:50 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:50 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:50 [QuestionManager] Таймер вопроса #587 (5 из 0): осталось 3 секунд
app_1       | 2026/02/09 17:49:51 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:51 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:51 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:51 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:51 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:51 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:51 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:51 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:51 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:51 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:51 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:51 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:51 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:51 [QuestionManager] Таймер вопроса #587 (5 из 0): осталось 2 секунд
app_1       | 2026/02/09 17:49:52 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:52 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:52 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:52 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:52 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:52 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:52 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:52 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:52 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:52 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:52 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:52 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:52 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:52 [QuestionManager] Таймер вопроса #587 (5 из 0): осталось 1 секунд
app_1       | 2026/02/09 17:49:53 [QuestionManager] Время на вопрос #587 (5 из 0) викторины #34 истекло
app_1       | 2026/02/09 17:49:54 [QuestionManager] Викторина #34, Вопрос #587 (5 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/09 17:49:54 [QuestionManager][DEBUG] Викторина #34, Вопрос #587: Получение участников из Redis Set quiz:34:participants...
app_1       | 2026/02/09 17:49:54 [QuestionManager][DEBUG] Викторина #34, Вопрос #587: SMembers вернул 1 участников
app_1       | 2026/02/09 17:49:54 [QuestionManager][DEBUG] Викторина #34, Вопрос #587: Проверка ответа для User #1 (Ключ: quiz:34:user:1:question:587)
app_1       | 2026/02/09 17:49:54 [QuestionManager][DEBUG] Викторина #34, Вопрос #587: User #1 НЕ ответил. Проверка ключа выбывания quiz:34:eliminated:1...
app_1       | 2026/02/09 17:49:54 [QuestionManager][DEBUG] Викторина #34, Вопрос #587: User #1 не ответил, но УЖЕ был выбывший (ключ quiz:34:eliminated:1 существует).
app_1       | 2026/02/09 17:49:54 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:54 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:54 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:54 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:54 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:54 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/09 17:49:54 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:54 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:54 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/09 17:49:54 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:54 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:54 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:49:54 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:54 [QuestionManager] Событие adaptive:question_stats для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:49:54 [QuestionManager] adaptive:question_stats отправлен для Q5: pass_rate=0.00, target=0.62
app_1       | 2026/02/09 17:49:54 [QuestionManager][DEBUG] Викторина #34, Вопрос #587: Отправка события quiz:answer_reveal...
app_1       | 2026/02/09 17:49:54 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:54 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:54 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:54 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:54 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:54 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:54 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:54 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/09 17:49:54 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:54 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/09 17:49:54 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/09 17:49:54 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:54 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:54 [QuestionManager] Событие quiz:answer_reveal для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:49:54 [QuestionManager] Пауза 500ms между вопросами 5 и 6
app_1       | 
app_1       | 2026/02/09 17:49:54 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [1.435ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 34 AND question_after = 5 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/09 17:49:55 [AdaptiveSelector] Quiz #34, Q6: prev_pass_rate=1.00, target_difficulty=5
app_1       | 
app_1       | 2026/02/09 17:49:55 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [1.677ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 34 AND difficulty = 5 AND is_used = false) AND id NOT IN (296,345,383,583,587) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 17:49:55 /app/internal/repository/postgres/question_repo.go:173
app_1       | [1.775ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 5 AND is_used = false) AND id NOT IN (296,345,383,583,587) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/09 17:49:55 [AdaptiveSelector] Found pool question ID=460 (difficulty=5)
app_1       | 2026/02/09 17:49:55 [AdaptiveSelector] Selected question ID=460, difficulty=5 for Q6
app_1       | 2026/02/09 17:49:55 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:55 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:55 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:55 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:55 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:49:55 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:55 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:question
app_1       | 2026/02/09 17:49:55 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/09 17:49:55 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:55 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:question
app_1       | 2026/02/09 17:49:55 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/09 17:49:55 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:55 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:55 [QuestionManager] Событие quiz:question для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:49:55 [QuestionManager][DEBUG] Викторина #34, Вопрос #460: Ожидание завершения таймера (10s)...
app_1       | 2026/02/09 17:49:56 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:56 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:56 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:56 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:56 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:56 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:56 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:56 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:56 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:56 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:56 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:56 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:56 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:56 [QuestionManager] Таймер вопроса #460 (6 из 0): осталось 8 секунд
app_1       | 2026/02/09 17:49:57 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:57 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:57 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:57 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:57 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:57 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:57 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:57 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:57 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:57 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:57 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:57 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:57 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:57 [QuestionManager] Таймер вопроса #460 (6 из 0): осталось 7 секунд
app_1       | 2026/02/09 17:49:58 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:58 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:58 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:58 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:58 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:58 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:58 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:58 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:58 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:58 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:58 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:58 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:58 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:58 [QuestionManager] Таймер вопроса #460 (6 из 0): осталось 6 секунд
app_1       | 2026/02/09 17:49:59 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:49:59 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:59 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:59 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:49:59 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:59 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:59 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:49:59 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:49:59 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:49:59 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:49:59 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:59 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:49:59 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:49:59 [QuestionManager] Таймер вопроса #460 (6 из 0): осталось 5 секунд
app_1       | 2026/02/09 17:50:00 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:00 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:00 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:00 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:00 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:00 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:00 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:00 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:00 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:00 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:00 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:00 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:00 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:00 [QuestionManager] Таймер вопроса #460 (6 из 0): осталось 4 секунд
app_1       | 2026/02/09 17:50:01 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:01 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:01 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:01 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:01 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:01 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:01 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:01 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:01 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:01 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:01 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:01 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:01 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:01 [QuestionManager] Таймер вопроса #460 (6 из 0): осталось 3 секунд
app_1       | 2026/02/09 17:50:02 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:02 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:02 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:02 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:02 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:02 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:02 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:02 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:02 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:02 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:02 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:02 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:02 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:02 [QuestionManager] Таймер вопроса #460 (6 из 0): осталось 2 секунд
app_1       | 2026/02/09 17:50:03 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:03 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:03 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:03 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:03 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:03 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:03 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:03 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:03 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:03 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:03 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:03 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:03 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:03 [QuestionManager] Таймер вопроса #460 (6 из 0): осталось 1 секунд
app_1       | 2026/02/09 17:50:04 [QuestionManager] Время на вопрос #460 (6 из 0) викторины #34 истекло
app_1       | 2026/02/09 17:50:05 [QuestionManager] Викторина #34, Вопрос #460 (6 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/09 17:50:05 [QuestionManager][DEBUG] Викторина #34, Вопрос #460: Получение участников из Redis Set quiz:34:participants...
app_1       | 2026/02/09 17:50:05 [QuestionManager][DEBUG] Викторина #34, Вопрос #460: SMembers вернул 1 участников
app_1       | 2026/02/09 17:50:05 [QuestionManager][DEBUG] Викторина #34, Вопрос #460: Проверка ответа для User #1 (Ключ: quiz:34:user:1:question:460)
app_1       | 2026/02/09 17:50:05 [QuestionManager][DEBUG] Викторина #34, Вопрос #460: User #1 НЕ ответил. Проверка ключа выбывания quiz:34:eliminated:1...
app_1       | 2026/02/09 17:50:05 [QuestionManager][DEBUG] Викторина #34, Вопрос #460: User #1 не ответил, но УЖЕ был выбывший (ключ quiz:34:eliminated:1 существует).
app_1       | 2026/02/09 17:50:05 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:05 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:05 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:05 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:05 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:05 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:05 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:05 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/09 17:50:05 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:05 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:05 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/09 17:50:05 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:05 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:05 [QuestionManager] Событие adaptive:question_stats для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:50:05 [QuestionManager] adaptive:question_stats отправлен для Q6: pass_rate=0.00, target=0.55
app_1       | 2026/02/09 17:50:05 [QuestionManager][DEBUG] Викторина #34, Вопрос #460: Отправка события quiz:answer_reveal...
app_1       | 2026/02/09 17:50:05 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:05 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:05 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:05 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:05 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:05 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/09 17:50:05 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:05 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:05 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/09 17:50:05 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:05 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:05 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:05 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:05 [QuestionManager] Событие quiz:answer_reveal для викторины #34 успешно отправлено с 1 попытки
app_1       | 
app_1       | 2026/02/09 17:50:05 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [1.501ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 34 AND question_after = 6 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/09 17:50:05 [QuestionManager] Пауза 500ms между вопросами 6 и 7
app_1       | 2026/02/09 17:50:06 [AdaptiveSelector] Quiz #34, Q7: prev_pass_rate=1.00, target_difficulty=5
app_1       | 
app_1       | 2026/02/09 17:50:06 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [1.521ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 34 AND difficulty = 5 AND is_used = false) AND id NOT IN (296,345,383,583,587,460) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 17:50:06 /app/internal/repository/postgres/question_repo.go:173
app_1       | [1.564ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 5 AND is_used = false) AND id NOT IN (296,345,383,583,587,460) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/09 17:50:06 [AdaptiveSelector] Found pool question ID=461 (difficulty=5)
app_1       | 2026/02/09 17:50:06 [AdaptiveSelector] Selected question ID=461, difficulty=5 for Q7
app_1       | 2026/02/09 17:50:06 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:06 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:06 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:06 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:06 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:question
app_1       | 2026/02/09 17:50:06 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/09 17:50:06 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:06 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:question
app_1       | 2026/02/09 17:50:06 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/09 17:50:06 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:06 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:06 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:06 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:06 [QuestionManager] Событие quiz:question для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:50:06 [QuestionManager][DEBUG] Викторина #34, Вопрос #461: Ожидание завершения таймера (10s)...
app_1       | 2026/02/09 17:50:07 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:07 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:07 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:07 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:07 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:07 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:07 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:07 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:07 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:07 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:07 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:07 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:07 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:07 [QuestionManager] Таймер вопроса #461 (7 из 0): осталось 8 секунд
app_1       | 2026/02/09 17:50:08 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:08 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:08 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:08 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:08 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:08 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:08 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:08 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:08 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:08 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:08 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:08 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:08 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:08 [QuestionManager] Таймер вопроса #461 (7 из 0): осталось 7 секунд
app_1       | 2026/02/09 17:50:09 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:09 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:09 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:09 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:09 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:09 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:09 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:09 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:09 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:09 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:09 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:09 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:09 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:09 [QuestionManager] Таймер вопроса #461 (7 из 0): осталось 6 секунд
app_1       | 2026/02/09 17:50:10 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:10 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:10 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:10 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:10 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:10 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:10 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:10 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:10 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:10 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:10 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:10 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:10 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:10 [QuestionManager] Таймер вопроса #461 (7 из 0): осталось 5 секунд
app_1       | 2026/02/09 17:50:11 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:11 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:11 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:11 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:11 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:11 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:11 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:11 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:11 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:11 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:11 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:11 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:11 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:11 [QuestionManager] Таймер вопроса #461 (7 из 0): осталось 4 секунд
app_1       | 2026/02/09 17:50:11 [Shard 1] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 17:50:11 [Shard 2] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 17:50:11 [Shard 3] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 17:50:11 [Shard 0] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 17:50:11 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 17:50:12 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:12 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:12 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:12 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:12 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:12 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:12 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:12 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:12 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:12 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:12 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:12 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:12 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:12 [QuestionManager] Таймер вопроса #461 (7 из 0): осталось 3 секунд
app_1       | 2026/02/09 17:50:13 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:13 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:13 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:13 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:13 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:13 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:13 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:13 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:13 [Shard 0][Quiz 34][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:13 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:13 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:13 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:13 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:13 [QuestionManager] Таймер вопроса #461 (7 из 0): осталось 2 секунд
app_1       | 2026/02/09 17:50:14 WebSocket Client Read Error (UserID: 1, ConnID: d67837c1-f1c5-4a47-bba8-f77ec52acd4c): websocket: close 1005 (no status)
app_1       | 2026/02/09 17:50:14 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:14 [Shard 0][User 1][Conn d67837c1-f1c5-4a47-bba8-f77ec52acd4c] handleUnregister called
app_1       | 2026/02/09 17:50:14 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: d67837c1-f1c5-4a47-bba8-f77ec52acd4c) from Quiz 34
app_1       | 2026/02/09 17:50:14 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:14 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:14 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 34.
app_1       | 2026/02/09 17:50:14 Client 1 (Conn: d67837c1-f1c5-4a47-bba8-f77ec52acd4c) cleared QuizID
app_1       | 2026/02/09 17:50:14 Shard 0: Client 1 unsubscribed from Quiz 34
app_1       | 2026/02/09 17:50:14 Shard 0: client 1 unregistered
app_1       | 2026/02/09 17:50:14 WebSocket Client Send Channel Closed (UserID: 1, ConnID: d67837c1-f1c5-4a47-bba8-f77ec52acd4c)
app_1       | 2026/02/09 17:50:14 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: d67837c1-f1c5-4a47-bba8-f77ec52acd4c
app_1       | 2026/02/09 17:50:14 [ShardedHub] Отправлено обновление player_count для викторины #34: 1 игроков
app_1       | 2026/02/09 17:50:14 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:14 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:14 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:14 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:14 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 17:50:14 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 17:50:14 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:14 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:14 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:14 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 
app_1       | 2026/02/09 17:50:14 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.805ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 34
app_1       | 
app_1       | 2026/02/09 17:50:14 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [1.788ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:50:14 | 200 |    1.976255ms |      172.18.0.6 | GET      "/api/quizzes/34/with-questions"
app_1       | 2026/02/09 17:50:14 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:14 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:14 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:14 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:14 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:14 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:14 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:14 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:14 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:14 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:14 [QuestionManager] Таймер вопроса #461 (7 из 0): осталось 1 секунд
app_1       | 2026/02/09 17:50:15 [QuestionManager] Время на вопрос #461 (7 из 0) викторины #34 истекло
app_1       | 2026/02/09 17:50:16 [QuestionManager] Викторина #34, Вопрос #461 (7 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/09 17:50:16 [QuestionManager][DEBUG] Викторина #34, Вопрос #461: Получение участников из Redis Set quiz:34:participants...
app_1       | 2026/02/09 17:50:16 [QuestionManager][DEBUG] Викторина #34, Вопрос #461: SMembers вернул 1 участников
app_1       | 2026/02/09 17:50:16 [QuestionManager][DEBUG] Викторина #34, Вопрос #461: Проверка ответа для User #1 (Ключ: quiz:34:user:1:question:461)
app_1       | 2026/02/09 17:50:16 [QuestionManager][DEBUG] Викторина #34, Вопрос #461: User #1 НЕ ответил. Проверка ключа выбывания quiz:34:eliminated:1...
app_1       | 2026/02/09 17:50:16 [QuestionManager][DEBUG] Викторина #34, Вопрос #461: User #1 не ответил, но УЖЕ был выбывший (ключ quiz:34:eliminated:1 существует).
app_1       | 2026/02/09 17:50:16 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:16 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:16 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:16 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:16 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:16 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/09 17:50:16 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:16 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:16 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:16 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:16 [QuestionManager] Событие adaptive:question_stats для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:50:16 [QuestionManager] adaptive:question_stats отправлен для Q7: pass_rate=0.00, target=0.48
app_1       | 2026/02/09 17:50:16 [QuestionManager][DEBUG] Викторина #34, Вопрос #461: Отправка события quiz:answer_reveal...
app_1       | 2026/02/09 17:50:16 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:16 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:16 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:16 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:16 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:16 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:16 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:16 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/09 17:50:16 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:16 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:16 [QuestionManager] Событие quiz:answer_reveal для викторины #34 успешно отправлено с 1 попытки
app_1       | 
app_1       | 2026/02/09 17:50:17 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [1.188ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 34 AND question_after = 7 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/09 17:50:17 [QuestionManager] Пауза 500ms между вопросами 7 и 8
app_1       | 2026/02/09 17:50:17 [AdaptiveSelector] Quiz #34, Q8: prev_pass_rate=1.00, target_difficulty=5
app_1       | 
app_1       | 2026/02/09 17:50:17 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [2.047ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 34 AND difficulty = 5 AND is_used = false) AND id NOT IN (296,345,383,583,587,460,461) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/09 17:50:17 [AdaptiveSelector] Found pool question ID=466 (difficulty=5)
app_1       | 2026/02/09 17:50:17 [AdaptiveSelector] Selected question ID=466, difficulty=5 for Q8
app_1       | 
app_1       | 2026/02/09 17:50:17 /app/internal/repository/postgres/question_repo.go:173
app_1       | [1.975ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 5 AND is_used = false) AND id NOT IN (296,345,383,583,587,460,461) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/09 17:50:18 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:18 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:18 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:18 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:18 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:question
app_1       | 2026/02/09 17:50:18 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/09 17:50:18 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:18 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:18 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:18 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:18 [QuestionManager] Событие quiz:question для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:50:18 [QuestionManager][DEBUG] Викторина #34, Вопрос #466: Ожидание завершения таймера (10s)...
app_1       | 2026/02/09 17:50:19 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:19 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:19 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:19 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:19 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:19 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:19 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:19 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:19 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:19 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:19 [QuestionManager] Таймер вопроса #466 (8 из 0): осталось 8 секунд
app_1       | 2026/02/09 17:50:20 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:20 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:20 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:20 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:20 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:20 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:20 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:20 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:20 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:20 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:20 [QuestionManager] Таймер вопроса #466 (8 из 0): осталось 7 секунд
app_1       | 2026/02/09 17:50:21 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:21 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:21 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:21 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:21 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:21 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:21 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:21 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:21 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:21 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:21 [QuestionManager] Таймер вопроса #466 (8 из 0): осталось 6 секунд
app_1       | 2026/02/09 17:50:22 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:22 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:22 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:22 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:22 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:22 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:22 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:22 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:22 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:22 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:22 [QuestionManager] Таймер вопроса #466 (8 из 0): осталось 5 секунд
app_1       | 2026/02/09 17:50:23 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:23 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:23 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:23 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:23 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:23 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:23 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:23 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:23 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:23 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:23 [QuestionManager] Таймер вопроса #466 (8 из 0): осталось 4 секунд
app_1       | 2026/02/09 17:50:24 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:24 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:24 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:24 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:24 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:24 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:24 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:24 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:24 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:24 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:24 [QuestionManager] Таймер вопроса #466 (8 из 0): осталось 3 секунд
app_1       | 2026/02/09 17:50:25 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:25 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:25 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:25 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:25 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:25 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:25 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:25 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:25 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:25 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:25 [QuestionManager] Таймер вопроса #466 (8 из 0): осталось 2 секунд
app_1       | 2026/02/09 17:50:26 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:26 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:26 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:26 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:26 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:26 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:26 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:26 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:26 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:26 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:26 [QuestionManager] Таймер вопроса #466 (8 из 0): осталось 1 секунд
app_1       | 2026/02/09 17:50:27 [QuestionManager] Время на вопрос #466 (8 из 0) викторины #34 истекло
app_1       | 2026/02/09 17:50:28 [QuestionManager] Викторина #34, Вопрос #466 (8 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/09 17:50:28 [QuestionManager][DEBUG] Викторина #34, Вопрос #466: Получение участников из Redis Set quiz:34:participants...
app_1       | 2026/02/09 17:50:28 [QuestionManager][DEBUG] Викторина #34, Вопрос #466: SMembers вернул 1 участников
app_1       | 2026/02/09 17:50:28 [QuestionManager][DEBUG] Викторина #34, Вопрос #466: Проверка ответа для User #1 (Ключ: quiz:34:user:1:question:466)
app_1       | 2026/02/09 17:50:28 [QuestionManager][DEBUG] Викторина #34, Вопрос #466: User #1 НЕ ответил. Проверка ключа выбывания quiz:34:eliminated:1...
app_1       | 2026/02/09 17:50:28 [QuestionManager][DEBUG] Викторина #34, Вопрос #466: User #1 не ответил, но УЖЕ был выбывший (ключ quiz:34:eliminated:1 существует).
app_1       | 2026/02/09 17:50:28 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:28 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:28 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:28 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:28 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:28 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:28 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/09 17:50:28 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:28 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:28 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:28 [QuestionManager] Событие adaptive:question_stats для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:50:28 [QuestionManager] adaptive:question_stats отправлен для Q8: pass_rate=0.00, target=0.42
app_1       | 2026/02/09 17:50:28 [QuestionManager][DEBUG] Викторина #34, Вопрос #466: Отправка события quiz:answer_reveal...
app_1       | 2026/02/09 17:50:28 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:28 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:28 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:28 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:28 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:28 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:28 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:28 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/09 17:50:28 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:28 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:28 [QuestionManager] Событие quiz:answer_reveal для викторины #34 успешно отправлено с 1 попытки
app_1       | 
app_1       | 2026/02/09 17:50:28 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [1.183ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 34 AND question_after = 8 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/09 17:50:28 [QuestionManager] Пауза 500ms между вопросами 8 и 9
app_1       | 2026/02/09 17:50:28 [AdaptiveSelector] Quiz #34, Q9: prev_pass_rate=1.00, target_difficulty=5
app_1       | 
app_1       | 2026/02/09 17:50:28 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [1.560ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 34 AND difficulty = 5 AND is_used = false) AND id NOT IN (296,345,383,583,587,460,461,466) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 17:50:28 /app/internal/repository/postgres/question_repo.go:173
app_1       | [1.665ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 5 AND is_used = false) AND id NOT IN (296,345,383,583,587,460,461,466) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/09 17:50:28 [AdaptiveSelector] Found pool question ID=491 (difficulty=5)
app_1       | 2026/02/09 17:50:28 [AdaptiveSelector] Selected question ID=491, difficulty=5 for Q9
app_1       | 2026/02/09 17:50:29 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:29 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:29 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:29 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:29 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:question
app_1       | 2026/02/09 17:50:29 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/09 17:50:29 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:29 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:29 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:29 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:29 [QuestionManager] Событие quiz:question для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:50:29 [QuestionManager][DEBUG] Викторина #34, Вопрос #491: Ожидание завершения таймера (10s)...
app_1       | 2026/02/09 17:50:30 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:30 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:30 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:30 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:30 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:30 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:30 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:30 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:30 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:30 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:30 [QuestionManager] Таймер вопроса #491 (9 из 0): осталось 8 секунд
app_1       | 2026/02/09 17:50:31 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:31 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:31 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:31 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:31 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:31 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:31 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:31 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:31 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:31 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:31 [QuestionManager] Таймер вопроса #491 (9 из 0): осталось 7 секунд
app_1       | 2026/02/09 17:50:32 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:32 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:32 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:32 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:32 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:32 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:32 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:32 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:32 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:32 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:32 [QuestionManager] Таймер вопроса #491 (9 из 0): осталось 6 секунд
app_1       | 2026/02/09 17:50:33 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:33 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:33 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:33 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:33 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:33 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:33 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:33 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:33 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:33 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:33 [QuestionManager] Таймер вопроса #491 (9 из 0): осталось 5 секунд
app_1       | 2026/02/09 17:50:34 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:34 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:34 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:34 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:34 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:34 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:34 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:34 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:34 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:34 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:34 [QuestionManager] Таймер вопроса #491 (9 из 0): осталось 4 секунд
app_1       | 
app_1       | 2026/02/09 17:50:34 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.838ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:34.509') OR (is_active = false AND rotated_at > '2026-02-02 17:50:34.509' AND expires_at > '2026-02-09 17:50:34.509') ORDER BY created_at DESC
app_1       | 2026/02/09 17:50:34 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:50:34 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 17:50:34 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.481ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:34.511') OR (is_active = false AND rotated_at > '2026-02-02 17:50:34.511' AND expires_at > '2026-02-09 17:50:34.511') ORDER BY created_at DESC
app_1       | 2026/02/09 17:50:34 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:50:34 /app/internal/repository/postgres/user_repo.go:83
app_1       | [3.384ms] [rows:1] UPDATE "users" SET "language"='kk',"updated_at"='2026-02-09 17:50:34.511' WHERE id = 1
app_1       | 2026/02/09 17:50:34 [AuthHandler] Язык пользователя ID=1 обновлен на 'kk'
app_1       | [GIN] 2026/02/09 - 17:50:34 | 200 |    5.840866ms |      172.18.0.6 | PUT      "/api/users/me/language"
app_1       | 
app_1       | 2026/02/09 17:50:34 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.541ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:34.946') OR (is_active = false AND rotated_at > '2026-02-02 17:50:34.946' AND expires_at > '2026-02-09 17:50:34.946') ORDER BY created_at DESC
app_1       | 2026/02/09 17:50:34 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:50:34 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 17:50:34 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.554ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:34.947') OR (is_active = false AND rotated_at > '2026-02-02 17:50:34.947' AND expires_at > '2026-02-09 17:50:34.947') ORDER BY created_at DESC
app_1       | 2026/02/09 17:50:34 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:50:34 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [0.718ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 17:50:34.947' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 17:50:34 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [GIN] 2026/02/09 - 17:50:34 | 200 |    2.968566ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 17:50:35 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:35 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:35 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:35 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:35 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:35 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:35 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:35 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:35 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:35 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:35 [QuestionManager] Таймер вопроса #491 (9 из 0): осталось 3 секунд
app_1       | 
app_1       | 2026/02/09 17:50:35 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.637ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:35.368') OR (is_active = false AND rotated_at > '2026-02-02 17:50:35.368' AND expires_at > '2026-02-09 17:50:35.368') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 17:50:35 | 200 |    1.151495ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY1OTQ5NCwiaWF0IjoxNzcwNjU5NDM0LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.mHjERVQnPHBBEqwyy4FAwZhYnvg4soeR9Wi3vLABA6k"
app_1       | 2026/02/09 17:50:35 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 17:50:35 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 17:50:35 Shard 0: replacing client 1 with new connection
app_1       | 2026/02/09 17:50:35 Shard 0: client 1 registered
app_1       | 2026/02/09 17:50:35 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 17:50:35 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:35 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:35 Client 1 (Conn: f37b664f-4257-4d10-84f7-9af1bf81fa76) set QuizID to 34
app_1       | 2026/02/09 17:50:35 [WSHandler] User 1 set QuizID to 34
app_1       | 2026/02/09 17:50:35 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: f37b664f-4257-4d10-84f7-9af1bf81fa76) to Quiz 34
app_1       | 2026/02/09 17:50:35 [Shard 0][Sub] Client 1: Old QuizID is 34, New QuizID is 34
app_1       | 2026/02/09 17:50:35 [Shard 0][Sub] Client 1 already has atomic QuizID 34. Ensuring map presence.
app_1       | 2026/02/09 17:50:35 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 34
app_1       | 2026/02/09 17:50:35 [Shard 0][Sub] Client 1: Found existing map for quiz 34
app_1       | 2026/02/09 17:50:35 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:35 [Shard 0][Sub] Client 1: STORED client in map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:35 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 34 immediately after Store.
app_1       | 2026/02/09 17:50:35 [WebSocketManager] Клиент 1 подписан на викторину 34 в шарде 0
app_1       | 2026/02/09 17:50:35 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #34
app_1       | 2026/02/09 17:50:35 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #34
app_1       | 2026/02/09 17:50:35 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:35 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:35 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:35 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:35 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 17:50:35 [Shard 0][Quiz 34][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 17:50:35 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:35 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 17:50:35 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 17:50:35 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:35 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:35 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:35 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:35 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #34 (игроков онлайн: 2)
app_1       | 2026/02/09 17:50:35 [WSHandler] Resync запрос от пользователя 1 для викторины 34
app_1       | 
app_1       | 2026/02/09 17:50:35 /app/internal/repository/postgres/result_repo.go:33
app_1       | [0.829ms] [rows:3] SELECT * FROM "user_answers" WHERE user_id = 1 AND quiz_id = 34 ORDER BY created_at
app_1       | 2026/02/09 17:50:35 [WSHandler] Успешно отправлен resync для пользователя 1, quiz 34
app_1       | 2026/02/09 17:50:35 WebSocket Client Read Error (UserID: 1, ConnID: 7e1ad69a-d50c-4614-b50e-0c0b455633ea): read tcp 172.18.0.5:8080->172.18.0.6:55010: use of closed network connection
app_1       | 2026/02/09 17:50:35 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:35 [Shard 0][User 1][Conn 7e1ad69a-d50c-4614-b50e-0c0b455633ea] handleUnregister called
app_1       | 2026/02/09 17:50:35 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 7e1ad69a-d50c-4614-b50e-0c0b455633ea) from Quiz 34
app_1       | 2026/02/09 17:50:35 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:35 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:35 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 34.
app_1       | 2026/02/09 17:50:35 Client 1 (Conn: 7e1ad69a-d50c-4614-b50e-0c0b455633ea) cleared QuizID
app_1       | 2026/02/09 17:50:35 Shard 0: Client 1 unsubscribed from Quiz 34
app_1       | 2026/02/09 17:50:35 [ShardedHub] Отправлено обновление player_count для викторины #34: 1 игроков
app_1       | 2026/02/09 17:50:35 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:35 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:35 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 7e1ad69a-d50c-4614-b50e-0c0b455633ea)
app_1       | 2026/02/09 17:50:35 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 7e1ad69a-d50c-4614-b50e-0c0b455633ea
app_1       | 2026/02/09 17:50:35 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:35 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:35 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 17:50:35 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 17:50:35 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:35 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:35 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:35 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:36 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:36 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:36 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:36 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:36 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:36 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:36 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:36 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:36 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:36 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:36 [QuestionManager] Таймер вопроса #491 (9 из 0): осталось 2 секунд
app_1       | 2026/02/09 17:50:37 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:37 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:37 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:37 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:37 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:37 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:37 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:37 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:37 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:37 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:37 [QuestionManager] Таймер вопроса #491 (9 из 0): осталось 1 секунд
app_1       | 2026/02/09 17:50:38 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:50:38 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 17:50:38 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.009ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:38.026') OR (is_active = false AND rotated_at > '2026-02-02 17:50:38.026' AND expires_at > '2026-02-09 17:50:38.026') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:50:38 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.720ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:38.027') OR (is_active = false AND rotated_at > '2026-02-02 17:50:38.027' AND expires_at > '2026-02-09 17:50:38.027') ORDER BY created_at DESC
app_1       | 2026/02/09 17:50:38 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:50:38 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [0.631ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 17:50:38.028' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 17:50:38 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [GIN] 2026/02/09 - 17:50:38 | 200 |    3.574408ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 17:50:38 [QuestionManager] Время на вопрос #491 (9 из 0) викторины #34 истекло
app_1       | 
app_1       | 2026/02/09 17:50:38 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.648ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:38.439') OR (is_active = false AND rotated_at > '2026-02-02 17:50:38.439' AND expires_at > '2026-02-09 17:50:38.439') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 17:50:38 | 200 |    1.188954ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY1OTQ5OCwiaWF0IjoxNzcwNjU5NDM4LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.P_cGixEEY7SLBuHlt3wREhJTlRLtRuOpVeqzEMpfd2U"
app_1       | 2026/02/09 17:50:38 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 17:50:38 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 17:50:38 Shard 0: client 1 registered
app_1       | 2026/02/09 17:50:38 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 17:50:38 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 64985113-0be6-4a10-9e53-414fcb7a4a4c
app_1       | 2026/02/09 17:50:38 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 64985113-0be6-4a10-9e53-414fcb7a4a4c
app_1       | 2026/02/09 17:50:38 Client 1 (Conn: 64985113-0be6-4a10-9e53-414fcb7a4a4c) set QuizID to 34
app_1       | 2026/02/09 17:50:38 [WSHandler] User 1 set QuizID to 34
app_1       | 2026/02/09 17:50:38 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 64985113-0be6-4a10-9e53-414fcb7a4a4c) to Quiz 34
app_1       | 2026/02/09 17:50:38 [Shard 0][Sub] Client 1: Old QuizID is 34, New QuizID is 34
app_1       | 2026/02/09 17:50:38 [Shard 0][Sub] Client 1 already has atomic QuizID 34. Ensuring map presence.
app_1       | 2026/02/09 17:50:38 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 34
app_1       | 2026/02/09 17:50:38 [Shard 0][Sub] Client 1: Found existing map for quiz 34
app_1       | 2026/02/09 17:50:38 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:38 [Shard 0][Sub] Client 1: STORED client in map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:38 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 34 immediately after Store.
app_1       | 2026/02/09 17:50:38 [WebSocketManager] Клиент 1 подписан на викторину 34 в шарде 0
app_1       | 2026/02/09 17:50:38 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #34
app_1       | 2026/02/09 17:50:38 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #34
app_1       | 2026/02/09 17:50:38 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:38 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:38 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:38 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c
app_1       | 2026/02/09 17:50:38 [Shard 0][Quiz 34][User 1][Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 17:50:38 [Shard 0][Quiz 34][User 1][Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 17:50:38 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:38 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 17:50:38 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 17:50:38 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:38 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:38 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:38 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:38 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #34 (игроков онлайн: 2)
app_1       | 2026/02/09 17:50:38 [WSHandler] Resync запрос от пользователя 1 для викторины 34
app_1       | 
app_1       | 2026/02/09 17:50:38 /app/internal/repository/postgres/result_repo.go:33
app_1       | [0.927ms] [rows:3] SELECT * FROM "user_answers" WHERE user_id = 1 AND quiz_id = 34 ORDER BY created_at
app_1       | 2026/02/09 17:50:38 [WSHandler] Успешно отправлен resync для пользователя 1, quiz 34
app_1       | 2026/02/09 17:50:39 [QuestionManager] Викторина #34, Вопрос #491 (9 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/09 17:50:39 [QuestionManager][DEBUG] Викторина #34, Вопрос #491: Получение участников из Redis Set quiz:34:participants...
app_1       | 2026/02/09 17:50:39 [QuestionManager][DEBUG] Викторина #34, Вопрос #491: SMembers вернул 1 участников
app_1       | 2026/02/09 17:50:39 [QuestionManager][DEBUG] Викторина #34, Вопрос #491: Проверка ответа для User #1 (Ключ: quiz:34:user:1:question:491)
app_1       | 2026/02/09 17:50:39 [QuestionManager][DEBUG] Викторина #34, Вопрос #491: User #1 НЕ ответил. Проверка ключа выбывания quiz:34:eliminated:1...
app_1       | 2026/02/09 17:50:39 [QuestionManager][DEBUG] Викторина #34, Вопрос #491: User #1 не ответил, но УЖЕ был выбывший (ключ quiz:34:eliminated:1 существует).
app_1       | 2026/02/09 17:50:39 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:39 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:39 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:39 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c
app_1       | 2026/02/09 17:50:39 [Shard 0][Quiz 34][User 1][Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:39 [Shard 0][Quiz 34][User 1][Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/09 17:50:39 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:39 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:39 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/09 17:50:39 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:39 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:39 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:39 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:39 [QuestionManager] Событие adaptive:question_stats для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:50:39 [QuestionManager] adaptive:question_stats отправлен для Q9: pass_rate=0.00, target=0.36
app_1       | 2026/02/09 17:50:39 [QuestionManager][DEBUG] Викторина #34, Вопрос #491: Отправка события quiz:answer_reveal...
app_1       | 
app_1       | 2026/02/09 17:50:39 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [0.768ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 34 AND question_after = 9 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/09 17:50:39 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:39 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:39 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:39 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:39 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:39 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c
app_1       | 2026/02/09 17:50:39 [Shard 0][Quiz 34][User 1][Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:39 [Shard 0][Quiz 34][User 1][Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/09 17:50:39 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:39 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:39 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/09 17:50:39 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:39 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:39 [QuestionManager] Событие quiz:answer_reveal для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:50:39 [QuestionManager] Пауза 500ms между вопросами 9 и 10
app_1       | 
app_1       | 2026/02/09 17:50:39 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.581ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:39.636') OR (is_active = false AND rotated_at > '2026-02-02 17:50:39.636' AND expires_at > '2026-02-09 17:50:39.636') ORDER BY created_at DESC
app_1       | 2026/02/09 17:50:39 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:50:39 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 17:50:39 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.470ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:39.637') OR (is_active = false AND rotated_at > '2026-02-02 17:50:39.637' AND expires_at > '2026-02-09 17:50:39.637') ORDER BY created_at DESC
app_1       | 2026/02/09 17:50:39 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:50:39 [AuthHandler] Язык пользователя ID=1 обновлен на 'ru'
app_1       | 
app_1       | 2026/02/09 17:50:39 /app/internal/repository/postgres/user_repo.go:83
app_1       | [1.906ms] [rows:1] UPDATE "users" SET "language"='ru',"updated_at"='2026-02-09 17:50:39.637' WHERE id = 1
app_1       | [GIN] 2026/02/09 - 17:50:39 | 200 |    3.929684ms |      172.18.0.6 | PUT      "/api/users/me/language"
app_1       | 2026/02/09 17:50:39 [AdaptiveSelector] Quiz #34, Q10: prev_pass_rate=1.00, target_difficulty=5
app_1       | 
app_1       | 2026/02/09 17:50:39 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [2.597ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 34 AND difficulty = 5 AND is_used = false) AND id NOT IN (296,345,383,583,587,460,461,466,491) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/09 17:50:39 [AdaptiveSelector] Found pool question ID=485 (difficulty=5)
app_1       | 2026/02/09 17:50:39 [AdaptiveSelector] Selected question ID=485, difficulty=5 for Q10
app_1       | 
app_1       | 2026/02/09 17:50:39 /app/internal/repository/postgres/question_repo.go:173
app_1       | [2.302ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 5 AND is_used = false) AND id NOT IN (296,345,383,583,587,460,461,466,491) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/09 17:50:39 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:50:39 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 17:50:39 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [13.306ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:39.926') OR (is_active = false AND rotated_at > '2026-02-02 17:50:39.926' AND expires_at > '2026-02-09 17:50:39.926') ORDER BY created_at DESC
app_1       | 2026/02/09 17:50:39 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:50:39 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.984ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:39.94') OR (is_active = false AND rotated_at > '2026-02-02 17:50:39.94' AND expires_at > '2026-02-09 17:50:39.94') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:50:39 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [2.775ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 17:50:39.941' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 17:50:39 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [GIN] 2026/02/09 - 17:50:39 | 200 |   18.323584ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 
app_1       | 2026/02/09 17:50:40 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.072ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:40.356') OR (is_active = false AND rotated_at > '2026-02-02 17:50:40.356' AND expires_at > '2026-02-09 17:50:40.356') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 17:50:40 | 200 |    1.864089ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY1OTQ5OSwiaWF0IjoxNzcwNjU5NDM5LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.op2v13ksYm8dKxJtUHNN53QgRgDmNAvz5-7D8XvhbUo"
app_1       | 2026/02/09 17:50:40 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 17:50:40 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 17:50:40 Shard 0: replacing client 1 with new connection
app_1       | 2026/02/09 17:50:40 Shard 0: client 1 registered
app_1       | 2026/02/09 17:50:40 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 17:50:40 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 235bf31b-88b3-4b8a-892d-d09ad6c4fd91
app_1       | 2026/02/09 17:50:40 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 235bf31b-88b3-4b8a-892d-d09ad6c4fd91
app_1       | 2026/02/09 17:50:40 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:40 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:40 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:40 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][User 1][Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c] Attempting to queue message type: quiz:question
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][User 1][Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Attempting to queue message type: quiz:question
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/09 17:50:40 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:40 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:40 [QuestionManager] Событие quiz:question для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:50:40 [QuestionManager][DEBUG] Викторина #34, Вопрос #485: Ожидание завершения таймера (10s)...
app_1       | 2026/02/09 17:50:40 Client 1 (Conn: 235bf31b-88b3-4b8a-892d-d09ad6c4fd91) set QuizID to 34
app_1       | 2026/02/09 17:50:40 [WSHandler] User 1 set QuizID to 34
app_1       | 2026/02/09 17:50:40 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 235bf31b-88b3-4b8a-892d-d09ad6c4fd91) to Quiz 34
app_1       | 2026/02/09 17:50:40 [Shard 0][Sub] Client 1: Old QuizID is 34, New QuizID is 34
app_1       | 2026/02/09 17:50:40 [Shard 0][Sub] Client 1 already has atomic QuizID 34. Ensuring map presence.
app_1       | 2026/02/09 17:50:40 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 34
app_1       | 2026/02/09 17:50:40 [Shard 0][Sub] Client 1: Found existing map for quiz 34
app_1       | 2026/02/09 17:50:40 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:40 [Shard 0][Sub] Client 1: STORED client in map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:40 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 34 immediately after Store.
app_1       | 2026/02/09 17:50:40 [WebSocketManager] Клиент 1 подписан на викторину 34 в шарде 0
app_1       | 2026/02/09 17:50:40 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #34
app_1       | 2026/02/09 17:50:40 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #34
app_1       | 2026/02/09 17:50:40 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:40 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][User 1][Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][User 1][Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][User 1][Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][User 1][Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 17:50:40 Shard 0: Message broadcast to 3 clients in Quiz 34
app_1       | 2026/02/09 17:50:40 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:40 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:40 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:40 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #34 (игроков онлайн: 3)
app_1       | 2026/02/09 17:50:40 [WSHandler] Resync запрос от пользователя 1 для викторины 34
app_1       | 
app_1       | 2026/02/09 17:50:40 /app/internal/repository/postgres/result_repo.go:33
app_1       | [4.309ms] [rows:3] SELECT * FROM "user_answers" WHERE user_id = 1 AND quiz_id = 34 ORDER BY created_at
app_1       | 2026/02/09 17:50:40 [WSHandler] Успешно отправлен resync для пользователя 1, quiz 34
app_1       | 2026/02/09 17:50:40 WebSocket Client Read Error (UserID: 1, ConnID: 64985113-0be6-4a10-9e53-414fcb7a4a4c): read tcp 172.18.0.5:8080->172.18.0.6:54984: use of closed network connection
app_1       | 2026/02/09 17:50:40 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 64985113-0be6-4a10-9e53-414fcb7a4a4c
app_1       | 2026/02/09 17:50:40 [Shard 0][User 1][Conn 64985113-0be6-4a10-9e53-414fcb7a4a4c] handleUnregister called
app_1       | 2026/02/09 17:50:40 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 64985113-0be6-4a10-9e53-414fcb7a4a4c) from Quiz 34
app_1       | 2026/02/09 17:50:40 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:40 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:40 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 34.
app_1       | 2026/02/09 17:50:40 Client 1 (Conn: 64985113-0be6-4a10-9e53-414fcb7a4a4c) cleared QuizID
app_1       | 2026/02/09 17:50:40 Shard 0: Client 1 unsubscribed from Quiz 34
app_1       | 2026/02/09 17:50:40 [ShardedHub] Отправлено обновление player_count для викторины #34: 2 игроков
app_1       | 2026/02/09 17:50:40 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:40 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:40 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 64985113-0be6-4a10-9e53-414fcb7a4a4c)
app_1       | 2026/02/09 17:50:40 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 64985113-0be6-4a10-9e53-414fcb7a4a4c
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][User 1][Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 17:50:40 [Shard 0][Quiz 34][User 1][Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 17:50:40 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:40 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:40 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:40 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:41 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:41 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:41 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:41 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:41 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:41 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:41 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:41 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91
app_1       | 2026/02/09 17:50:41 [Shard 0][Quiz 34][User 1][Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:41 [Shard 0][Quiz 34][User 1][Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:41 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:41 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:41 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:41 [QuestionManager] Таймер вопроса #485 (10 из 0): осталось 8 секунд
app_1       | 2026/02/09 17:50:42 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:42 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:42 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:42 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:42 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:42 [Shard 0][Quiz 34][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:42 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91
app_1       | 2026/02/09 17:50:42 [Shard 0][Quiz 34][User 1][Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:42 [Shard 0][Quiz 34][User 1][Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:42 Shard 0: Message broadcast to 2 clients in Quiz 34
app_1       | 2026/02/09 17:50:42 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:42 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:42 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:42 [QuestionManager] Таймер вопроса #485 (10 из 0): осталось 7 секунд
app_1       | 2026/02/09 17:50:42 WebSocket Client Connection Closed Normally (UserID: 1, ConnID: f37b664f-4257-4d10-84f7-9af1bf81fa76): websocket: close 1001 (going away)
app_1       | 2026/02/09 17:50:42 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:42 [Shard 0][User 1][Conn f37b664f-4257-4d10-84f7-9af1bf81fa76] handleUnregister called
app_1       | 2026/02/09 17:50:42 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: f37b664f-4257-4d10-84f7-9af1bf81fa76) from Quiz 34
app_1       | 2026/02/09 17:50:42 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:42 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:42 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 34.
app_1       | 2026/02/09 17:50:42 Client 1 (Conn: f37b664f-4257-4d10-84f7-9af1bf81fa76) cleared QuizID
app_1       | 2026/02/09 17:50:42 Shard 0: Client 1 unsubscribed from Quiz 34
app_1       | 2026/02/09 17:50:42 Shard 0: client 1 unregistered
app_1       | 2026/02/09 17:50:42 WebSocket Client Send Channel Closed (UserID: 1, ConnID: f37b664f-4257-4d10-84f7-9af1bf81fa76)
app_1       | 2026/02/09 17:50:42 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: f37b664f-4257-4d10-84f7-9af1bf81fa76
app_1       | 2026/02/09 17:50:42 [ShardedHub] Отправлено обновление player_count для викторины #34: 1 игроков
app_1       | 2026/02/09 17:50:42 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:42 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:42 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:42 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91
app_1       | 2026/02/09 17:50:42 [Shard 0][Quiz 34][User 1][Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91] Attempting to queue message type: quiz:player_count
app_1       | 2026/02/09 17:50:42 [Shard 0][Quiz 34][User 1][Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91] Successfully queued message type: quiz:player_count. Buffer len: 0
app_1       | 2026/02/09 17:50:42 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:42 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:42 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:42 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:42 WebSocket Client Connection Closed Normally (UserID: 1, ConnID: 235bf31b-88b3-4b8a-892d-d09ad6c4fd91): websocket: close 1001 (going away)
app_1       | 2026/02/09 17:50:42 WebSocket Client Read Pump STOPPED for UserID: 1, ConnID: 235bf31b-88b3-4b8a-892d-d09ad6c4fd91
app_1       | 2026/02/09 17:50:42 [Shard 0][User 1][Conn 235bf31b-88b3-4b8a-892d-d09ad6c4fd91] handleUnregister called
app_1       | 2026/02/09 17:50:42 [Shard 0][Unsub] unsubscribeInternal called for Client 1 (Conn: 235bf31b-88b3-4b8a-892d-d09ad6c4fd91) from Quiz 34
app_1       | 2026/02/09 17:50:42 [Shard 0][Unsub] Client 1: Attempting to DELETE client from map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:42 [Shard 0][Unsub] Client 1: DELETED client from map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:42 [Shard 0][Unsub] Client 1 VERIFIED deletion from map for Quiz 34.
app_1       | 2026/02/09 17:50:42 Client 1 (Conn: 235bf31b-88b3-4b8a-892d-d09ad6c4fd91) cleared QuizID
app_1       | 2026/02/09 17:50:42 Shard 0: Client 1 unsubscribed from Quiz 34
app_1       | 2026/02/09 17:50:42 Shard 0: client 1 unregistered
app_1       | 2026/02/09 17:50:42 WebSocket Client Send Channel Closed (UserID: 1, ConnID: 235bf31b-88b3-4b8a-892d-d09ad6c4fd91)
app_1       | 2026/02/09 17:50:42 WebSocket Client Write Pump STOPPED for UserID: 1, ConnID: 235bf31b-88b3-4b8a-892d-d09ad6c4fd91
app_1       | 2026/02/09 17:50:42 [ShardedHub] Отправлено обновление player_count для викторины #34: 0 игроков
app_1       | 2026/02/09 17:50:42 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:42 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:42 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:42 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:42 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:player_count
app_1       | 2026/02/09 17:50:42 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 
app_1       | 2026/02/09 17:50:42 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.048ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:42.786') OR (is_active = false AND rotated_at > '2026-02-02 17:50:42.786' AND expires_at > '2026-02-09 17:50:42.786') ORDER BY created_at DESC
app_1       | 2026/02/09 17:50:42 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:50:42 /app/internal/repository/postgres/user_repo.go:33
app_1       | [3.754ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:50:42 | 200 |     5.30322ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 17:50:42 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.727ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:42.926') OR (is_active = false AND rotated_at > '2026-02-02 17:50:42.926' AND expires_at > '2026-02-09 17:50:42.926') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 17:50:42 | 200 |    1.084931ms |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 2026/02/09 17:50:42 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:50:42 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 17:50:43 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.750ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:43.056') OR (is_active = false AND rotated_at > '2026-02-02 17:50:43.056' AND expires_at > '2026-02-09 17:50:43.056') ORDER BY created_at DESC
app_1       | 2026/02/09 17:50:43 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:50:43 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/09 17:50:43 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.749ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:43.057') OR (is_active = false AND rotated_at > '2026-02-02 17:50:43.057' AND expires_at > '2026-02-09 17:50:43.057') ORDER BY created_at DESC
app_1       | 2026/02/09 17:50:43 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:50:43 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [1.150ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-09 17:50:43.058' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
app_1       | 2026/02/09 17:50:43 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | [GIN] 2026/02/09 - 17:50:43 | 200 |    3.806592ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/09 17:50:43 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:43 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:43 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:43 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:43 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:43 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:43 [QuestionManager] Таймер вопроса #485 (10 из 0): осталось 6 секунд
app_1       | 
app_1       | 2026/02/09 17:50:43 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.641ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:43.464') OR (is_active = false AND rotated_at > '2026-02-02 17:50:43.464' AND expires_at > '2026-02-09 17:50:43.464') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 17:50:43 | 200 |    1.219571ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDY1OTUwMywiaWF0IjoxNzcwNjU5NDQzLCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.ofEhQFPM6gesqfFZ-fooqGO1dnktBpAiTERlbHB6-XQ"
app_1       | 2026/02/09 17:50:43 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/09 17:50:43 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/09 17:50:43 Shard 0: client 1 registered
app_1       | 2026/02/09 17:50:43 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/09 17:50:43 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 3c16e81f-241d-4501-8a89-9398a7af2607
app_1       | 2026/02/09 17:50:43 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 3c16e81f-241d-4501-8a89-9398a7af2607
app_1       | 2026/02/09 17:50:43 Client 1 (Conn: 3c16e81f-241d-4501-8a89-9398a7af2607) set QuizID to 34
app_1       | 2026/02/09 17:50:43 [WSHandler] User 1 set QuizID to 34
app_1       | 2026/02/09 17:50:43 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 3c16e81f-241d-4501-8a89-9398a7af2607) to Quiz 34
app_1       | 2026/02/09 17:50:43 [Shard 0][Sub] Client 1: Old QuizID is 34, New QuizID is 34
app_1       | 2026/02/09 17:50:43 [Shard 0][Sub] Client 1 already has atomic QuizID 34. Ensuring map presence.
app_1       | 2026/02/09 17:50:43 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 34
app_1       | 2026/02/09 17:50:43 [Shard 0][Sub] Client 1: Found existing map for quiz 34
app_1       | 2026/02/09 17:50:43 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:43 [Shard 0][Sub] Client 1: STORED client in map for Quiz 34 (Map: 0xc0003bb110)
app_1       | 2026/02/09 17:50:43 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 34 immediately after Store.
app_1       | 2026/02/09 17:50:43 [WebSocketManager] Клиент 1 подписан на викторину 34 в шарде 0
app_1       | 2026/02/09 17:50:43 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #34
app_1       | 2026/02/09 17:50:43 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #34
app_1       | 2026/02/09 17:50:43 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:43 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:43 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:43 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 3c16e81f-241d-4501-8a89-9398a7af2607
app_1       | 2026/02/09 17:50:43 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/09 17:50:43 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/09 17:50:43 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:43 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:43 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/09 17:50:43 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:43 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #34 (игроков онлайн: 1)
app_1       | 2026/02/09 17:50:43 [WSHandler] Resync запрос от пользователя 1 для викторины 34
app_1       | 
app_1       | 2026/02/09 17:50:43 /app/internal/repository/postgres/result_repo.go:33
app_1       | [0.942ms] [rows:3] SELECT * FROM "user_answers" WHERE user_id = 1 AND quiz_id = 34 ORDER BY created_at
app_1       | 2026/02/09 17:50:43 [WSHandler] Успешно отправлен resync для пользователя 1, quiz 34
app_1       | 2026/02/09 17:50:44 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:44 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:44 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:44 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 3c16e81f-241d-4501-8a89-9398a7af2607
app_1       | 2026/02/09 17:50:44 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:44 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:44 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:44 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:44 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:44 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:44 [QuestionManager] Таймер вопроса #485 (10 из 0): осталось 5 секунд
app_1       | 2026/02/09 17:50:45 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:45 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:45 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:45 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 3c16e81f-241d-4501-8a89-9398a7af2607
app_1       | 2026/02/09 17:50:45 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:45 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:45 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:45 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:45 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:45 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:45 [QuestionManager] Таймер вопроса #485 (10 из 0): осталось 4 секунд
app_1       | 2026/02/09 17:50:46 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:46 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:46 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:46 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 3c16e81f-241d-4501-8a89-9398a7af2607
app_1       | 2026/02/09 17:50:46 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:46 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:46 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:46 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:46 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:46 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:46 [QuestionManager] Таймер вопроса #485 (10 из 0): осталось 3 секунд
app_1       | 2026/02/09 17:50:47 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:47 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:47 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:47 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 3c16e81f-241d-4501-8a89-9398a7af2607
app_1       | 2026/02/09 17:50:47 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:47 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:47 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:47 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:47 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:47 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:47 [QuestionManager] Таймер вопроса #485 (10 из 0): осталось 2 секунд
app_1       | 2026/02/09 17:50:48 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:48 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:48 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:48 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 3c16e81f-241d-4501-8a89-9398a7af2607
app_1       | 2026/02/09 17:50:48 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Attempting to queue message type: quiz:timer
app_1       | 2026/02/09 17:50:48 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/09 17:50:48 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:48 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:48 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/09 17:50:48 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:48 [QuestionManager] Таймер вопроса #485 (10 из 0): осталось 1 секунд
app_1       | 2026/02/09 17:50:49 [QuestionManager] Время на вопрос #485 (10 из 0) викторины #34 истекло
app_1       | 2026/02/09 17:50:50 [QuestionManager] Викторина #34, Вопрос #485 (10 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/09 17:50:50 [QuestionManager][DEBUG] Викторина #34, Вопрос #485: Получение участников из Redis Set quiz:34:participants...
app_1       | 2026/02/09 17:50:50 [QuestionManager][DEBUG] Викторина #34, Вопрос #485: SMembers вернул 1 участников
app_1       | 2026/02/09 17:50:50 [QuestionManager][DEBUG] Викторина #34, Вопрос #485: Проверка ответа для User #1 (Ключ: quiz:34:user:1:question:485)
app_1       | 2026/02/09 17:50:50 [QuestionManager][DEBUG] Викторина #34, Вопрос #485: User #1 НЕ ответил. Проверка ключа выбывания quiz:34:eliminated:1...
app_1       | 2026/02/09 17:50:50 [QuestionManager][DEBUG] Викторина #34, Вопрос #485: User #1 не ответил, но УЖЕ был выбывший (ключ quiz:34:eliminated:1 существует).
app_1       | 2026/02/09 17:50:50 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:50 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 3c16e81f-241d-4501-8a89-9398a7af2607
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/09 17:50:50 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:50 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:50 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/09 17:50:50 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:50 [QuestionManager] Событие adaptive:question_stats для викторины #34 успешно отправлено с 1 попытки
app_1       | 2026/02/09 17:50:50 [QuestionManager] adaptive:question_stats отправлен для Q10: pass_rate=0.00, target=0.50
app_1       | 2026/02/09 17:50:50 [QuestionManager][DEBUG] Викторина #34, Вопрос #485: Отправка события quiz:answer_reveal...
app_1       | 2026/02/09 17:50:50 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:50 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:50 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:50 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 3c16e81f-241d-4501-8a89-9398a7af2607
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/09 17:50:50 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:50 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:50 [QuestionManager] Событие quiz:answer_reveal для викторины #34 успешно отправлено с 1 попытки
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [3.537ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 34 AND question_after = 10 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/09 17:50:50 [QuestionManager] Помечено 10 вопросов как использованные
app_1       | 2026/02/09 17:50:50 [QuestionManager] Сигнал о завершении вопросов для викторины #34 отправлен
app_1       | 2026/02/09 17:50:50 [QuizManager] Завершение викторины #34
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/repository/postgres/question_repo.go:135
app_1       | [7.768ms] [rows:10] UPDATE "questions" SET "is_used"=true,"updated_at"='2026-02-09 17:50:50.64' WHERE id IN (296,345,383,583,587,460,461,466,491,485)
app_1       | 2026/02/09 17:50:50 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:50 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:finish
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:finish
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 3c16e81f-241d-4501-8a89-9398a7af2607
app_1       | 2026/02/09 17:50:50 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:finish
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Attempting to queue message type: quiz:finish
app_1       | 2026/02/09 17:50:50 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:finish
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Successfully queued message type: quiz:finish. Buffer len: 0
app_1       | 2026/02/09 17:50:50 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:50 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:50 [QuizManager] Получение списка участников из Redis Set quiz:34:participants для викторины #34...
app_1       | 2026/02/09 17:50:50 [QuizManager] Расчет и сохранение итоговых результатов для 1 участников викторины #34...
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/repository/postgres/quiz_repo.go:90
app_1       | [3.389ms] [rows:1] UPDATE "quizzes" SET "title"='хахахаха',"description"='',"scheduled_time"='2026-02-09 17:49:00',"status"='completed',"question_count"=0,"prize_fund"=8555,"created_at"='2026-02-09 17:47:30.143',"updated_at"='2026-02-09 17:50:50.648' WHERE "id" = 34
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.737ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.836ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 34
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [2.295ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/repository/postgres/result_repo.go:33
app_1       | [0.828ms] [rows:3] SELECT * FROM "user_answers" WHERE user_id = 1 AND quiz_id = 34 ORDER BY created_at
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/service/result_service.go:128
app_1       | [7.123ms] [rows:1] INSERT INTO "results" ("user_id","quiz_id","username","profile_picture","score","correct_answers","total_questions","rank","is_winner","prize_fund","is_eliminated","completed_at","created_at","updated_at","eliminated_on_question","elimination_reason") VALUES (1,34,'Temirlan','',2,2,0,0,false,0,true,'2026-02-09 17:50:50.657','2026-02-09 17:50:50.657','2026-02-09 17:50:50.657',3,'no_answer_timeout') RETURNING "eliminated_on_question","elimination_reason","id"
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/service/result_service.go:135
app_1       | [2.069ms] [rows:1] UPDATE "users" SET "total_score"=total_score + 2,"updated_at"='2026-02-09 17:50:50.664' WHERE id = 1
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/service/result_service.go:142
app_1       | [0.917ms] [rows:0] UPDATE "users" SET "highest_score"=2,"updated_at"='2026-02-09 17:50:50.667' WHERE id = 1 AND highest_score < 2
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/service/result_service.go:148
app_1       | [0.816ms] [rows:1] UPDATE "users" SET "games_played"=games_played + 1 WHERE id = 1
app_1       | 2026/02/09 17:50:50 [ResultService] Успешно рассчитан и сохранен результат для пользователя #1 в викторине #34
app_1       | 2026/02/09 17:50:50 [QuizManager] Индивидуальные результаты для викторины #34 рассчитаны.
app_1       | 2026/02/09 17:50:50 [QuizManager] Определение победителей и распределение призов для викторины #34...
app_1       | 2026/02/09 17:50:50 [ResultService] Финализация результатов для викторины #34
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | 2026/02/09 17:50:50 [ResultService] Викторина #34 не имеет вопросов, пропуск определения победителей и обновления рангов.
app_1       | [0.428ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 34
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [1.130ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | 2026/02/09 17:50:50 ShardedHub: Broadcasting message to Quiz 34 across all shards
app_1       | 2026/02/09 17:50:50 [Shard 1][Quiz 34] BroadcastToQuiz called. Message type: quiz:results_available
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34] BroadcastToQuiz called. Message type: quiz:results_available
app_1       | 2026/02/09 17:50:50 [Shard 3][Quiz 34] BroadcastToQuiz called. Message type: quiz:results_available
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34][Range] Iterating over client: User 1, Conn 3c16e81f-241d-4501-8a89-9398a7af2607
app_1       | 2026/02/09 17:50:50 [Shard 2][Quiz 34] BroadcastToQuiz called. Message type: quiz:results_available
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Attempting to queue message type: quiz:results_available
app_1       | 2026/02/09 17:50:50 [Shard 0][Quiz 34][User 1][Conn 3c16e81f-241d-4501-8a89-9398a7af2607] Successfully queued message type: quiz:results_available. Buffer len: 0
app_1       | 2026/02/09 17:50:50 Shard 0: Message broadcast to 1 clients in Quiz 34
app_1       | 2026/02/09 17:50:50 ShardedHub: Finished broadcasting to Quiz 34
app_1       | 2026/02/09 17:50:50 [ResultService] Событие quiz:results_available для викторины #34 успешно отправлено
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.874ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:50.776') OR (is_active = false AND rotated_at > '2026-02-02 17:50:50.776' AND expires_at > '2026-02-09 17:50:50.776') ORDER BY created_at DESC
app_1       | 2026/02/09 17:50:50 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.634ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:50:50 | 200 |      1.9868ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.736ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:50.911') OR (is_active = false AND rotated_at > '2026-02-02 17:50:50.911' AND expires_at > '2026-02-09 17:50:50.911') ORDER BY created_at DESC
app_1       | 2026/02/09 17:50:50 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:50:50 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.762ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:50:50 | 200 |     2.12687ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 17:50:51 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.603ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:51.036') OR (is_active = false AND rotated_at > '2026-02-02 17:50:51.036' AND expires_at > '2026-02-09 17:50:51.036') ORDER BY created_at DESC
app_1       | 2026/02/09 17:50:51 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:50:51 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | [GIN] 2026/02/09 - 17:50:51 | 200 |      922.26µs |      172.18.0.6 | GET      "/api/auth/csrf"
app_1       | 
app_1       | 2026/02/09 17:50:51 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.756ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:50:51 | 200 |     945.493µs |      172.18.0.6 | GET      "/api/quizzes/34"
app_1       | 
app_1       | 2026/02/09 17:50:51 /app/internal/repository/postgres/result_repo.go:60
app_1       | [2.262ms] [rows:1] SELECT count(*) FROM "results" WHERE quiz_id = 34
app_1       | 
app_1       | 2026/02/09 17:50:51 /app/internal/repository/postgres/result_repo.go:72
app_1       | [1.974ms] [rows:1] SELECT * FROM "results" WHERE quiz_id = 34 ORDER BY rank ASC, score DESC LIMIT 20
app_1       | [GIN] 2026/02/09 - 17:50:51 | 200 |    5.322964ms |      172.18.0.6 | GET      "/api/quizzes/34/results?page=1&page_size=20"
app_1       | 2026/02/09 17:50:51 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:50:51 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.653ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:51.241') OR (is_active = false AND rotated_at > '2026-02-02 17:50:51.241' AND expires_at > '2026-02-09 17:50:51.241') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:50:51 /app/internal/repository/postgres/result_repo.go:103
app_1       | [1.269ms] [rows:1] SELECT * FROM "results" WHERE user_id = 1 AND quiz_id = 34 ORDER BY "results"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:50:51 | 200 |    2.360334ms |      172.18.0.6 | GET      "/api/quizzes/34/my-result"
app_1       | 
app_1       | 2026/02/09 17:50:54 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [3.106ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 17:50:54.836' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 17:50:54 | 200 |    3.290865ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 17:50:56 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.327ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:50:56.121') OR (is_active = false AND rotated_at > '2026-02-02 17:50:56.121' AND expires_at > '2026-02-09 17:50:56.121') ORDER BY created_at DESC
app_1       | 2026/02/09 17:50:56 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:50:56 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [4.117ms] [rows:6] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 17:50:56.123' ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 17:50:56 | 200 |    6.184204ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 2026/02/09 17:50:56 [TokenManager] Получено 6 активных токенов пользователя ID=1
app_1       | 2026/02/09 17:51:00 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:51:00 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.281ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:51:00.036') OR (is_active = false AND rotated_at > '2026-02-02 17:51:00.036' AND expires_at > '2026-02-09 17:51:00.036') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:51:00 /app/internal/repository/postgres/result_repo.go:119
app_1       | [1.349ms] [rows:1] SELECT count(*) FROM "results" WHERE user_id = 1
app_1       | 
app_1       | 2026/02/09 17:51:00 /app/internal/repository/postgres/result_repo.go:128
app_1       | [1.645ms] [rows:10] SELECT * FROM "results" WHERE user_id = 1 ORDER BY created_at DESC LIMIT 10
app_1       | [GIN] 2026/02/09 - 17:51:00 | 200 |    5.203061ms |      172.18.0.6 | GET      "/api/users/me/results?page=1&page_size=10"
app_1       | 
app_1       | 2026/02/09 17:51:01 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [1.049ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:51:01 | 200 |    1.540497ms |      172.18.0.6 | GET      "/api/quizzes/34"
app_1       | 
app_1       | 2026/02/09 17:51:01 /app/internal/repository/postgres/result_repo.go:60
app_1       | [0.776ms] [rows:1] SELECT count(*) FROM "results" WHERE quiz_id = 34
app_1       | 
app_1       | 2026/02/09 17:51:01 /app/internal/repository/postgres/result_repo.go:72
app_1       | [0.985ms] [rows:1] SELECT * FROM "results" WHERE quiz_id = 34 ORDER BY rank ASC, score DESC LIMIT 20
app_1       | [GIN] 2026/02/09 - 17:51:01 | 200 |    2.931768ms |      172.18.0.6 | GET      "/api/quizzes/34/results?page=1&page_size=20"
app_1       | 
app_1       | 2026/02/09 17:51:01 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.843ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:51:01.761') OR (is_active = false AND rotated_at > '2026-02-02 17:51:01.761' AND expires_at > '2026-02-09 17:51:01.761') ORDER BY created_at DESC
app_1       | 2026/02/09 17:51:01 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:51:01 /app/internal/repository/postgres/result_repo.go:103
app_1       | [1.344ms] [rows:1] SELECT * FROM "results" WHERE user_id = 1 AND quiz_id = 34 ORDER BY "results"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:51:01 | 200 |    2.854869ms |      172.18.0.6 | GET      "/api/quizzes/34/my-result"
app_1       | 
app_1       | 2026/02/09 17:51:04 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.043ms] [rows:0] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-09 17:51:04.116' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/09 - 17:51:04 | 200 |    1.247739ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
app_1       | 
app_1       | 2026/02/09 17:51:05 /app/internal/repository/postgres/user_repo.go:179
app_1       | [0.689ms] [rows:1] SELECT count(*) FROM "users"
app_1       | 
app_1       | 2026/02/09 17:51:05 /app/internal/repository/postgres/user_repo.go:191
app_1       | [1.124ms] [rows:10] SELECT "id","username","profile_picture","wins_count","total_prize_won" FROM "users" ORDER BY wins_count DESC, total_prize_won DESC, id ASC LIMIT 10
app_1       | [GIN] 2026/02/09 - 17:51:05 | 200 |    2.740724ms |      172.18.0.6 | GET      "/api/leaderboard?page=1&page_size=10"
app_1       | 
app_1       | 2026/02/09 17:51:06 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.592ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:51:06.159') OR (is_active = false AND rotated_at > '2026-02-02 17:51:06.159' AND expires_at > '2026-02-09 17:51:06.159') ORDER BY created_at DESC
app_1       | 2026/02/09 17:51:06 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:51:06 [TokenManager] Получено 6 активных токенов пользователя ID=1
app_1       | 
app_1       | 2026/02/09 17:51:06 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [0.991ms] [rows:6] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 17:51:06.16' ORDER BY created_at DESC
app_1       | [GIN] 2026/02/09 - 17:51:06 | 200 |    2.255116ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 2026/02/09 17:51:06 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:51:06 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.621ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:51:06.921') OR (is_active = false AND rotated_at > '2026-02-02 17:51:06.921' AND expires_at > '2026-02-09 17:51:06.921') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:51:06 /app/internal/repository/postgres/refresh_token_repo.go:85
app_1       | [1.155ms] [rows:6] SELECT * FROM "refresh_tokens" WHERE user_id = 1 AND expires_at > '2026-02-09 17:51:06.922' ORDER BY created_at DESC
app_1       | 2026/02/09 17:51:06 [TokenManager] Получено 6 активных токенов пользователя ID=1
app_1       | [GIN] 2026/02/09 - 17:51:06 | 200 |    2.308726ms |      172.18.0.6 | GET      "/api/auth/sessions"
app_1       | 
app_1       | 2026/02/09 17:51:08 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.462ms] [rows:34] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 17:51:08 | 200 |    1.968652ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 
app_1       | 2026/02/09 17:51:09 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.596ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 34
app_1       | 
app_1       | 2026/02/09 17:51:09 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [1.998ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:51:09 | 200 |    2.246019ms |      172.18.0.6 | GET      "/api/quizzes/34/with-questions"
app_1       | 2026/02/09 17:51:11 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 17:51:12 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.834ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:51:12 | 200 |    1.079101ms |      172.18.0.6 | GET      "/api/quizzes/34"
app_1       | 
app_1       | 2026/02/09 17:51:12 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.529ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:51:12.019') OR (is_active = false AND rotated_at > '2026-02-02 17:51:12.019' AND expires_at > '2026-02-09 17:51:12.019') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:51:12 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.811ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:51:12.019') OR (is_active = false AND rotated_at > '2026-02-02 17:51:12.019' AND expires_at > '2026-02-09 17:51:12.019') ORDER BY created_at DESC
app_1       | 2026/02/09 17:51:12 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/09 17:51:12 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:51:12 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.566ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 17:51:12 /app/internal/repository/postgres/result_repo.go:174
app_1       | [1.370ms] [rows:0] SELECT * FROM "results" WHERE quiz_id = 34 AND is_winner = true ORDER BY rank ASC, score DESC
app_1       | [GIN] 2026/02/09 - 17:51:12 | 200 |    2.427118ms |      172.18.0.6 | GET      "/api/quizzes/34/winners"
app_1       | 
app_1       | 2026/02/09 17:51:12 /app/internal/service/result_service.go:396
app_1       | [3.595ms] [rows:1] SELECT 
app_1       |                   COUNT(*) as total,
app_1       |                   COUNT(*) FILTER (WHERE is_winner = true) as winners,
app_1       |                   COUNT(*) FILTER (WHERE is_eliminated = true) as eliminated
app_1       |            FROM "results" WHERE quiz_id = 34
app_1       | 
app_1       | 2026/02/09 17:51:12 /app/internal/service/result_service.go:412
app_1       | [5.080ms] [rows:1] SELECT 
app_1       |                   AVG(NULLIF(correct_answers, 0)) as avg_correct
app_1       |            FROM "results" WHERE quiz_id = 34
app_1       | 
app_1       | 2026/02/09 17:51:12 /app/internal/service/result_service.go:419
app_1       | [1.188ms] [rows:1] SELECT AVG(response_time_ms) FROM "user_answers" WHERE quiz_id = 34 AND response_time_ms > 0
app_1       | 
app_1       | 2026/02/09 17:51:12 /app/internal/service/result_service.go:446
app_1       | [2.284ms] [rows:3] SELECT 
app_1       |                   question_id,
app_1       |                   COUNT(*) FILTER (WHERE is_eliminated = true) as eliminated_count,
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason IN ('time_exceeded', 'no_answer_timeout')) as by_timeout,
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason = 'incorrect_answer') as by_wrong_answer,
app_1       |                   AVG(response_time_ms) FILTER (WHERE response_time_ms > 0) as avg_resp_ms,
app_1       |                   COUNT(*) as total_answers,
app_1       |                   COUNT(*) FILTER (WHERE is_correct = true AND is_eliminated = false) as passed_count
app_1       |            FROM "user_answers" WHERE quiz_id = 34 GROUP BY "question_id" ORDER BY question_id
app_1       | 
app_1       | 2026/02/09 17:51:12 /app/internal/repository/postgres/question_repo.go:54
app_1       | [1.287ms] [rows:0] SELECT * FROM "questions" WHERE quiz_id = 34 ORDER BY id
app_1       | 2026/02/09 17:51:12 [ResultService] Статистика для викторины #34: 1 участников, 0 победителей, 1 выбыло
app_1       | 
app_1       | 2026/02/09 17:51:12 /app/internal/service/result_service.go:531
app_1       | [1.282ms] [rows:1] SELECT 
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason IN ('time_exceeded', 'no_answer_timeout') AND is_eliminated = true) as timeout,
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason = 'incorrect_answer' AND is_eliminated = true) as wrong_answer,
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason = 'disconnected' AND is_eliminated = true) as disconnected,
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason NOT IN ('time_exceeded', 'no_answer_timeout', 'incorrect_answer', 'disconnected', '') AND is_eliminated = true) as other
app_1       |            FROM "user_answers" WHERE quiz_id = 34
app_1       | [GIN] 2026/02/09 - 17:51:12 | 200 |   17.675376ms |      172.18.0.6 | GET      "/api/quizzes/34/statistics"
app_1       | 
app_1       | 2026/02/09 17:51:12 /app/internal/repository/postgres/result_repo.go:60
app_1       | [1.159ms] [rows:1] SELECT count(*) FROM "results" WHERE quiz_id = 34
app_1       | 
app_1       | 2026/02/09 17:51:12 /app/internal/repository/postgres/result_repo.go:72
app_1       | [1.450ms] [rows:1] SELECT * FROM "results" WHERE quiz_id = 34 ORDER BY rank ASC, score DESC LIMIT 50
app_1       | [GIN] 2026/02/09 - 17:51:12 | 200 |    3.573461ms |      172.18.0.6 | GET      "/api/quizzes/34/results?page=1&page_size=50"
app_1       | [GIN] 2026/02/09 - 17:51:20 | 401 |      94.655µs |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 17:51:21 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [1.653ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 34
app_1       | 
app_1       | 2026/02/09 17:51:21 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [3.947ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:51:21 | 200 |    4.409064ms |      172.18.0.6 | GET      "/api/quizzes/34/with-questions"
app_1       | 
app_1       | 2026/02/09 17:51:25 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.999ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:51:25 | 200 |    1.777354ms |      172.18.0.6 | GET      "/api/quizzes/34"
app_1       | 
app_1       | 2026/02/09 17:51:25 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [2.323ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:51:25.754') OR (is_active = false AND rotated_at > '2026-02-02 17:51:25.754' AND expires_at > '2026-02-09 17:51:25.754') ORDER BY created_at DESC
app_1       | 2026/02/09 17:51:25 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:51:25 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [1.321ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/09 17:51:25 /app/internal/service/result_service.go:396
app_1       | [0.911ms] [rows:1] SELECT 
app_1       |                   COUNT(*) as total,
app_1       |                   COUNT(*) FILTER (WHERE is_winner = true) as winners,
app_1       |                   COUNT(*) FILTER (WHERE is_eliminated = true) as eliminated
app_1       |            FROM "results" WHERE quiz_id = 34
app_1       | 
app_1       | 2026/02/09 17:51:25 /app/internal/service/result_service.go:412
app_1       | [1.940ms] [rows:1] SELECT 
app_1       |                   AVG(NULLIF(correct_answers, 0)) as avg_correct
app_1       |            FROM "results" WHERE quiz_id = 34
app_1       | 
app_1       | 2026/02/09 17:51:25 /app/internal/service/result_service.go:419
app_1       | [1.022ms] [rows:1] SELECT AVG(response_time_ms) FROM "user_answers" WHERE quiz_id = 34 AND response_time_ms > 0
app_1       | 
app_1       | 2026/02/09 17:51:25 /app/internal/service/result_service.go:446
app_1       | [1.702ms] [rows:3] SELECT 
app_1       |                   question_id,
app_1       |                   COUNT(*) FILTER (WHERE is_eliminated = true) as eliminated_count,
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason IN ('time_exceeded', 'no_answer_timeout')) as by_timeout,
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason = 'incorrect_answer') as by_wrong_answer,
app_1       |                   AVG(response_time_ms) FILTER (WHERE response_time_ms > 0) as avg_resp_ms,
app_1       |                   COUNT(*) as total_answers,
app_1       |                   COUNT(*) FILTER (WHERE is_correct = true AND is_eliminated = false) as passed_count
app_1       |            FROM "user_answers" WHERE quiz_id = 34 GROUP BY "question_id" ORDER BY question_id
app_1       | 
app_1       | 2026/02/09 17:51:25 /app/internal/repository/postgres/question_repo.go:54
app_1       | [0.996ms] [rows:0] SELECT * FROM "questions" WHERE quiz_id = 34 ORDER BY id
app_1       | 2026/02/09 17:51:25 [ResultService] Статистика для викторины #34: 1 участников, 0 победителей, 1 выбыло
app_1       | 
app_1       | 2026/02/09 17:51:25 /app/internal/service/result_service.go:531
app_1       | [1.861ms] [rows:1] SELECT 
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason IN ('time_exceeded', 'no_answer_timeout') AND is_eliminated = true) as timeout,
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason = 'incorrect_answer' AND is_eliminated = true) as wrong_answer,
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason = 'disconnected' AND is_eliminated = true) as disconnected,
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason NOT IN ('time_exceeded', 'no_answer_timeout', 'incorrect_answer', 'disconnected', '') AND is_eliminated = true) as other
app_1       |            FROM "user_answers" WHERE quiz_id = 34
app_1       | [GIN] 2026/02/09 - 17:51:25 | 200 |   15.327208ms |      172.18.0.6 | GET      "/api/quizzes/34/statistics"
app_1       | 2026/02/09 17:52:11 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 17:52:27 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.544ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 34
app_1       | 
app_1       | 2026/02/09 17:52:27 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [1.665ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:52:27 | 200 |     1.97062ms |      172.18.0.6 | GET      "/api/quizzes/34/with-questions"
app_1       | 
app_1       | 2026/02/09 17:52:28 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [1.454ms] [rows:34] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 17:52:28 | 200 |    1.928327ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 2026/02/09 17:52:32 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:52:32 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.135ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:52:32.457') OR (is_active = false AND rotated_at > '2026-02-02 17:52:32.457' AND expires_at > '2026-02-09 17:52:32.457') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:52:32 /app/internal/repository/postgres/question_repo.go:188
app_1       | [0.643ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL
app_1       | 
app_1       | 2026/02/09 17:52:32 /app/internal/repository/postgres/question_repo.go:193
app_1       | [0.868ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false
app_1       | 
app_1       | 2026/02/09 17:52:32 /app/internal/repository/postgres/question_repo.go:202
app_1       | [0.784ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 1
app_1       | 
app_1       | 2026/02/09 17:52:32 /app/internal/repository/postgres/question_repo.go:202
app_1       | [0.454ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 2
app_1       | 
app_1       | 2026/02/09 17:52:32 /app/internal/repository/postgres/question_repo.go:202
app_1       | [0.487ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 3
app_1       | 
app_1       | 2026/02/09 17:52:32 /app/internal/repository/postgres/question_repo.go:202
app_1       | [0.470ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 4
app_1       | 
app_1       | 2026/02/09 17:52:32 /app/internal/repository/postgres/question_repo.go:202
app_1       | [0.426ms] [rows:1] SELECT count(*) FROM "questions" WHERE quiz_id IS NULL AND is_used = false AND difficulty = 5
app_1       | [GIN] 2026/02/09 - 17:52:32 | 200 |    6.383438ms |      172.18.0.6 | GET      "/api/admin/question-pool/stats"
app_1       | 2026/02/09 17:53:11 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 17:53:42 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:53:42 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.840ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:53:42.003') OR (is_active = false AND rotated_at > '2026-02-02 17:53:42.003' AND expires_at > '2026-02-09 17:53:42.003') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:53:42 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.732ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:53:42 | 200 |    2.183041ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/09 17:53:42 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [2.630ms] [rows:34] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/09 - 17:53:42 | 200 |    3.052904ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
app_1       | 
app_1       | 2026/02/09 17:53:43 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.556ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 34
app_1       | 
app_1       | 2026/02/09 17:53:43 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [1.537ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:53:43 | 200 |    1.714151ms |      172.18.0.6 | GET      "/api/quizzes/34/with-questions"
app_1       | 
app_1       | 2026/02/09 17:53:45 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.865ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:53:45 | 200 |    1.246869ms |      172.18.0.6 | GET      "/api/quizzes/34"
app_1       | 
app_1       | 2026/02/09 17:53:45 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.788ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:53:45.188') OR (is_active = false AND rotated_at > '2026-02-02 17:53:45.188' AND expires_at > '2026-02-09 17:53:45.188') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/09 17:53:45 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.469ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 34 ORDER BY "quizzes"."id" LIMIT 1
app_1       | 2026/02/09 17:53:45 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:53:45 /app/internal/service/result_service.go:396
app_1       | [1.000ms] [rows:1] SELECT 
app_1       |                   COUNT(*) as total,
app_1       |                   COUNT(*) FILTER (WHERE is_winner = true) as winners,
app_1       |                   COUNT(*) FILTER (WHERE is_eliminated = true) as eliminated
app_1       |            FROM "results" WHERE quiz_id = 34
app_1       | 
app_1       | 2026/02/09 17:53:45 /app/internal/service/result_service.go:412
app_1       | [0.807ms] [rows:1] SELECT 
app_1       |                   AVG(NULLIF(correct_answers, 0)) as avg_correct
app_1       |            FROM "results" WHERE quiz_id = 34
app_1       | 
app_1       | 2026/02/09 17:53:45 /app/internal/service/result_service.go:419
app_1       | [0.796ms] [rows:1] SELECT AVG(response_time_ms) FROM "user_answers" WHERE quiz_id = 34 AND response_time_ms > 0
app_1       | 
app_1       | 2026/02/09 17:53:45 /app/internal/service/result_service.go:446
app_1       | [1.009ms] [rows:3] SELECT 
app_1       |                   question_id,
app_1       |                   COUNT(*) FILTER (WHERE is_eliminated = true) as eliminated_count,
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason IN ('time_exceeded', 'no_answer_timeout')) as by_timeout,
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason = 'incorrect_answer') as by_wrong_answer,
app_1       |                   AVG(response_time_ms) FILTER (WHERE response_time_ms > 0) as avg_resp_ms,
app_1       |                   COUNT(*) as total_answers,
app_1       |                   COUNT(*) FILTER (WHERE is_correct = true AND is_eliminated = false) as passed_count
app_1       |            FROM "user_answers" WHERE quiz_id = 34 GROUP BY "question_id" ORDER BY question_id
app_1       | 
app_1       | 2026/02/09 17:53:45 /app/internal/repository/postgres/question_repo.go:54
app_1       | [1.012ms] [rows:0] SELECT * FROM "questions" WHERE quiz_id = 34 ORDER BY id
app_1       | 
app_1       | 2026/02/09 17:53:45 /app/internal/service/result_service.go:531
app_1       | [0.806ms] [rows:1] SELECT 
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason IN ('time_exceeded', 'no_answer_timeout') AND is_eliminated = true) as timeout,
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason = 'incorrect_answer' AND is_eliminated = true) as wrong_answer,
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason = 'disconnected' AND is_eliminated = true) as disconnected,
app_1       |                   COUNT(*) FILTER (WHERE elimination_reason NOT IN ('time_exceeded', 'no_answer_timeout', 'incorrect_answer', 'disconnected', '') AND is_eliminated = true) as other
app_1       |            FROM "user_answers" WHERE quiz_id = 34
app_1       | 2026/02/09 17:53:45 [ResultService] Статистика для викторины #34: 1 участников, 0 победителей, 1 выбыло
app_1       | [GIN] 2026/02/09 - 17:53:45 | 200 |    8.129283ms |      172.18.0.6 | GET      "/api/quizzes/34/statistics"
app_1       | 2026/02/09 17:54:11 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/09 17:54:41 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.165ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-09 17:54:41.981') OR (is_active = false AND rotated_at > '2026-02-02 17:54:41.981' AND expires_at > '2026-02-09 17:54:41.981') ORDER BY created_at DESC
app_1       | 2026/02/09 17:54:41 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/09 17:54:41 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.887ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/09 - 17:54:41 | 200 |     2.78083ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 2026/02/09 17:55:11 [Shard 1] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 17:55:11 [Shard 2] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 17:55:11 [Shard 3] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 17:55:11 [Shard 0] Запуск проверки неактивных клиентов...
app_1       | 2026/02/09 17:55:11 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/09 17:56:11 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
