# üìã –ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–µ–∫—Ç—É Trivia API

---

## üéØ –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

**Trivia API** ‚Äî —ç—Ç–æ MVP –±—ç–∫–µ–Ω–¥-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è real-time –≤–∏–∫—Ç–æ—Ä–∏–Ω —Å –¥–µ–Ω–µ–∂–Ω—ã–º–∏ –ø—Ä–∏–∑–∞–º–∏. –ü–æ—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ **Go 1.x** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Clean Architecture** –∏ **Dependency Injection**.

### –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|-----------|
| **Go** | –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ |
| **Gin** | HTTP-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ |
| **GORM** | ORM –¥–ª—è PostgreSQL |
| **Redis** | –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, Pub/Sub –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ |
| **Gorilla WebSocket** | Real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è |
| **JWT (golang-jwt)** | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
| **bcrypt** | –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π |

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
trivia-api/
‚îú‚îÄ‚îÄ cmd/api/main.go              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (435 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ config/config.yaml           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ migrations/                  # 12 –ø–∞—Ä –º–∏–≥—Ä–∞—Ü–∏–π (up/down)
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ config/config.go         # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (257 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entity/              # 8 —Å—É—â–Ω–æ—Å—Ç–µ–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repository/          # 8 –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îÇ   ‚îú‚îÄ‚îÄ handler/                 # 4 HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ + 2 DTO + 1 helper
‚îÇ   ‚îú‚îÄ‚îÄ middleware/              # 2 middleware
‚îÇ   ‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ postgres/            # 7 PostgreSQL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ redis/               # 1 Redis —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫–µ—à–∞
‚îÇ   ‚îú‚îÄ‚îÄ service/                 # 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ + 4 quizmanager
‚îÇ   ‚îú‚îÄ‚îÄ websocket/               # 9 —Ñ–∞–π–ª–æ–≤ WebSocket –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ pkg/errors/              # –û–±—â–∏–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ pkg/
    ‚îú‚îÄ‚îÄ auth/jwt.go              # JWT —Å–µ—Ä–≤–∏—Å (662 —Å—Ç—Ä–æ–∫–∏)
    ‚îú‚îÄ‚îÄ auth/manager/            # TokenManager (860 —Å—Ç—Ä–æ–∫)
    ‚îî‚îÄ‚îÄ database/                # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL –∏ Redis
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ |
|-----------|-----------|
| **–í—Å–µ–≥–æ Go-—Ñ–∞–π–ª–æ–≤** | ~47 |
| **–ü—Ä–∏–º–µ—Ä–Ω—ã–π –æ–±—ä—ë–º –∫–æ–¥–∞** | ~12,000 —Å—Ç—Ä–æ–∫ |
| **Domain Entities** | 8 |
| **Repository Interfaces** | 8 |
| **Repository Implementations** | 8 (7 postgres + 1 redis) |
| **Handlers** | 4 |
| **Services** | 9 (5 –æ—Å–Ω–æ–≤–Ω—ã—Ö + 4 quizmanager) |
| **WebSocket –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** | 9 |
| **Middlewares** | 2 |
| **Migrations** | 34 —Ñ–∞–π–ª–∞ (17 –ø–∞—Ä) |

---

## üÜï –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (2026-02)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/users/me/results` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∏–≥—Ä —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ Result: `eliminated_on_question`, `elimination_reason`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `GET /api/quizzes/:id/results/export?format=csv|xlsx`
- StreamWriter –¥–ª—è Excel —á–µ—Ä–µ–∑ excelize

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ê–¥–º–∏–Ω-–ø–æ–∏—Å–∫ –≤–∏–∫—Ç–æ—Ä–∏–Ω
- `ListWithFilters` –≤ QuizRepository —Å GROUP BY
- Query params: `status`, `search`, `date_from`, `date_to`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /api/quizzes/:id/statistics`
- `QuizStatistics` struct: —É—á–∞—Å—Ç–Ω–∏–∫–∏, –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏, –≤—ã–±—ã—Ç–∏—è –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º, –ø—Ä–∏—á–∏–Ω—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5: –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (–§–µ–≤—Ä–∞–ª—å 2026)
**–ë—ç–∫–µ–Ω–¥:**
- `AdaptiveQuestionSelector` ‚Äî –≤—ã–±–∏—Ä–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–≥–æ pass rate
- `DifficultyConfig` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–µ–ª–µ–≤—ã—Ö pass rates –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º
- `recordAdaptiveStats` ‚Äî –∑–∞–ø–∏—Å—å –≤ Redis —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
- WS —Å–æ–±—ã—Ç–∏–µ `adaptive:question_stats` ‚Äî realtime –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞

**–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- `difficulty`, `pass_rate`, `total_answers` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
- `DifficultyDistribution` ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (1-5)
- `avg_pass_rate`, `pool_questions_used` ‚Äî –æ–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏

**–§—Ä–æ–Ω—Ç–µ–Ω–¥:**
- `/admin/quizzes/:id/statistics` ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- `/admin/quiz-live/:id` ‚Äî **NEW** realtime –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ WebSocket

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Clean Architecture)

```mermaid
graph TD
    A[HTTP/WebSocket Handlers] --> B[Services]
    B --> C[Repository Interfaces]
    C --> D[Repository Implementations]
    D --> E[(PostgreSQL)]
    D --> F[(Redis)]
    
    B --> G[Domain Entities]
    C --> G
    
    subgraph "pkg"
        H[auth/jwt.go]
        I[auth/manager/token_manager.go]
        J[database/]
    end
    
    A --> H
    B --> H
    A --> I
```

---

## üì¶ Domain Entities (8 —Å—É—â–Ω–æ—Å—Ç–µ–π)

### 1. User ([user.go](file:///c:/project/trivia-api/internal/domain/entity/user.go) - 81 —Å—Ç—Ä–æ–∫–∞)
```go
type User struct {
    ID             uint
    Username       string    // unique, 3-50 —Å–∏–º–≤–æ–ª–æ–≤
    Email          string    // unique, email
    Password       string    // bcrypt hash
    ProfilePicture string
    GamesPlayed    int
    TotalScore     int
    HighestScore   int
    WinsCount      int       // –¥–ª—è –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
    TotalPrizeWon  int       // –¥–ª—è –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
    CreatedAt, UpdatedAt time.Time
}
```
**–ú–µ—Ç–æ–¥—ã:**
- [BeforeSave()](file:///c:/project/trivia-api/internal/domain/entity/user.go#28-57) ‚Äî —Ö–µ—à–∏—Ä—É–µ—Ç –ø–∞—Ä–æ–ª—å (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—â—ë –Ω–µ —Ö–µ—à)
- [CheckPassword()](file:///c:/project/trivia-api/internal/domain/entity/user.go#58-81) ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è —á–µ—Ä–µ–∑ bcrypt

---

### 2. Quiz ([quiz.go](file:///c:/project/trivia-api/internal/domain/entity/quiz.go) - 35 —Å—Ç—Ä–æ–∫)
```go
type Quiz struct {
    ID            uint
    Title         string
    Description   string
    ScheduledTime time.Time
    Status        string     // "scheduled", "in_progress", "completed"
    QuestionCount int
    PrizeFund     int        // –ü—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥ (–¥–µ–ª–∏—Ç—Å—è –ø–æ—Ä–æ–≤–Ω—É –º–µ–∂–¥—É –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º–∏)
    Questions     []Question // FK relationship
}
```
**–ú–µ—Ç–æ–¥—ã:** [IsActive()](file:///c:/project/trivia-api/internal/domain/entity/quiz.go#20-24), [IsScheduled()](file:///c:/project/trivia-api/internal/domain/entity/quiz.go#25-29), [IsCompleted()](file:///c:/project/trivia-api/internal/domain/entity/quiz.go#30-34)

---

### 3. Question ([question.go](file:///c:/project/trivia-api/internal/domain/entity/question.go) - 85 —Å—Ç—Ä–æ–∫)
```go
type Question struct {
    ID            uint
    QuizID        uint
    Text          string
    Options       StringArray  // JSONB –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫
    CorrectOption int          // —Å–∫—Ä—ã—Ç –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ json:"-"
    TimeLimitSec  int
    PointValue    int
}
```
**–ú–µ—Ç–æ–¥—ã:**
- [IsCorrect(selectedOption)](file:///c:/project/trivia-api/internal/domain/entity/question.go#46-50) ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
- [CalculatePoints()](file:///c:/project/trivia-api/internal/domain/entity/question.go#51-85) ‚Äî **–£–ü–†–û–©–ï–ù–û: –≤—Å–µ–≥–¥–∞ 1 –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, 0 –∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π**

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ç–∏–ø `StringArray` —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π [Scan()](file:///c:/project/trivia-api/internal/domain/entity/question.go#13-23) –∏ [Value()](file:///c:/project/trivia-api/internal/domain/entity/question.go#24-32) –¥–ª—è JSONB.

---

### 4. Result ([result.go](file:///c:/project/trivia-api/internal/domain/entity/result.go) - 24 —Å—Ç—Ä–æ–∫–∏)
```go
type Result struct {
    ID             uint
    UserID, QuizID uint
    Username       string    // –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    ProfilePicture string    // –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
    Score          int
    CorrectAnswers int
    TotalQuestions int
    Rank           int
    IsWinner       bool
    PrizeFund      int       // –¥–æ–ª—è –ø—Ä–∏–∑–æ–≤–æ–≥–æ —Ñ–æ–Ω–¥–∞
    IsEliminated   bool
}
```

---

### 5. UserAnswer ([user_answer.go](file:///c:/project/trivia-api/internal/domain/entity/user_answer.go) - 26 —Å—Ç—Ä–æ–∫)
```go
type UserAnswer struct {
    ID                uint
    UserID, QuizID    uint
    QuestionID        uint
    SelectedOption    int
    IsCorrect         bool
    ResponseTimeMs    int64
    Score             int
    IsEliminated      bool
    EliminationReason string
}
```

---

### 6. RefreshToken ([refresh_token.go](file:///c:/project/trivia-api/internal/domain/entity/refresh_token.go) - 68 —Å—Ç—Ä–æ–∫)
```go
type RefreshToken struct {
    ID        uint
    UserID    uint
    Token     string
    DeviceID  string
    IPAddress string
    UserAgent string
    ExpiresAt time.Time
    IsExpired bool
    RevokedAt *time.Time
    Reason    string
}
```
**–ú–µ—Ç–æ–¥—ã:** [NewRefreshToken()](file:///c:/project/trivia-api/internal/domain/entity/refresh_token.go#22-35), [IsValid()](file:///c:/project/trivia-api/internal/domain/entity/refresh_token.go#36-40), [SessionInfo()](file:///c:/project/trivia-api/internal/domain/entity/refresh_token.go#41-63), [TableName()](file:///c:/project/trivia-api/internal/domain/entity/user_answer.go#22-26)

---

### 7. JWTKey ([jwt_key.go](file:///c:/project/trivia-api/internal/domain/entity/jwt_key.go) - 22 —Å—Ç—Ä–æ–∫–∏)
```go
type JWTKey struct {
    ID          string    // UUID
    Key         string    // –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ–∫—Ä–µ—Ç
    Algorithm   string    // "HS256", "RS256"
    IsActive    bool
    CreatedAt   time.Time
    ExpiresAt   time.Time
    RotatedAt   *time.Time
    LastUsedAt  *time.Time
}
```

---

### 8. InvalidToken ([invalid_token.go](file:///c:/project/trivia-api/internal/domain/entity/invalid_token.go) - 17 —Å—Ç—Ä–æ–∫)
```go
type InvalidToken struct {
    UserID           uint
    InvalidationTime time.Time
}
```
*–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Å–µ—Ö —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è)*

---

### 9. AdAsset ([ad_asset.go](file:///c:/project/vmdeploy/trivia-api/internal/domain/entity/ad_asset.go) - 34 —Å—Ç—Ä–æ–∫–∏)
```go
type AdAsset struct {
    ID            uint
    Title         string
    MediaType     string    // "image" | "video"
    URL           string
    ThumbnailURL  string
    DurationSec   int       // 3-30 —Å–µ–∫—É–Ω–¥
    FileSizeBytes int64
    CreatedAt     time.Time
    UpdatedAt     time.Time
}
```
**–ú–µ—Ç–æ–¥—ã:** `IsVideo()`, `IsImage()`

---

### 10. QuizAdSlot ([quiz_ad_slot.go](file:///c:/project/vmdeploy/trivia-api/internal/domain/entity/quiz_ad_slot.go) - 24 —Å—Ç—Ä–æ–∫–∏)
```go
type QuizAdSlot struct {
    ID            uint
    QuizID        uint
    QuestionAfter int       // –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ –≤–æ–ø—Ä–æ—Å–∞ N
    AdAssetID     uint
    IsActive      bool
    AdAsset       *AdAsset  // preload
}
```
*–ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç —Ä–µ–∫–ª–∞–º—É –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≤–æ–ø—Ä–æ—Å—É –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã*

---

## üîå Repository Interfaces (8 –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤)

| –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å | –ú–µ—Ç–æ–¥—ã | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|--------|-----------|
| **UserRepository** | 12 | CRUD –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ª–∏–¥–µ—Ä–±–æ—Ä–¥ |
| **QuizRepository** | 9 | CRUD –≤–∏–∫—Ç–æ—Ä–∏–Ω |
| **QuestionRepository** | 7 | CRUD –≤–æ–ø—Ä–æ—Å–æ–≤ |
| **ResultRepository** | 11 | –û—Ç–≤–µ—Ç—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —Ä–∞–Ω–≥–∏, –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏ |
| **RefreshTokenRepository** | 12 | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ refresh —Ç–æ–∫–µ–Ω–∞–º–∏ |
| **JWTKeyRepository** | 7 | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏ JWT (—Ä–æ—Ç–∞—Ü–∏—è) |
| **InvalidTokenRepository** | 5 | –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ |
| **CacheRepository** | 13 | –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis (–≤–∫–ª—é—á–∞—è Set –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤) |

---

## üéÆ Handlers (HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏)

### 1. AuthHandler ([auth_handler.go](file:///c:/project/trivia-api/internal/handler/auth_handler.go) - 907 —Å—Ç—Ä–æ–∫)
**–°–∞–º—ã–π –±–æ–ª—å—à–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫.** –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| [Register](file:///c:/project/trivia-api/internal/service/auth_service.go#67-104) | POST /api/auth/register | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è |
| [Login](file:///c:/project/trivia-api/internal/service/auth_service.go#112-138) | POST /api/auth/login | –í—Ö–æ–¥ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã) |
| [RefreshToken](file:///c:/project/trivia-api/internal/domain/entity/refresh_token.go#8-21) | POST /api/auth/refresh | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ |
| [Logout](file:///c:/project/trivia-api/internal/service/auth_service.go#213-231) | POST /api/auth/logout | –í—ã—Ö–æ–¥ (—Ç—Ä–µ–±—É–µ—Ç CSRF) |
| [LogoutAllDevices](file:///c:/project/trivia-api/internal/service/auth_service.go#232-258) | POST /api/auth/logout-all | –í—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ |
| `GetActiveSessions` | GET /api/auth/sessions | –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π |
| `RevokeSession` | POST /api/auth/revoke-session | –û—Ç–∑—ã–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–µ—Å—Å–∏–∏ |
| [ChangePassword](file:///c:/project/trivia-api/internal/service/auth_service.go#189-212) | POST /api/auth/change-password | –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è |
| `GetCSRFToken` | GET /api/auth/csrf | –ü–æ–ª—É—á–µ–Ω–∏–µ CSRF —Ç–æ–∫–µ–Ω–∞ |
| `GenerateWsTicket` | POST /api/auth/ws-ticket | –¢–∏–∫–µ—Ç –¥–ª—è WebSocket |
| [GetMe](file:///c:/project/trivia-api/internal/websocket/pubsub.go#35-37) | GET /api/users/me | –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| [UpdateProfile](file:///c:/project/trivia-api/internal/domain/repository/user_repo.go#14-15) | PUT /api/users/me | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è |

**Admin-only –º–µ—Ç–æ–¥—ã:**
- `ResetAuth` ‚Äî —Å–±—Ä–æ—Å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
- [DebugToken](file:///c:/project/trivia-api/internal/service/auth_service.go#316-321) ‚Äî –æ—Ç–ª–∞–¥–∫–∞ —Ç–æ–∫–µ–Ω–∞
- `AdminResetPassword` ‚Äî —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

### 2. QuizHandler ([quiz_handler.go](file:///c:/project/trivia-api/internal/handler/quiz_handler.go) - 340 —Å—Ç—Ä–æ–∫)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| [CreateQuiz](file:///c:/project/trivia-api/internal/handler/quiz_handler.go#45-61) | POST /api/quizzes | –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã (admin) |
| [GetQuiz](file:///c:/project/trivia-api/internal/handler/quiz_handler.go#62-74) | GET /api/quizzes/:id | –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã |
| [GetActiveQuiz](file:///c:/project/trivia-api/internal/handler/quiz_handler.go#75-93) | GET /api/quizzes/active | –¢–µ–∫—É—â–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ |
| [GetScheduledQuizzes](file:///c:/project/trivia-api/internal/service/quiz_service.go#76-80) | GET /api/quizzes/scheduled | –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ |
| [AddQuestions](file:///c:/project/trivia-api/internal/handler/quiz_handler.go#117-150) | POST /api/quizzes/:id/questions | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ (admin) |
| [ScheduleQuiz](file:///c:/project/trivia-api/internal/service/quiz_service.go#122-146) | PUT /api/quizzes/:id/schedule | –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (admin) |
| [CancelQuiz](file:///c:/project/trivia-api/internal/service/quiz_manager.go#125-130) | PUT /api/quizzes/:id/cancel | –û—Ç–º–µ–Ω–∞ (admin) |
| [DuplicateQuiz](file:///c:/project/trivia-api/internal/service/quiz_service.go#179-264) | POST /api/quizzes/:id/duplicate | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (admin) |
| [GetQuizResults](file:///c:/project/trivia-api/internal/domain/repository/result_repo.go#14-15) | GET /api/quizzes/:id/results | –†–µ–∑—É–ª—å—Ç–∞—Ç—ã |
| [GetUserQuizResult](file:///c:/project/trivia-api/internal/handler/quiz_handler.go#237-261) | GET /api/quizzes/:id/my-result | –ú–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç |
| [ListQuizzes](file:///c:/project/trivia-api/internal/service/quiz_service.go#152-157) | GET /api/quizzes | –°–ø–∏—Å–æ–∫ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π |

---

### 3. UserHandler ([user_handler.go](file:///c:/project/trivia-api/internal/handler/user_handler.go) - 58 —Å—Ç—Ä–æ–∫)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| [GetLeaderboard](file:///c:/project/trivia-api/internal/handler/user_handler.go#26-56) | GET /api/leaderboard | –õ–∏–¥–µ—Ä–±–æ—Ä–¥ (–ø—É–±–ª–∏—á–Ω—ã–π) |

---

### 4. WSHandler ([ws_handler.go](file:///c:/project/trivia-api/internal/handler/ws_handler.go) - 212 —Å—Ç—Ä–æ–∫)

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| [HandleConnection](file:///c:/project/trivia-api/internal/handler/ws_handler.go#60-107) | –û–±—Ä–∞–±–æ—Ç–∫–∞ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è |
| [registerMessageHandlers](file:///c:/project/trivia-api/internal/handler/ws_handler.go#108-199) | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π |

**WebSocket —Å–æ–æ–±—â–µ–Ω–∏—è:**
- `ready` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ—Ç–æ–≤ –∫ –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ
- `answer` ‚Äî –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å

---

## ‚öôÔ∏è Services (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)

### 1. AuthService ([auth_service.go](file:///c:/project/trivia-api/internal/service/auth_service.go) - 500 —Å—Ç—Ä–æ–∫)
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TokenManager –∏ JWTService

### 2. QuizService ([quiz_service.go](file:///c:/project/trivia-api/internal/service/quiz_service.go) - 264 —Å—Ç—Ä–æ–∫–∏)
- CRUD –≤–∏–∫—Ç–æ—Ä–∏–Ω
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω

### 3. QuizManager ([quiz_manager.go](file:///c:/project/trivia-api/internal/service/quiz_manager.go) - 333 —Å—Ç—Ä–æ–∫–∏)
**–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã:**
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –≤–∏–∫—Ç–æ—Ä–∏–Ω
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã

### 4. ResultService ([result_service.go](file:///c:/project/trivia-api/internal/service/result_service.go) - 342 —Å—Ç—Ä–æ–∫–∏)
- –†–∞—Å—á—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–∑–æ–≤–æ–≥–æ —Ñ–æ–Ω–¥–∞
- WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

### 5. UserService ([user_service.go](file:///c:/project/trivia-api/internal/service/user_service.go) - 69 —Å—Ç—Ä–æ–∫)
- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

---

## üéØ QuizManager Components (4 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞)

### 1. Scheduler ([scheduler.go](file:///c:/project/trivia-api/internal/service/quizmanager/scheduler.go) - 350 —Å—Ç—Ä–æ–∫)
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω
- –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç
- –ó–∞–ª –æ–∂–∏–¥–∞–Ω–∏—è
- –ê–Ω–æ–Ω—Å—ã

### 2. QuestionManager ([question_manager.go](file:///c:/project/trivia-api/internal/service/quizmanager/question_manager.go) - 446 —Å—Ç—Ä–æ–∫)
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
- –¢–∞–π–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤
- –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—ã–±—ã–≤–∞–Ω–∏–∏

### 3. AnswerProcessor ([answer_processor.go](file:///c:/project/trivia-api/internal/service/quizmanager/answer_processor.go) - 234 —Å—Ç—Ä–æ–∫–∏)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
- –õ–æ–≥–∏–∫–∞ –≤—ã–±—ã–≤–∞–Ω–∏—è
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤

### 4. Types ([types.go](file:///c:/project/trivia-api/internal/websocket/message_types.go) - 135 —Å—Ç—Ä–æ–∫)
- Config —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- Dependencies (DI)
- ActiveQuizState —Å thread-safe –¥–æ—Å—Ç—É–ø–æ–º

---

## üåê WebSocket –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ (9 —Ñ–∞–π–ª–æ–≤)

| –§–∞–π–ª | –°—Ç—Ä–æ–∫ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-------|-----------|
| [sharded_hub.go](file:///c:/project/trivia-api/internal/websocket/sharded_hub.go) | 865 | –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ö–∞–± –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è |
| [shard.go](file:///c:/project/trivia-api/internal/websocket/shard.go) | 731 | –û—Ç–¥–µ–ª—å–Ω—ã–π —à–∞—Ä–¥ —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –Ω–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã |
| [pubsub.go](file:///c:/project/trivia-api/internal/websocket/pubsub.go) | 691 | Redis Pub/Sub –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ |
| [client.go](file:///c:/project/trivia-api/internal/websocket/client.go) | 525 | WebSocket –∫–ª–∏–µ–Ω—Ç |
| [manager.go](file:///c:/project/trivia-api/internal/websocket/manager.go) | 292 | –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π |
| [metrics.go](file:///c:/project/trivia-api/internal/websocket/metrics.go) | ~200 | –ú–µ—Ç—Ä–∏–∫–∏ |
| [api.go](file:///c:/project/trivia-api/internal/websocket/api.go) | ~200 | API –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è |
| [interfaces.go](file:///c:/project/trivia-api/internal/websocket/interfaces.go) | ~50 | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã |
| [message_types.go](file:///c:/project/trivia-api/internal/websocket/message_types.go) | ~30 | –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π |

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- **Sharding** ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ —à–∞—Ä–¥–∞–º (FNV hash –ø–æ UserID)
- **WorkerPool** ‚Äî –ø—É–ª –≤–æ—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- **Redis Pub/Sub** ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏
- **–ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã** ‚Äî broadcast —Ç–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º
- **–û—á–∏—Å—Ç–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (pkg/auth)

### JWTService ([jwt.go](file:///c:/project/trivia-api/pkg/auth/jwt.go) - 662 —Å—Ç—Ä–æ–∫–∏)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –∫–ª—é—á–µ–π
- –ü–∞—Ä—Å–∏–Ω–≥ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫–ª—é—á–∞–º
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ cache + DB
- WebSocket —Ç–∏–∫–µ—Ç—ã
- Pub/Sub —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–π

### TokenManager ([token_manager.go](file:///c:/project/trivia-api/pkg/auth/manager/token_manager.go) - 860 —Å—Ç—Ä–æ–∫)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Access –∏ Refresh —Ç–æ–∫–µ–Ω–∞–º–∏
- **–†–æ—Ç–∞—Ü–∏—è JWT –∫–ª—é—á–µ–π** —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º –≤ –ë–î (AES-256)
- CSRF –∑–∞—â–∏—Ç–∞ (Double Submit Cookie)
- Secure cookies
- –õ–∏–º–∏—Ç —Å–µ—Å—Å–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –§–æ–Ω–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç—ë–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤

---

## üîí Middlewares

### 1. AuthMiddleware ([auth_middleware.go](file:///c:/project/trivia-api/internal/middleware/auth_middleware.go) - 250 —Å—Ç—Ä–æ–∫)
- [RequireAuth()](file:///c:/project/trivia-api/internal/middleware/auth_middleware.go#29-97) ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT
- [AdminOnly()](file:///c:/project/trivia-api/internal/middleware/auth_middleware.go#98-123) ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ admin
- [RequireCSRF()](file:///c:/project/trivia-api/internal/middleware/auth_middleware.go#124-238) ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ CSRF —Ç–æ–∫–µ–Ω–∞
- [LogRequestInfo()](file:///c:/project/trivia-api/internal/middleware/auth_middleware.go#239-250) ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### 2. ParamMiddleware ([param_middleware.go](file:///c:/project/trivia-api/internal/middleware/param_middleware.go) - 30 —Å—Ç—Ä–æ–∫)
- `ExtractUintParam()` ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ uint –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ URL

---

## üì° API Endpoints (–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫)

### Public
| Method | Endpoint | Handler |
|--------|----------|---------|
| POST | /api/auth/register | AuthHandler.Register |
| POST | /api/auth/login | AuthHandler.Login |
| POST | /api/auth/refresh | AuthHandler.RefreshToken |
| POST | /api/auth/check-refresh | AuthHandler.CheckRefreshToken |
| POST | /api/auth/token-info | AuthHandler.GetTokenInfo |
| GET | /api/leaderboard | UserHandler.GetLeaderboard |
| GET | /api/quizzes | QuizHandler.ListQuizzes |
| GET | /api/quizzes/active | QuizHandler.GetActiveQuiz |
| GET | /api/quizzes/scheduled | QuizHandler.GetScheduledQuizzes |
| GET | /api/quizzes/:id | QuizHandler.GetQuiz |
| GET | /api/quizzes/:id/with-questions | QuizHandler.GetQuizWithQuestions |
| GET | /api/quizzes/:id/results | QuizHandler.GetQuizResults |
| GET | /ws | WSHandler.HandleConnection |

### Requires Auth
| Method | Endpoint | Handler |
|--------|----------|---------|
| GET | /api/auth/csrf | AuthHandler.GetCSRFToken |
| GET | /api/users/me | AuthHandler.GetMe |
| GET | /api/quizzes/:id/my-result | QuizHandler.GetUserQuizResult |

### Requires Auth + CSRF
| Method | Endpoint | Handler |
|--------|----------|---------|
| POST | /api/auth/logout | AuthHandler.Logout |
| POST | /api/auth/logout-all | AuthHandler.LogoutAllDevices |
| GET | /api/auth/sessions | AuthHandler.GetActiveSessions |
| POST | /api/auth/revoke-session | AuthHandler.RevokeSession |
| POST | /api/auth/change-password | AuthHandler.ChangePassword |
| POST | /api/auth/ws-ticket | AuthHandler.GenerateWsTicket |
| PUT | /api/users/me | AuthHandler.UpdateProfile |

### Admin Only (Auth + Admin + CSRF)
| Method | Endpoint | Handler |
|--------|----------|---------|
| POST | /api/auth/admin/reset-auth | AuthHandler.ResetAuth |
| POST | /api/auth/admin/debug-token | AuthHandler.DebugToken |
| POST | /api/auth/admin/reset-password | AuthHandler.AdminResetPassword |
| POST | /api/quizzes | QuizHandler.CreateQuiz |
| POST | /api/quizzes/:id/questions | QuizHandler.AddQuestions |
| PUT | /api/quizzes/:id/schedule | QuizHandler.ScheduleQuiz |
| PUT | /api/quizzes/:id/cancel | QuizHandler.CancelQuiz |
| POST | /api/quizzes/:id/duplicate | QuizHandler.DuplicateQuiz |

### Admin Only (Auth + Admin, no CSRF - GET only)
| Method | Endpoint | Handler |
|--------|----------|---------|
| GET | /admin/ws/metrics | ws.WebSocketMetricsHandler |
| GET | /admin/ws/metrics/detailed | ws.DetailedWebSocketMetricsHandler |
| GET | /admin/ws/metrics/prometheus | ws.PrometheusMetricsHandler |
| GET | /admin/ws/health | ws.WebSocketHealthCheckHandler |
| GET | /admin/ws/alerts | ws.WebSocketSystemAlertsHandler |

---

## üéÆ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã

### üí∞ –°—É—Ç—å –∏–≥—Ä—ã
**Trivia** ‚Äî —ç—Ç–æ real-time –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ —Å –¥–µ–Ω–µ–∂–Ω—ã–º–∏ –ø—Ä–∏–∑–∞–º–∏. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –ö—Ç–æ –æ—à–∏–±—Å—è ‚Äî –≤—ã–±—ã–≤–∞–µ—Ç. –û—Å—Ç–∞–≤—à–∏–µ—Å—è –¥–µ–ª—è—Ç –ø—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥.

---

### üèÜ –ü—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–ò—Å—Ç–æ—á–Ω–∏–∫** | –ó–∞–¥–∞—ë—Ç—Å—è –∞–¥–º–∏–Ω–æ–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã |
| **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** | –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º–∏ |
| **–ü–æ–±–µ–¥–∏—Ç–µ–ª—å** | –¢–æ—Ç, –∫—Ç–æ –æ—Ç–≤–µ—Ç–∏–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞ –í–°–ï –≤–æ–ø—Ä–æ—Å—ã |
| **–ï—Å–ª–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –Ω–µ—Ç** | –§–æ–Ω–¥ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –≤–∏–∫—Ç–æ—Ä–∏–Ω—É |

---

### üìã –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã

```mermaid
stateDiagram-v2
    [*] --> scheduled: CreateQuiz
    scheduled --> scheduled: ScheduleQuiz
    scheduled --> announcement: AutoFill (–∑–∞ 2 –º–∏–Ω)
    announcement --> waiting_room: (–∑–∞ 5 –º–∏–Ω)
    waiting_room --> countdown: (–∑–∞ 60 —Å–µ–∫)
    countdown --> in_progress: QuizStart
    in_progress --> in_progress: NextQuestion
    in_progress --> completed: AllQuestionsAnswered
    completed --> [*]: DetermineWinners
    scheduled --> cancelled: CancelQuiz
```

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `scheduled` | –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ —Å–æ–∑–¥–∞–Ω–∞, –∂–¥—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å—Ç–∞—Ä—Ç–∞ |
| `announcement` | –ê–Ω–æ–Ω—Å –∑–∞ 5 –º–∏–Ω—É—Ç –¥–æ —Å—Ç–∞—Ä—Ç–∞ |
| `waiting_room` | –ó–∞–ª –æ–∂–∏–¥–∞–Ω–∏—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è |
| `countdown` | –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç 60 —Å–µ–∫—É–Ω–¥ |
| `in_progress` | –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∏–¥—ë—Ç, –≤–æ–ø—Ä–æ—Å—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è |
| `completed` | –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥—Å—á–∏—Ç–∞–Ω—ã |
| `cancelled` | –û—Ç–º–µ–Ω–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º |

---

### üë§ –ü—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (User Flow)

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–õ–æ–≥–∏–Ω** ‚Üí –ø–æ–ª—É—á–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã
2. **–ü–æ–ª—É—á–∞–µ—Ç WS Ticket** ‚Üí POST /api/auth/ws-ticket (—Ç—Ä–µ–±—É–µ—Ç Auth + CSRF)
3. **–ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ WebSocket** ‚Üí /ws?token=...
4. **–ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—É** ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `{"type": "ready", "quiz_id": 123}`
5. **–ñ–¥—ë—Ç –≤ –∑–∞–ª–µ –æ–∂–∏–¥–∞–Ω–∏—è** ‚Üí –ø–æ–ª—É—á–∞–µ—Ç countdown
6. **–ü–æ–ª—É—á–∞–µ—Ç –≤–æ–ø—Ä–æ—Å** ‚Üí `question` —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–∞–π–º–µ—Ä–æ–º
7. **–û—Ç–≤–µ—á–∞–µ—Ç** ‚Üí `{"type": "answer", "question_id": 1, "selected_option": 2}`
8. **–ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ** ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç
9. **–ï—Å–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ** ‚Üí `eliminated` —Å–æ–æ–±—â–µ–Ω–∏–µ, –Ω–∞–±–ª—é–¥–∞–µ—Ç
10. **–ü–æ—Å–ª–µ –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤** ‚Üí `quiz_ended` —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

---

### üéØ –õ–æ–≥–∏–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤** | 4 (–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è 0-3) |
| **–í—Ä–µ–º—è –Ω–∞ –æ—Ç–≤–µ—Ç** | –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10 —Å–µ–∫) |
| **–û—á–∫–∏ –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π** | 1 |
| **–û—á–∫–∏ –∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π** | 0 |
| **–û—Ç–≤–µ—Ç –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏** | –í—ã–±—ã–≤–∞–Ω–∏–µ |

---

### ‚ùå –°–∏—Å—Ç–µ–º–∞ –≤—ã–±—ã–≤–∞–Ω–∏—è

| –ü—Ä–∏—á–∏–Ω–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---------|-----------|
| –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç | `IsEliminated = true` |
| –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ | `IsEliminated = true` |
| –ù–µ –æ—Ç–ø—Ä–∞–≤–∏–ª –æ—Ç–≤–µ—Ç | `IsEliminated = true` |

**–ü–æ—Å–ª–µ –≤—ã–±—ã–≤–∞–Ω–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç `eliminated` —Å–æ–æ–±—â–µ–Ω–∏–µ
- –ù–µ –º–æ–∂–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
- –ú–æ–∂–µ—Ç –Ω–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω–æ–π

---

### üì° WebSocket —Å–æ–æ–±—â–µ–Ω–∏—è

#### –û—Ç –∫–ª–∏–µ–Ω—Ç–∞ ‚Üí –°–µ—Ä–≤–µ—Ä:
| –¢–∏–ø | Payload | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|---------|----------|
| `ready` | `{quiz_id}` | –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—É |
| `answer` | `{question_id, selected_option}` | –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å |

#### –û—Ç —Å–µ—Ä–≤–µ—Ä–∞ ‚Üí –ö–ª–∏–µ–Ω—Ç:
| –¢–∏–ø | –ö–æ–≥–¥–∞ | –°–æ–¥–µ—Ä–∂–∏—Ç |
|-----|-------|----------|
| `announcement` | –ó–∞ 5 –º–∏–Ω –¥–æ —Å—Ç–∞—Ä—Ç–∞ | quiz_id, title, scheduled_time |
| `waiting_room` | –û—Ç–∫—Ä—ã—Ç–∏–µ –∑–∞–ª–∞ –æ–∂–∏–¥–∞–Ω–∏—è | participants_count |
| `countdown` | –ó–∞ 60 —Å–µ–∫ –¥–æ —Å—Ç–∞—Ä—Ç–∞ | seconds_remaining |
| `quiz_started` | –°—Ç–∞—Ä—Ç –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã | quiz_id, total_questions |
| `question` | –ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å | question_id, text, options, time_limit |
| `answer_result` | –ü–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ | is_correct, correct_option |
| `eliminated` | –ü—Ä–∏ –≤—ã–±—ã–≤–∞–Ω–∏–∏ | reason |
| `question_ended` | –ö–æ–Ω–µ—Ü –≤—Ä–µ–º–µ–Ω–∏ –≤–æ–ø—Ä–æ—Å–∞ | correct_option, stats |
| `quiz_ended` | –ö–æ–Ω–µ—Ü –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã | winners, prize_per_winner |
| `leaderboard_update` | –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ | top_players |

---

### üñ•Ô∏è –≠–∫—Ä–∞–Ω—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

| –≠–∫—Ä–∞–Ω | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| **–ì–ª–∞–≤–Ω–∞—è** | –°–ø–∏—Å–æ–∫ –≤–∏–∫—Ç–æ—Ä–∏–Ω, –±–ª–∏–∂–∞–π—à–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è |
| **–ó–∞–ª –æ–∂–∏–¥–∞–Ω–∏—è** | –°—á—ë—Ç—á–∏–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç |
| **–ò–≥—Ä–∞** | –í–æ–ø—Ä–æ—Å, –≤–∞—Ä–∏–∞–Ω—Ç—ã, —Ç–∞–π–º–µ—Ä |
| **–í—ã–±—ã–≤–∞–Ω–∏–µ** | –°–æ–æ–±—â–µ–Ω–∏–µ "–í—ã –≤—ã–±—ã–ª–∏", –º–æ–∂–Ω–æ –Ω–∞–±–ª—é–¥–∞—Ç—å |
| **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã** | –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏, —Å—É–º–º–∞ –ø—Ä–∏–∑–∞ |
| **–õ–∏–¥–µ—Ä–±–æ—Ä–¥** | –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –ø–æ–±–µ–¥–∞–º/–ø—Ä–∏–∑–∞–º |

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã

| –ú–µ—Ö–∞–Ω–∏–∑–º | –ó–∞—â–∏—Ç–∞ |
|----------|--------|
| **WS Ticket** | –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π —Ç–æ–∫–µ–Ω –Ω–∞ 60 —Å–µ–∫ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
| **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è** | –û–¥–∏–Ω –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏** | –°–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞ |
| **CSRF** | –ó–∞—â–∏—Ç–∞ –≤—Å–µ—Ö –º—É—Ç–∏—Ä—É—é—â–∏—Ö endpoint'–æ–≤ |
| **Rate limiting** | –ù–∞ —É—Ä–æ–≤–Ω–µ WebSocket –±—É—Ñ–µ—Ä–æ–≤ |

---

## üìã Database Schema (–∏–∑ –º–∏–≥—Ä–∞—Ü–∏–π)

```sql
-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
users, quizzes, questions, results, user_answers

-- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
refresh_tokens, invalid_tokens, jwt_keys

-- –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è refresh_tokens
token, device_id, ip_address, user_agent, expires_at, 
is_expired, revoked_at, reason

-- JWT Keys —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º
id, key (encrypted), algorithm, is_active, expires_at, rotated_at
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –∏ TODO

### –ö–æ–¥ –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –æ—Ç–∫–ª—é—á—ë–Ω–Ω—ã–π:
1. **`ResultService.ProcessUserAnswer`** ‚Äî –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω, –ª–æ–≥–∏–∫–∞ –≤ [AnswerProcessor](file:///c:/project/trivia-api/internal/service/quizmanager/answer_processor.go#15-22)
2. **`Question.CalculatePoints`** ‚Äî —É–ø—Ä–æ—â—ë–Ω –¥–æ 1/0, —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ —Å –±–æ–Ω—É—Å–æ–º –∑–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞

### TODO –≤ –∫–æ–¥–µ:
1. [user_handler.go](file:///c:/project/trivia-api/internal/handler/user_handler.go): "–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã UserHandler"
2. [user_service.go](file:///c:/project/trivia-api/internal/service/user_service.go): "–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã UserService"
3. ~~[errors.go](file:///c:/project/trivia-api/internal/service/errors.go): "–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å—é–¥–∞ –¥—Ä—É–≥–∏–µ –æ–±—â–∏–µ –æ—à–∏–±–∫–∏"~~ ‚Äî —Ç–µ—Ö–¥–æ–ª–≥, –¥—É–±–ª–∏–∫–∞—Ç—ã –æ—Å—Ç–∞–≤–ª–µ–Ω—ã

### ~~–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –≤–Ω–∏–º–∞–Ω–∏—è~~ ‚Üí –ò–°–ü–†–ê–í–õ–ï–ù–û:
1. ~~**–î–≤–æ–π–Ω–æ–π –∫–æ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ PubSub** –≤ main.go (—Å—Ç—Ä–æ–∫–∏ 136-153 –∏ 206-231) ‚Äî –≤—Ç–æ—Ä–æ–π –±–ª–æ–∫ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω~~ ‚Äî ‚úÖ –£–î–ê–õ–Å–ù –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥ (Stage 9)
2. **CORS**: –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã origins (localhost, vercel) ‚Äî –æ—Å—Ç–∞–≤–ª–µ–Ω–æ –∫–∞–∫ —Ç–µ—Ö–¥–æ–ª–≥
3. ~~**Secure cookies**: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `gin.Mode()`~~ ‚Äî ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —Ö–æ–¥–µ –∞—É–¥–∏—Ç–∞ (Stages 1-10):

| –≠—Ç–∞–ø | –§–∞–π–ª | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |
|------|------|-------------|
| Stage 5 | `converter.go` | –ò–∑–º–µ–Ω–µ–Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å 1-based –Ω–∞ 0-based |
| Stage 5 | `quiz_handler.go` | –£–¥–∞–ª—ë–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ `GetQuiz` |
| Stage 7 | `client.go` | –î–æ–±–∞–≤–ª–µ–Ω `maxBufferWarnings` + conditional debug logging |
| Stage 7 | `shard.go` | –£–¥–∞–ª—ë–Ω `ClientStore` interface, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã |
| Stage 8 | `jwt.go` | –£–¥–∞–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `min()`, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω context usage |
| Stage 8 | `jwt.go` | –£–¥–∞–ª—ë–Ω –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–ª–æ–∫ DB-–ø—Ä–æ–≤–µ—Ä–∫–∏ |
| Stage 9 | `main.go` | –£–¥–∞–ª—ë–Ω –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥ (~25 —Å—Ç—Ä–æ–∫) |
| Stage 9 | `main.go` | –î–æ–±–∞–≤–ª–µ–Ω—ã `ReadTimeout`/`WriteTimeout` |
| Stage 9 | `config.go` | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ debug —Ä–µ–∂–∏–º–µ |
| Stage 9 | `config.yaml` | –£–¥–∞–ª—ë–Ω hardcoded –ø–∞—Ä–æ–ª—å |

---

## üìà –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **production-grade MVP** —Å:
- ‚úÖ Clean Architecture
- ‚úÖ Dependency Injection
- ‚úÖ JWT —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –∫–ª—é—á–µ–π
- ‚úÖ CSRF –∑–∞—â–∏—Ç–∞
- ‚úÖ Real-time WebSocket —Å —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ Redis Pub/Sub –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ Graceful shutdown
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ HTTP —Ç–∞–π–º-–∞—É—Ç—ã (Slowloris –∑–∞—â–∏—Ç–∞)
- ‚úÖ Connection pooling PostgreSQL (25 max)

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:** 100% ‚úÖ  
**–ê—É–¥–∏—Ç –≤—Å–µ—Ö 10 —ç—Ç–∞–ø–æ–≤ –∑–∞–≤–µ—Ä—à—ë–Ω:** 2026-01-20

---

## üìã History

| –î–∞—Ç–∞ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| 2026-01-29 | **Frontend**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è TanStack Query v5 –¥–ª—è data-fetching. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `games_played`, `wins_count`, `total_score`, `total_prize_won` –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã. –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã: `QueryProvider.tsx`, `useUserQuery.ts` |
| 2026-01-29 | `quiz_manager.go`: –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `PlayerCount` –≤ `QuizStateResponse`. `GetCurrentState()` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ —á–µ—Ä–µ–∑ `wsManager.GetSubscriberCount()` |
| 2026-01-20 | –ê—É–¥–∏—Ç –∑–∞–≤–µ—Ä—à—ë–Ω (Stages 1-10) |

