# üìã –ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞ Trivia API –¥–ª—è –∞–≥–µ–Ω—Ç–∞

---

## A) –ö–∞—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞

| # | –ü—É—Ç—å | –ß—Ç–æ —ç—Ç–æ | –ó–æ–Ω–∞ —Ä–∏—Å–∫–∞ |
|---|------|---------|------------|
| 1 | `cmd/api/main.go` | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, DI, —Ä–æ—É—Ç–∏–Ω–≥, graceful shutdown | –í—ã—Å–æ–∫–∞—è ‚Äî –ø–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫—Ä–∏—Ç–∏—á–µ–Ω |
| 2 | `config/config.yaml` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ø–æ—Ä—Ç—ã, —Ç–∞–π–º–∞—É—Ç—ã, WebSocket) | –°—Ä–µ–¥–Ω—è—è ‚Äî —Å–µ–∫—Ä–µ—Ç—ã —á–µ—Ä–µ–∑ ENV |
| 3 | `internal/handler/` | HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (auth, quiz, user, ws) | –í—ã—Å–æ–∫–∞—è ‚Äî auth_handler.go 907 —Å—Ç—Ä–æ–∫ |
| 4 | `internal/service/` | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (auth, quiz, result, quizmanager) | –í—ã—Å–æ–∫–∞—è ‚Äî quizmanager/* —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞–º–∏ |
| 5 | `internal/repository/postgres/` | PostgreSQL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (7 —Ñ–∞–π–ª–æ–≤) | –°—Ä–µ–¥–Ω—è—è ‚Äî SQL —á–µ—Ä–µ–∑ GORM |
| 6 | `internal/repository/redis/` | Redis –∫–µ—à | –ù–∏–∑–∫–∞—è |
| 7 | `internal/domain/entity/` | Domain entities (8 —Å—É—â–Ω–æ—Å—Ç–µ–π) | –°—Ä–µ–¥–Ω—è—è ‚Äî –º–µ—Ç–æ–¥—ã BeforeSave, CheckPassword |
| 8 | `internal/domain/repository/` | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ | –ù–∏–∑–∫–∞—è ‚Äî —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã |
| 9 | `internal/websocket/` | WebSocket –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞ (9 —Ñ–∞–π–ª–æ–≤) | **–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è** ‚Äî sharding, pub/sub, concurrency |
| 10 | `pkg/auth/jwt.go` | JWT —Å–µ—Ä–≤–∏—Å (662 —Å—Ç—Ä–æ–∫–∏) | –í—ã—Å–æ–∫–∞—è ‚Äî —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π, –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è |
| 11 | `pkg/auth/manager/token_manager.go` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏ (860 —Å—Ç—Ä–æ–∫) | –í—ã—Å–æ–∫–∞—è ‚Äî CSRF, cookies, —Å–µ—Å—Å–∏–∏ |
| 12 | `migrations/` | 10 –ø–∞—Ä –º–∏–≥—Ä–∞—Ü–∏–π (up/down) | –í—ã—Å–æ–∫–∞—è ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –ë–î |

---

## B) –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å

### –ü—Ä–æ—Ü–µ—Å—Å: –ü–ª–∞–Ω ‚Üí –ò–∑–º–µ–Ω–µ–Ω–∏—è ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∏ ‚Üí –†–µ–∑—é–º–µ

1. **–ü—Ä–æ—á–∏—Ç–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç**
   - –û—Ç–∫—Ä–æ–π `trivia_api_full_report.md.resolved` ‚Äî –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
   - –û—Ç–∫—Ä–æ–π audit-—Ñ–∞–π–ª—ã (`stage_*_audit.md.resolved`) –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è —Ä–µ—à–µ–Ω–∏–π

2. **–°–æ—Å—Ç–∞–≤—å –ø–ª–∞–Ω**
   - –û–ø–∏—à–∏ –ß–¢–û –º–µ–Ω—è–µ—à—å –∏ –ó–ê–ß–ï–ú
   - –£–∫–∞–∂–∏ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã
   - –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞—Å–∞–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏–π ‚Äî —É–∫–∞–∂–∏ —è–≤–Ω–æ

3. **–í–Ω–æ—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è**
   - –û–¥–Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∞—è –µ–¥–∏–Ω–∏—Ü–∞ –∑–∞ —Ä–∞–∑
   - –°–ª–µ–¥—É–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º (—Å–º. —Ä–∞–∑–¥–µ–ª E)

4. **–ü—Ä–æ–≤–µ—Ä—å**
   - –ó–∞–ø—É—Å—Ç–∏ `go build ./cmd/api` ‚Äî –¥–æ–ª–∂–Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è
   - –ó–∞–ø—É—Å—Ç–∏ `go test ./...` ‚Äî —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å
   - –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª WebSocket –∏–ª–∏ auth ‚Äî –ø—Ä–æ–≤–µ—Ä—å –≤—Ä—É—á–Ω—É—é

5. **–†–µ–∑—é–º–∏—Ä—É–π**
   - –ö—Ä–∞—Ç–∫–æ: —á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ

---

## C) –ö–æ–º–∞–Ω–¥—ã

| –î–µ–π—Å—Ç–≤–∏–µ | –ö–æ–º–∞–Ω–¥–∞ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|----------|---------|------------|
| **Install** | `go mod download` –∏–ª–∏ `make init` | |
| **Dev** | `go run ./cmd/api` –∏–ª–∏ `make run` | –¢—Ä–µ–±—É–µ—Ç PostgreSQL + Redis |
| **Build** | `go build -o trivia-api ./cmd/api` –∏–ª–∏ `make build` | |
| **Test** | `go test -v ./...` –∏–ª–∏ `make test` | –¢–æ–ª—å–∫–æ 1 —Ç–µ—Å—Ç-—Ñ–∞–π–ª: `quiz_manager_test.go` |
| **Lint** | `go vet ./...` | –ù–µ—Ç golangci-lint –∫–æ–Ω—Ñ–∏–≥–∞. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `.golangci.yml` |
| **Typecheck** | `go build ./...` | Go ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω |
| **Docker** | `docker-compose up -d` | –ü–æ–¥–Ω–∏–º–∞–µ—Ç app + postgres + redis |
| **Migrate** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ | –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (`MigrateDB()` –≤ `main.go`) |

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
DATABASE_PASSWORD    # –ü–∞—Ä–æ–ª—å PostgreSQL (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
DB_JWT_KEY_ENCRYPTION_KEY  # AES-–∫–ª—é—á –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è JWT-–∫–ª—é—á–µ–π –≤ –ë–î (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
GIN_MODE=release     # Production —Ä–µ–∂–∏–º
```

---

## D) Quality Gates / Definition of Done

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å |
|----------|-------------|---------------|
| –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è | ‚úÖ | `go build ./cmd/api` –±–µ–∑ –æ—à–∏–±–æ–∫ |
| –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç | ‚úÖ | `go test ./...` ‚Äî 0 failures |
| –ù–µ—Ç panic –≤ runtime | ‚úÖ | –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ |
| –ú–∏–≥—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞—Ç–∏–º—ã | ‚úÖ (–µ—Å–ª–∏ –µ—Å—Ç—å) | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ .down.sql |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ | ‚úÖ | –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã, —Ç–æ–∫–µ–Ω—ã, –ø–∞—Ä–æ–ª–∏ |
| Graceful shutdown | ‚úÖ (–µ—Å–ª–∏ –º–µ–Ω—è–µ—à—å main.go) | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–≥–Ω–∞–ª—ã SIGINT/SIGTERM |

### –ß–µ–≥–æ –ù–ï —Ö–≤–∞—Ç–∞–µ—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
- CI/CD pipeline (`.github/workflows/`, `.gitlab-ci.yml`) ‚Äî –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- Lint –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`.golangci.yml`) ‚Äî –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞  
- Integration tests ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
- API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (Swagger/OpenAPI) ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

---

## E) –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∏ —Ç–∞–±—É

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **Clean Architecture**: Handler ‚Üí Service ‚Üí Repository ‚Üí Entity
- **Dependency Injection**: —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤, —Å–±–æ—Ä–∫–∞ –≤ `main.go`
- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã**: –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –≤ `internal/domain/repository/`, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ `internal/repository/`

### –ö–æ–Ω–≤–µ–Ω—Ü–∏–∏ –∫–æ–¥–∞
- –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤: `snake_case.go`
- –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä/—Ñ—É–Ω–∫—Ü–∏–π: `PascalCase` (—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ), `camelCase` (–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ)
- –û—à–∏–±–∫–∏: –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫–∞–∫ `error`, –Ω–µ panic
- –ö–æ–Ω—Ç–µ–∫—Å—Ç: –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `context.Context` –ø–µ—Ä–≤—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º

### üö´ –¢–∞–±—É

| –ù–µ–ª—å–∑—è | –ü–æ—á–µ–º—É |
|--------|--------|
| –•–∞—Ä–¥–∫–æ–¥–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–¥–µ/–∫–æ–Ω—Ñ–∏–≥–µ | –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ ENV |
| –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã, –ø–∞—Ä–æ–ª–∏, –∫–ª—é—á–∏ | –£—Ç–µ—á–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ |
| –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ (`_ = err`) | –°–∫—Ä—ã—Ç—ã–µ –±–∞–≥–∏ |
| –ú–µ–Ω—è—Ç—å —Å—Ö–µ–º—É –ë–î –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏ | –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö |
| –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ WebSocket goroutines | –î–µ–¥–ª–æ–∫–∏, —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `panic` –¥–ª—è –±–∏–∑–Ω–µ—Å-–æ—à–∏–±–æ–∫ | –¢–æ–ª—å–∫–æ –¥–ª—è –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ |

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **JWT**: —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π —á–µ—Ä–µ–∑ `jwt_keys` —Ç–∞–±–ª–∏—Ü—É
- **CSRF**: Double Submit Cookie –¥–ª—è –º—É—Ç–∏—Ä—É—é—â–∏—Ö endpoints
- **–ü–∞—Ä–æ–ª–∏**: bcrypt, –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `user.CheckPassword()`
- **WS Ticket**: –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π, 60 —Å–µ–∫—É–Ω–¥ TTL
- **Cookies**: `Secure=true` –≤ production (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç `GIN_MODE`)

### –ú–∏–≥—Ä–∞—Ü–∏–∏
- –ù—É–º–µ—Ä–∞—Ü–∏—è: `000XXX_description.up.sql` / `.down.sql`
- –ü—Ä–æ–≤–µ—Ä—è–π –æ–±—Ä–∞—Ç–∏–º–æ—Å—Ç—å: down-–º–∏–≥—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å up
- –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: 10 (000010_create_jwt_keys_table)

### –ë–æ–ª—å—à–∏–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä—ã
- –ï—Å–ª–∏ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—à—å >3 —Ñ–∞–π–ª–æ–≤ ‚Äî —Ä–∞–∑–±–µ–π –Ω–∞ —ç—Ç–∞–ø—ã
- WebSocket –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞: –æ—á–µ–Ω—å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ, –º–Ω–æ–≥–æ concurrency
- `auth_handler.go` (907 —Å—Ç—Ä–æ–∫): –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª, –∏–∑–º–µ–Ω—è–π —Ç–æ—á–µ—á–Ω–æ

---

## F) –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Context7

| –°–∏—Ç—É–∞—Ü–∏—è | –ù—É–∂–µ–Ω Context7? | –ü—Ä–∏–º–µ—Ä |
|----------|-----------------|--------|
| –†–∞–±–æ—Ç–∞ —Å Gin API | ‚úÖ –î–∞ | `gin.Context`, middleware, routing |
| –†–∞–±–æ—Ç–∞ —Å GORM | ‚úÖ –î–∞ | –ú–∏–≥—Ä–∞—Ü–∏–∏, hooks, associations |
| –†–∞–±–æ—Ç–∞ —Å Redis | ‚úÖ –î–∞ | go-redis/v8 API |
| –†–∞–±–æ—Ç–∞ —Å JWT | ‚úÖ –î–∞ | golang-jwt/jwt/v4 |
| –†–∞–±–æ—Ç–∞ —Å WebSocket | ‚úÖ –î–∞ | gorilla/websocket |
| –†–∞–±–æ—Ç–∞ —Å Viper | ‚úÖ –î–∞ | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, ENV binding |
| –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ | ‚ùå –ù–µ—Ç | –≠—Ç–æ –Ω–∞—à –∫–æ–¥ |
| –°—Ö–µ–º–∞ –ë–î –ø—Ä–æ–µ–∫—Ç–∞ | ‚ùå –ù–µ—Ç | –°–º–æ—Ç—Ä–∏ migrations/ –∏ entities |

### Library IDs –¥–ª—è Context7
```
/gin-gonic/gin
/go-gorm/gorm
/go-redis/go-redis
/gorilla/websocket
/golang-jwt/jwt
/spf13/viper
/stretchr/testify
/golang-migrate/migrate
```

---

## –ö—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞: –ß—Ç–æ –≥–¥–µ –∏—Å–∫–∞—Ç—å

| –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ | –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å |
|-------------|--------------|
| –í—Å–µ endpoints | `cmd/api/main.go` (—Ä–æ—É—Ç–∏–Ω–≥) |
| –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã | `internal/service/quizmanager/` |
| –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è | `internal/handler/auth_handler.go`, `pkg/auth/` |
| WebSocket –ª–æ–≥–∏–∫–∞ | `internal/websocket/`, `internal/handler/ws_handler.go` |
| –°—Ö–µ–º–∞ –ë–î | `migrations/` (SQL), `internal/domain/entity/` (Go) |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | `config/config.yaml`, `internal/config/config.go` |


