# üìã –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã ‚Äî –ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ñ—É–Ω–∫—Ü–∏–π

> **–î–∞—Ç–∞:** 10.02.2026  
> **–í–µ—Ä—Å–∏—è:** –∞–∫—Ç—É–∞–ª—å–Ω–∞—è (–ø–æ –∫–æ–¥—É –Ω–∞ –í–ú)  
> **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –æ–ø–∏—Å–∞–Ω–∏–µ –í–°–ï–• —Ñ—É–Ω–∫—Ü–∏–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –≤–∏–∫—Ç–æ—Ä–∏–Ω–æ–π, –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º

---

## üìñ –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–°—É—â–Ω–æ—Å—Ç–∏ (—á—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –±–∞–∑–µ)](#1-—Å—É—â–Ω–æ—Å—Ç–∏)
2. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω–æ–π (CRUD)](#2-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–≤–∏–∫—Ç–æ—Ä–∏–Ω–æ–π)
3. [–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (Scheduler)](#3-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫)
4. [–ú–µ–Ω–µ–¥–∂–µ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤ (QuestionManager)](#4-–º–µ–Ω–µ–¥–∂–µ—Ä-–≤–æ–ø—Ä–æ—Å–æ–≤)
5. [–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏](#5-–∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è-—Å–∏—Å—Ç–µ–º–∞-—Å–ª–æ–∂–Ω–æ—Å—Ç–∏)
6. [–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–æ–≤ (AnswerProcessor)](#6-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫-–æ—Ç–≤–µ—Ç–æ–≤)
7. [–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã (QuizManager)](#7-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä-–≤–∏–∫—Ç–æ—Ä–∏–Ω—ã)
8. [–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø—Ä–∏–∑—ã (ResultService)](#8-—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã-–∏-–ø—Ä–∏–∑—ã)
9. [WebSocket ‚Äî –æ–±—â–µ–Ω–∏–µ —Å –∏–≥—Ä–æ–∫–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏](#9-websocket)
10. [–ü—É–ª –≤–æ–ø—Ä–æ—Å–æ–≤ (–∞–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–∏)](#10-–ø—É–ª-–≤–æ–ø—Ä–æ—Å–æ–≤)
11. [–ü–æ–ª–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ –ø—Ä–∏–∑–æ–≤](#11-–ø–æ–ª–Ω–∞—è-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

---

## 1. –°—É—â–Ω–æ—Å—Ç–∏

–≠—Ç–æ ¬´–º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö¬ª ‚Äî —Ç–æ, —á—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

### Quiz (–í–∏–∫—Ç–æ—Ä–∏–Ω–∞)
| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `ID` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã |
| `Title` | –ù–∞–∑–≤–∞–Ω–∏–µ (–º–∞–∫—Å. 100 —Å–∏–º–≤–æ–ª–æ–≤) |
| `Description` | –û–ø–∏—Å–∞–Ω–∏–µ (–º–∞–∫—Å. 500 —Å–∏–º–≤–æ–ª–æ–≤) |
| `ScheduledTime` | –î–∞—Ç–∞/–≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ |
| `Status` | –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: `scheduled`, `in_progress`, `completed`, `cancelled` |
| `QuestionCount` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ |
| `PrizeFund` | –ü—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 000 000 ‚Ç∏) |

**–ú–µ—Ç–æ–¥—ã:**
- **`IsActive()`** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true`, –µ—Å–ª–∏ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ —Å–µ–π—á–∞—Å –∏–¥—ë—Ç (`in_progress`)
- **`IsScheduled()`** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true`, –µ—Å–ª–∏ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞
- **`IsCompleted()`** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true`, –µ—Å–ª–∏ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

---

### Question (–í–æ–ø—Ä–æ—Å)
| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `ID` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞ |
| `QuizID` | –ö –∫–∞–∫–æ–π –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω. –ï—Å–ª–∏ `NULL` ‚Äî –≤–æ–ø—Ä–æ—Å –∏–∑ **–æ–±—â–µ–≥–æ –ø—É–ª–∞** |
| `Text` | –¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ (—Ä—É—Å—Å–∫–∏–π) |
| `TextKK` | –¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ (–∫–∞–∑–∞—Ö—Å–∫–∏–π, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `Options` | –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ (—Ä—É—Å—Å–∫–∏–π), —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ JSONB |
| `OptionsKK` | –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ (–∫–∞–∑–∞—Ö—Å–∫–∏–π, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `CorrectOption` | –ò–Ω–¥–µ–∫—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (0, 1, 2...). **–°–∫—Ä—ã—Ç –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞** |
| `TimeLimitSec` | –õ–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –æ—Ç–≤–µ—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10) |
| `PointValue` | –û—á–∫–∏ –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10) |
| `Difficulty` | –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç 1 –¥–æ 5 (1 = –æ—á–µ–Ω—å –ª–µ–≥–∫–æ, 5 = –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ) |
| `IsUsed` | –§–ª–∞–≥: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ª–∏ –≤–æ–ø—Ä–æ—Å —Ä–∞–Ω–µ–µ (–¥–ª—è –ø—É–ª–∞) |

**–ú–µ—Ç–æ–¥—ã:**
- **`IsCorrect(selectedOption)`** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º
- **`CalculatePoints(isCorrect, responseTimeMs)`** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 1 –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, 0 –∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- **`IsValidOption(selectedOption)`** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∏–Ω–¥–µ–∫—Å –æ–ø—Ü–∏–∏ –≤ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö
- **`GetLocalizedText(lang)`** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ –Ω—É–∂–Ω–æ–º —è–∑—ã–∫–µ (`"kk"` ‚Üí –∫–∞–∑–∞—Ö—Å–∫–∏–π, –∏–Ω–∞—á–µ —Ä—É—Å—Å–∫–∏–π)
- **`GetLocalizedOptions(lang)`** ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞

---

### UserAnswer (–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `UserID` | –ö—Ç–æ –æ—Ç–≤–µ—Ç–∏–ª |
| `QuizID` | –í –∫–∞–∫–æ–π –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ |
| `QuestionID` | –ù–∞ –∫–∞–∫–æ–π –≤–æ–ø—Ä–æ—Å |
| `SelectedOption` | –ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã–±—Ä–∞–ª (`-1` = –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª) |
| `IsCorrect` | –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ |
| `ResponseTimeMs` | –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö |
| `Score` | –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –æ—á–∫–∏ |
| `IsEliminated` | –í—ã–±—ã–ª –ª–∏ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ |
| `EliminationReason` | –ü—Ä–∏—á–∏–Ω–∞ –≤—ã–±—ã—Ç–∏—è (`incorrect_answer`, `time_exceeded`, `no_answer_timeout`) |

---

### Result (–ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `UserID` / `QuizID` | –°–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üî –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ (—É–Ω–∏–∫–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞) |
| `Username` | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `Score` | –ò—Ç–æ–≥–æ–≤—ã–π —Å—á—ë—Ç |
| `CorrectAnswers` | –ß–∏—Å–ª–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ |
| `TotalQuestions` | –í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ |
| `Rank` | –ú–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ |
| `IsWinner` | –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –∏–ª–∏ –Ω–µ—Ç |
| `PrizeFund` | –ü—Ä–∏–∑ —ç—Ç–æ–º—É –∏–≥—Ä–æ–∫—É (‚Ç∏) |
| `IsEliminated` | –í—ã–±—ã–ª –ª–∏ |
| `EliminatedOnQuestion` | –ù–∞ –∫–∞–∫–æ–º –≤–æ–ø—Ä–æ—Å–µ –≤—ã–±—ã–ª |
| `EliminationReason` | –ü–æ—á–µ–º—É –≤—ã–±—ã–ª |

---

## 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω–æ–π

–§–∞–π–ª: [quiz_service.go](file:///c:/project/vmdeploy/trivia-api/internal/service/quiz_service.go)

### `CreateQuiz(title, description, scheduledTime, prizeFund)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –≤–∏–∫—Ç–æ—Ä–∏–Ω—É –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞ ‚Äî –≤ –±—É–¥—É—â–µ–º
  2. –ï—Å–ª–∏ `prizeFund` –Ω–µ —É–∫–∞–∑–∞–Ω –∏–ª–∏ ‚â§ 0 ‚Äî —Å—Ç–∞–≤–∏—Ç –¥–µ—Ñ–æ–ª—Ç –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (1 000 000 ‚Ç∏)
  3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å `scheduled`, `QuestionCount = 0`
  4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—É—é –≤–∏–∫—Ç–æ—Ä–∏–Ω—É

### `AddQuestions(quizID, questions)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –î–æ–±–∞–≤–ª—è–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ (–∞–¥–º–∏–Ω–æ–º –≤—Ä—É—á–Ω—É—é).
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –≤ —Å—Ç–∞—Ç—É—Å–µ `scheduled`
  2. –°—á–∏—Ç–∞–µ—Ç —É–∂–µ –∏–º–µ—é—â–∏–µ—Å—è –≤–æ–ø—Ä–æ—Å—ã + –Ω–æ–≤—ã–µ; –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç (10 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) ‚Üí –æ—à–∏–±–∫–∞
  3. –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å –∫ –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ —á–µ—Ä–µ–∑ `QuizID`
  4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–∞–∫–µ—Ç–æ–º –≤ –ë–î –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—á—ë—Ç—á–∏–∫ `QuestionCount`

### `ScheduleQuiz(quizID, scheduledTime)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ú–µ–Ω—è–µ—Ç –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—Ä–µ–º—è –≤ –±—É–¥—É—â–µ–º
  2. –û–±–Ω–æ–≤–ª—è–µ—Ç `ScheduledTime`
  3. –ï—Å–ª–∏ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ –±—ã–ª–∞ `completed` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ `scheduled` (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫)

### `DuplicateQuiz(originalQuizID, newScheduledTime)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–æ–∑–¥–∞—ë—Ç –∫–æ–ø–∏—é —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã —Å –Ω–æ–≤—ã–º –≤—Ä–µ–º–µ–Ω–µ–º.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª —Å–æ –≤—Å–µ–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏
  2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —É –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏ –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è –≤ –±—É–¥—É—â–µ–º
  3. **–í —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:** —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –≤–∏–∫—Ç–æ—Ä–∏–Ω—É ‚Üí –∫–æ–ø–∏—Ä—É–µ—Ç –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã (–≤–∫–ª—é—á–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏ –∫–∞–∑–∞—Ö—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥)
  4. –ü–æ–ª–µ `IsUsed` —É –∫–æ–ø–∏–π —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è ‚Äî –æ–Ω–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –Ω–æ–≤—ã–º–∏
  5. –ù–∞–∑–≤–∞–Ω–∏–µ: –æ—Ä–∏–≥–∏–Ω–∞–ª + ` (–ö–æ–ø–∏—è)`, —Å –æ–±—Ä–µ–∑–∫–æ–π –¥–æ 100 —Å–∏–º–≤–æ–ª–æ–≤

### `DeleteQuiz(quizID)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –£–¥–∞–ª—è–µ—Ç –≤–∏–∫—Ç–æ—Ä–∏–Ω—É.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ **–Ω–µ –∞–∫—Ç–∏–≤–Ω–∞** (`in_progress`), –∑–∞—Ç–µ–º —É–¥–∞–ª—è–µ—Ç.

### `GetQuizByID` / `GetActiveQuiz` / `GetScheduledQuizzes` / `ListQuizzes` / `ListQuizzesWithFilters`
- **–ß—Ç–æ –¥–µ–ª–∞—é—Ç:** –ó–∞–ø—Ä–æ—Å—ã –Ω–∞ —á—Ç–µ–Ω–∏–µ ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –ø–æ ID, –∞–∫—Ç–∏–≤–Ω–æ–π, –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö, —Å–ø–∏—Å–∫–∞ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π (–ø–æ —Å—Ç–∞—Ç—É—Å—É, –ø–æ–∏—Å–∫—É, –¥–∞—Ç–∞–º).

---

## 3. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫

–§–∞–π–ª: [scheduler.go](file:///c:/project/vmdeploy/trivia-api/internal/service/quizmanager/scheduler.go)

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ç–∞–π–º–µ—Ä—ã: –∫–æ–≥–¥–∞ —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞–º –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.

### `ScheduleQuiz(ctx, quizID, scheduledTime)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–ª–∞–Ω–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã ‚Äî —Å—Ç–∞–≤–∏—Ç —Ç–∞–π–º–µ—Ä—ã –Ω–∞ –∞–Ω–æ–Ω—Å, –∑–∞–ª –æ–∂–∏–¥–∞–Ω–∏—è, –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç –∏ —Å—Ç–∞—Ä—Ç.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—Ä–µ–º—è –≤ –±—É–¥—É—â–µ–º
  2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–∏–∫—Ç–æ—Ä–∏–Ω—É —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏
  3. –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–µ—Ç ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –æ–±—â–∏–π –ø—É–ª. –ï—Å–ª–∏ –ø—É–ª —Ç–æ–∂–µ –ø—É—Å—Ç ‚Üí –æ—à–∏–±–∫–∞
  4. –ï—Å–ª–∏ —É–∂–µ –±—ã–ª –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω —Å—Ç–∞—Ä—ã–π —Ç–∞–π–º–µ—Ä ‚Äî –æ—Ç–º–µ–Ω—è–µ—Ç –µ–≥–æ
  5. –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º (–∑–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)
  6. –ó–∞–ø—É—Å–∫–∞–µ—Ç `runQuizSequence` –≤ —Ñ–æ–Ω–µ

### `CancelQuiz(quizID)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û—Ç–º–µ–Ω—è–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–∏–∫—Ç–æ—Ä–∏–Ω—É.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ –≤ —Å—Ç–∞—Ç—É—Å–µ `scheduled`
  2. –û—Ç–º–µ–Ω—è–µ—Ç —Ç–∞–π–º–µ—Ä (–µ—Å–ª–∏ –µ—Å—Ç—å)
  3. –ú–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ –ë–î –Ω–∞ `cancelled`
  4. –†–∞—Å—Å—ã–ª–∞–µ—Ç –≤—Å–µ–º —Å–æ–±—ã—Ç–∏–µ `quiz:cancelled`

### `runQuizSequence(ctx, quiz, token)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ì–ª–∞–≤–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π –ø–µ—Ä–µ–¥ –≤–∏–∫—Ç–æ—Ä–∏–Ω–æ–π.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ –ø–æ—Ä—è–¥–∫—É):**

| –í—Ä–µ–º—è | –°–æ–±—ã—Ç–∏–µ | –§—É–Ω–∫—Ü–∏—è |
|-------|---------|---------|
| **–ó–∞ 30 –º–∏–Ω** –¥–æ –Ω–∞—á–∞–ª–∞ | üì¢ –ê–Ω–æ–Ω—Å | `triggerAnnouncement` ‚Äî —Ä–∞—Å—Å—ã–ª–∞–µ—Ç `quiz:announcement` |
| **–ó–∞ 5 –º–∏–Ω** –¥–æ –Ω–∞—á–∞–ª–∞ | üö™ –ó–∞–ª –æ–∂–∏–¥–∞–Ω–∏—è | `triggerWaitingRoom` ‚Äî —Ä–∞—Å—Å—ã–ª–∞–µ—Ç `quiz:waiting_room` |
| **–ó–∞ 60 —Å–µ–∫** –¥–æ –Ω–∞—á–∞–ª–∞ | ‚è± –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç | `triggerCountdown` ‚Äî –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É —Ä–∞—Å—Å—ã–ª–∞–µ—Ç `quiz:countdown` |
| **–í —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è** | üöÄ –°—Ç–∞—Ä—Ç | `triggerQuizStart` ‚Äî –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ `in_progress`, —Ä–∞—Å—Å—ã–ª–∞–µ—Ç `quiz:start`, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∏–≥–Ω–∞–ª –≤ `QuizManager` |

–ï—Å–ª–∏ –Ω–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ—Ç–º–µ–Ω—ë–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∏–∫—Ç–æ—Ä–∏–Ω—É –æ—Ç–º–µ–Ω–∏–ª–∏) ‚Äî –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è.

### `hasPoolQuestions()`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å –≤ –æ–±—â–µ–º –ø—É–ª–µ (–ø–æ –∫–∞–∂–¥–æ–º—É —É—Ä–æ–≤–Ω—é —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç 1 –¥–æ 5).

---

## 4. –ú–µ–Ω–µ–¥–∂–µ—Ä –≤–æ–ø—Ä–æ—Å–æ–≤

–§–∞–π–ª: [question_manager.go](file:///c:/project/vmdeploy/trivia-api/internal/service/quizmanager/question_manager.go)

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ **–¥–æ—Å—Ç–∞–≤–∫—É –≤–æ–ø—Ä–æ—Å–æ–≤** –∏–≥—Ä–æ–∫–∞–º –≤–æ –≤—Ä–µ–º—è –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã.

### `RunQuizQuestions(ctx, quizState)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª: –±–µ—Ä—ë—Ç –≤–æ–ø—Ä–æ—Å—ã –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–≥—Ä–æ–∫–∞–º.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ 10 –≤–æ–ø—Ä–æ—Å–æ–≤):**
  1. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä** ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç `SelectNextQuestion` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞ –Ω—É–∂–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
  2. –î–æ–±–∞–≤–ª—è–µ—Ç –≤–æ–ø—Ä–æ—Å –≤ —Å–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö (`usedQuestionIDs`)
  3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
  4. –ñ–¥—ë—Ç –∫–æ—Ä–æ—Ç–∫—É—é –∑–∞–¥–µ—Ä–∂–∫—É (`QuestionDelayMs` = 500–º—Å) –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º
  5. –§–∏–∫—Å–∏—Ä—É–µ—Ç —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (`sendTimeMs`)
  6. **–†–∞—Å—Å—ã–ª–∞–µ—Ç `quiz:question`** ‚Äî –≤–æ–ø—Ä–æ—Å —Å–æ –≤—Å–µ–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤ (–≤–∫–ª—é—á–∞—è –∫–∞–∑–∞—Ö—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥), –ª–∏–º–∏—Ç–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏ –Ω–æ–º–µ—Ä–æ–º
  7. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞ –≤–æ–ø—Ä–æ—Å–∞ –≤ Redis (`question:{id}:start_time`)
  8. –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–∞–π–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞ (`runQuestionTimer`)
  9. **–ñ–¥—ë—Ç `timeLimitSec` —Å–µ–∫—É–Ω–¥** ‚Äî —ç—Ç–æ –≤—Ä–µ–º—è –Ω–∞ –æ—Ç–≤–µ—Ç
  10. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –æ—Ç–≤–µ—Ç–∏–≤—à–∏—Ö** ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç `processNoAnswerEliminations`
  11. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `adaptive:question_stats` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
  12. –ñ–¥—ë—Ç –∑–∞–¥–µ—Ä–∂–∫—É (`AnswerRevealDelayMs` = 200–º—Å)
  13. **–†–∞—Å—Å—ã–ª–∞–µ—Ç `quiz:answer_reveal`** ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
  14. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∫–ª–∞–º–Ω—ã–π —Å–ª–æ—Ç (`processAdBreak`)
  15. –ü–∞—É–∑–∞ –º–µ–∂–¥—É –≤–æ–ø—Ä–æ—Å–∞–º–∏ (`InterQuestionDelayMs` = 500–º—Å)
  16. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É

**–ü–æ—Å–ª–µ –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:**
- –ü–æ–º–µ—á–∞–µ—Ç –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∫–∞–∫ `IsUsed = true` –≤ –ë–î
- –û—á–∏—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∏–≥–Ω–∞–ª `questionDoneCh` ‚Üí `QuizManager` –∑–∞–ø—É—Å–∫–∞–µ—Ç `finishQuiz`

### `processNoAnswerEliminations(ctx, quizState, question, questionNumber)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –í—ã–±–∏–≤–∞–µ—Ç –∏–≥—Ä–æ–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ **–Ω–µ –æ—Ç–≤–µ—Ç–∏–ª–∏** –Ω–∞ –≤–æ–ø—Ä–æ—Å.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ Redis Set (`quiz:{id}:participants`)
  2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
     - –ï—Å—Ç—å –ª–∏ –∫–ª—é—á –æ—Ç–≤–µ—Ç–∞ (`quiz:{quizID}:user:{userID}:question:{questionID}`) ‚Üí **–æ—Ç–≤–µ—Ç–∏–ª**
     - –ï—Å—Ç—å –ª–∏ –∫–ª—é—á –≤—ã–±—ã–≤–∞–Ω–∏—è (`quiz:{quizID}:eliminated:{userID}`) ‚Üí **—É–∂–µ –≤—ã–±—ã–ª —Ä–∞–Ω—å—à–µ**
  3. –ï—Å–ª–∏ –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –∏ –µ—â—ë –Ω–µ –≤—ã–±—ã–ª:
     - –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å `UserAnswer` —Å `SelectedOption = -1`, `IsEliminated = true`, `EliminationReason = "no_answer_timeout"`
     - –°—Ç–∞–≤–∏—Ç –∫–ª—é—á –≤—ã–±—ã–≤–∞–Ω–∏—è –≤ Redis
     - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `quiz:elimination` –ª–∏—á–Ω–æ –∏–≥—Ä–æ–∫—É
     - –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã (–Ω–µ –ø—Ä–æ—à—ë–ª)

### `processAdBreak(ctx, quizState, questionNumber, totalQuestions)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∫–ª–∞–º—É –º–µ–∂–¥—É –≤–æ–ø—Ä–æ—Å–∞–º–∏ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞).
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —Ä–µ–∫–ª–∞–º–Ω—ã–π —Å–ª–æ—Ç –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –≤ –ë–î
  2. –ï—Å–ª–∏ –µ—Å—Ç—å –∏ –∞–∫—Ç–∏–≤–µ–Ω ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `quiz:ad_break` (—Ç–∏–ø –º–µ–¥–∏–∞, URL, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
  3. –ñ–¥—ë—Ç –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–∫–∞–∑–∞ —Ä–µ–∫–ª–∞–º—ã
  4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `quiz:ad_break_end`

### `runQuestionTimer(ctx, quiz, question, questionNumber, endTime, wg)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É —Ä–∞—Å—Å—ã–ª–∞–µ—Ç `quiz:timer` ‚Äî —Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –æ—Å—Ç–∞–ª–æ—Å—å –Ω–∞ –æ—Ç–≤–µ—Ç.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –¢–∏–∫–µ—Ä –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É ‚Üí –≤—ã—á–∏—Å–ª—è–µ—Ç `remaining_seconds` ‚Üí —Ä–∞—Å—Å—ã–ª–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ ‚Üí –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –≤—Ä–µ–º—è –≤—ã—à–ª–æ.

### `sendEventWithRetry(ctx, quizID, eventType, data)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ù–∞–¥—ë–∂–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ WebSocket —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ (–¥–æ 3 —Ä–∞–∑ —Å –ø–∞—É–∑–æ–π 500–º—Å).

---

## 5. –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

–§–∞–π–ª—ã:
- [adaptive_selector.go](file:///c:/project/vmdeploy/trivia-api/internal/service/quizmanager/adaptive_selector.go)
- [difficulty_config.go](file:///c:/project/vmdeploy/trivia-api/internal/service/quizmanager/difficulty_config.go)

–°–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–±–∏—Ä–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å** —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–≥–æ, —Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π –ø—Ä–æ—à–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`DefaultDifficultyConfig`)

**–¶–µ–ª–µ–≤—ã–µ pass rate** (—Å–∫–æ–ª—å–∫–æ % –∏–≥—Ä–æ–∫–æ–≤ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å):

| –í–æ–ø—Ä–æ—Å | –¶–µ–ª–µ–≤–æ–π % | –ë–∞–∑–æ–≤–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å |
|--------|-----------|-------------------|
| Q1 | 90% | 1 (–û—á–µ–Ω—å –ª–µ–≥–∫–æ) |
| Q2 | 85% | 2 (–õ–µ–≥–∫–æ) |
| Q3 | 78% | 2 (–õ–µ–≥–∫–æ) |
| Q4 | 70% | 3 (–°—Ä–µ–¥–Ω–µ) |
| Q5 | 62% | 3 (–°—Ä–µ–¥–Ω–µ) |
| Q6 | 55% | 4 (–°–ª–æ–∂–Ω–æ) |
| Q7 | 48% | 4 (–°–ª–æ–∂–Ω–æ) |
| Q8 | 42% | 5 (–û—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ) |
| Q9 | 36% | 5 (–û—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ) |
| Q10 | 50% | 5 (–û—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ) |

> üìä –ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤—Å–µ—Ö pass rate ‚âà **0.52%** ‚Äî —Ç–æ –µ—Å—Ç—å –∏–∑ 1000 –∏–≥—Ä–æ–∫–æ–≤ –¥–æ –∫–æ–Ω—Ü–∞ –¥–æ–π–¥—É—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ 5.

**–ü–æ—Ä–æ–≥ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏:** 10% (`AdaptationThreshold = 0.10`)

### `SelectNextQuestion(ctx, quizID, questionNumber, usedQuestionIDs)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –í—ã–±–∏—Ä–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å, —É—á–∏—Ç—ã–≤–∞—è —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –ü–æ–ª—É—á–∞–µ—Ç **—Ä–µ–∞–ª—å–Ω—ã–π pass rate** –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –∏–∑ Redis
  2. –í—ã—á–∏—Å–ª—è–µ—Ç –Ω—É–∂–Ω—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ `CalculateAdjustedDifficulty`
  3. –ò—â–µ—Ç –≤–æ–ø—Ä–æ—Å –≥–∏–±—Ä–∏–¥–Ω–æ: **—Å–Ω–∞—á–∞–ª–∞ —Å—Ä–µ–¥–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã**, –ø–æ—Ç–æ–º **–∏–∑ –æ–±—â–µ–≥–æ –ø—É–ª–∞**
  4. –ï—Å–ª–∏ –Ω–µ –Ω–∞—à—ë–ª ‚Äî **fallback** –Ω–∞ –¥—Ä—É–≥–∏–µ —É—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

### `CalculateAdjustedDifficulty(questionNumber, actualPassRate)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞ ¬±1 –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è.
- **–õ–æ–≥–∏–∫–∞:**
  - –ï—Å–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π % –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è **–Ω–∞ 10%+ –≤—ã—à–µ** —Ü–µ–ª–µ–≤–æ–≥–æ ‚Üí **+1 –∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏** (–≤–æ–ø—Ä–æ—Å —Å–ª–æ–∂–Ω–µ–µ)
  - –ï—Å–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π % –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è **–Ω–∞ 10%+ –Ω–∏–∂–µ** —Ü–µ–ª–µ–≤–æ–≥–æ ‚Üí **-1 –∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏** (–≤–æ–ø—Ä–æ—Å –ª–µ–≥—á–µ)
  - –ï—Å–ª–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø–æ—Ä–æ–≥–∞ ‚Üí –±–∞–∑–æ–≤–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
  - –î–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ ‚Äî –≤—Å–µ–≥–¥–∞ –±–∞–∑–æ–≤–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å (–Ω–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö)

### `getActualPassRate(quizID, questionNumber)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ß–∏—Ç–∞–µ—Ç –∏–∑ Redis —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ë–µ—Ä—ë—Ç –∫–ª—é—á–∏ `quiz:{id}:q{N}:total` –∏ `quiz:{id}:q{N}:passed`, –¥–µ–ª–∏—Ç `passed / total`.
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `-1.0` –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, `0.0...1.0` ‚Äî —Ä–µ–∞–ª—å–Ω—ã–π %, `1.0` ‚Äî –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞.

### `findQuestionByDifficultyHybrid(quizID, difficulty, excludeIDs)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ò—â–µ—Ç –≤–æ–ø—Ä–æ—Å –Ω—É–∂–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
  1. –°–Ω–∞—á–∞–ª–∞ —Å—Ä–µ–¥–∏ –≤–æ–ø—Ä–æ—Å–æ–≤, **–ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö –∫ –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ** (–¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–æ–º)
  2. –ó–∞—Ç–µ–º –∏–∑ **–æ–±—â–µ–≥–æ –ø—É–ª–∞** (—Å `QuizID = NULL` –∏ `IsUsed = false`)

### `findQuestionWithFallbackHybrid(quizID, targetDifficulty, excludeIDs)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ï—Å–ª–∏ –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–∞ –Ω—É–∂–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ ‚Äî –∏—â–µ—Ç –Ω–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö —É—Ä–æ–≤–Ω—è—Ö.
- **–ü–æ—Ä—è–¥–æ–∫:** –ü—Ä–∏ `FallbackToHigher = true`: —Å–Ω–∞—á–∞–ª–∞ –≤–≤–µ—Ä—Ö (—Å–ª–æ–∂–Ω–µ–µ 4‚Üí5), –ø–æ—Ç–æ–º –≤–Ω–∏–∑ (3‚Üí2‚Üí1).

### `RecordQuestionResult(quizID, questionNumber, passed)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–≤–µ—Ç–∞ –≤ Redis –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∞–¥–∞–ø—Ç–∞—Ü–∏–∏.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç `quiz:{id}:q{N}:total` –∏ (–µ—Å–ª–∏ –ø—Ä–æ—à—ë–ª) `quiz:{id}:q{N}:passed`.

---

## 6. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–æ–≤

–§–∞–π–ª: [answer_processor.go](file:///c:/project/vmdeploy/trivia-api/internal/service/quizmanager/answer_processor.go)

### `ProcessAnswer(ctx, userID, question, selectedOption, timestamp, quizState, questionStartTimeMs)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç –∏–≥—Ä–æ–∫–∞ ‚Äî THE CORE of the game.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—à–∞–≥–æ–≤–æ:**

  **–®–∞–≥ 1 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–±—ã–≤–∞–Ω–∏—è:**
  - –ö–ª—é—á Redis `quiz:{quizID}:eliminated:{userID}` ‚Äî –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –æ—Ç–≤–µ—Ç –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è, –∏–≥—Ä–æ–∫—É —à–ª—ë–º `quiz:elimination` —Å –ø—Ä–∏—á–∏–Ω–æ–π `already_eliminated`

  **–®–∞–≥ 2 ‚Äî –†–∞—Å—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏:**
  - –ë–µ—Ä—ë—Ç –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –≤–æ–ø—Ä–æ—Å–∞ (–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–ª–∏ fallback –∏–∑ Redis)
  - –í—ã—á–∏—Å–ª—è–µ—Ç `responseTimeMs = —Ç–µ–∫—É—â–µ–µ_–≤—Ä–µ–º—è ‚Äì –≤—Ä–µ–º—è_–Ω–∞—á–∞–ª–∞_–≤–æ–ø—Ä–æ—Å–∞`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏ –ª–∏–º–∏—Ç: `responseTimeMs > timeLimitSec √ó 1000`

  **–®–∞–≥ 3 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞:**
  - –í—ã–∑—ã–≤–∞–µ—Ç `question.IsCorrect(selectedOption)` ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–ª–∏ –Ω–µ—Ç
  - –í—ã—á–∏—Å–ª—è–µ—Ç –æ—á–∫–∏: `question.CalculatePoints(...)` ‚Üí 1 –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, 0 –∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

  **–®–∞–≥ 4 ‚Äî –†–µ—à–µ–Ω–∏–µ –æ –≤—ã–±—ã—Ç–∏–∏:**
  - –ò–≥—Ä–æ–∫ **–≤—ã–±—ã–≤–∞–µ—Ç**, –µ—Å–ª–∏:
    - ‚ùå **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç** ‚Üí –ø—Ä–∏—á–∏–Ω–∞ `incorrect_answer`
    - ‚è∞ **–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏** ‚Üí –ø—Ä–∏—á–∏–Ω–∞ `time_exceeded`

  **–®–∞–≥ 5 ‚Äî –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î:**
  - –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å `UserAnswer` –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç
  - –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å-–¥—É–±–ª—å (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á) ‚Üí –æ—à–∏–±–∫–∞ ¬´—É–∂–µ –æ—Ç–≤–µ—Ç–∏–ª¬ª

  **–®–∞–≥ 6 ‚Äî –ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞:**
  - –ï—Å–ª–∏ –≤—ã–±—ã–ª ‚Üí —Å—Ç–∞–≤–∏—Ç –∫–ª—é—á `quiz:{quizID}:eliminated:{userID}` –≤ Redis (–Ω–∞ 24 —á–∞—Å–∞)
  - –ï—Å–ª–∏ –≤—ã–±—ã–ª ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `quiz:elimination` –ª–∏—á–Ω–æ –∏–≥—Ä–æ–∫—É
  - –°—Ç–∞–≤–∏—Ç –∫–ª—é—á ¬´–æ—Ç–≤–µ—Ç–∏–ª¬ª –≤ Redis: `quiz:{quizID}:user:{userID}:question:{questionID}`
  - –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
  - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `quiz:answer_result` –ª–∏—á–Ω–æ –∏–≥—Ä–æ–∫—É —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

### `HandleReadyEvent(ctx, userID, quizID)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏–≥—Ä–æ–∫–∞ –∫–∞–∫ ¬´–≥–æ—Ç–æ–≤–æ–≥–æ¬ª –∫ –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –°—Ç–∞–≤–∏—Ç –∫–ª—é—á –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤ Redis
  2. **–î–æ–±–∞–≤–ª—è–µ—Ç —é–∑–µ—Ä–∞ –≤ Redis Set** `quiz:{quizID}:participants` ‚Äî —ç—Ç–æ—Ç Set –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–±—ã–≤–∞–Ω–∏—è (–≤–º–µ—Å—Ç–æ WebSocket ‚Äî —á—Ç–æ–±—ã –æ—Ç–∫–ª—é—á—ë–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∏ —Ç–æ–∂–µ —É—á–∏—Ç—ã–≤–∞–ª–∏—Å—å!)
  3. –†–∞—Å—Å—ã–ª–∞–µ—Ç `quiz:user_ready` –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º —Å —Ç–µ–∫—É—â–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∏–≥—Ä–æ–∫–æ–≤

### `GetUserQuizStatus(ctx, userID, quizID)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∏–≥—Ä–æ–∫–∞ –¥–ª—è —Ä–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–ø–æ—Å–ª–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è).
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–ª—é—á –≤—ã–±—ã–≤–∞–Ω–∏—è –≤ Redis
  2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã –∏–∑ –ë–î ‚Üí —Å—á–∏—Ç–∞–µ—Ç –æ—á–∫–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
  3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `IsEliminated`, `EliminationReason`, `Score`, `CorrectCount`

---

## 7. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã

–§–∞–π–ª: [quiz_manager.go](file:///c:/project/vmdeploy/trivia-api/internal/service/quiz_manager.go)

–ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: Scheduler, QuestionManager, AnswerProcessor.

### `handleEvents()` (—Ñ–æ–Ω–æ–≤—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å)
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–ª—É—à–∞–µ—Ç –¥–≤–∞ –∫–∞–Ω–∞–ª–∞:
  - `quizStartCh` ‚Üê –æ—Ç Scheduler: ¬´–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ #N —Å—Ç–∞—Ä—Ç—É–µ—Ç!¬ª ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç `handleQuizStart`
  - `questionDoneCh` ‚Üê –æ—Ç QuestionManager: ¬´–í—Å–µ –≤–æ–ø—Ä–æ—Å—ã –∑–∞–¥–∞–Ω—ã!¬ª ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç `finishQuiz`

### `handleQuizStart(quizID)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∞–∫—Ç–∏–≤–Ω—É—é –≤–∏–∫—Ç–æ—Ä–∏–Ω—É.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–∏–∫—Ç–æ—Ä–∏–Ω—É —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –∏–∑ –ë–î
  2. –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–µ—Ç ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ (–≤–æ–ø—Ä–æ—Å—ã –∏–∑ –ø—É–ª–∞)
  3. –°–æ–∑–¥–∞—ë—Ç `ActiveQuizState` ‚Äî –æ–±—ä–µ–∫—Ç-—Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
  4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ—Ç –ª–∏ —É–∂–µ –¥—Ä—É–≥–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã (–∑–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)
  5. –ó–∞–ø—É—Å–∫–∞–µ—Ç `QuestionManager.RunQuizQuestions` –≤ –≥–æ—Ä—É—Ç–∏–Ω–µ

### `finishQuiz(quizID)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ó–∞–≤–µ—Ä—à–∞–µ—Ç –≤–∏–∫—Ç–æ—Ä–∏–Ω—É –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–¥—Å—á—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. **–ü–æ–¥ lock:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —ç—Ç–æ —Ç–µ–∫—É—â–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ ‚Üí —Å—Ç–∞–≤–∏—Ç —Å—Ç–∞—Ç—É—Å `completed` ‚Üí —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç `activeQuizState = nil`
  2. **–ë–µ–∑ lock:** –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ –ë–î
  3. –†–∞—Å—Å—ã–ª–∞–µ—Ç `quiz:finish` –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º
  4. –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ Redis Set `quiz:{quizID}:participants`
  5. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `CalculateQuizResult` (–ø–æ–¥—Å—á—ë—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
  6. –ñ–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–∞—Å—á—ë—Ç–æ–≤ (`WaitGroup`)
  7. –í—ã–∑—ã–≤–∞–µ—Ç `DetermineWinnersAndAllocatePrizes` ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–∑–æ–≤

### `ProcessAnswer(userID, questionID, selectedOption, timestamp)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ WebSocket).
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã (–ø–æ–¥ RLock)
  2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≤–æ–ø—Ä–æ—Å–æ–º –∏–∑ –æ—Ç–≤–µ—Ç–∞
  3. –ü–æ–ª—É—á–∞–µ—Ç –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –≤–æ–ø—Ä–æ—Å–∞
  4. –î–µ–ª–µ–≥–∏—Ä—É–µ—Ç –≤ `AnswerProcessor.ProcessAnswer`

### `GetCurrentState(userID, quizID)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** Resync ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∏–≥—Ä–æ–∫–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  - –ï—Å–ª–∏ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ **–Ω–µ –∞–∫—Ç–∏–≤–Ω–∞**: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∏–∑ –ë–î + —Ä–µ–∑—É–ª—å—Ç–∞—Ç –µ—Å–ª–∏ `completed`
  - –ï—Å–ª–∏ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ **–∞–∫—Ç–∏–≤–Ω–∞**: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å, –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è, —Å—Ç–∞—Ç—É—Å –≤—ã–±—ã–≤–∞–Ω–∏—è, –æ—á–∫–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤

---

## 8. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø—Ä–∏–∑—ã

–§–∞–π–ª: [result_service.go](file:///c:/project/vmdeploy/trivia-api/internal/service/result_service.go)

### `CalculateQuizResult(userID, quizID)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°—á–∏—Ç–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–¥–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤–∏–∫—Ç–æ—Ä–∏–Ω—É, –≤—Å–µ –æ—Ç–≤–µ—Ç—ã
  2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤—ã–±—ã–≤–∞–Ω–∏—è –≤ Redis
  3. –°—É–º–º–∏—Ä—É–µ—Ç –æ—á–∫–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
  4. –ù–∞—Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–π –æ—Ç–≤–µ—Ç —Å –≤—ã–±—ã—Ç–∏–µ–º ‚Üí –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –Ω–æ–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞ –∏ –ø—Ä–∏—á–∏–Ω—É
  5. **–í —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
     - –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å `Result`
     - –û–±–Ω–æ–≤–ª—è–µ—Ç `total_score` —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø—Ä–∏–±–∞–≤–ª—è–µ—Ç)
     - –û–±–Ω–æ–≤–ª—è–µ—Ç `highest_score` –µ—Å–ª–∏ –Ω–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥
     - –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `games_played` –Ω–∞ 1

### `DetermineWinnersAndAllocatePrizes(ctx, quizID)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –∏ —Ä–∞–∑–¥–∞—ë—Ç –ø—Ä–∏–∑—ã. THE BIG ONE.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–∏–∫—Ç–æ—Ä–∏–Ω—É —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏
  2. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ (—Å fallback: –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã ‚Üí —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–∑ –æ—Ç–≤–µ—Ç–æ–≤ ‚Üí `QuestionCount`)
  3. –ë–µ—Ä—ë—Ç –ø—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã (fallback –Ω–∞ –¥–µ—Ñ–æ–ª—Ç –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
  4. **–í —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
     - **‚ö° `CalculateRanks`** ‚Äî SQL-–∑–∞–ø—Ä–æ—Å `RANK() OVER (ORDER BY score DESC, correct_answers DESC)` ‚Äî –≤—ã—á–∏—Å–ª—è–µ—Ç –º–µ—Å—Ç–æ –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
     - **‚ö° `FindAndUpdateWinners`** ‚Äî –∏—â–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π: `correct_answers = totalQuestions AND is_eliminated = false`
     - –ü—Ä–∏–∑ = `prizeFund / –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π` (—Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –¥–µ–ª–µ–Ω–∏–µ)
     - –û–±–Ω–æ–≤–ª—è–µ—Ç `is_winner = true`, `prize_fund` —É –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
     - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç `is_winner = false` —É –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
     - –û–±–Ω–æ–≤–ª—è–µ—Ç `wins_count + 1` –∏ `total_prize_won` —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π-–ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
  5. –†–∞—Å—Å—ã–ª–∞–µ—Ç `quiz:results_available` —á–µ—Ä–µ–∑ WebSocket

> **–ö—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–º:** —Ç–æ–ª—å–∫–æ —Ç–æ—Ç, –∫—Ç–æ **–æ—Ç–≤–µ—Ç–∏–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞ –í–°–ï –≤–æ–ø—Ä–æ—Å—ã** –∏ **–Ω–µ –±—ã–ª –≤—ã–±–∏—Ç**.

### `CalculateQuizStatistics(quizID)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã.
- **–ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
  - –í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π, –≤—ã–±—ã–≤—à–∏—Ö
  - –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞, —Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
  - –í—ã–±—ã—Ç–∏—è –ø–æ –∫–∞–∂–¥–æ–º—É –≤–æ–ø—Ä–æ—Å—É (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –ø—Ä–∏—á–∏–Ω—ã, pass rate)
  - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (1-5)
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ –ø—É–ª–∞
  - –°—Ä–µ–¥–Ω–∏–π pass rate

### `GetQuizResults` / `GetUserResult` / `GetQuizWinners` / `GetQuizResultsAll`
- **–ß—Ç–æ –¥–µ–ª–∞—é—Ç:** –ß—Ç–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π, –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–ø–∏—Å–∫–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π, –ø–æ–ª–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç.

---

## 9. WebSocket

–§–∞–π–ª: [ws_handler.go](file:///c:/project/vmdeploy/trivia-api/internal/handler/ws_handler.go)

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- **`HandleConnection`** ‚Äî –∫–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —Å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–º WS-—Ç–∏–∫–µ—Ç–æ–º (JWT, 60 —Å–µ–∫ TTL)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∏–∫–µ—Ç —á–µ—Ä–µ–∑ `ParseWSTicket`
- –°–æ–∑–¥–∞—ë—Ç WebSocket-–∫–ª–∏–µ–Ω—Ç–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏–∑ `config.yaml`

### –í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ ‚Üí —Å–µ—Ä–≤–µ—Ä—É)

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ß—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç |
|-----|----------|--------------|
| `user:ready` | –ò–≥—Ä–æ–∫ –∑–∞—à—ë–ª –≤ –∑–∞–ª –æ–∂–∏–¥–∞–Ω–∏—è | `HandleReadyEvent` ‚Üí –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ quiz, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ participants |
| `user:answer` | –ò–≥—Ä–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å | `ProcessAnswer` ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ –∏ –≤—ã–±—ã—Ç–∏–µ |
| `user:heartbeat` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏ | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `server:heartbeat` |
| `user:resync` | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è | `GetCurrentState` ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è |

### –ò—Å—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (—Å–µ—Ä–≤–µ—Ä ‚Üí –∫–ª–∏–µ–Ω—Ç—É)

| –¢–∏–ø | –ö–æ–≥–¥–∞ | –ö–æ–º—É |
|-----|-------|------|
| `quiz:announcement` | –ó–∞ 30 –º–∏–Ω –¥–æ —Å—Ç–∞—Ä—Ç–∞ | –í—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º |
| `quiz:waiting_room` | –ó–∞ 5 –º–∏–Ω –¥–æ —Å—Ç–∞—Ä—Ç–∞ | –í—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º |
| `quiz:countdown` | –ó–∞ 60 —Å–µ–∫, –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É | –í—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º |
| `quiz:start` | –ú–æ–º–µ–Ω—Ç —Å—Ç–∞—Ä—Ç–∞ | –í—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º |
| `quiz:question` | –ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å | –í—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º |
| `quiz:timer` | –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –≤–æ –≤—Ä–µ–º—è –≤–æ–ø—Ä–æ—Å–∞ | –í—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º |
| `quiz:answer_result` | –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ | –õ–∏—á–Ω–æ –∏–≥—Ä–æ–∫—É |
| `quiz:answer_reveal` | –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç | –í—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º |
| `quiz:elimination` | –ò–≥—Ä–æ–∫ –≤—ã–±—ã–ª | –õ–∏—á–Ω–æ –∏–≥—Ä–æ–∫—É |
| `quiz:user_ready` | –ö—Ç–æ-—Ç–æ –∑–∞—à—ë–ª –≤ –∑–∞–ª –æ–∂–∏–¥–∞–Ω–∏—è | –í—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º |
| `quiz:ad_break` / `quiz:ad_break_end` | –†–µ–∫–ª–∞–º–Ω–∞—è –ø–∞—É–∑–∞ | –í—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º |
| `quiz:finish` | –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ | –í—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º |
| `quiz:results_available` | –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ—Ç–æ–≤—ã | –í—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º |
| `quiz:state` | –û—Ç–≤–µ—Ç –Ω–∞ resync | –õ–∏—á–Ω–æ –∏–≥—Ä–æ–∫—É |
| `quiz:cancelled` | –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ | –í—Å–µ–º |
| `adaptive:question_stats` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ –≤–æ–ø—Ä–æ—Å–∞ | –í—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º |

---

## 10. –ü—É–ª –≤–æ–ø—Ä–æ—Å–æ–≤

### `BulkUploadQuestionPool(questions)`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ú–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ –æ–±—â–∏–π –ø—É–ª (–¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã).
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
  1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å: `Difficulty` –æ—Ç 1 –¥–æ 5, `CorrectOption` –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
  2. –í–æ–ø—Ä–æ—Å—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å `QuizID = nil` (–Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ)
  3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–∞–∫–µ—Ç–æ–º –≤ –ë–î

### `GetPoolStats()`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—É–ª–∞.
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –≤—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.

### `ResetPoolUsed()`
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ñ–ª–∞–≥ `IsUsed = false` –¥–ª—è –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—É–ª–∞.
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ö–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –Ω—É–∂–Ω–æ ¬´–ø–µ—Ä–µ–∏–≥—Ä–∞—Ç—å¬ª –ø—É–ª.

---

## 11. –ü–æ–ª–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ –ø—Ä–∏–∑–æ–≤

```mermaid
flowchart TD
    A["üë§ –ê–¥–º–∏–Ω —Å–æ–∑–¥–∞—ë—Ç –≤–∏–∫—Ç–æ—Ä–∏–Ω—É<br/><b>CreateQuiz</b>"] --> B{"–í–æ–ø—Ä–æ—Å—ã"}
    B -->|"–î–æ–±–∞–≤–ª—è–µ—Ç –≤—Ä—É—á–Ω—É—é"| C["<b>AddQuestions</b><br/>–ü—Ä–∏–≤—è–∑–∫–∞ –∫ –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ"]
    B -->|"–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—É–ª"| D["–û–±—â–∏–π –ø—É–ª<br/><b>BulkUploadQuestionPool</b>"]
    
    A --> E["üìÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫<br/><b>ScheduleQuiz</b>"]
    
    E --> F["üì¢ –ê–Ω–æ–Ω—Å<br/>quiz:announcement<br/>(-30 –º–∏–Ω)"]
    F --> G["üö™ –ó–∞–ª –æ–∂–∏–¥–∞–Ω–∏—è<br/>quiz:waiting_room<br/>(-5 –º–∏–Ω)"]
    G --> H["‚è± –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç<br/>quiz:countdown<br/>(-60 —Å–µ–∫)"]
    H --> I["üöÄ –°–¢–ê–†–¢<br/>quiz:start"]
    
    I --> J["‚ùì –í–æ–ø—Ä–æ—Å #N<br/><b>SelectNextQuestion</b>"]
    J --> K["üì§ –û—Ç–ø—Ä–∞–≤–∫–∞<br/>quiz:question"]
    K --> L["‚è∞ –¢–∞–π–º–µ—Ä<br/>quiz:timer"]
    
    L --> M{"–ò–≥—Ä–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç?"}
    M -->|"–î–∞"| N["<b>ProcessAnswer</b>"]
    M -->|"–ù–µ—Ç (–≤—Ä–µ–º—è –≤—ã—à–ª–æ)"| O["<b>processNoAnswerEliminations</b>"]
    
    N --> P{"–ü—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –≤–æ–≤—Ä–µ–º—è?"}
    P -->|"‚úÖ –î–∞"| Q["–û—á–∫–∏ +1<br/>–ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏–≥—Ä–∞—Ç—å"]
    P -->|"‚ùå –ù–µ—Ç"| R["üíÄ –í–´–ë–´–í–ê–ï–¢<br/>quiz:elimination"]
    O --> R
    
    Q --> S["üìä answer_reveal"]
    R --> S
    S --> T{"–ï—â—ë –≤–æ–ø—Ä–æ—Å—ã?"}
    T -->|"–î–∞"| J
    T -->|"–ù–µ—Ç"| U["üèÅ –§–ò–ù–ò–®<br/>quiz:finish<br/><b>finishQuiz</b>"]
    
    U --> V["üìä –†–∞—Å—á—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤<br/><b>CalculateQuizResult</b><br/>(–∫–∞–∂–¥–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É)"]
    V --> W["üèÜ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π<br/><b>DetermineWinnersAndAllocatePrizes</b>"]
    W --> X["üí∞ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–∑–æ–≤<br/>–ü—Ä–∏–∑ = –§–æ–Ω–¥ / –ö–æ–ª-–≤–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π"]
    X --> Y["üì¢ quiz:results_available"]
```

### –ü—Ä–∏—á–∏–Ω—ã –≤—ã–±—ã—Ç–∏—è (–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫)

| –ü—Ä–∏—á–∏–Ω–∞ | –ö–æ–¥ | –ö–æ–≥–¥–∞ |
|---------|-----|-------|
| –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç | `incorrect_answer` | –ò–≥—Ä–æ–∫ –≤—ã–±—Ä–∞–ª –Ω–µ —Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç |
| –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ | `time_exceeded` | –û—Ç–≤–µ—Ç–∏–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –ø–æ–∑–∂–µ –¥–µ–¥–ª–∞–π–Ω–∞ |
| –ù–µ –æ—Ç–≤–µ—Ç–∏–ª | `no_answer_timeout` | –í–æ–æ–±—â–µ –Ω–µ –ø—Ä–∏—Å–ª–∞–ª –æ—Ç–≤–µ—Ç –∑–∞ –≤—Ä–µ–º—è –≤–æ–ø—Ä–æ—Å–∞ |
| –û—Ç–∫–ª—é—á–∏–ª—Å—è | `disconnected` | (–æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ) |

### –ö–ª—é—á–∏ Redis (–≤–æ –≤—Ä–µ–º—è –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã)

| –ö–ª—é—á | –ó–∞—á–µ–º | TTL |
|------|-------|-----|
| `quiz:{id}:participants` | Set –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ | 24 —á |
| `quiz:{id}:eliminated:{userID}` | –§–ª–∞–≥ –≤—ã–±—ã–≤–∞–Ω–∏—è | 24 —á |
| `quiz:{id}:user:{userID}:question:{questionID}` | –û—Ç–≤–µ—Ç–∏–ª –ª–∏ –Ω–∞ –≤–æ–ø—Ä–æ—Å | 1 —á |
| `question:{id}:start_time` | –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –≤–æ–ø—Ä–æ—Å–∞ | 1 —á |
| `quiz:{id}:q{N}:total` | –°–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π –æ—Ç–≤–µ—á–∞–ª–∏ (–∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è) | ‚Äî |
| `quiz:{id}:q{N}:passed` | –°–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π –ø—Ä–æ—à–ª–∏ (–∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è) | ‚Äî |

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| –ú–∞–∫—Å. –≤–æ–ø—Ä–æ—Å–æ–≤ | 10 |
| –ü—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥ | 1 000 000 ‚Ç∏ |
| –ê–Ω–æ–Ω—Å –¥–æ —Å—Ç–∞—Ä—Ç–∞ | 30 –º–∏–Ω |
| –ó–∞–ª –æ–∂–∏–¥–∞–Ω–∏—è | 5 –º–∏–Ω |
| –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç | 60 —Å–µ–∫ |
| –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –≤–æ–ø—Ä–æ—Å–æ–º | 500 –º—Å |
| –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º | 200 –º—Å |
| –ü–∞—É–∑–∞ –º–µ–∂–¥—É –≤–æ–ø—Ä–æ—Å–∞–º–∏ | 500 –º—Å |
| –ú–∞–∫—Å. –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ | 30 —Å–µ–∫ |
| –õ–∏–º–∏—Ç –Ω–∞ –≤—ã–±—ã–≤–∞–Ω–∏–µ | 10 —Å–µ–∫ |
| –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ | 3 |
