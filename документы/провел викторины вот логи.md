app_1       | 2026/02/10 13:36:36 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 
app_1       | 2026/02/10 13:36:45 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.548ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-10 13:36:45.747') OR (is_active = false AND rotated_at > '2026-02-03 13:36:45.747' AND expires_at > '2026-02-10 13:36:45.747') ORDER BY created_at DESC
app_1       | 2026/02/10 13:36:45 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:36:45 +0000] "GET /api/users/me HTTP/2.0" 200 287 "https://qazaquiz.duckdns.org/admin/quizzes/new" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/10 13:36:45 /app/internal/repository/postgres/user_repo.go:33
app_1       | [2.140ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/10 - 13:36:45 | 200 |    4.570622ms |      172.18.0.6 | GET      "/api/users/me"
app_1       | 
app_1       | 2026/02/10 13:37:24 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.210ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-10 13:37:24.612') OR (is_active = false AND rotated_at > '2026-02-03 13:37:24.612' AND expires_at > '2026-02-10 13:37:24.612') ORDER BY created_at DESC
app_1       | 2026/02/10 13:37:24 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/10 13:37:24 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/10 13:37:24 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.778ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-10 13:37:24.613') OR (is_active = false AND rotated_at > '2026-02-03 13:37:24.613' AND expires_at > '2026-02-10 13:37:24.613') ORDER BY created_at DESC
app_1       | 2026/02/10 13:37:24 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/10 13:37:24 /app/internal/repository/postgres/quiz_repo.go:26
app_1       | [14.168ms] [rows:1] INSERT INTO "quizzes" ("title","description","scheduled_time","status","question_count","prize_fund","created_at","updated_at") VALUES ('Тест викторины после коммита с адаптивной сложность и распредлением призов.','','2026-02-10 13:38:00','scheduled',0,7999,'2026-02-10 13:37:24.616','2026-02-10 13:37:24.616') RETURNING "id"
app_1       | 2026/02/10 13:37:24 [QuizManager] Планирование викторины #35 на 2026-02-10 13:38:00 +0000 UTC
app_1       | 
app_1       | 2026/02/10 13:37:24 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [14.225ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 35
app_1       | 
app_1       | 2026/02/10 13:37:24 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [16.898ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 35 ORDER BY "quizzes"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/10 13:37:24 /app/internal/repository/postgres/question_repo.go:173
app_1       | [9.274ms] [rows:1] SELECT * FROM "questions" WHERE quiz_id IS NULL AND difficulty = 1 AND is_used = false ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/10 13:37:24 [Scheduler] Quiz #35: no preset questions, using pool
app_1       | 2026/02/10 13:37:24 [Scheduler] Викторина #35 запланирована на 2026-02-10 13:38:00 +0000 UTC
app_1       | 
app_1       | 2026/02/10 13:37:24 /app/internal/repository/postgres/quiz_repo.go:90
app_1       | [6.372ms] [rows:1] UPDATE "quizzes" SET "title"='Тест викторины после коммита с адаптивной сложность и распредлением призов.',"description"='',"scheduled_time"='2026-02-10 13:38:00',"status"='scheduled',"question_count"=0,"prize_fund"=7999,"created_at"='2026-02-10 13:37:24.616',"updated_at"='2026-02-10 13:37:24.658' WHERE "id" = 35
app_1       | [GIN] 2026/02/10 - 13:37:24 | 201 |   51.512959ms |      172.18.0.6 | POST     "/api/quizzes"
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:37:24 +0000] "POST /api/quizzes HTTP/2.0" 201 350 "https://qazaquiz.duckdns.org/admin/quizzes/new" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/10 13:37:24 [Scheduler] Викторина #35: слишком поздно для отсчета, ожидание начала (35.335841593s)
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:37:24 +0000] "GET /admin/quizzes/35?_rsc=526y9 HTTP/2.0" 200 1173 "https://qazaquiz.duckdns.org/admin/quizzes/new" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:37:25 +0000] "GET /api/quizzes/35/with-questions HTTP/2.0" 200 344 "https://qazaquiz.duckdns.org/admin/quizzes/35" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 
app_1       | 2026/02/10 13:37:25 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.909ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 35
app_1       | 
app_1       | 2026/02/10 13:37:25 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [2.495ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 35 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/10 - 13:37:25 | 200 |    2.725437ms |      172.18.0.6 | GET      "/api/quizzes/35/with-questions"
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:37:25 +0000] "GET /admin/quiz-live/35?_rsc=3uwmu HTTP/2.0" 200 173 "https://qazaquiz.duckdns.org/admin/quizzes/35" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:37:25 +0000] "GET /admin/quiz-live/35?_rsc=2yizi HTTP/2.0" 200 819 "https://qazaquiz.duckdns.org/admin/quizzes/35" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:37:27 +0000] "GET /api/quizzes?page=1&page_size=100 HTTP/2.0" 200 10359 "https://qazaquiz.duckdns.org/admin" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/10 13:37:27 /app/internal/repository/postgres/quiz_repo.go:96
app_1       | [2.081ms] [rows:35] SELECT * FROM "quizzes" ORDER BY id DESC LIMIT 100
app_1       | [GIN] 2026/02/10 - 13:37:27 | 200 |     2.77604ms |      172.18.0.6 | GET      "/api/quizzes?page=1&page_size=100"
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:37:28 +0000] "GET /api/quizzes/scheduled HTTP/2.0" 200 346 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 
app_1       | 2026/02/10 13:37:28 /app/internal/repository/postgres/quiz_repo.go:60
app_1       | [1.083ms] [rows:1] SELECT * FROM "quizzes" WHERE status = 'scheduled' AND scheduled_time > '2026-02-10 13:37:28.092' ORDER BY scheduled_time
app_1       | [GIN] 2026/02/10 - 13:37:28 | 200 |    1.305011ms |      172.18.0.6 | GET      "/api/quizzes/scheduled"
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:37:28 +0000] "GET /quiz/35/lobby?_rsc=eqsj3 HTTP/2.0" 200 183 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:37:28 +0000] "GET /quiz/35/lobby?_rsc=1a28h HTTP/2.0" 200 828 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:37:29 +0000] "GET /quiz/35/lobby?_rsc=1qhpx HTTP/2.0" 200 1410 "https://qazaquiz.duckdns.org/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:37:29 +0000] "GET /api/quizzes/35 HTTP/2.0" 200 344 "https://qazaquiz.duckdns.org/quiz/35/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/10 13:37:29 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [1.281ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 35 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/10 - 13:37:29 | 200 |    1.515182ms |      172.18.0.6 | GET      "/api/quizzes/35"
app_1       | 
app_1       | 2026/02/10 13:37:29 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [13.354ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-10 13:37:29.586') OR (is_active = false AND rotated_at > '2026-02-03 13:37:29.586' AND expires_at > '2026-02-10 13:37:29.586') ORDER BY created_at DESC
app_1       | 2026/02/10 13:37:29 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/10 13:37:29 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/10 13:37:29 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [2.066ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-10 13:37:29.6') OR (is_active = false AND rotated_at > '2026-02-03 13:37:29.6' AND expires_at > '2026-02-10 13:37:29.6') ORDER BY created_at DESC
app_1       | 2026/02/10 13:37:29 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/10 13:37:29 /app/internal/repository/postgres/jwt_key_repo.go:99
app_1       | [4.577ms] [rows:1] SELECT * FROM "jwt_keys" WHERE is_active = true AND expires_at > '2026-02-10 13:37:29.602' ORDER BY created_at DESC,"jwt_keys"."id" LIMIT 1
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:37:29 +0000] "POST /api/auth/ws-ticket HTTP/2.0" 200 363 "https://qazaquiz.duckdns.org/quiz/35/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | [GIN] 2026/02/10 - 13:37:29 | 200 |   21.439312ms |      172.18.0.6 | POST     "/api/auth/ws-ticket"
app_1       | 2026/02/10 13:37:29 [JWT] WS-тикет успешно сгенерирован для пользователя ID=1 с ключом ID=a488fda381b19b17, истекает через 1m0s
app_1       | 2026/02/10 13:37:30 WebSocket: Connection upgraded for UserID: 1
app_1       | 2026/02/10 13:37:30 WebSocket: registering client 1 in ShardedHub
app_1       | 2026/02/10 13:37:30 Shard 0: client 1 registered
app_1       | 2026/02/10 13:37:30 WebSocket: client 1 fully registered, starting pumps
app_1       | 2026/02/10 13:37:30 WebSocket Client Read Pump STARTED for UserID: 1, ConnID: 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 
app_1       | 2026/02/10 13:37:30 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | 2026/02/10 13:37:30 WebSocket Client Write Pump STARTED for UserID: 1, ConnID: 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | [1.030ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-10 13:37:30.032') OR (is_active = false AND rotated_at > '2026-02-03 13:37:30.032' AND expires_at > '2026-02-10 13:37:30.032') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/10 - 13:37:30 | 200 |    1.734135ms |      172.18.0.6 | GET      "/ws?ticket=eyJhbGciOiJIUzI1NiIsImtpZCI6ImE0ODhmZGEzODFiMTliMTciLCJ0eXAiOiJKV1QifQ.eyJ1c2VyX2lkIjoxLCJlbWFpbCI6InRlbWlybGFuQG1haWwucnUiLCJyb2xlIjoiIiwiaXNzIjoidHJpdmlhLWFwaSIsInN1YiI6IjEiLCJhdWQiOlsidHJpdmlhLXdzIl0sImV4cCI6MTc3MDczMDcwOSwiaWF0IjoxNzcwNzMwNjQ5LCJ1c2FnZSI6IndlYnNvY2tldF9hdXRoIn0.Jfj6lRdQYZSbCIgw3XMDchjHdCDOL-3hA7vWbwodqlE"
app_1       | 2026/02/10 13:37:30 Client 1 (Conn: 8e6402be-5c91-4217-8599-17cab0ca556a) set QuizID to 35
app_1       | 2026/02/10 13:37:30 [WSHandler] User 1 set QuizID to 35
app_1       | 2026/02/10 13:37:30 [Shard 0][Sub] SubscribeToQuiz called for Client 1 (Conn: 8e6402be-5c91-4217-8599-17cab0ca556a) to Quiz 35
app_1       | 2026/02/10 13:37:30 [Shard 0][Sub] Client 1: Old QuizID is 35, New QuizID is 35
app_1       | 2026/02/10 13:37:30 [Shard 0][Sub] Client 1 already has atomic QuizID 35. Ensuring map presence.
app_1       | 2026/02/10 13:37:30 [Shard 0][Sub] Client 1: Attempting LoadOrStore for quiz map 35
app_1       | 2026/02/10 13:37:30 [Shard 0][Sub] Client 1: Created new map for quiz 35
app_1       | 2026/02/10 13:37:30 [Shard 0][Sub] Client 1: Attempting to STORE client in map for Quiz 35 (Map: 0xc00047a660)
app_1       | 2026/02/10 13:37:30 [Shard 0][Sub] Client 1: STORED client in map for Quiz 35 (Map: 0xc00047a660)
app_1       | 2026/02/10 13:37:30 [Shard 0][Sub] Client 1 VERIFIED in map for Quiz 35 immediately after Store.
app_1       | 2026/02/10 13:37:30 [WebSocketManager] Клиент 1 подписан на викторину 35 в шарде 0
app_1       | 2026/02/10 13:37:30 [AnswerProcessor] Пользователь #1 отметился как готовый к викторине #35
app_1       | 2026/02/10 13:37:30 [AnswerProcessor] Пользователь #1 добавлен в participants Set викторины #35
app_1       | 2026/02/10 13:37:30 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:37:30 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/10 13:37:30 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/10 13:37:30 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/10 13:37:30 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:user_ready
app_1       | 2026/02/10 13:37:30 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:37:30 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:user_ready
app_1       | 2026/02/10 13:37:30 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:user_ready. Buffer len: 0
app_1       | 2026/02/10 13:37:30 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:37:30 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:37:30 [AnswerProcessor] Успешно отправлено событие о готовности пользователя #1 к викторине #35 (игроков онлайн: 1)
app_1       | 2026/02/10 13:37:36 [Shard 2] Запуск проверки неактивных клиентов...
app_1       | 2026/02/10 13:37:36 [Shard 0] Запуск проверки неактивных клиентов...
app_1       | 2026/02/10 13:37:36 [Shard 1] Запуск проверки неактивных клиентов...
app_1       | 2026/02/10 13:37:36 [Shard 3] Запуск проверки неактивных клиентов...
app_1       | 2026/02/10 13:37:36 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/10 13:38:00 [Scheduler] Запуск викторины #35
app_1       | 
app_1       | 2026/02/10 13:38:00 /app/internal/repository/postgres/quiz_repo.go:84
app_1       | [7.671ms] [rows:1] UPDATE "quizzes" SET "status"='in_progress',"updated_at"='2026-02-10 13:38:00.002' WHERE id = 35
app_1       | 2026/02/10 13:38:00 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:00 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:start
app_1       | 2026/02/10 13:38:00 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:start
app_1       | 2026/02/10 13:38:00 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:start
app_1       | 2026/02/10 13:38:00 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:00 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:start
app_1       | 2026/02/10 13:38:00 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:start. Buffer len: 0
app_1       | 2026/02/10 13:38:00 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:00 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:start
app_1       | 2026/02/10 13:38:00 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:00 [Scheduler] Уведомление о запуске викторины #35 отправлено
app_1       | 2026/02/10 13:38:00 [Scheduler] Сигнал о запуске викторины #35 отправлен в QuizManager
app_1       | 2026/02/10 13:38:00 [QuizManager] Обработка запуска викторины #35
app_1       | 
app_1       | 2026/02/10 13:38:00 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [4.742ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 35
app_1       | 
app_1       | 2026/02/10 13:38:00 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [11.249ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 35 ORDER BY "quizzes"."id" LIMIT 1
app_1       | 2026/02/10 13:38:00 [QuizManager] Quiz #35: no preset questions, using adaptive mode
app_1       | 2026/02/10 13:38:00 [QuestionManager] Начинаю адаптивный процесс отправки вопросов для викторины #35. Всего вопросов: 10
app_1       | 2026/02/10 13:38:00 [AdaptiveSelector] Quiz #35, Q1: prev_pass_rate=1.00, target_difficulty=1
app_1       | 
app_1       | 2026/02/10 13:38:00 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [6.397ms] [rows:0] SELECT * FROM "questions" WHERE quiz_id = 35 AND difficulty = 1 AND is_used = false ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/10 13:38:00 /app/internal/repository/postgres/question_repo.go:173
app_1       | [2.300ms] [rows:1] SELECT * FROM "questions" WHERE quiz_id IS NULL AND difficulty = 1 AND is_used = false ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/10 13:38:00 [AdaptiveSelector] Found pool question ID=293 (difficulty=1)
app_1       | 2026/02/10 13:38:00 [AdaptiveSelector] Selected question ID=293, difficulty=1 for Q1
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:38:00 +0000] "GET /quiz/35/play?_rsc=16x4d HTTP/2.0" 200 1218 "https://qazaquiz.duckdns.org/quiz/35/lobby" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/10 13:38:00 [WSHandler] Resync запрос от пользователя 1 для викторины 35
app_1       | 
app_1       | 2026/02/10 13:38:00 /app/internal/repository/postgres/result_repo.go:33
app_1       | [6.944ms] [rows:0] SELECT * FROM "user_answers" WHERE user_id = 1 AND quiz_id = 35 ORDER BY created_at
app_1       | 2026/02/10 13:38:00 [WSHandler] Успешно отправлен resync для пользователя 1, quiz 35
app_1       | 2026/02/10 13:38:00 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:00 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:00 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:00 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:00 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:question
app_1       | 2026/02/10 13:38:00 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/10 13:38:00 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:00 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:00 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:00 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:00 [QuestionManager] Событие quiz:question для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:38:00 [QuestionManager][DEBUG] Викторина #35, Вопрос #293: Ожидание завершения таймера (10s)...
app_1       | 2026/02/10 13:38:01 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:01 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:01 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:01 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:01 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:01 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:01 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:01 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:01 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:01 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:01 [QuestionManager] Таймер вопроса #293 (1 из 0): осталось 8 секунд
app_1       | 2026/02/10 13:38:02 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:02 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:02 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:02 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:02 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:02 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:02 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:02 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:02 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:02 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:02 [QuestionManager] Таймер вопроса #293 (1 из 0): осталось 7 секунд
app_1       | 2026/02/10 13:38:03 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:03 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:03 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:03 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:03 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:03 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:03 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:03 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:03 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:03 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:03 [QuestionManager] Таймер вопроса #293 (1 из 0): осталось 6 секунд
app_1       | 2026/02/10 13:38:04 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:04 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:04 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:04 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:04 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:04 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:04 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:04 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:04 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:04 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:04 [QuestionManager] Таймер вопроса #293 (1 из 0): осталось 5 секунд
app_1       | 2026/02/10 13:38:05 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:05 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:05 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:05 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:05 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:05 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:05 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:05 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:05 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:05 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:05 [QuestionManager] Таймер вопроса #293 (1 из 0): осталось 4 секунд
app_1       | 2026/02/10 13:38:06 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:06 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:06 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:06 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:06 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:06 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:06 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:06 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:06 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:06 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:06 [QuestionManager] Таймер вопроса #293 (1 из 0): осталось 3 секунд
app_1       | 2026/02/10 13:38:07 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:07 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:07 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:07 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:07 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:07 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:07 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:07 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:07 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:07 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:07 [QuestionManager] Таймер вопроса #293 (1 из 0): осталось 2 секунд
app_1       | 2026/02/10 13:38:08 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:08 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:08 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:08 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:08 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:08 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:08 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:08 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:08 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:08 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:08 [QuestionManager] Таймер вопроса #293 (1 из 0): осталось 1 секунд
app_1       | 2026/02/10 13:38:09 [AnswerProcessor] Обработка ответа пользователя #1 на вопрос #293 (викторина #35), выбранный вариант: 1
app_1       | 
app_1       | 2026/02/10 13:38:09 /app/internal/repository/postgres/result_repo.go:25
app_1       | [9.171ms] [rows:1] INSERT INTO "user_answers" ("user_id","quiz_id","question_id","selected_option","is_correct","response_time_ms","score","is_eliminated","elimination_reason","created_at") VALUES (1,35,293,1,true,8858,1,false,'','2026-02-10 13:38:09.389') RETURNING "id"
app_1       | 2026/02/10 13:38:09 [AnswerProcessor] Ответ User #1 на Q #293 успешно сохранен в БД.
app_1       | 2026/02/10 13:38:09 [AnswerProcessor] Успешно обработан и отправлен результат для User #1 на Q #293 (Quiz #35). Выбыл: false
app_1       | 2026/02/10 13:38:09 [QuestionManager] Время на вопрос #293 (1 из 0) викторины #35 истекло
app_1       | 2026/02/10 13:38:10 [QuestionManager] Викторина #35, Вопрос #293 (1 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/10 13:38:10 [QuestionManager][DEBUG] Викторина #35, Вопрос #293: Получение участников из Redis Set quiz:35:participants...
app_1       | 2026/02/10 13:38:10 [QuestionManager][DEBUG] Викторина #35, Вопрос #293: SMembers вернул 1 участников
app_1       | 2026/02/10 13:38:10 [QuestionManager][DEBUG] Викторина #35, Вопрос #293: Проверка ответа для User #1 (Ключ: quiz:35:user:1:question:293)
app_1       | 2026/02/10 13:38:10 [QuestionManager][DEBUG] Викторина #35, Вопрос #293: User #1 УСПЕЛ ответить (ключ quiz:35:user:1:question:293 существует).
app_1       | 2026/02/10 13:38:10 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:10 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:10 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:10 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:10 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:10 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:10 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/10 13:38:10 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:10 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:10 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:10 [QuestionManager] Событие adaptive:question_stats для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:38:10 [QuestionManager] adaptive:question_stats отправлен для Q1: pass_rate=1.00, target=0.90
app_1       | 2026/02/10 13:38:10 [QuestionManager][DEBUG] Викторина #35, Вопрос #293: Отправка события quiz:answer_reveal...
app_1       | 2026/02/10 13:38:10 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:10 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:10 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:10 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:10 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:10 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:10 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:10 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/10 13:38:10 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:10 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:10 [QuestionManager] Событие quiz:answer_reveal для викторины #35 успешно отправлено с 1 попытки
app_1       | 
app_1       | 2026/02/10 13:38:10 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [7.462ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 35 AND question_after = 1 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/10 13:38:10 [QuestionManager] Пауза 500ms между вопросами 1 и 2
app_1       | 2026/02/10 13:38:11 [AdaptiveSelector] Quiz #35, Q2: prev_pass_rate=1.00, target_difficulty=2
app_1       | 
app_1       | 2026/02/10 13:38:11 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [2.735ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 35 AND difficulty = 2 AND is_used = false) AND id NOT IN (293) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/10 13:38:11 /app/internal/repository/postgres/question_repo.go:173
app_1       | [2.621ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 2 AND is_used = false) AND id NOT IN (293) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/10 13:38:11 [AdaptiveSelector] Found pool question ID=311 (difficulty=2)
app_1       | 2026/02/10 13:38:11 [AdaptiveSelector] Selected question ID=311, difficulty=2 for Q2
app_1       | 2026/02/10 13:38:11 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:11 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:11 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:11 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:11 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:11 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:11 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:question
app_1       | 2026/02/10 13:38:11 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/10 13:38:11 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:11 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:11 [QuestionManager] Событие quiz:question для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:38:11 [QuestionManager][DEBUG] Викторина #35, Вопрос #311: Ожидание завершения таймера (10s)...
app_1       | 2026/02/10 13:38:12 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:12 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:12 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:12 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:12 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:12 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:12 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:12 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:12 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:12 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:12 [QuestionManager] Таймер вопроса #311 (2 из 0): осталось 8 секунд
app_1       | 2026/02/10 13:38:13 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:13 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:13 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:13 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:13 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:13 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:13 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:13 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:13 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:13 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:13 [QuestionManager] Таймер вопроса #311 (2 из 0): осталось 7 секунд
app_1       | 2026/02/10 13:38:14 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:14 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:14 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:14 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:14 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:14 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:14 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:14 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:14 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:14 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:14 [QuestionManager] Таймер вопроса #311 (2 из 0): осталось 6 секунд
app_1       | 2026/02/10 13:38:15 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:15 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:15 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:15 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:15 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:15 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:15 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:15 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:15 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:15 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:15 [QuestionManager] Таймер вопроса #311 (2 из 0): осталось 5 секунд
app_1       | 2026/02/10 13:38:16 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:16 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:16 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:16 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:16 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:16 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:16 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:16 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:16 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:16 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:16 [QuestionManager] Таймер вопроса #311 (2 из 0): осталось 4 секунд
app_1       | 2026/02/10 13:38:17 [AnswerProcessor] Обработка ответа пользователя #1 на вопрос #311 (викторина #35), выбранный вариант: 2
app_1       | 
app_1       | 2026/02/10 13:38:17 /app/internal/repository/postgres/result_repo.go:25
app_1       | [3.681ms] [rows:1] INSERT INTO "user_answers" ("user_id","quiz_id","question_id","selected_option","is_correct","response_time_ms","score","is_eliminated","elimination_reason","created_at") VALUES (1,35,311,2,true,5643,1,false,'','2026-02-10 13:38:17.394') RETURNING "id"
app_1       | 2026/02/10 13:38:17 [AnswerProcessor] Ответ User #1 на Q #311 успешно сохранен в БД.
app_1       | 2026/02/10 13:38:17 [AnswerProcessor] Успешно обработан и отправлен результат для User #1 на Q #311 (Quiz #35). Выбыл: false
app_1       | 2026/02/10 13:38:17 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:17 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:17 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:17 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:17 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:17 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:17 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:17 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:17 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:17 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:17 [QuestionManager] Таймер вопроса #311 (2 из 0): осталось 3 секунд
app_1       | 2026/02/10 13:38:18 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:18 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:18 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:18 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:18 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:18 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:18 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:18 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:18 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:18 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:18 [QuestionManager] Таймер вопроса #311 (2 из 0): осталось 2 секунд
app_1       | 2026/02/10 13:38:19 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:19 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:19 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:19 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:19 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:19 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:19 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:19 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:19 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:19 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:19 [QuestionManager] Таймер вопроса #311 (2 из 0): осталось 1 секунд
app_1       | 2026/02/10 13:38:20 [QuestionManager] Время на вопрос #311 (2 из 0) викторины #35 истекло
app_1       | 2026/02/10 13:38:21 [QuestionManager] Викторина #35, Вопрос #311 (2 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/10 13:38:21 [QuestionManager][DEBUG] Викторина #35, Вопрос #311: Получение участников из Redis Set quiz:35:participants...
app_1       | 2026/02/10 13:38:21 [QuestionManager][DEBUG] Викторина #35, Вопрос #311: SMembers вернул 1 участников
app_1       | 2026/02/10 13:38:21 [QuestionManager][DEBUG] Викторина #35, Вопрос #311: Проверка ответа для User #1 (Ключ: quiz:35:user:1:question:311)
app_1       | 2026/02/10 13:38:21 [QuestionManager][DEBUG] Викторина #35, Вопрос #311: User #1 УСПЕЛ ответить (ключ quiz:35:user:1:question:311 существует).
app_1       | 2026/02/10 13:38:21 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:21 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:21 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:21 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:21 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:21 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/10 13:38:21 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:21 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:21 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:21 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:21 [QuestionManager] Событие adaptive:question_stats для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:38:21 [QuestionManager] adaptive:question_stats отправлен для Q2: pass_rate=1.00, target=0.85
app_1       | 2026/02/10 13:38:21 [QuestionManager][DEBUG] Викторина #35, Вопрос #311: Отправка события quiz:answer_reveal...
app_1       | 2026/02/10 13:38:21 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:21 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:21 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:21 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:21 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:21 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/10 13:38:21 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:21 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:21 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:21 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:21 [QuestionManager] Событие quiz:answer_reveal для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:38:21 [QuestionManager] Пауза 500ms между вопросами 2 и 3
app_1       | 
app_1       | 2026/02/10 13:38:21 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [3.843ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 35 AND question_after = 2 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/10 13:38:22 [AdaptiveSelector] Quiz #35, Q3: prev_pass_rate=1.00, target_difficulty=3
app_1       | 
app_1       | 2026/02/10 13:38:22 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [2.649ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 35 AND difficulty = 3 AND is_used = false) AND id NOT IN (293,311) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/10 13:38:22 /app/internal/repository/postgres/question_repo.go:173
app_1       | [4.188ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 3 AND is_used = false) AND id NOT IN (293,311) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/10 13:38:22 [AdaptiveSelector] Found pool question ID=362 (difficulty=3)
app_1       | 2026/02/10 13:38:22 [AdaptiveSelector] Selected question ID=362, difficulty=3 for Q3
app_1       | 2026/02/10 13:38:22 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:22 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:22 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:22 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:22 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:22 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:22 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:question
app_1       | 2026/02/10 13:38:22 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/10 13:38:22 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:22 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:22 [QuestionManager] Событие quiz:question для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:38:22 [QuestionManager][DEBUG] Викторина #35, Вопрос #362: Ожидание завершения таймера (10s)...
app_1       | 2026/02/10 13:38:23 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:23 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:23 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:23 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:23 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:23 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:23 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:23 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:23 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:23 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:23 [QuestionManager] Таймер вопроса #362 (3 из 0): осталось 8 секунд
app_1       | 2026/02/10 13:38:24 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:24 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:24 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:24 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:24 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:24 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:24 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:24 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:24 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:24 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:24 [QuestionManager] Таймер вопроса #362 (3 из 0): осталось 7 секунд
app_1       | 2026/02/10 13:38:25 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:25 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:25 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:25 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:25 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:25 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:25 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:25 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:25 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:25 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:25 [QuestionManager] Таймер вопроса #362 (3 из 0): осталось 6 секунд
app_1       | 2026/02/10 13:38:26 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:26 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:26 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:26 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:26 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:26 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:26 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:26 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:26 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:26 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:26 [QuestionManager] Таймер вопроса #362 (3 из 0): осталось 5 секунд
app_1       | 2026/02/10 13:38:27 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:27 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:27 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:27 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:27 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:27 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:27 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:27 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:27 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:27 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:27 [QuestionManager] Таймер вопроса #362 (3 из 0): осталось 4 секунд
app_1       | 2026/02/10 13:38:28 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:28 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:28 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:28 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:28 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:28 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:28 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:28 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:28 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:28 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:28 [QuestionManager] Таймер вопроса #362 (3 из 0): осталось 3 секунд
app_1       | 2026/02/10 13:38:29 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:29 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:29 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:29 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:29 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:29 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:29 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:29 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:29 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:29 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:29 [QuestionManager] Таймер вопроса #362 (3 из 0): осталось 2 секунд
app_1       | 2026/02/10 13:38:30 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:30 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:30 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:30 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:30 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:30 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:30 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:30 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:30 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:30 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:30 [QuestionManager] Таймер вопроса #362 (3 из 0): осталось 1 секунд
app_1       | 2026/02/10 13:38:31 [QuestionManager] Время на вопрос #362 (3 из 0) викторины #35 истекло
app_1       | 2026/02/10 13:38:32 [QuestionManager] Викторина #35, Вопрос #362 (3 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/10 13:38:32 [QuestionManager][DEBUG] Викторина #35, Вопрос #362: Получение участников из Redis Set quiz:35:participants...
app_1       | 2026/02/10 13:38:32 [QuestionManager][DEBUG] Викторина #35, Вопрос #362: SMembers вернул 1 участников
app_1       | 2026/02/10 13:38:32 [QuestionManager][DEBUG] Викторина #35, Вопрос #362: Проверка ответа для User #1 (Ключ: quiz:35:user:1:question:362)
app_1       | 2026/02/10 13:38:32 [QuestionManager][DEBUG] Викторина #35, Вопрос #362: User #1 НЕ ответил. Проверка ключа выбывания quiz:35:eliminated:1...
app_1       | 2026/02/10 13:38:32 [QuestionManager] Пользователь #1 выбывает из викторины #35. Причина: no_answer_timeout (Вопрос #362). Установка ключа quiz:35:eliminated:1...
app_1       | 2026/02/10 13:38:32 [QuestionManager][DEBUG] Сохранён user_answer для таймаута User #1 на вопрос #362
app_1       | 2026/02/10 13:38:32 [QuestionManager][DEBUG] Успешно установлен ключ выбывания quiz:35:eliminated:1 для User #1
app_1       | 
app_1       | 2026/02/10 13:38:32 /app/internal/repository/postgres/result_repo.go:25
app_1       | [4.249ms] [rows:1] INSERT INTO "user_answers" ("user_id","quiz_id","question_id","selected_option","is_correct","response_time_ms","score","is_eliminated","elimination_reason","created_at") VALUES (1,35,362,-1,false,0,0,true,'no_answer_timeout','2026-02-10 13:38:32.977') RETURNING "id"
app_1       | 2026/02/10 13:38:32 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:32 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:32 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:32 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:32 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:32 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/10 13:38:32 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:32 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:32 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:32 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:32 [QuestionManager] Событие adaptive:question_stats для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:38:32 [QuestionManager] adaptive:question_stats отправлен для Q3: pass_rate=0.00, target=0.78
app_1       | 2026/02/10 13:38:33 [QuestionManager][DEBUG] Викторина #35, Вопрос #362: Отправка события quiz:answer_reveal...
app_1       | 2026/02/10 13:38:33 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:33 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:33 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:33 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:33 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/10 13:38:33 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:33 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:33 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:33 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:33 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:33 [QuestionManager] Событие quiz:answer_reveal для викторины #35 успешно отправлено с 1 попытки
app_1       | 
app_1       | 2026/02/10 13:38:33 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [1.913ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 35 AND question_after = 3 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/10 13:38:33 [QuestionManager] Пауза 500ms между вопросами 3 и 4
app_1       | 2026/02/10 13:38:33 [AdaptiveSelector] Quiz #35, Q4: prev_pass_rate=0.00, target_difficulty=2
app_1       | 
app_1       | 2026/02/10 13:38:33 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [3.423ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 35 AND difficulty = 2 AND is_used = false) AND id NOT IN (293,311,362) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/10 13:38:33 /app/internal/repository/postgres/question_repo.go:173
app_1       | [2.702ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 2 AND is_used = false) AND id NOT IN (293,311,362) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/10 13:38:33 [AdaptiveSelector] Found pool question ID=347 (difficulty=2)
app_1       | 2026/02/10 13:38:33 [AdaptiveSelector] Selected question ID=347, difficulty=2 for Q4
app_1       | 2026/02/10 13:38:34 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:34 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:34 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:34 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:34 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:question
app_1       | 2026/02/10 13:38:34 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/10 13:38:34 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:34 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:34 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:34 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:34 [QuestionManager] Событие quiz:question для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:38:34 [QuestionManager][DEBUG] Викторина #35, Вопрос #347: Ожидание завершения таймера (10s)...
app_1       | 2026/02/10 13:38:35 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:35 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:35 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:35 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:35 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:35 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:35 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:35 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:35 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:35 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:35 [QuestionManager] Таймер вопроса #347 (4 из 0): осталось 8 секунд
app_1       | 2026/02/10 13:38:36 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:36 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:36 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:36 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:36 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:36 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:36 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:36 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:36 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:36 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:36 [QuestionManager] Таймер вопроса #347 (4 из 0): осталось 7 секунд
app_1       | 2026/02/10 13:38:36 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/10 13:38:37 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:37 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:37 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:37 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:37 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:37 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:37 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:37 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:37 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:37 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:37 [QuestionManager] Таймер вопроса #347 (4 из 0): осталось 6 секунд
app_1       | 2026/02/10 13:38:38 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:38 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:38 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:38 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:38 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:38 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:38 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:38 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:38 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:38 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:38 [QuestionManager] Таймер вопроса #347 (4 из 0): осталось 5 секунд
app_1       | 2026/02/10 13:38:39 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:39 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:39 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:39 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:39 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:39 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:39 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:39 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:39 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:39 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:39 [QuestionManager] Таймер вопроса #347 (4 из 0): осталось 4 секунд
app_1       | 2026/02/10 13:38:40 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:40 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:40 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:40 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:40 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:40 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:40 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:40 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:40 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:40 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:40 [QuestionManager] Таймер вопроса #347 (4 из 0): осталось 3 секунд
app_1       | 2026/02/10 13:38:41 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:41 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:41 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:41 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:41 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:41 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:41 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:41 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:41 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:41 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:41 [QuestionManager] Таймер вопроса #347 (4 из 0): осталось 2 секунд
app_1       | 2026/02/10 13:38:42 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:42 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:42 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:42 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:42 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:42 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:42 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:42 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:42 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:42 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:42 [QuestionManager] Таймер вопроса #347 (4 из 0): осталось 1 секунд
app_1       | 2026/02/10 13:38:43 [QuestionManager] Время на вопрос #347 (4 из 0) викторины #35 истекло
app_1       | 2026/02/10 13:38:44 [QuestionManager] Викторина #35, Вопрос #347 (4 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/10 13:38:44 [QuestionManager][DEBUG] Викторина #35, Вопрос #347: Получение участников из Redis Set quiz:35:participants...
app_1       | 2026/02/10 13:38:44 [QuestionManager][DEBUG] Викторина #35, Вопрос #347: SMembers вернул 1 участников
app_1       | 2026/02/10 13:38:44 [QuestionManager][DEBUG] Викторина #35, Вопрос #347: Проверка ответа для User #1 (Ключ: quiz:35:user:1:question:347)
app_1       | 2026/02/10 13:38:44 [QuestionManager][DEBUG] Викторина #35, Вопрос #347: User #1 НЕ ответил. Проверка ключа выбывания quiz:35:eliminated:1...
app_1       | 2026/02/10 13:38:44 [QuestionManager][DEBUG] Викторина #35, Вопрос #347: User #1 не ответил, но УЖЕ был выбывший (ключ quiz:35:eliminated:1 существует).
app_1       | 2026/02/10 13:38:44 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:44 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:44 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:44 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:44 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:44 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/10 13:38:44 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:44 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:44 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:44 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:44 [QuestionManager] Событие adaptive:question_stats для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:38:44 [QuestionManager] adaptive:question_stats отправлен для Q4: pass_rate=0.00, target=0.70
app_1       | 2026/02/10 13:38:44 [QuestionManager][DEBUG] Викторина #35, Вопрос #347: Отправка события quiz:answer_reveal...
app_1       | 2026/02/10 13:38:44 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:44 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:44 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:44 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:44 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:44 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:44 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:44 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/10 13:38:44 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:44 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:44 [QuestionManager] Событие quiz:answer_reveal для викторины #35 успешно отправлено с 1 попытки
app_1       | 
app_1       | 2026/02/10 13:38:44 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [2.030ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 35 AND question_after = 4 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/10 13:38:44 [QuestionManager] Пауза 500ms между вопросами 4 и 5
app_1       | 2026/02/10 13:38:44 [AdaptiveSelector] Quiz #35, Q5: prev_pass_rate=-1.00, target_difficulty=3
app_1       | 
app_1       | 2026/02/10 13:38:44 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [2.880ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 35 AND difficulty = 3 AND is_used = false) AND id NOT IN (293,311,362,347) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/10 13:38:44 [AdaptiveSelector] Found pool question ID=388 (difficulty=3)
app_1       | 2026/02/10 13:38:44 [AdaptiveSelector] Selected question ID=388, difficulty=3 for Q5
app_1       | 
app_1       | 2026/02/10 13:38:44 /app/internal/repository/postgres/question_repo.go:173
app_1       | [2.573ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 3 AND is_used = false) AND id NOT IN (293,311,362,347) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/10 13:38:45 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:45 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:45 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:45 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:45 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:question
app_1       | 2026/02/10 13:38:45 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/10 13:38:45 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:45 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:45 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:45 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:45 [QuestionManager] Событие quiz:question для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:38:45 [QuestionManager][DEBUG] Викторина #35, Вопрос #388: Ожидание завершения таймера (10s)...
app_1       | 2026/02/10 13:38:46 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:46 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:46 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:46 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:46 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:46 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:46 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:46 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:46 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:46 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:46 [QuestionManager] Таймер вопроса #388 (5 из 0): осталось 8 секунд
app_1       | 2026/02/10 13:38:47 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:47 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:47 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:47 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:47 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:47 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:47 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:47 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:47 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:47 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:47 [QuestionManager] Таймер вопроса #388 (5 из 0): осталось 7 секунд
app_1       | 2026/02/10 13:38:48 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:48 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:48 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:48 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:48 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:48 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:48 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:48 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:48 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:48 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:48 [QuestionManager] Таймер вопроса #388 (5 из 0): осталось 6 секунд
app_1       | 2026/02/10 13:38:49 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:49 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:49 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:49 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:49 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:49 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:49 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:49 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:49 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:49 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:49 [QuestionManager] Таймер вопроса #388 (5 из 0): осталось 5 секунд
app_1       | 2026/02/10 13:38:50 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:50 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:50 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:50 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:50 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:50 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:50 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:50 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:50 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:50 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:50 [QuestionManager] Таймер вопроса #388 (5 из 0): осталось 4 секунд
app_1       | 2026/02/10 13:38:51 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:51 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:51 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:51 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:51 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:51 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:51 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:51 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:51 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:51 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:51 [QuestionManager] Таймер вопроса #388 (5 из 0): осталось 3 секунд
app_1       | 2026/02/10 13:38:52 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:52 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:52 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:52 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:52 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:52 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:52 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:52 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:52 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:52 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:52 [QuestionManager] Таймер вопроса #388 (5 из 0): осталось 2 секунд
app_1       | 2026/02/10 13:38:53 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:53 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:53 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:53 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:53 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:53 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:53 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:53 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:53 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:53 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:53 [QuestionManager] Таймер вопроса #388 (5 из 0): осталось 1 секунд
app_1       | 2026/02/10 13:38:54 [QuestionManager] Время на вопрос #388 (5 из 0) викторины #35 истекло
app_1       | 2026/02/10 13:38:55 [QuestionManager] Викторина #35, Вопрос #388 (5 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/10 13:38:55 [QuestionManager][DEBUG] Викторина #35, Вопрос #388: Получение участников из Redis Set quiz:35:participants...
app_1       | 2026/02/10 13:38:55 [QuestionManager][DEBUG] Викторина #35, Вопрос #388: SMembers вернул 1 участников
app_1       | 2026/02/10 13:38:55 [QuestionManager][DEBUG] Викторина #35, Вопрос #388: Проверка ответа для User #1 (Ключ: quiz:35:user:1:question:388)
app_1       | 2026/02/10 13:38:55 [QuestionManager][DEBUG] Викторина #35, Вопрос #388: User #1 НЕ ответил. Проверка ключа выбывания quiz:35:eliminated:1...
app_1       | 2026/02/10 13:38:55 [QuestionManager][DEBUG] Викторина #35, Вопрос #388: User #1 не ответил, но УЖЕ был выбывший (ключ quiz:35:eliminated:1 существует).
app_1       | 2026/02/10 13:38:55 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:55 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:55 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:55 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:55 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:55 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/10 13:38:55 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:55 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:55 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:38:55 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:55 [QuestionManager] Событие adaptive:question_stats для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:38:55 [QuestionManager] adaptive:question_stats отправлен для Q5: pass_rate=0.00, target=0.62
app_1       | 2026/02/10 13:38:55 [QuestionManager][DEBUG] Викторина #35, Вопрос #388: Отправка события quiz:answer_reveal...
app_1       | 2026/02/10 13:38:55 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:55 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:55 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:55 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:55 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:55 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/10 13:38:55 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:55 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:55 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:38:55 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:55 [QuestionManager] Событие quiz:answer_reveal для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:38:55 [QuestionManager] Пауза 500ms между вопросами 5 и 6
app_1       | 
app_1       | 2026/02/10 13:38:55 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [3.712ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 35 AND question_after = 5 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/10 13:38:56 [AdaptiveSelector] Quiz #35, Q6: prev_pass_rate=-1.00, target_difficulty=4
app_1       | 
app_1       | 2026/02/10 13:38:56 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [3.344ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 35 AND difficulty = 4 AND is_used = false) AND id NOT IN (293,311,362,347,388) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/10 13:38:56 /app/internal/repository/postgres/question_repo.go:173
app_1       | [6.652ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 4 AND is_used = false) AND id NOT IN (293,311,362,347,388) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/10 13:38:56 [AdaptiveSelector] Found pool question ID=420 (difficulty=4)
app_1       | 2026/02/10 13:38:56 [AdaptiveSelector] Selected question ID=420, difficulty=4 for Q6
app_1       | 2026/02/10 13:38:56 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:56 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:56 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:56 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:56 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:question
app_1       | 2026/02/10 13:38:56 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/10 13:38:56 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:56 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:56 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:38:56 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:56 [QuestionManager] Событие quiz:question для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:38:56 [QuestionManager][DEBUG] Викторина #35, Вопрос #420: Ожидание завершения таймера (10s)...
app_1       | 2026/02/10 13:38:57 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:57 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:57 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:57 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:57 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:57 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:57 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:57 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:57 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:57 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:57 [QuestionManager] Таймер вопроса #420 (6 из 0): осталось 8 секунд
app_1       | 2026/02/10 13:38:58 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:58 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:58 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:58 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:58 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:58 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:58 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:58 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:58 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:58 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:58 [QuestionManager] Таймер вопроса #420 (6 из 0): осталось 7 секунд
app_1       | 2026/02/10 13:38:59 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:38:59 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:59 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:59 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:59 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:38:59 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:38:59 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:38:59 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:38:59 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:38:59 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:38:59 [QuestionManager] Таймер вопроса #420 (6 из 0): осталось 6 секунд
app_1       | 2026/02/10 13:39:00 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:00 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:00 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:00 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:00 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:00 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:00 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:00 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:00 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:00 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:00 [QuestionManager] Таймер вопроса #420 (6 из 0): осталось 5 секунд
app_1       | 2026/02/10 13:39:01 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:01 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:01 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:01 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:01 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:01 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:01 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:01 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:01 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:01 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:01 [QuestionManager] Таймер вопроса #420 (6 из 0): осталось 4 секунд
app_1       | 2026/02/10 13:39:02 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:02 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:02 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:02 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:02 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:02 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:02 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:02 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:02 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:02 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:02 [QuestionManager] Таймер вопроса #420 (6 из 0): осталось 3 секунд
app_1       | 2026/02/10 13:39:03 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:03 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:03 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:03 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:03 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:03 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:03 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:03 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:03 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:03 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:03 [QuestionManager] Таймер вопроса #420 (6 из 0): осталось 2 секунд
app_1       | 2026/02/10 13:39:04 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:04 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:04 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:04 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:04 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:04 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:04 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:04 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:04 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:04 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:04 [QuestionManager] Таймер вопроса #420 (6 из 0): осталось 1 секунд
app_1       | 2026/02/10 13:39:05 [QuestionManager] Время на вопрос #420 (6 из 0) викторины #35 истекло
app_1       | 2026/02/10 13:39:06 [QuestionManager] Викторина #35, Вопрос #420 (6 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/10 13:39:06 [QuestionManager][DEBUG] Викторина #35, Вопрос #420: Получение участников из Redis Set quiz:35:participants...
app_1       | 2026/02/10 13:39:06 [QuestionManager][DEBUG] Викторина #35, Вопрос #420: SMembers вернул 1 участников
app_1       | 2026/02/10 13:39:06 [QuestionManager][DEBUG] Викторина #35, Вопрос #420: Проверка ответа для User #1 (Ключ: quiz:35:user:1:question:420)
app_1       | 2026/02/10 13:39:06 [QuestionManager][DEBUG] Викторина #35, Вопрос #420: User #1 НЕ ответил. Проверка ключа выбывания quiz:35:eliminated:1...
app_1       | 2026/02/10 13:39:06 [QuestionManager][DEBUG] Викторина #35, Вопрос #420: User #1 не ответил, но УЖЕ был выбывший (ключ quiz:35:eliminated:1 существует).
app_1       | 2026/02/10 13:39:06 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:06 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:06 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:06 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:06 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:06 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/10 13:39:06 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:06 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:06 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:06 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:06 [QuestionManager] Событие adaptive:question_stats для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:39:06 [QuestionManager] adaptive:question_stats отправлен для Q6: pass_rate=0.00, target=0.55
app_1       | 2026/02/10 13:39:06 [QuestionManager][DEBUG] Викторина #35, Вопрос #420: Отправка события quiz:answer_reveal...
app_1       | 2026/02/10 13:39:06 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:06 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:06 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:06 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:06 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:06 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/10 13:39:06 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:06 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:06 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:06 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:06 [QuestionManager] Событие quiz:answer_reveal для викторины #35 успешно отправлено с 1 попытки
app_1       | 
app_1       | 2026/02/10 13:39:06 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [2.858ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 35 AND question_after = 6 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/10 13:39:06 [QuestionManager] Пауза 500ms между вопросами 6 и 7
app_1       | 2026/02/10 13:39:07 [AdaptiveSelector] Quiz #35, Q7: prev_pass_rate=-1.00, target_difficulty=4
app_1       | 
app_1       | 2026/02/10 13:39:07 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [2.579ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 35 AND difficulty = 4 AND is_used = false) AND id NOT IN (293,311,362,347,388,420) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/10 13:39:07 [AdaptiveSelector] Found pool question ID=427 (difficulty=4)
app_1       | 2026/02/10 13:39:07 [AdaptiveSelector] Selected question ID=427, difficulty=4 for Q7
app_1       | 
app_1       | 2026/02/10 13:39:07 /app/internal/repository/postgres/question_repo.go:173
app_1       | [2.699ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 4 AND is_used = false) AND id NOT IN (293,311,362,347,388,420) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/10 13:39:07 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:07 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:07 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:07 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:07 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:question
app_1       | 2026/02/10 13:39:07 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/10 13:39:07 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:07 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:07 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:07 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:07 [QuestionManager] Событие quiz:question для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:39:07 [QuestionManager][DEBUG] Викторина #35, Вопрос #427: Ожидание завершения таймера (10s)...
app_1       | 2026/02/10 13:39:08 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:08 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:08 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:08 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:08 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:08 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:08 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:08 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:08 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:08 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:08 [QuestionManager] Таймер вопроса #427 (7 из 0): осталось 8 секунд
app_1       | 2026/02/10 13:39:09 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:09 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:09 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:09 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:09 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:09 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:09 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:09 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:09 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:09 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:09 [QuestionManager] Таймер вопроса #427 (7 из 0): осталось 7 секунд
app_1       | 2026/02/10 13:39:10 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:10 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:10 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:10 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:10 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:10 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:10 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:10 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:10 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:10 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:10 [QuestionManager] Таймер вопроса #427 (7 из 0): осталось 6 секунд
app_1       | 2026/02/10 13:39:11 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:11 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:11 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:11 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:11 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:11 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:11 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:11 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:11 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:11 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:11 [QuestionManager] Таймер вопроса #427 (7 из 0): осталось 5 секунд
app_1       | 2026/02/10 13:39:12 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:12 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:12 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:12 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:12 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:12 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:12 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:12 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:12 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:12 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:12 [QuestionManager] Таймер вопроса #427 (7 из 0): осталось 4 секунд
app_1       | 2026/02/10 13:39:13 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:13 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:13 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:13 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:13 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:13 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:13 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:13 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:13 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:13 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:13 [QuestionManager] Таймер вопроса #427 (7 из 0): осталось 3 секунд
app_1       | 2026/02/10 13:39:14 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:14 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:14 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:14 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:14 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:14 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:14 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:14 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:14 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:14 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:14 [QuestionManager] Таймер вопроса #427 (7 из 0): осталось 2 секунд
app_1       | 2026/02/10 13:39:15 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:15 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:15 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:15 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:15 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:15 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:15 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:15 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:15 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:15 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:15 [QuestionManager] Таймер вопроса #427 (7 из 0): осталось 1 секунд
app_1       | 2026/02/10 13:39:16 [QuestionManager] Время на вопрос #427 (7 из 0) викторины #35 истекло
app_1       | 2026/02/10 13:39:17 [QuestionManager] Викторина #35, Вопрос #427 (7 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/10 13:39:17 [QuestionManager][DEBUG] Викторина #35, Вопрос #427: Получение участников из Redis Set quiz:35:participants...
app_1       | 2026/02/10 13:39:17 [QuestionManager][DEBUG] Викторина #35, Вопрос #427: SMembers вернул 1 участников
app_1       | 2026/02/10 13:39:17 [QuestionManager][DEBUG] Викторина #35, Вопрос #427: Проверка ответа для User #1 (Ключ: quiz:35:user:1:question:427)
app_1       | 2026/02/10 13:39:17 [QuestionManager][DEBUG] Викторина #35, Вопрос #427: User #1 НЕ ответил. Проверка ключа выбывания quiz:35:eliminated:1...
app_1       | 2026/02/10 13:39:17 [QuestionManager][DEBUG] Викторина #35, Вопрос #427: User #1 не ответил, но УЖЕ был выбывший (ключ quiz:35:eliminated:1 существует).
app_1       | 2026/02/10 13:39:17 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:17 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:17 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:17 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:17 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:17 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/10 13:39:17 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:17 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:17 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:17 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:17 [QuestionManager] Событие adaptive:question_stats для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:39:17 [QuestionManager] adaptive:question_stats отправлен для Q7: pass_rate=0.00, target=0.48
app_1       | 2026/02/10 13:39:18 [QuestionManager][DEBUG] Викторина #35, Вопрос #427: Отправка события quiz:answer_reveal...
app_1       | 2026/02/10 13:39:18 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:18 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:18 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:18 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:18 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:18 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:18 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:18 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/10 13:39:18 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:18 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:18 [QuestionManager] Событие quiz:answer_reveal для викторины #35 успешно отправлено с 1 попытки
app_1       | 
app_1       | 2026/02/10 13:39:18 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [2.430ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 35 AND question_after = 7 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/10 13:39:18 [QuestionManager] Пауза 500ms между вопросами 7 и 8
app_1       | 2026/02/10 13:39:18 [AdaptiveSelector] Quiz #35, Q8: prev_pass_rate=-1.00, target_difficulty=5
app_1       | 
app_1       | 2026/02/10 13:39:18 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [3.364ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 35 AND difficulty = 5 AND is_used = false) AND id NOT IN (293,311,362,347,388,420,427) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/10 13:39:18 /app/internal/repository/postgres/question_repo.go:173
app_1       | [5.040ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 5 AND is_used = false) AND id NOT IN (293,311,362,347,388,420,427) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/10 13:39:18 [AdaptiveSelector] Found pool question ID=455 (difficulty=5)
app_1       | 2026/02/10 13:39:18 [AdaptiveSelector] Selected question ID=455, difficulty=5 for Q8
app_1       | 2026/02/10 13:39:19 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:19 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:19 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:19 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:19 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:question
app_1       | 2026/02/10 13:39:19 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/10 13:39:19 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:19 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:19 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:19 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:19 [QuestionManager] Событие quiz:question для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:39:19 [QuestionManager][DEBUG] Викторина #35, Вопрос #455: Ожидание завершения таймера (10s)...
app_1       | 2026/02/10 13:39:20 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:20 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:20 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:20 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:20 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:20 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:20 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:20 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:20 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:20 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:20 [QuestionManager] Таймер вопроса #455 (8 из 0): осталось 8 секунд
app_1       | 2026/02/10 13:39:21 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:21 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:21 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:21 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:21 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:21 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:21 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:21 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:21 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:21 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:21 [QuestionManager] Таймер вопроса #455 (8 из 0): осталось 7 секунд
app_1       | 2026/02/10 13:39:22 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:22 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:22 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:22 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:22 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:22 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:22 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:22 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:22 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:22 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:22 [QuestionManager] Таймер вопроса #455 (8 из 0): осталось 6 секунд
app_1       | 2026/02/10 13:39:23 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:23 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:23 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:23 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:23 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:23 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:23 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:23 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:23 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:23 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:23 [QuestionManager] Таймер вопроса #455 (8 из 0): осталось 5 секунд
app_1       | 2026/02/10 13:39:24 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:24 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:24 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:24 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:24 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:24 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:24 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:24 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:24 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:24 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:24 [QuestionManager] Таймер вопроса #455 (8 из 0): осталось 4 секунд
app_1       | 2026/02/10 13:39:25 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:25 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:25 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:25 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:25 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:25 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:25 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:25 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:25 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:25 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:25 [QuestionManager] Таймер вопроса #455 (8 из 0): осталось 3 секунд
app_1       | 2026/02/10 13:39:26 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:26 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:26 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:26 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:26 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:26 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:26 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:26 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:26 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:26 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:26 [QuestionManager] Таймер вопроса #455 (8 из 0): осталось 2 секунд
app_1       | 2026/02/10 13:39:27 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:27 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:27 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:27 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:27 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:27 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:27 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:27 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:27 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:27 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:27 [QuestionManager] Таймер вопроса #455 (8 из 0): осталось 1 секунд
app_1       | 2026/02/10 13:39:28 [QuestionManager] Время на вопрос #455 (8 из 0) викторины #35 истекло
app_1       | 2026/02/10 13:39:29 [QuestionManager] Викторина #35, Вопрос #455 (8 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/10 13:39:29 [QuestionManager][DEBUG] Викторина #35, Вопрос #455: Получение участников из Redis Set quiz:35:participants...
app_1       | 2026/02/10 13:39:29 [QuestionManager][DEBUG] Викторина #35, Вопрос #455: SMembers вернул 1 участников
app_1       | 2026/02/10 13:39:29 [QuestionManager][DEBUG] Викторина #35, Вопрос #455: Проверка ответа для User #1 (Ключ: quiz:35:user:1:question:455)
app_1       | 2026/02/10 13:39:29 [QuestionManager][DEBUG] Викторина #35, Вопрос #455: User #1 НЕ ответил. Проверка ключа выбывания quiz:35:eliminated:1...
app_1       | 2026/02/10 13:39:29 [QuestionManager][DEBUG] Викторина #35, Вопрос #455: User #1 не ответил, но УЖЕ был выбывший (ключ quiz:35:eliminated:1 существует).
app_1       | 2026/02/10 13:39:29 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:29 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:29 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:29 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:29 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:29 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:29 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:29 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/10 13:39:29 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:29 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:29 [QuestionManager] Событие adaptive:question_stats для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:39:29 [QuestionManager] adaptive:question_stats отправлен для Q8: pass_rate=0.00, target=0.42
app_1       | 2026/02/10 13:39:29 [QuestionManager][DEBUG] Викторина #35, Вопрос #455: Отправка события quiz:answer_reveal...
app_1       | 2026/02/10 13:39:29 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:29 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:29 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:29 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:29 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/10 13:39:29 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:29 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:29 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:29 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:29 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:29 [QuestionManager] Событие quiz:answer_reveal для викторины #35 успешно отправлено с 1 попытки
app_1       | 
app_1       | 2026/02/10 13:39:29 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [1.974ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 35 AND question_after = 8 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/10 13:39:29 [QuestionManager] Пауза 500ms между вопросами 8 и 9
app_1       | 2026/02/10 13:39:29 [AdaptiveSelector] Quiz #35, Q9: prev_pass_rate=-1.00, target_difficulty=5
app_1       | 
app_1       | 2026/02/10 13:39:29 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [2.083ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 35 AND difficulty = 5 AND is_used = false) AND id NOT IN (293,311,362,347,388,420,427,455) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/10 13:39:29 /app/internal/repository/postgres/question_repo.go:173
app_1       | [2.244ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 5 AND is_used = false) AND id NOT IN (293,311,362,347,388,420,427,455) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/10 13:39:29 [AdaptiveSelector] Found pool question ID=490 (difficulty=5)
app_1       | 2026/02/10 13:39:29 [AdaptiveSelector] Selected question ID=490, difficulty=5 for Q9
app_1       | 2026/02/10 13:39:30 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:30 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:30 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:30 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:30 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:30 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:30 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:question
app_1       | 2026/02/10 13:39:30 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/10 13:39:30 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:30 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:30 [QuestionManager] Событие quiz:question для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:39:30 [QuestionManager][DEBUG] Викторина #35, Вопрос #490: Ожидание завершения таймера (10s)...
app_1       | 2026/02/10 13:39:31 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:31 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:31 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:31 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:31 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:31 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:31 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:31 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:31 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:31 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:31 [QuestionManager] Таймер вопроса #490 (9 из 0): осталось 8 секунд
app_1       | 2026/02/10 13:39:32 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:32 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:32 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:32 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:32 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:32 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:32 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:32 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:32 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:32 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:32 [QuestionManager] Таймер вопроса #490 (9 из 0): осталось 7 секунд
app_1       | 2026/02/10 13:39:33 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:33 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:33 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:33 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:33 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:33 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:33 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:33 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:33 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:33 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:33 [QuestionManager] Таймер вопроса #490 (9 из 0): осталось 6 секунд
app_1       | 2026/02/10 13:39:34 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:34 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:34 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:34 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:34 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:34 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:34 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:34 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:34 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:34 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:34 [QuestionManager] Таймер вопроса #490 (9 из 0): осталось 5 секунд
app_1       | 2026/02/10 13:39:35 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:35 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:35 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:35 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:35 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:35 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:35 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:35 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:35 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:35 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:35 [QuestionManager] Таймер вопроса #490 (9 из 0): осталось 4 секунд
app_1       | 2026/02/10 13:39:36 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:36 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:36 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:36 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:36 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:36 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:36 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:36 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:36 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:36 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:36 [QuestionManager] Таймер вопроса #490 (9 из 0): осталось 3 секунд
app_1       | 2026/02/10 13:39:36 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
app_1       | 2026/02/10 13:39:37 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:37 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:37 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:37 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:37 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:37 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:37 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:37 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:37 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:37 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:37 [QuestionManager] Таймер вопроса #490 (9 из 0): осталось 2 секунд
app_1       | 2026/02/10 13:39:38 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:38 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:38 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:38 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:38 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:38 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:38 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:38 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:38 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:38 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:38 [QuestionManager] Таймер вопроса #490 (9 из 0): осталось 1 секунд
app_1       | 2026/02/10 13:39:39 [QuestionManager] Время на вопрос #490 (9 из 0) викторины #35 истекло
app_1       | 2026/02/10 13:39:40 [QuestionManager] Викторина #35, Вопрос #490 (9 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/10 13:39:40 [QuestionManager][DEBUG] Викторина #35, Вопрос #490: Получение участников из Redis Set quiz:35:participants...
app_1       | 2026/02/10 13:39:40 [QuestionManager][DEBUG] Викторина #35, Вопрос #490: SMembers вернул 1 участников
app_1       | 2026/02/10 13:39:40 [QuestionManager][DEBUG] Викторина #35, Вопрос #490: Проверка ответа для User #1 (Ключ: quiz:35:user:1:question:490)
app_1       | 2026/02/10 13:39:40 [QuestionManager][DEBUG] Викторина #35, Вопрос #490: User #1 НЕ ответил. Проверка ключа выбывания quiz:35:eliminated:1...
app_1       | 2026/02/10 13:39:40 [QuestionManager][DEBUG] Викторина #35, Вопрос #490: User #1 не ответил, но УЖЕ был выбывший (ключ quiz:35:eliminated:1 существует).
app_1       | 2026/02/10 13:39:40 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:40 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:40 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:40 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:40 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:40 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:40 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:40 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/10 13:39:40 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:40 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:40 [QuestionManager] Событие adaptive:question_stats для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:39:40 [QuestionManager] adaptive:question_stats отправлен для Q9: pass_rate=0.00, target=0.36
app_1       | 2026/02/10 13:39:40 [QuestionManager][DEBUG] Викторина #35, Вопрос #490: Отправка события quiz:answer_reveal...
app_1       | 2026/02/10 13:39:40 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:40 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:40 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:40 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:40 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:40 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:40 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:40 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/10 13:39:40 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:40 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:40 [QuestionManager] Событие quiz:answer_reveal для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:39:40 [QuestionManager] Пауза 500ms между вопросами 9 и 10
app_1       | 
app_1       | 2026/02/10 13:39:40 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [1.864ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 35 AND question_after = 9 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/10 13:39:41 [AdaptiveSelector] Quiz #35, Q10: prev_pass_rate=-1.00, target_difficulty=5
app_1       | 
app_1       | 2026/02/10 13:39:41 /app/internal/repository/postgres/question_repo.go:155 record not found
app_1       | [2.290ms] [rows:0] SELECT * FROM "questions" WHERE (quiz_id = 35 AND difficulty = 5 AND is_used = false) AND id NOT IN (293,311,362,347,388,420,427,455,490) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/10 13:39:41 [AdaptiveSelector] Found pool question ID=512 (difficulty=5)
app_1       | 2026/02/10 13:39:41 [AdaptiveSelector] Selected question ID=512, difficulty=5 for Q10
app_1       | 
app_1       | 2026/02/10 13:39:41 /app/internal/repository/postgres/question_repo.go:173
app_1       | [2.273ms] [rows:1] SELECT * FROM "questions" WHERE (quiz_id IS NULL AND difficulty = 5 AND is_used = false) AND id NOT IN (293,311,362,347,388,420,427,455,490) ORDER BY RANDOM(),"questions"."id" LIMIT 1
app_1       | 2026/02/10 13:39:41 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:41 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:41 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:41 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:41 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:question
app_1       | 2026/02/10 13:39:41 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:question. Buffer len: 0
app_1       | 2026/02/10 13:39:41 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:41 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:41 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:question
app_1       | 2026/02/10 13:39:41 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:41 [QuestionManager] Событие quiz:question для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:39:41 [QuestionManager][DEBUG] Викторина #35, Вопрос #512: Ожидание завершения таймера (10s)...
app_1       | 2026/02/10 13:39:42 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:42 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:42 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:42 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:42 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:42 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:42 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:42 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:42 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:42 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:42 [QuestionManager] Таймер вопроса #512 (10 из 0): осталось 8 секунд
app_1       | 2026/02/10 13:39:43 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:43 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:43 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:43 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:43 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:43 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:43 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:43 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:43 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:43 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:43 [QuestionManager] Таймер вопроса #512 (10 из 0): осталось 7 секунд
app_1       | 2026/02/10 13:39:44 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:44 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:44 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:44 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:44 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:44 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:44 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:44 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:44 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:44 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:44 [QuestionManager] Таймер вопроса #512 (10 из 0): осталось 6 секунд
app_1       | 2026/02/10 13:39:45 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:45 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:45 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:45 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:45 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:45 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:45 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:45 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:45 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:45 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:45 [QuestionManager] Таймер вопроса #512 (10 из 0): осталось 5 секунд
app_1       | 2026/02/10 13:39:46 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:46 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:46 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:46 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:46 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:46 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:46 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:46 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:46 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:46 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:46 [QuestionManager] Таймер вопроса #512 (10 из 0): осталось 4 секунд
app_1       | 2026/02/10 13:39:47 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:47 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:47 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:47 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:47 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:47 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:47 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:47 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:47 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:47 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:47 [QuestionManager] Таймер вопроса #512 (10 из 0): осталось 3 секунд
app_1       | 2026/02/10 13:39:48 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:48 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:48 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:48 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:48 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:48 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:48 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:48 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:48 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:48 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:48 [QuestionManager] Таймер вопроса #512 (10 из 0): осталось 2 секунд
app_1       | 2026/02/10 13:39:49 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:49 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:49 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:49 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:49 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:timer
app_1       | 2026/02/10 13:39:49 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:timer. Buffer len: 0
app_1       | 2026/02/10 13:39:49 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:49 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:49 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:timer
app_1       | 2026/02/10 13:39:49 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:49 [QuestionManager] Таймер вопроса #512 (10 из 0): осталось 1 секунд
app_1       | 2026/02/10 13:39:50 [QuestionManager] Время на вопрос #512 (10 из 0) викторины #35 истекло
app_1       | 2026/02/10 13:39:51 [QuestionManager] Викторина #35, Вопрос #512 (10 из 10): Время истекло. Начинаем проверку не ответивших.
app_1       | 2026/02/10 13:39:51 [QuestionManager][DEBUG] Викторина #35, Вопрос #512: Получение участников из Redis Set quiz:35:participants...
app_1       | 2026/02/10 13:39:51 [QuestionManager][DEBUG] Викторина #35, Вопрос #512: SMembers вернул 1 участников
app_1       | 2026/02/10 13:39:51 [QuestionManager][DEBUG] Викторина #35, Вопрос #512: Проверка ответа для User #1 (Ключ: quiz:35:user:1:question:512)
app_1       | 2026/02/10 13:39:51 [QuestionManager][DEBUG] Викторина #35, Вопрос #512: User #1 НЕ ответил. Проверка ключа выбывания quiz:35:eliminated:1...
app_1       | 2026/02/10 13:39:51 [QuestionManager][DEBUG] Викторина #35, Вопрос #512: User #1 не ответил, но УЖЕ был выбывший (ключ quiz:35:eliminated:1 существует).
app_1       | 2026/02/10 13:39:51 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:51 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: adaptive:question_stats. Buffer len: 0
app_1       | 2026/02/10 13:39:51 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:51 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:51 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: adaptive:question_stats
app_1       | 2026/02/10 13:39:51 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:51 [QuestionManager] Событие adaptive:question_stats для викторины #35 успешно отправлено с 1 попытки
app_1       | 2026/02/10 13:39:51 [QuestionManager] adaptive:question_stats отправлен для Q10: pass_rate=0.00, target=0.50
app_1       | 2026/02/10 13:39:51 [QuestionManager][DEBUG] Викторина #35, Вопрос #512: Отправка события quiz:answer_reveal...
app_1       | 2026/02/10 13:39:51 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:51 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:51 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:51 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:answer_reveal
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:answer_reveal. Buffer len: 0
app_1       | 2026/02/10 13:39:51 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:51 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:51 [QuestionManager] Событие quiz:answer_reveal для викторины #35 успешно отправлено с 1 попытки
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/repository/postgres/quiz_ad_slot_repo.go:50 record not found
app_1       | [1.952ms] [rows:0] SELECT * FROM "quiz_ad_slots" WHERE quiz_id = 35 AND question_after = 10 AND is_active = true ORDER BY "quiz_ad_slots"."id" LIMIT 1
app_1       | 2026/02/10 13:39:51 [QuestionManager] Помечено 10 вопросов как использованные
app_1       | 2026/02/10 13:39:51 [QuestionManager] Сигнал о завершении вопросов для викторины #35 отправлен
app_1       | 2026/02/10 13:39:51 [QuizManager] Завершение викторины #35
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/repository/postgres/question_repo.go:135
app_1       | [7.459ms] [rows:10] UPDATE "questions" SET "is_used"=true,"updated_at"='2026-02-10 13:39:51.724' WHERE id IN (293,311,362,347,388,420,427,455,490,512)
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/repository/postgres/quiz_repo.go:90
app_1       | [3.202ms] [rows:1] UPDATE "quizzes" SET "title"='Тест викторины после коммита с адаптивной сложность и распредлением призов.',"description"='',"scheduled_time"='2026-02-10 13:38:00',"status"='completed',"question_count"=0,"prize_fund"=7999,"created_at"='2026-02-10 13:37:24.616',"updated_at"='2026-02-10 13:39:51.729' WHERE "id" = 35
app_1       | 2026/02/10 13:39:51 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:51 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:finish
app_1       | 2026/02/10 13:39:51 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:finish
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:finish
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:51 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:finish
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:finish
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:finish. Buffer len: 0
app_1       | 2026/02/10 13:39:51 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:51 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:51 [QuizManager] Получение списка участников из Redis Set quiz:35:participants для викторины #35...
app_1       | 2026/02/10 13:39:51 [QuizManager] Расчет и сохранение итоговых результатов для 1 участников викторины #35...
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/repository/postgres/user_repo.go:33
app_1       | [2.203ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.565ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 35
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [2.390ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 35 ORDER BY "quizzes"."id" LIMIT 1
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/repository/postgres/result_repo.go:33
app_1       | [1.591ms] [rows:3] SELECT * FROM "user_answers" WHERE user_id = 1 AND quiz_id = 35 ORDER BY created_at
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/repository/postgres/result_repo.go:165
app_1       | [1.351ms] [rows:3] SELECT * FROM "user_answers" WHERE quiz_id = 35
app_1       | 2026/02/10 13:39:51 [ResultService] getTotalQuestions: викторина #35 — fallback на user_answers (3 уникальных вопросов)
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/service/result_service.go:128
app_1       | [7.825ms] [rows:1] INSERT INTO "results" ("user_id","quiz_id","username","profile_picture","score","correct_answers","total_questions","rank","is_winner","prize_fund","is_eliminated","completed_at","created_at","updated_at","eliminated_on_question","elimination_reason") VALUES (1,35,'Temirlan','',2,2,3,0,false,0,true,'2026-02-10 13:39:51.744','2026-02-10 13:39:51.746','2026-02-10 13:39:51.746',3,'no_answer_timeout') RETURNING "eliminated_on_question","elimination_reason","id"
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/service/result_service.go:135
app_1       | [2.970ms] [rows:1] UPDATE "users" SET "total_score"=total_score + 2,"updated_at"='2026-02-10 13:39:51.754' WHERE id = 1
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/service/result_service.go:142
app_1       | [2.165ms] [rows:0] UPDATE "users" SET "highest_score"=2,"updated_at"='2026-02-10 13:39:51.756' WHERE id = 1 AND highest_score < 2
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/service/result_service.go:148
app_1       | [1.826ms] [rows:1] UPDATE "users" SET "games_played"=games_played + 1 WHERE id = 1
app_1       | 2026/02/10 13:39:51 [ResultService] Успешно рассчитан и сохранен результат для пользователя #1 в викторине #35
app_1       | 2026/02/10 13:39:51 [QuizManager] Индивидуальные результаты для викторины #35 рассчитаны.
app_1       | 2026/02/10 13:39:51 [QuizManager] Определение победителей и распределение призов для викторины #35...
app_1       | 2026/02/10 13:39:51 [ResultService] Финализация результатов для викторины #35
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [0.761ms] [rows:0] SELECT * FROM "questions" WHERE "questions"."quiz_id" = 35
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/repository/postgres/quiz_repo.go:70
app_1       | [2.953ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 35 ORDER BY "quizzes"."id" LIMIT 1
app_1       | 2026/02/10 13:39:51 [ResultService] Викторина #35: вопросы определены по user_answers (3 уникальных)
app_1       | 2026/02/10 13:39:51 [ResultService] Викторина #35: определение победителей на основе 3 вопросов
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/repository/postgres/result_repo.go:165
app_1       | [0.786ms] [rows:3] SELECT * FROM "user_answers" WHERE quiz_id = 35
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/repository/postgres/result_repo.go:152
app_1       | [5.873ms] [rows:1] 
app_1       |   WITH RankedResults AS (
app_1       |       SELECT
app_1       |           id,
app_1       |           RANK() OVER (ORDER BY score DESC, correct_answers DESC) as calculated_rank
app_1       |       FROM results
app_1       |       WHERE quiz_id = 35
app_1       |   )
app_1       |   UPDATE results r
app_1       |   SET rank = rr.calculated_rank
app_1       |   FROM RankedResults rr
app_1       |   WHERE r.id = rr.id AND r.quiz_id = 35;
app_1       | 2026/02/10 13:39:51 [ResultRepo] Ranks successfully calculated and updated for quiz 35 within transaction
app_1       | 2026/02/10 13:39:51 [ResultService] Ранги для викторины #35 успешно рассчитаны и сохранены в транзакции.
app_1       | 2026/02/10 13:39:51 [ResultRepo] FindAndUpdateWinners: Quiz 35, Winners found: 0, Prize per winner: 0 (within transaction)
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/repository/postgres/result_repo.go:191
app_1       | [2.357ms] [rows:0] SELECT "user_id" FROM "results" WHERE quiz_id = 35 AND correct_answers = 3 AND is_eliminated = false
app_1       | 
app_1       | 2026/02/10 13:39:51 /app/internal/repository/postgres/result_repo.go:231
app_1       | [1.697ms] [rows:1] UPDATE "results" SET "is_winner"=false,"prize_fund"=0,"updated_at"='2026-02-10 13:39:51.775' WHERE quiz_id = 35
app_1       | 2026/02/10 13:39:51 [ResultService] Найдено и обновлено 0 победителей для викторины #35 в транзакции. Приз на победителя: 0.
app_1       | 2026/02/10 13:39:51 ShardedHub: Broadcasting message to Quiz 35 across all shards
app_1       | 2026/02/10 13:39:51 [Shard 3][Quiz 35] BroadcastToQuiz called. Message type: quiz:results_available
app_1       | 2026/02/10 13:39:51 [Shard 1][Quiz 35] BroadcastToQuiz called. Message type: quiz:results_available
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35] BroadcastToQuiz called. Message type: quiz:results_available
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35][Range] Iterating over client: User 1, Conn 8e6402be-5c91-4217-8599-17cab0ca556a
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Attempting to queue message type: quiz:results_available
app_1       | 2026/02/10 13:39:51 [Shard 0][Quiz 35][User 1][Conn 8e6402be-5c91-4217-8599-17cab0ca556a] Successfully queued message type: quiz:results_available. Buffer len: 0
app_1       | 2026/02/10 13:39:51 Shard 0: Message broadcast to 1 clients in Quiz 35
app_1       | 2026/02/10 13:39:51 [Shard 2][Quiz 35] BroadcastToQuiz called. Message type: quiz:results_available
app_1       | 2026/02/10 13:39:51 ShardedHub: Finished broadcasting to Quiz 35
app_1       | 2026/02/10 13:39:51 [ResultService] Событие quiz:results_available для викторины #35 успешно отправлено
app_1       | 2026/02/10 13:39:51 [ResultService] Финализация результатов для викторины #35 успешно завершена.
app_1       | 2026/02/10 13:39:52 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 
app_1       | 2026/02/10 13:39:52 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.220ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-10 13:39:52.418') OR (is_active = false AND rotated_at > '2026-02-03 13:39:52.418' AND expires_at > '2026-02-10 13:39:52.418') ORDER BY created_at DESC
app_1       | 
app_1       | 2026/02/10 13:39:52 /app/internal/repository/postgres/user_repo.go:33
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:39:52 +0000] "GET /api/users/me HTTP/2.0" 200 287 "https://qazaquiz.duckdns.org/quiz/35/play" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | [3.289ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/10 - 13:39:52 | 200 |    5.220362ms |      172.18.0.6 | GET      "/api/users/me"
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:39:52 +0000] "GET /quiz/35/results?_rsc=oy96r HTTP/2.0" 200 1219 "https://qazaquiz.duckdns.org/quiz/35/play" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 
app_1       | 2026/02/10 13:39:52 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.067ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-10 13:39:52.55') OR (is_active = false AND rotated_at > '2026-02-03 13:39:52.55' AND expires_at > '2026-02-10 13:39:52.55') ORDER BY created_at DESC
app_1       | 2026/02/10 13:39:52 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:39:52 +0000] "GET /api/users/me HTTP/2.0" 200 287 "https://qazaquiz.duckdns.org/quiz/35/play" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 
app_1       | 2026/02/10 13:39:52 /app/internal/repository/postgres/user_repo.go:33
app_1       | [0.685ms] [rows:1] SELECT * FROM "users" WHERE "users"."id" = 1 ORDER BY "users"."id" LIMIT 1
app_1       | [GIN] 2026/02/10 - 13:39:52 | 200 |    2.265841ms |      172.18.0.6 | GET      "/api/users/me"
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:39:52 +0000] "GET /api/quizzes/35 HTTP/2.0" 200 344 "https://qazaquiz.duckdns.org/quiz/35/results" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:39:52 +0000] "GET /api/quizzes/35/results?page=1&page_size=20 HTTP/2.0" 200 329 "https://qazaquiz.duckdns.org/quiz/35/results" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 
app_1       | 2026/02/10 13:39:52 /app/internal/repository/postgres/quiz_repo.go:32
app_1       | [0.803ms] [rows:1] SELECT * FROM "quizzes" WHERE "quizzes"."id" = 35 ORDER BY "quizzes"."id" LIMIT 1
app_1       | [GIN] 2026/02/10 - 13:39:52 | 200 |    1.064522ms |      172.18.0.6 | GET      "/api/quizzes/35"
app_1       | 
app_1       | 2026/02/10 13:39:52 /app/internal/repository/postgres/result_repo.go:60
app_1       | [1.458ms] [rows:1] SELECT count(*) FROM "results" WHERE quiz_id = 35
app_1       | 
app_1       | 2026/02/10 13:39:52 /app/internal/repository/postgres/result_repo.go:72
app_1       | [1.649ms] [rows:1] SELECT * FROM "results" WHERE quiz_id = 35 ORDER BY rank ASC, score DESC LIMIT 20
app_1       | [GIN] 2026/02/10 - 13:39:52 | 200 |    4.635736ms |      172.18.0.6 | GET      "/api/quizzes/35/results?page=1&page_size=20"
app_1       | 2026/02/10 13:39:52 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
app_1       | 2026/02/10 13:39:52 [TokenManager] Successfully retrieved CSRF secret cookie '__Host-csrf-secret'
app_1       | 
app_1       | 2026/02/10 13:39:52 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [1.007ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-10 13:39:52.688') OR (is_active = false AND rotated_at > '2026-02-03 13:39:52.688' AND expires_at > '2026-02-10 13:39:52.688') ORDER BY created_at DESC
app_1       | [GIN] 2026/02/10 - 13:39:52 | 200 |    1.403537ms |      172.18.0.6 | GET      "/api/auth/csrf"
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:39:52 +0000] "GET /api/auth/csrf HTTP/2.0" 200 81 "https://qazaquiz.duckdns.org/quiz/35/results" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 
app_1       | 2026/02/10 13:39:52 /app/internal/repository/postgres/jwt_key_repo.go:131
app_1       | [0.848ms] [rows:1] SELECT * FROM "jwt_keys" WHERE (is_active = true AND expires_at > '2026-02-10 13:39:52.764') OR (is_active = false AND rotated_at > '2026-02-03 13:39:52.764' AND expires_at > '2026-02-10 13:39:52.764') ORDER BY created_at DESC
app_1       | 
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:39:52 +0000] "GET /api/quizzes/35/my-result HTTP/2.0" 200 282 "https://qazaquiz.duckdns.org/quiz/35/results" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/10 13:39:52 /app/internal/repository/postgres/result_repo.go:103
app_1       | [1.631ms] [rows:1] SELECT * FROM "results" WHERE user_id = 1 AND quiz_id = 35 ORDER BY "results"."id" LIMIT 1
app_1       | [GIN] 2026/02/10 - 13:39:52 | 200 |    3.610198ms |      172.18.0.6 | GET      "/api/quizzes/35/my-result"
app_1       | 2026/02/10 13:39:52 [JWT] Токен успешно проверен для пользователя ID=1, Email=temirlan@mail.ru, выдан: 2026-02-09 17:47:03 +0000 UTC
nginx_1     | 185.229.121.163 - - [10/Feb/2026:13:39:53 +0000] "GET /quiz/35/results?_rsc=w3fo7 HTTP/2.0" 200 1110 "https://qazaquiz.duckdns.org/quiz/35/results" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" "-"
app_1       | 2026/02/10 13:40:36 RedisPubSub: Published message to channel 'ws:metrics' (Subscribers: 1)
